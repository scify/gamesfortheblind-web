FD50.installer("EasyBlog","definitions",function(a){a.module(["easyblog/easyblog","easyblog/layout/template","easyblog/layout/responsive","easyblog/layout/dialog","easyblog/layout/elements","easyblog/layout/launcher","easyblog/layout/placeholder","easyblog/layout/image/popup","easyblog/layout/image/gallery","easyblog/layout/image/legacy","easyblog/subscribe","easyblog/composer/document/artboard","easyblog/composer/blocks/dimensions","easyblog/composer/blocks/droppable","easyblog/composer/blocks/font","easyblog/composer/blocks/guide","easyblog/composer/blocks/handlers/audio","easyblog/composer/blocks/handlers/behance","easyblog/composer/blocks/handlers/buttons","easyblog/composer/blocks/handlers/code","easyblog/composer/blocks/handlers/codepen","easyblog/composer/blocks/handlers/columns","easyblog/composer/blocks/handlers/compare","easyblog/composer/blocks/handlers/file","easyblog/composer/blocks/handlers/gist","easyblog/composer/blocks/handlers/heading","easyblog/composer/blocks/handlers/html","easyblog/composer/blocks/handlers/image","easyblog/composer/blocks/handlers/instagram","easyblog/composer/blocks/handlers/links","easyblog/composer/blocks/handlers/list","easyblog/composer/blocks/handlers/note","easyblog/composer/blocks/handlers/post","easyblog/composer/blocks/handlers/quotes","easyblog/composer/blocks/handlers/readmore","easyblog/composer/blocks/handlers/rule","easyblog/composer/blocks/handlers/slideshare","easyblog/composer/blocks/handlers/soundcloud","easyblog/composer/blocks/handlers/spotify","easyblog/composer/blocks/handlers/table","easyblog/composer/blocks/handlers/tabs","easyblog/composer/blocks/handlers/text","easyblog/composer/blocks/handlers/tweet","easyblog/composer/blocks/handlers/video","easyblog/composer/blocks/mobile","easyblog/composer/blocks/nestable","easyblog/composer/blocks/panel","easyblog/composer/blocks/removal","easyblog/composer/blocks/resizable","easyblog/composer/blocks/scrollable","easyblog/composer/blocks/search","easyblog/composer/blocks/text","easyblog/composer/blocks/tree","easyblog/composer/blocks","easyblog/composer/blocks/media","easyblog/composer/blocks/toolbar","easyblog/","easyblog/composer/blogimage","easyblog/composer/category","easyblog/composer/datetime","easyblog/composer/debugger","easyblog/composer/document/overlay","easyblog/composer/document","easyblog/composer/document/toolbar","easyblog/composer/redactor10","easyblog/composer/location","easyblog/composer/manager","easyblog/composer/media","easyblog/mediamanager","easyblog/mediamanager/uploader","easyblog/composer/panels/authorship","easyblog/composer/panels/autopost","easyblog/composer/panels/fields","easyblog/composer/panels/post","easyblog/composer/panels/seo","easyblog/composer/panels","easyblog/composer/posts","easyblog/composer/redactor","easyblog/composer/tags","easyblog/composer/templates","easyblog/composer","easyblog/composer/revisions","easyblog/composer/panels/category","easyblog/layout/image/caption","easyblog/mediamanager/audio","easyblog/mediamanager/image","easyblog/mediamanager/video"]),a.require.template.loader(["easyblog/site/composer/primary.category.item"])
}),FD50.installer("EasyBlog","scripts",function($){EasyBlog.require().library("ui/position").script("layout/template","layout/responsive","layout/dialog","layout/elements","layout/launcher","layout/placeholder","layout/image/popup","layout/image/gallery","layout/image/legacy","subscribe").done(),EasyBlog.module("layout/template",function(a){var b=this,c=EasyBlog.template=function(b){if(b){if(c.cache.hasOwnProperty(b))return c.cache[b];var d='.eb-template[data-name="'+b+'"]',e=a.trim(a(d).detach().html());return e&&(c.cache[b]=e),e
}};c.cache={},b.resolve()}),EasyBlog.module("layout/responsive",function(a){var b=this;a(function(){a.responsive(".eb-responsive",[{at:1200,switchTo:"wide"},{at:960,switchTo:"wide w960"},{at:818,switchTo:"wide w960 w768"},{at:600,switchTo:"wide w960 w768 w600"},{at:560,switchTo:"wide w960 w768 w600 w480"},{at:480,switchTo:"wide w960 w768 w600 w480 w320"}])});var c="#fd.eb [data-responsive]",d=function(){a(c).each(function(){for(var e,b=a(this),c=b.outerWidth(),d=b.data("responsive").split(","),f=[],g=[];e=d.shift();)(e>=c?g:f).push("w"+e);
b.removeClass(f.join(" ")).addClass(g.join(" "))})};a(document).ready(d),a(window).on("load.responsive",d).on("resize.responsive_",a.debounce(d,350)),b.resolve()}),EasyBlog.module("layout/dialog",function($){var module=this,dialogHtml='<div id="fd" class="eb eb-dialog has-footer"><div class="eb-dialog-modal"><div class="eb-dialog-header"><div class="row-table"><div class="col-cell cell-ellipse"><span class="eb-dialog-title"></span></div><div class="col-cell cell-tight eb-dialog-close-button"><i class="fa fa-close"></i></div></div></div><div class="eb-dialog-body"><div class="eb-dialog-container"><div class="eb-dialog-content"></div><div class="eb-hint hint-loading layout-overlay style-gray size-sm"><div><i class="eb-hint-icon"><span class="eb-loader-o size-lg"></span></i></div></div><div class="eb-hint hint-failed layout-overlay style-gray size-sm"><div><i class="eb-hint-icon fa fa-warning"></i><span class="eb-hint-text"><span class="eb-dialog-error-message"></span></span></div></div></div></div><div class="eb-dialog-footer"><div class="row-table"><div class="col-cell eb-dialog-footer-content"></div></div></div></div></div>',dialog_=".eb-dialog",dialogModal_=".eb-dialog-modal",dialogContent_=".eb-dialog-content",dialogHeader_=".eb-dialog-header",dialogFooter_=".eb-dialog-footer",dialogFooterContent_=".eb-dialog-footer-content",dialogCloseButton_=".eb-dialog-close-button",dialogTitle_=".eb-dialog-title",dialogErrorMessage_=".eb-dialog-error-message",isFailed="is-failed",isLoading="is-loading",rxBraces=/\{|\}/gi,self=EasyBlog.dialog=function(a){if(void 0===a)return self;
$.isString(a)&&(a={content:a});var b=self.open;return window.parentEasyBlogDialog&&(b=window.parentEasyBlogDialog.open),b.apply(self,[a]),self};$.extend(self,{defaultOptions:{title:"",content:"",buttons:"",classname:"",width:"auto",height:"auto",escapeKey:!0},open:function(a){var b=$(dialog_);b.length<1&&(b=$(dialogHtml).appendTo("body"));var a=$.extend({},self.defaultOptions,a),c=$(dialogTitle_);c.text(a.title);var d=$(dialogFooterContent_);d.html(a.buttons),b.toggleClass("has-footer",!!a.buttons),self.setBindings(a);
var e=$(dialogContent_).empty(),f=a.content,g=self.getContentType(f);b.switchClass("type-"+g);var h=$(dialogModal_),i=a.width,j=a.height;if($.isNumeric(j)){var k=$(dialogHeader_),l=$(dialogFooter_);j+=k.height()+l.height()}switch(h.css({width:i,height:j}),b.addClassAfter("active"),g){case"html":e.html(f);break;case"iframe":var m=$("<iframe>"),n=f;m.appendTo(e).one("load",function(){try{m[0].contentWindow.parentEasyBlogDialog=self}catch(a){}}).attr("src",n);break;case"deferred":return b.switchClass(isLoading),f.done(function(c){$.isPlainObject(c)?self.reopen($.extend(!0,a,c)):$.isString(c)?(a.content=c,self.reopen(a)):b.switchClass(isFailed)
}).fail(function(a){b.switchClass(isFailed);var c=$(dialogErrorMessage_);$.isString(a)&&c.html(a),$.isPlainObject(a)&&a.message&&c.html(a.message)}),void 0;case"dialog":var o=self.parseXMLOptions(f);return self.open($.extend(!0,a,o)),void 0}},reopen:function(a){self.close(),self.open(a)},close:function(){self.unsetBindings();var a=$(dialog_);a.remove()},getContentType:function(a){return/<dialog>(.*?)/.test(a)?"dialog":$.isUrl(a)?"iframe":$.isDeferred(a)?"deferred":"html"},parseXMLOptions:function(xml){var xmlOptions=$.buildHTML(xml),newOptions={};
return $.each(xmlOptions.children(),function(i,node){var node=$(node),key=$.String.camelize(this.nodeName.toLowerCase()),val=node.html(),type=node.attr("type");switch(type){case"json":try{val=$.parseJSON(val)}catch(e){}break;case"javascript":try{val=eval("(function($){ return "+$.trim(val)+" })("+$.globalNamespace+")")}catch(e){}break;case"text":val=node.text()}$.isNumeric(val)&&(val=parseFloat(val)),newOptions[key]=val}),newOptions},bindings:{},setBindings:function(a){self.unsetBindings();var b=a.selectors,c=a.bindings;
if(b&&c){var d={parent:self},e=$(dialog_);$.each(b,function(a,b){var a=a.replace(rxBraces,""),c=d[a]=function(){return e.find(b)};c.selector=b}),$.each(c,function(a,b){var c=a.split(" "),f=c[0].replace(rxBraces,""),g=c[1]+".eb.dialog",h=d[f];if(h){var i=h.selector;e.on(g,i,function(){b.apply(d,[this].concat(arguments))}),self.bindings[g]=b}})}a.escapeKey&&$(document).on("keydown.eb.dialog",function(a){27==a.keyCode&&self.close()})},unsetBindings:function(){var a=$(dialog_);$.each(self.bindings,function(b){a.off(b)
}),$(document).off("keydown.eb.dialog")}}),$(document).on("click",dialogCloseButton_,function(){self.close()}).on("click",dialog_,function(a){var b=$(dialog_);a.target==b[0]&&self.close()}),module.resolve()}),EasyBlog.module("layout/elements",function(a){var b=this;a(document).on("click.button.data-bp-api","[data-bp-toggle-value]",function(){var b=a(this),d=(b.siblings("[data-bp-toggle-value]"),b.parents('[data-bp-toggle="radio-buttons"]'));if(!d.hasClass("disabled")&&d.length>0){var e=b.data("bp-toggle-value");
return d.find("input[type=hidden]").val(e).trigger("change"),void 0}}),a(document).on("change.data-bp-input",'[data-bp-toggle="radio-buttons"] input[type=hidden]',function(){{var b=a(this),c=b.siblings("[data-bp-toggle-value]");b.val()}c.removeClass("active").filter('[data-bp-toggle-value="'+b.val()+'"]').addClass("active")}),a(document).on("mouseover.tooltip.data-eb-api","[data-eb-provide=tooltip]",function(){a(this).tooltip({delay:{show:200,hide:100},animation:!1,template:'<div id="fd" class="eb tooltip tooltip-eb"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',container:"body"}).tooltip("show")
}),a(document).on("mouseover.popover.data-eb-api","[data-eb-provide=popover]",function(){a(this).popover({delay:{show:200,hide:100},animation:!1,trigger:"hover",container:"body"}).popover("show")});var c=function(a){return a%400?a%100?a%4?!1:!0:!1:!0};a(document).on("keyup","[data-date-form] [data-date-day]",function(){if(a.trim(a(this).val())){var b=parseInt(a(this).siblings("[data-date-year]").val()||a(this).siblings("[data-date-year]").data("dateDefault")),d=parseInt(a(this).siblings("[data-date-month]").val()||a(this).siblings("[data-date-month]").data("dateDefault")),e=parseInt(a(this).val()||a(this).data("dateDefault")),f=/1|3|5|7|8|10|12/.test(d)?31:30;
2==d&&(f=c(b)?29:28),1>e&&(e=1),e>f&&(e=f),a.isNumeric(e)?a(this).val(e):a(this).val("")}}),a(document).on("keyup","[data-date-form] [data-date-year]",function(){if(a.trim(a(this).val())){var b=parseInt(a(this).val());1>b&&(b=1),a.isNumeric(b)?a(this).val(b):a(this).val("")}}),a.fn.listbox=function(b){var c=this;if(a.isPlainObject(b)||void 0===b)return c.each(function(){var c=a(this),e=d.get(c);e?e.update(b):e=new d(c,b)}),this;if(a.isString(b)){var h,e=a(this[0]),f=d.get(e)||new d(e),g=f[b];return a.isFunction(g)&&(h=g.apply(f,a.makeArray(arguments).slice(1))),h||this
}return this},a.fn.listboxitem=function(b){var c=this;if(void 0===b)return c.each(function(){var b=a(this);d.Item.init(b)}),this;if(a.isString(b)){var e=a(this[0]);d.Item.init(e);var h,f=e.data("listboxitem"),g=f[b];return a.isFunction(g)&&(h=g.apply(f,a.makeArray(arguments).slice(1))),h||this}return this};var d=function(b,c,e){var f=this,g={};f.container=b,b.data("listbox",f),a.each(d.defaultOptions,function(a){var d=b.attr("data-listbox-"+a);void 0!==d&&(g[a]=isNaN(parseInt(d))?d:parseInt(d))}),e&&f.extend(e),f.update(a.extend(!0,{},d.defaultOptions,g,c)),f.init()
};d.defaultOptions={toggleDefault:!0,sortable:!0,allowAdd:!0,allowRemove:!0,max:0,min:1,customHTML:"",itemTitle:"Title"},d.get=function(b){var c=a(b).data("listbox");return c instanceof d?c:void 0},a.extend(d.prototype,{options:{},addButton:function(){return this.container.find("[data-listbox-button-add]")},update:function(b){var c=this;a.extend(!0,c.options,b)},extend:function(b){a.each(b,function(b,c){a.isFunction(c)&&(d.prototype[b]=c)})},getItems:function(a){var c=this.container.find("[data-listbox-item]");
return a&&(c=c.filter(a)),d.Item.init(c),c},getParentItem:function(b){var c=a(b).closest("[data-listbox-item]");return d.Item.init(c),c},init:function(){var a=this,b=a.container,c=b.find("[data-listbox-custom-html]");a.options.customHTML=c.html(),c.remove(),a.options.toggleDefault&&b.on("click.listbox.toggleDefault","[data-listbox-button-default]",function(){return a.toggleDefault(this)}),a.options.allowAdd&&b.on("click.listbox.addItem","[data-listbox-button-add]",function(){return a.add(this)}),a.options.allowRemove&&b.on("click.listbox.removeItem","[data-listbox-button-remove]",function(){return a.remove(this)
}),a.options.sortable&&this.initSortable(),!a.options.customHTML&&this.getItems().find("[data-listbox-item-content]").editable(!0)},initSortable:function(){},toggleDefault:function(a){var b=this.getItems(),c=this.getParentItem(a);0!=c.length&&(this.container.trigger("listboxBeforeToggleDefault",[c]),c&&(b.removeClass("is-default"),c.addClass("is-default"),this.container.trigger("listboxAfterToggleDefault",[c])))},isDefault:function(a){return a.hasClass("is-default")},add:function(){var a=this.getItems();if(!(this.options.max>0&&a.length>=this.options.max)){var b=d.Item.newItem(this.options);
this.container.trigger("listboxBeforeAddItem",[b]),b&&(this.addButton().before(b),this.container.trigger("listboxAfterAddItem",[b]),0==this.getItems(".is-default").length&&this.toggleDefault(this.getItems(":first")))}},remove:function(a){var b=this.getItems();if(!(this.options.min>0&&b.length<=this.options.min)){var c=this.getParentItem(a);this.container.trigger("listboxBeforeRemoveItem",[c]),c&&(c.remove(),this.container.trigger("listboxAfterRemoveItem",[c]),this.isDefault(c)&&this.toggleDefault(this.getItems(":first")))
}},populate:function(b,c){var e=this;e.getItems().remove(),a.each(b,function(b,f){var g=d.Item.newItem(e.options);a.isFunction(c)&&c(g,f.content),f.default&&g.addClass("is-default"),e.container.trigger("listboxBeforePopulateItem",[f]),e.addButton().before(g),e.container.trigger("listboxAfterPopulateItem",[f])})},toData:function(){var b=[];return a.each(this.getItems(),function(c,d){b.push(a(d).listboxitem("toData"))}),b}}),d.Item=function(a){this.item=a,this.parent=a.parents("[data-listbox]").data("listbox")
},d.Item.get=function(b){var c=a(b).data("listboxitem");return c instanceof d.Item?c:void 0},d.Item.init=function(b){return b=a(b),a.each(b,function(b,c){c=a(c),d.Item.get(c)||c.data("listboxitem",new d.Item(c))}),b},d.Item.newItem=function(b){var c=a("<div></div>",{"data-listbox-item":"","class":"eb-composer-manage-tab row-table"}),e=a("<div></div>",{"class":"col-cell eb-composer-manage-tab-handler"});b.sortable&&e.append('<i class="fa fa-bars"></i>'),b.toggleDefault&&e.append(' <i class="fa fa-star" data-listbox-button-default></i>'),c.append(e);
var f=a("<div></div>",{"data-listbox-item-content":"","class":"col-cell eb-composer-manage-tab-name"}).html(b.customHTML?a.buildHTML(b.customHTML):b.itemTitle);return!b.customHTML&&f.editable(!0),c.append(f),b.allowRemove&&c.append(a("<div></div>",{"data-listbox-button-remove":"","class":"col-cell eb-composer-manage-tab-remove"}).html("&times;")),d.Item.init(c),c},a.extend(d.Item.prototype,{isDefault:function(){return this.item.hasClass("is-default")},content:function(a){var b=this.item.find("[data-listbox-item-content]");
return void 0!==a?(b.html(a),this):b.html()},remove:function(){this.parent.remove(this.item)},setDefault:function(){this.parent.toggleDefault(this.item)},toData:function(){var a=this;return{"default":a.isDefault()?1:0,content:a.content()}}}),EasyBlog.UI=function(b){var c=b.document;a(c).on("click.ebtabs",".eb-tabs-menu-item",function(){var b=a(this),c=b.closest(".eb-tabs"),d=c.find("> .eb-tabs-menu"),e=d.find("> .eb-tabs-menu-item"),f=c.find("> .eb-tabs-content"),g=f.find("> .eb-tabs-content-item");"toggle"==c.data("eb-tabs-mode")&&b.hasClass("active")?(e.removeClass("active"),g.removeClass("active")):(e.removeClass("active"),b.addClass("active"),g.removeClass("active").where("id",b.data("id")).addClass("active")),c[g.filter(".active").length>0?"addClassAfter":"removeClassAfter"]("is-open",1)
})},EasyBlog.UI(window),b.resolve()}),EasyBlog.module("layout/launcher",function(a){var b=this,c='<div id="fd" class="eb eb-composer-launcher is-loading" data-eb-composer-launcher><div class="eb-composer-launcher-header"><div class="eb-composer-launcher-close-button" data-eb-composer-launcher-close-button><i class="fa fa-close"></i></div></div><div class="eb-composer-launcher-container" data-eb-composer-launcher-container><div class="eb-loader-o size-lg"></div></div></div>',d='<iframe class="eb-composer-launcher-instance" data-eb-composer-launcher-instance />',e="[data-eb-composer-launcher]",f="[data-eb-composer]",g="[data-eb-composer-launcher-close-button]",h="[data-eb-composer-launcher-container]",j=EasyBlog.ComposerLauncher={open:function(b){j.close(),a("body").noscroll(!0);
{var e=a(c),f=e.find(h);a(d).attr("src",b).one("load",j.ready).appendTo(f)}e.appendTo("body").addClassAfter("active")},close:function(){a(e).remove(),a("body").noscroll(!1)},ready:function(){a(e).removeClass("is-loading")},redirect:function(a){parent.window.location=a}};a(document).on("composerSaveError",function(){}),a(document).on("composerSaveSuccess",function(){}),a(document).on("click",f,function(b){if(!(b.shiftKey||b.ctrlKey||b.metaKey||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))){var c=a(this),d=c.attr("href");
j.open(d),b.preventDefault()}}).on("click",g,function(){EasyBlog.dialog({content:EasyBlog.ajax("site/views/composer/confirmClose"),bindings:{"{cancelButton} click":function(){EasyBlog.dialog.close()},"{closeButton} click":function(){EasyBlog.dialog.close(),j.close()}}})}),b.resolve()}),EasyBlog.module("layout/placeholder",function(a){var b=this;if(a.IE<=9){var c="textarea[placeholder]:not(.placeholder), :input[placeholder]:not(.placeholder)";EasyBlog.require().library("placeholder").done(function(){EasyBlog.fixPlaceholder=function(){a(c).placeholder()
},a(EasyBlog.fixPlaceholder),a(document).on("mouseover",c,function(){a(this).placeholder()})})}b.resolve()}),EasyBlog.module("layout/image/popup",function(a){var b=this,c=EasyBlog.template("site/layout/image/popup"),d=EasyBlog.template("site/layout/image/popup/thumb"),e=EasyBlog.template("site/layout/image/container"),f=".eb-image-popup",g=".eb-image-popup-button",h=".eb-image-popup-close-button",i=".eb-image-popup-container",j=".eb-image-popup-footer",k=".eb-image-popup-thumbs",l=".eb-image-popup-thumb",m=".eb-image",n=".eb-image-viewport",o=".eb-image-caption > span",p=".eb-thumbs",q="keyup.eb.imagepopup",r="click.eb.imagepopup",s="resize.eb.imagepopup",t="keydown.eb.imagepopup",u=EasyBlog.ImagePopup={open:function(){u.close(),a("body").noscroll(!0),a(window).off(q).on(q,function(a){27==a.which&&u.close()
}).off(r).on(r,function(b){var c=a(b.target).parentsUntil(f).andSelf().filter(m);c.length||u.close()}).off(s).on(s,function(){u.refresh()}).off(t).on(t,function(b){if(a(l).length){var c=b.which;if(/37|38|39|40/.test(c)){var e,d=a(l+".active");/37|38/.test(c)&&(e=d.prev(l)),/39|40/.test(c)&&(e=d.next(l)),e.length&&u.openPopupThumb(e),b.preventDefault()}}});var b=a(c);b.appendTo("body")},close:function(){a(window).off(q).off(r).off(s).off(t),a(f).data("destoyed",!0).remove(),a("body").noscroll(!1)},openThumbnails:function(b,c){u.open();
var i,e=a(j),f=a(k),h=0;e.show(),b.find(m).each(function(){var b=a(this),e=b.find("img"),j=b.find(g),k=e.attr("src"),l=j.attr("href"),m=a(d).attr("data-url",l).find("img").attr("src",k).end().appendTo(f);h+=m.outerWidth(!0),b[0]==c[0]&&(i=m)}),f.css("width",h),u.openPopupThumb(i)},openImage:function(a){u.open();var b=a.find(o),c=a.find(g),d=c.attr("href"),e=b.text();e||(e=c.attr("title")),u.showImage(d,e)},openPopupThumb:function(b){var c=b.attr("data-url");a(l).removeClass("active"),b.addClass("active"),u.showImage(c,""),u._reposition()
},showImage:function(b,c){var d=a(f),g=d.find(i);d.addClass("is-loading"),d.find(m).remove();var h=a(e),j=h.find(n),k=h.find(o);k.text(c).css("display",c?"block":"none"),h.addClass("style-popup").appendTo(g);var l=a("<img>");l.on("load",function(){d.data("destroyed")||(d.removeClass("is-loading").addClass("is-preparing"),u.resize(),d.removeClassAfter("is-preparing"))}).on("error",function(){d.removeClass("is-loading").addClass("is-failed")}).appendTo(j).attr("src",b)},refresh:function(){u.resize(),u.reposition()
},resize:function(){var b=a(f),c=a(j),d=b.find(m),e=d.find("img"),g=c.height(),h=e.width(),i=e.height(),k=b.width(),l=b.height(),n=.75*k,o=.75*l-g,p=n/h;targetWidth=h*p,targetHeight=i*p;var q=targetHeight>o;q&&(p=o/i,targetWidth=h*p,targetHeight=i*p),e.css({width:targetWidth,height:targetHeight});var r=d.width(),s=d.height()-g;d.css({top:(l-s)/2-g,left:(k-r)/2})},reposition:function(){var b=a(j),c=a(k),d=a(l+".active"),e=b.width()/2,f=d.position().left+d.width()/2,g=e-f;c.css("left",g)},_reposition:a.debounce(function(){u.reposition()
},350)};a(document).on("click",n,function(){var c=a(this),d=c.attr("href");"javascript:void(0)"===d&&c.siblings(g).click()}).on("click",g,function(b){if(!(b.shiftKey||b.ctrlKey||b.metaKey)){var c=a(this),d=c.closest(m),e=d.closest(p);e.length?u.openThumbnails(e,d):u.openImage(d),b.stopPropagation(),b.preventDefault()}}).on("click",n,function(b){var c=a(this);if(!c.attr("href")){var d=c.closest(m),e=d.find(g);e.length&&(e.click(),b.stopPropagation(),b.preventDefault())}}).on("click",l,function(b){var c=a(this);
u.openPopupThumb(c),b.stopPropagation(),b.preventDefault()}).on("click",h,function(){u.close()}),b.resolve()}),EasyBlog.module("layout/image/gallery",function(a){var b=this,c=".eb-gallery",d=".eb-gallery-viewport",e=".eb-gallery-item",g=".eb-gallery-next-button",i=".eb-gallery-button",k=".eb-gallery-menu-item",l=EasyBlog.ImageGallery={setLayout:function(b){var c=b.find(e);c.each(function(b){var c=a(this),d=100*b;c.css("left",d+"%")});var d=b.data("autoplay");d&&this.autoplay.start(b)},autoplay:{start:function(a){var b=1e3*a.data("interval");
l.autoplay.stop(a);var c=setTimeout(function(){l.next(a),l.autoplay.start(a)},b);a.data("timer",c)},stop:function(a){var b=a.data("timer");clearTimeout(b)}},checkAutoplay:function(a){var b=1e3*a.data("interval");this.stopMonitoringAutoplay(a),setTimeout(function(){l.next(a),l.startMonitoringAutoplay(a)},b)},go:function(a,b){var c=l.getMenuItems(a).length-1;0>b&&(b=c),b>c&&(b=0),l.setActiveIndex(a,b);var e=a.find(d),f=-100*b;e.css("left",f+"%")},next:function(a){var b=l.getActiveIndex(a),c=b+1;l.go(a,c)},prev:function(a){var b=l.getActiveIndex(a),c=b-1;
l.go(a,c)},setActiveIndex:function(a,b){var c=l.getMenuItems(a);c.removeClass("active").eq(b).addClass("active")},getActiveIndex:function(a){var b=l.getMenuItems(a),c=b.filter(".active").index();return 0>c&&(c=0),c},getMenuItems:function(a){return a.find(k)}};a(document).on("click.eb.gallery.button",i,function(){var d=a(this),e=d.closest(c);if(!(e.length<1)){var f=d.is(g)?"next":"prev";l[f](e)}}).on("click.eb.gallery.menuItem",k,function(){var d=a(this),e=d.closest(c);if(!(e.length<1)){var f=e.find(k).index(d);
l.go(e,f)}}).ready(function(){a(c).each(function(){var b=a(this);l.setLayout(b)})}),b.resolve()}),EasyBlog.module("layout/image/legacy",function(a){function c(a){var b=a.parent(),c=b.css("float");if("none"==c&&(c=a.css("float")),"none"==c){var d=a[0].style;"auto"==d.marginLeft&&"auto"==d.marginRight&&(c="center")}return"none"==c&&(c=b.attr("align"),(void 0===c||"none"==c)&&(c=a.attr("align"))),/none|middle/.test(c)&&(c="center"),c}var b=this,d=".easyblog-thumb-preview img, img.easyblog-image-caption, img[data-popup], img[data-style]";
a(document).ready(function(){a(d).each(function(){var b=a(this),d=b.parent(),e=b.attr("src"),f=a('<div class="eb-image">'),g=a('<div class="eb-image-figure">');g.appendTo(f);var h=a('<a class="eb-image-viewport"><img /></a>');h.appendTo(g);{var i=d.is(".easyblog-thumb-preview"),j=!!b.attr("data-popup"),k=i||j;d.is("a:not(.easyblog-thumb-preview)")}if(k){var m=i?d.attr("href"):b.attr("data-popup");h.addClass("eb-image-popup-button").attr({href:m,title:d.attr("title")})}else h.attr({href:d.attr("href"),title:d.attr("title"),target:d.attr("target")});
var n=f.find("img");n.attr({src:e,width:b.attr("width"),height:b.attr("height"),alt:b.attr("alt")});var o=b.is(".easyblog-image-caption");if(o){var p=a('<div class="eb-image-caption"><span></span></div>'),q=b.attr("title");p.appendTo(f).find("span").append(q);var r=b.attr("width");r?p.css("width",r):(p.hide(),n.on("load",function(){p.css("width",n.width()).show()}))}var s=b.attr("data-style")||(o?"gray":"");s&&f.addClass("style-"+s);var t=c(b),u=a('<div class="ebd-block" data-type="image">');/left|right/.test(t)&&u.addClass("is-nested nest-"+t).css("width","auto"),/center/.test(t)&&u.css("text-align","center"),u.append(f),k&&!j?d.replaceWith(u):b.replaceWith(u)
})}),b.resolve()}),EasyBlog.module("subscribe",function(a){var b=this;a(document).on("click.eb.subscribe","[data-blog-subscribe]",function(){var b=a(this).data("type"),c=a(this).data("id");EasyBlog.dialog({content:EasyBlog.ajax("site/views/subscription/form",{type:b,id:c})})}),a(document).on("click.eb.unsubscribe","[data-blog-unsubscribe]",function(){var b=a(this).data("subscription-id"),c=a(this).data("return");console.log(b,c),EasyBlog.dialog({content:EasyBlog.ajax("site/views/subscription/confirmUnsubscribe",{id:b,"return":c}),bindings:{"{submitButton} click":function(){this.form().submit()
}}})}),b.resolve()}),EasyBlog.module("composer/document/artboard",function(){var b=this;EasyBlog.Controller("Composer.Document.Artboard",{defaultOptions:{"{container}":".eb-composer-artboard","{viewport}":".eb-composer-artboard-viewport","{art}":"[data-eb-composer-art]","{metaButton}":"[data-eb-composer-meta-button]"}},function(a){return{init:function(){},current:function(){return a.art(".active").data("id")},show:function(b){var b=b||a.current();a.container().switchClass("show-"+b).switchClass("state-expand").addClassAfter("active",1),a.art().removeClass("active").where("id",b).addClass("active"),a.metaButton().removeClass("active").where("id",b).addClass("active"),a.trigger("composerArtboardShow",[b])
},hide:function(b){var b=b||a.current();a.container().toggleClass("active",!!a.art(".has-image").length).switchClass("state-collapse"),a.art().removeClass("active"),a.metaButton().removeClass("active"),a.trigger("composerArtboardHide",[b])},"{metaButton} click":function(b){var c=b.data("id");a[a.current()===c?"hide":"show"](c)}}}),b.resolve()}),EasyBlog.module("composer/blocks/dimensions",function(a){var b=this,c=function(a){return a.toString().match("%")?"%":"px"};EasyBlog.require().library("nouislider").done(function(){EasyBlog.Controller("Composer.Blocks.Dimensions",{elements:["[data-eb-block-dimensions-{field}]","[data-eb-block-dimensions-field-container] [data-eb-{numslider-toggle|numslider-widget|numslider-value|numslider-input|numslider-units|numslider-unit|numslider-current-unit}]"],defaultOptions:a.extend({},EBD.selectors)},function(b,d,e,f,g,h){return{init:function(){g=b.blocks,f=g.composer,h=a()
},"{self} composerBlockActivate":function(a,c,d){h=d,b.populate(d)},isResizableNestedBlock:function(a){return g.isNestedBlock(a)?"content"==g.getBlockNestType(a):!1},allowDimensionsFieldset:function(a){return b.isResizableNestedBlock(a)&&b.getDimensionsSettings(a).enabled},getDimensionsSettings:function(a){return g.getBlockMeta(a).dimensions},getDimensionsFieldset:function(){return f.panels.fieldset.get("dimensions")},shouldRespectMinContentSize:function(a){return b.isResizableNestedBlock(a)&&b.getDimensionsSettings(a).respectMinContentSize
},isInherited:function(a){return!a||/auto|inherit/.test(a)},hasInheritedSize:function(a,c){var d=a[0].style[c];return b.isInherited(d)},hasInheritedWidth:function(a){return b.hasInheritedSize(a,"width")},hasInheritedHeight:function(a){return b.hasInheritedSize(a,"height")},getSize:function(a,c){var d=a[0].style[c];return b.isInherited(d)?a.css(c):d},getWidth:function(a){return b.getSize(a,"width")},getHeight:function(a){return b.getSize(a,"height")},getComputedWidth:function(a){return a.width()},getComputedHeight:function(a){return a.height()
},setWidth:function(a,b){a.css("width",b)},setHeight:function(a,b){a.css("height",b)},updateWidth:function(a,c){b.setWidth(a,c),b.populateWidth(a)},updateHeight:function(a,c){b.setHeight(a,c),b.populateHeight(a)},getFluidWidth:function(b){var c=a(g.getBlockNest(b)[0]||b.parent()[0]),d=Math.round(b.width()/c.width()*100)+"%";return d},toFluidWidth:function(a){if(!g.isRootBlock(a)){var c=b.getFluidWidth(a);b.updateWidth(a,c)}},toFluidHeight:function(a){b.updateHeight(a,"")},toFixedWidth:function(a){b.updateWidth(a,a.width())
},toFixedHeight:function(a){b.updateHeight(a,a.height())},toAutoWidth:function(a){b.updateWidth(a,"auto")},toAutoHeight:function(a){b.updateHeight(a,"")},setUnit:function(a,c,d){if("width"===c){var e=b.getUnit(a,c);"%"==e&&"px"==d&&b.toFixedWidth(a),"px"==e&&"%"==d&&b.toFluidWidth(a)}},getUnit:function(a,d){return c(b.getSize(a,d))},updateUnit:function(a,c,d){b.setUnit(a,c,d),"width"==c&&b.populateWidth(a),"height"==c&&b.populateHeight(a)},populate:function(a){var c=b.getDimensionsFieldset(),d=b.allowDimensionsFieldset(a);
c.toggle(d),d&&(b.populateWidth(a),b.populateHeight(a))},populateWidth:function(a){var c=b.getWidth(a),d=!b.hasInheritedWidth(a);b.populateField("width",c,d)},populateHeight:function(a){var c=b.getHeight(a),d=!b.hasInheritedHeight(a);b.populateField("height",c,d)},populateField:function(a,d,e){var f=b.field().where("name",a),g=parseFloat(d),h=c(d);if(b.numsliderToggle.inside(f).prop("checked",e),b.numsliderInput.inside(f).data("number",g).val(g),b.numsliderCurrentUnit.inside(f).html(h),b.numsliderUnit.inside(f).where("unit",'"'+h+'"').activateClass("active"),f.data("unit",h),b.resizingFromSlider!==a){if("px"==h)var i={start:g,step:1,range:{min:0,max:800},pips:{mode:"values",density:4,values:[0,200,400,600,800,1e3]}};
if("%"==h)var i={start:g,step:1,range:{min:0,max:100},pips:{mode:"positions",values:[0,20,40,60,80,100],density:5}};b.numsliderWidget.inside(f).find(".noUi-pips").remove().end().noUiSlider(i,!0).noUiSlider_pips(i.pips)}},handleNumsliderWidget:function(a,c){var d=b.workarea(),e=b.field.of(a),f=e.data("name"),g=e.data("unit"),i=Math.round(c)+g;b.resizingFromSlider=f,clearTimeout(b.resizingTimer),d.addClass("is-resizing"),"width"==f&&b.updateWidth(h,i),"height"==f&&b.updateHeight(h,i),b.resizingTimer=setTimeout(function(){d.removeClass("is-resizing")
},15),b.resizingFromSlider=null},"{numsliderWidget} nouislide":function(a,c,d){b.handleNumsliderWidget(a,d)},"{numsliderWidget} set":function(a,c,d){b.handleNumsliderWidget(a,d)},"{numsliderInput} input":function(c){function d(a){c.on("blur.numslider",function(){c.val(a)})}c.off("blur.numslider");var e=b.field.of(c),f=e.data("name"),g=a.trim(c.val()),i=b.numsliderUnit.inside(e),j=i.data("unit"),k=g+j;if(0==g||!a.isNumeric(g)){var l=c.data("number");return d(l)}"width"==f&&b.updateWidth(h,k),"height"==f&&b.updateHeight(h,k)
},"{numsliderUnit} click":function(a){var c=b.field.of(a),d=c.data("name"),e=a.data("unit");b.setUnit(h,d,e)},"{numsliderToggle} change":function(a){var c=b.field.of(a),d=c.data("name");a.is(":checked")||("width"==d&&b.toAutoWidth(h),"height"==d&&b.toAutoHeight(h))},"{self} composerBlockResize":function(a,c,d){b.populate(d)},"{self} composerBlockNestOut":function(a,b,c){c.css({width:"",height:""})}}}),b.resolve()})}),EasyBlog.module("composer/blocks/droppable",function(a){var b=this;EasyBlog.require().library("ui/draggable","ui/droppable").done(function(){EasyBlog.Controller("Composer.Blocks.Droppable",{defaultOptions:a.extend({"{dropzones}":"[data-ebd-dropzone]","{dropzonePlaceholder}":"[data-ebd-dropzone-placeholder]","{mediaFile}":"[data-eb-mm-file]"},EBD.selectors)},function(b,c,d,e,f,g){return{init:function(){f=b.blocks,e=f.composer,g=a(),b.dropzonePlaceholder=b.dropzonePlaceholder().detach().removeClass("hide")[0]
},"{self} composerReady":function(){b.draggableOptions={connectWith:EBD.dropzone,helper:"clone",appendTo:e.document.ghosts(),placeholder:"ebd-block is-placeholder",refreshPositions:!0,handle:EBD.immediateBlockSortHandle},b.droppableOptions={accept:[EBD.block,".eb-mm-file"].join(","),tolerance:"pointer"},b.enable()},enable:function(){f.getAllBlocks().draggable(b.draggableOptions)},disable:function(){b.block(".ui-draggable").draggable("destroy")},selectedBlock:null,"{self} composerBlockMove":function(a,c,d){b.selectedBlock=d
},"{self} composerBlockMenuSelected":function(a,c,d){b.selectedBlock=d},"{self} composerBlockInit":function(a,c,d){d.draggable(b.draggableOptions)},populateDropzones:function(){b.nest().each(function(){var c=a(this),d=c.data("type");if("block"==d&&(c.prepend(b.createNestedDropzone()),c.find(EBD.childBlock).each(function(){var c=a(this);c.after(b.createNestedDropzone())})),"content"==d){var e=f.nestable.availablePositions(c);a.each(e,function(a,d){c.prepend(b.createNestedDropzone(d))})}});var c=f.getRootBlocks();
c.each(function(c){var d=a(this);0==c&&d.before(b.createDropzone()),d.hasClass("is-sort-item")||d.after(b.createDropzone())}),c.length<1&&b.root().append(b.createDropzone()),b.dropzone().droppable(b.droppableOptions)},createDropzone:function(){return a(b.dropzonePlaceholder).clone()},createNestedDropzone:function(a){var c=b.createDropzone().addClass("is-nested");return a&&c.addClass("nest-"+a).data("position",a),c},destroyDropzones:function(){b.dropzone().remove()},"{block} dragstart":function(a,c,d){c.stopPropagation(),d.helper.addClass("is-helper").css({width:a.width(),height:a.height()}),f.deactivateBlock(),f.drag(a),a.addClass("hide"),g=a,b.populateDropzones(),e.manager().addClass("is-resizing")
},"{blocks.menu} dragstart":function(a){b.populateDropzones(),g=a,e.manager().addClass("is-resizing")},"{mediaFile} dragstart":function(){b.populateDropzones(),g=a(),e.manager().addClass("is-resizing")},"{dropzone} click":function(a){if(!e.manager().hasClass("is-dragging-block")){b.isDropping=!0;var d=b.selectedBlock;d.removeClass("hide").removeClass("is-sort-item"),b.dropBlock(a,d),setTimeout(function(){b.isDropping=!1,b.dropStop(),b.selectedMenu=null,b.selectedBlock=null,e.manager().removeClass("is-dropping-block"),e.manager().removeClass("is-moving-block")
},0)}},"{dropzone} mouseenter":function(a){a.addClass("is-receiving")},"{dropzone} mouseleave":function(a){a.removeClass("is-receiving")},"{dropzone} dropover":function(a,c,d){f.over(a),b.lastDropzone=a;var e=a.data("position");d.helper.addClass("is-sending"),e&&b.nest.of(a).data("snappedPosition",e)},"{dropzone} dropout":function(a,c,d){b.lastDropzone=null,f.out(a),d.helper.removeClass("is-sending")},isDropping:!1,lastDropzone:null,dropBlock:function(a,c){var d=c,g=c.is(f.menu);g&&(d=f.createBlockFromMenu(c));
var h=c.is(b.mediaFile);h&&(d=f.createBlockFromMediaFile(c));var i=e.manager().hasClass("is-moving-block"),j=e.manager().hasClass("is-dropping-block");if(i||j){var k=f.getBlockNest(a),l=a.data("position");k.data("snappedPosition",l)}a.replaceWith(d),(g||h||i||j)&&(f.drop(d),f.release(d),f.out(d))},dropStop:function(){setTimeout(function(){b.destroyDropzones()},1),e.manager().removeClass("is-resizing")},"{dropzone} drop":function(a,c,d){if(!b.isDropping){b.isDropping=!0;var e=d.draggable;b.dropBlock(a,e),setTimeout(function(){b.isDropping=!1
},0)}},"{block} dragstop":function(a){a.removeClass("hide"),f.drop(a),f.release(a),f.out(a),b.dropStop()},"{blocks.menu} dragstop":function(a,c,d){if(b.isDropping||!b.lastDropzone)return b.dropStop(),void 0;var e=d.helper;b.dropBlock(b.lastDropzone,e),b.dropStop()},"{mediaFile} dragstop":function(a,c,d){if(b.isDropping||!b.lastDropzone)return b.dropStop(),void 0;var e=d.helper;b.dropBlock(b.lastDropzone,e),b.dropStop()},"{self} composerDocumentScroll":function(b,c){var d=g.data("ui-draggable");a.ui.ddmanager.prepareOffsets(d,c)
},"{dropzone} dropdeactivate":function(a){f.out(a)}}}),b.resolve()})}),EasyBlog.module("composer/blocks/font",function(a){var b=this;EasyBlog.require().library("colorpicker","nouislider").done(function(){EasyBlog.Controller("Composer.Blocks.Font",{elements:[".eb-composer-fieldset[data-name=font] [data-eb-{font-color-menu|font-family-menu|font-size-menu|font-color-content|font-color-picker|font-family-content|font-size-content|font-color-caption|font-family-caption|font-size-caption|font-family-option|font-format-option}]",".eb-composer-fieldset[data-name=font] [data-eb-{numslider-toggle|numslider-widget|numslider-value|numslider-input|numslider-units|numslider-unit|numslider-current-unit}]",".eb-composer-fieldset[data-name=font] [data-eb-{colorpicker|colorpicker-toggle}]"],defaultOptions:a.extend({fontSizeUnits:{px:{start:12,step:2,range:{min:8,max:72},pips:{mode:"values",density:4,values:[8,12,18,24,48,72]}},"%":{start:100,step:10,range:{min:0,max:200},pips:{mode:"positions",values:[0,50,100],density:10}}}},EBD.selectors)},function(b,c,d,e,f,g){return{init:function(){f=b.blocks,e=f.composer,g=a(),b.initFontFormatting(),b.initFontColor()
},"{self} composerBlockActivate":function(a,c,d){g=d,b.populate(d)},populate:function(a){var c=f.getBlockMeta(a),d=c.properties.fonts;e.panels.fieldset.get("font").toggle(d),d&&(b.populateFontColor(a),b.populateFontFamily(a),b.populateFontSize(a),b.populateFontFormatting(a))},initFontColor:function(){b.fontColorPicker().colorpicker()},populateFontColor:function(a){var c=a.css("color");b.updateFontColorUI(c)},setFontColor:function(a,c){a.css("color",c),b.updateFontColorUI(c)},updateFontColorUI:function(a){b.updatingFontColorUI=!0,a||(a=g.css("color")||"#000"),b.fontColorCaption().css("backgroundColor",a),b.fontColorPicker().colorpicker("setColor",a),b.updatingFontColorUI=!1
},removeFontColor:function(a){b.setFontColor(a,"")},populateFontFamily:function(a){var c=a[0].style.fontFamily;b.updateFontFamilyUI(c)},setFontFamily:function(c,e){b.unpreviewFontFamily(c);var f=a.Event("composertBlockFontFamilyChange");f.fontFamily=e,d.trigger(f,e),b.updateFontFamilyUI(f.fontFamily),f.isDefaultPrevented()||c.css("fontFamily",f.fontFamily)},updateFontFamilyUI:function(a){var c=b.fontFamilyOption().removeClass("active").where("value",'"'+a+'"').addClass("active"),d=c.length>0?c.html():a.split(",")[0];
b.fontFamilyCaption().html(d)},previewFontFamily:function(b,c){var e=b.data("originalFontFamily")||g[0].style.fontFamily,f=a.Event("composerBlockFontFamilyPreview");f.originalFontFamily=e,f.fontFamily=c,d.trigger(f,c,e),b.data("originalFontFamily",f.originalFontFamily),f.isDefaultPrevented()||b.css("fontFamily",f.fontFamily)},unpreviewFontFamily:function(b){var c=b.data("originalFontFamily"),e=a.Event("composerBlockFontFamilyUnpreview");return e.originalFontFamily=c,d.trigger(e,c),b.removeData("originalFontFamily"),e.isDefaultPrevented()?void 0:(b.css("fontFamily",e.originalFontFamily),void 0)
},populateFontSize:function(a){var c=a.css("fontSize");b.updateFontSizeUI(c)},setFontSize:function(c,d){if(a.isNumeric(d)){var e=b.getFontSizeUnit();d+=e}c.css("fontSize",d),b.updateFontSizeUI(d||c.css("fontSize")),d?(b.setLineHeight(c,"120%"),b.numsliderToggle().prop("checked",!0)):(b.removeLineHeight(c),b.numsliderToggle().prop("checked",!1))},updateFontSizeUI:function(a){b.updatingFontSizeUI=!0;var c=Math.abs(a.replace(/\%|px/gi,""));unit=a.match("%")?"%":"px",b.getFontSizeUnit()!==unit&&b.setFontSizeUnit(unit),b.fontSizeCaption().html(a),b.numsliderCurrentUnit().html(unit),b.numsliderUnit().removeClass("active").where("unit",'"'+unit+'"').addClass("active"),b.numsliderWidget().val(c),b.numsliderInput().val(c),b.updatingFontSizeUI=!1
},removeFontSize:function(a){b.setFontSize(a,"")},getFontSizeUnit:function(){return b.fontSizeContent().data("unit")||"%"},setFontSizeUnit:function(a){b.fontSizeContent().data("unit",a);var d=c.fontSizeUnits[a];b.numsliderWidget().find(".noUi-pips").remove().end().noUiSlider(d,!0).noUiSlider_pips(d.pips)},setLineHeight:function(a,b){a.css("lineHeight",b)},removeLineHeight:function(a){b.setLineHeight(a,"")},fontFormatting:{bold:{key:"fontWeight",val:"bold"},italic:{key:"fontStyle",val:"italic"},underline:{key:"textDecoration",val:"underline"},strikethrough:{key:"textDecoration",val:"line-through"},alignleft:{key:"textAlign",val:"left"},alignright:{key:"textAlign",val:"right"},aligncenter:{key:"textAlign",val:"center"},justify:{key:"textAlign",val:"justify"}},initFontFormatting:function(){b.fontFormatOption().on("touchstart click mousedown mouseup",function(a){a.preventDefault()
}).on("touchstart click",function(){var d=a(this),e=d.data("format");b.setFontFormatting(g,e,d.hasClass("active"))})},populateFontFormatting:function(c){var d=c[0],f=d.style,g=b.fontFormatOption().each(function(){var c=a(this),d=c.data("format");if(/orderedlist|unorderedlist|indent|outdent/.test(d))return c.removeClass("active"),void 0;var e=b.fontFormatting[d],g=f[e.key]==e.val;c.toggleClass("active",g)}),h="text"==c.data("type");if(h){var i=e.editor.selection.getCurrent(),j=a(i).parentsUntil(c).filter("ul, ol").eq(0);
a.each({orderedlist:"ol",unorderedlist:"ul"},function(a,b){var c=j.is(b);g.where("format",a).toggleClass("active",c)})}e.panels.fieldset.get("font").find(".eb-font-formatting.section-list").toggle(h)},setFontFormatting:function(a,c,d){var f=e.editor;switch(c){case"orderedlist":case"unorderedlist":f.list.toggle(c);break;case"indent":f.indent.increase();break;case"outdent":f.indent.decrease();break;default:var g=b.fontFormatting[c];a.css(g.key,d?"":g.val)}b.populateFontFormatting(a)},removeFontFormatting:function(a,c){b.setFontFormatting(a,c,!0)
},"{colorpicker} colorpickerChange":function(a,c,d){b.updatingFontColorUI||(b.colorpickerToggle().prop("checked",!0),b.setFontColor(g,d))},"{colorpickerToggle} change":function(a){a.checked()||b.removeFontColor(g)},"{fontFamilyOption} mouseover":function(a){var c=a.data("value");b.previewFontFamily(g,c)},"{fontFamilyOption} mouseout":function(){b.unpreviewFontFamily(g)},"{fontFamilyOption} click":function(a){var c=a.data("value");b.setFontFamily(g,c)},"{numsliderWidget} nouislide":function(a,c,d){b.numsliderInput().val(Math.abs(d))
},"{numsliderWidget} set":function(a,c,d){b.updatingFontSizeUI||b.setFontSize(g,Math.abs(d))},"{numsliderInput} input":function(c){if(!b.updatingFontSizeUI){var d=Math.abs(a.trim(c.val()));b.numsliderToggle().checked(!0),b.setFontSize(g,d)}},"{numsliderUnit} click":function(a){var c=a.data("unit");b.setFontSizeUnit(c)},"{numsliderToggle} change":function(a){a.checked()||b.removeFontSize(g)}}}),b.resolve()})}),EasyBlog.module("composer/blocks/guide",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Guide",{defaultOptions:a.extend({},EBD.selectors)},function(a,b,c,d,e){return{init:function(){e=a.blocks,d=a.blocks.composer
},"{self} composerBlockHoverIn":function(a,b,c){c.addClass("hover")},"{self} composerBlockHoverOut":function(a,b,c){c.removeClass("hover")},"{self} composerBlockDrop":function(){},"{self} composerBlockActivate":function(b,c,d){d.addClass("active");var g=d.is(EBD.nestedBlock);g&&(a.nest.of(d).addClass("active"),e.getAllParentBlocks(d).addClass("has-active-child")),a.workarea().toggleClass("has-active-nest",g),d.addClass("is-glowing"),setTimeout(function(){d.removeTransitionClass("is-glowing",2e3)},10)},"{self} composerBlockDeactivate":function(){a.block().removeClass("active has-active-child"),a.nest().removeClass("active")
}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/audio",function(){var b=this;EasyBlog.require().library("plupload2","audiojs").done(function(a){EasyBlog.Controller("Composer.Blocks.Handlers.Audio",{elements:["[data-eb-{file-error}]"],defaultOptions:{"{browseButton}":".eb-composer-placeholder-audio [data-eb-mm-browse-button]","{audio}":"audio","{placeholder}":"[data-eb-composer-audio-placeholder]","{infoBox}":"[data-audio-infobox]","{artist}":"[data-audio-artist]","{track}":"[data-audio-track]","{trackSeparator}":"[data-audio-track-separator]","{download}":"[data-audio-download]","{displayArtist}":"[data-audio-fieldset-artist]","{displayTrack}":"[data-audio-fieldset-track]","{displayDownload}":"[data-audio-fieldset-download]","{autoplay}":"[data-audio-fieldset-autoplay]","{loop}":"[data-audio-fieldset-loop]"}},function(b,c,d,e,f,g,h,i){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a(),i=EasyBlog.MediaManager
},toText:function(){},toData:function(a){var c=f.data(a),d=f.getBlockContent(a);return c.download=b.download.inside(d).attr("href"),c.artist=b.artist.inside(d).text(),c.track=b.track.inside(d).text(),c},toHTML:function(a){var a=a.clone()},toLegacyShortcode:function(a){var c={uri:a.uri},d="[embed=audio]"+JSON.stringify(c)+"[/embed]";return d},activate:function(a){h=a,b.populate(a)},deactivate:function(){},construct:function(b){var c=f.createBlockContainer("audio"),d=f.data(c);return a.extend(d,b),c},constructFromMediaFile:function(a){{var c=a.data("key"),d=i.getUri(c),e=f.createBlockContainer("audio");
f.getBlockContent(e),f.data(e)}return e.addClass("is-loading"),i.getMedia(d).done(function(a){var c=a.meta;b.createPlayer(e,c.url,c.title)}).fail(function(){}).always(function(){e.removeClass("is-loading")}),e},reconstruct:function(a){var c=b.placeholder.inside(a),d=f.data(a);d.url&&b.createPlayer(a,d.url,d.track),c.length>0&&EasyBlog.MediaManager.uploader.register(c)},deconstruct:function(){},refocus:function(){},reset:function(a){f.getBlockContent(a)},populate:function(a){f.data(a);b.updateFieldset(a)},updateFieldset:function(a){var c=f.data(a);
b.autoplay().val(c.autoplay?"1":"0").trigger("change"),b.loop().val(c.loop?"1":"0").trigger("change"),b.displayArtist().val(c.showArtist?"1":"0").trigger("change"),b.displayDownload().val(c.showDownload?"1":"0").trigger("change"),b.displayTrack().val(c.showTrack?"1":"0").trigger("change")},getPlayerTemplate:function(){return a(g.player)},createPlayer:function(c,d,e){var g=f.getBlockContent(c),h=b.getPlayerTemplate(),i=f.data(c),j=i.uid||(i.uid=a.uid("audio-")),d=i.url||d,k=e||"",l=i.artist;i.url=d,i.track=k,i.artist=l,i.uid=j,b.audio.inside(h).attr("id",j).attr("src",d),b.artist.inside(h).html(i.artist).editable(!0),b.track.inside(h).html(i.track).editable(!0),b.download.inside(h).attr("href",d).attr("target","blank").on("click",function(a){a.preventDefault()
}),g.html(h),a.audiojs.events.ready(function(){a.audiojs.create(g.find("audio"))}),i.showDownload||b.download.inside(g).addClass("hide"),i.showArtist||b.artist.inside(g).addClass("hide"),i.showTrack||b.track.inside(g).addClass("hide"),b.updateInfoBox(c)},updateInfoBox:function(a){var c=f.data(a),d=f.getBlockContent(a),e=b.infoBox.inside(d);return c.showDownload||c.showTrack||c.showArtist?(e.removeClass("disabled"),void 0):(e.addClass("disabled"),void 0)},"{displayDownload} change":function(a){var e=(f.getBlockContent(h),1==a.val()?!0:!1),g=f.data(h);
return g.showDownload=e,b.updateInfoBox(h),e?(b.download.inside(h).removeClass("hide"),void 0):(b.download.inside(h).addClass("hide"),void 0)},"{displayArtist} change":function(a){var d=f.getBlockContent(h),e=1==a.val()?!0:!1,g=b.artist.inside(d),i=f.data(h);return i.showArtist=e,b.updateInfoBox(h),e?(g.removeClass("hide"),void 0):(g.addClass("hide"),void 0)},"{displayTrack} change":function(a){var d=f.getBlockContent(h),e=1==a.val()?!0:!1,g=b.track.inside(d),i=b.trackSeparator.inside(d),j=f.data(h);return j.showTrack=e,b.updateInfoBox(h),e?(i.removeClass("hide"),g.removeClass("hide"),void 0):(i.addClass("hide"),g.addClass("hide"),void 0)
},"{autoplay} change":function(a){var c=f.data(h),d=1==a.val()?!0:!1;c.autoplay=d},"{loop} change":function(a){var c=f.data(h),d=1==a.val()?!0:!1;c.loop=d},"{placeholder} mediaUploaderFilesAdded":function(a,b,c,d){EasyBlog.MediaManager.uploader.addItem(d[0],a)},"{placeholder} mediaUploaderFileUploaded":function(a,c,d,e,g){var h=g.response,i=h.media,j=i.meta,k=f.block.of(a);setTimeout(function(){b.createPlayer(k,j.url,e.name),k.hasClass("active")&&b.populate(k)},600)},"{browseButton} mediaSelect":function(a,c,d){var g=f.block.of(a);
if("audio"==d.meta.type){var h=d.meta,i=e.document,j=i.isLegacy();j?(content=b.toLegacyHTML(g),i.insertContent(content)):b.createPlayer(g,h.url,h.title)}},"{placeholder} mediaUploaderFileError":function(c,d,e,f){f.code==a.plupload2.FILE_EXTENSION_ERROR&&b.fileError.inside(h).removeClass("hide")},"{self} mediaInsert":function(a,c,d,g){if("audio"==d.meta.type){var h=e.document,i=h.isLegacy();if(i)content=b.toLegacyShortcode(d,g),h.insertContent(content);else{var g=f.constructBlock("audio",{url:d.meta.url,track:d.meta.title});
f.addBlock(g),f.activateBlock(g)}}}}}),b.resolve()})}),EasyBlog.module("composer/blocks/handlers/behance",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Behance",{defaultOptions:a.extend({"{form}":"> [data-behance-form]","{insert}":"[data-behance-insert]","{source}":"[data-behance-source]","{loader}":"> [data-behance-loader]","{preview}":"> [data-behance-preview]","{errorMessage}":"[data-behance-error]","{fsSource}":"[data-fs-behance-source]","{fsUpdate}":"[data-fs-behance-update]"},EBD.selectors)},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},toData:function(a){var b=f.data(a);return b},toText:function(a){var b=f.data(a);return b.url},toEditableHTML:function(){return""},toHTML:function(a){var b=f.data(a);return b.embed},activate:function(a){h=a,b.populate(a)},deactivate:function(){},construct:function(){},reconstruct:function(c){var d=f.data(c),e=c.data("overlay"),h=f.getBlockContent(c);d.embed&&!e&&b.setOverlay(c,d.embed),d.embed||h.html(a(g.html)),c.find(b.source.selector).off("paste").on("paste",function(a){a.stopPropagation()})},deconstruct:function(a){var c=f.getBlockContent(a);
return b.form.inside(c).remove(),b.loader.inside(c).remove(),a},refocus:function(){},reset:function(){},populate:function(a){var c=f.data(a);c.url&&b.fsSource().val(c.url)},loading:function(){var a=f.getBlockContent(h);return b.isLoading?(b.loader.inside(a).addClass("hidden"),b.form.inside(a).removeClass("hidden"),b.isLoading=!1,void 0):(b.loader.inside(a).removeClass("hidden"),b.form.inside(a).addClass("hidden"),b.isLoading=!0,void 0)},setOverlay:function(a,b){var c=f.getBlockContent(a),d=a.data("overlay");
d?(d.element().empty(),d.element().append(b)):(d=e.document.overlay.create(a),d.placeholder().css("height","450px").appendTo(c),d.element().append(b),d.attach()),a.data("overlay",d)},isUrlValid:function(a){if(""==a)return!1;var b=/^https:\/\/www\.behance\.net\/gallery\/(.*)\/(.*)$/,c=b.test(a);return c},getOembedUrl:function(a){return"http://www.behance.net/services/oembed?url="+a},crawl:function(a,c){var d=f.getBlockContent(a),e=f.data(a),g=b.getOembedUrl(c);if(!b.isUrlValid(c))return b.errorMessage().removeClass("hide"),!1;
var h=a.data("overlay");return h&&h.element().empty(),b.loading(),EasyBlog.ajax("site/views/crawler/crawl",{url:g}).done(function(f){b.loading();var h=f[g];e.url=c,e.embed=h.oembed.html,b.setOverlay(a,e.embed),b.form.inside(d).addClass("hidden")}).fail(function(a){b.loading(),b.errorMessage().removeClass("hide").html(a)}),task},"{insert} click":function(a){if(h.length<1){var c=b.block.of(a);f.activateBlock(c)}var d=f.getBlockContent(h),e=b.source.inside(d).val();b.fsSource().val(e),b.crawl(h,e)},"{fsUpdate} click":function(){var c=(f.getBlockContent(h),b.fsSource().val());
b.crawl(h,c)}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/buttons",function(a){var b=this;EasyBlog.require().library("rangeslider").done(function(){EasyBlog.Controller("Composer.Blocks.Handlers.Buttons",{defaultOptions:{"{button}":"> a.btn","{textWrapper}":"> span","{buttonSize}":"[data-eb-composer-block-button-size] [data-size]","{buttonHyperlink}":"[data-button-link]","{buttonNofollow}":"[data-button-nofollow]","{buttonTarget}":"[data-button-target]","{buttonSwatchItem}":"[data-eb-composer-button-swatch-item]"}},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},selectionState:{},toData:function(a){var b=f.data(a);return b},toText:function(a){{var c=f.getBlockContent(a);b.button.inside(c)}return text=f.data(a).link},toHTML:function(a){var c=a.clone(),d=b.deconstruct(c),e=f.getBlockContent(d).html();return e},activate:function(a){h=a,b.populate(a)},deactivate:function(){},construct:function(){},reconstruct:function(a){var c=f.getBlockContent(a),d=b.button.inside(c);d.on("click",function(a){a.stopPropagation(),a.preventDefault()})},deconstruct:function(a){var c=f.getBlockContent(a),d=b.button.inside(c);
return b.textWrapper.inside(d).removeAttr("contenteditable").editable(!1),a},refocus:function(){},reset:function(){},populate:function(a){var c=f.data(a);b.buttonSwatchItem().removeClass("active").where("style",c.style).addClass("active");var d=b.buttonSize().filter('[data-size="'+c.size+'"]');d.siblings().removeClass("active"),d.addClass("active"),b.buttonHyperlink().val(c.link),b.buttonNofollow().val(c.nofollow).trigger("change"),b.buttonTarget().val(c.target)},"{buttonSwatchItem} click":function(a){var c=a.data("style"),d=f.getBlockContent(h);
b.buttonSwatchItem().removeClass("active").where("style",c).addClass("active"),b.button.inside(d).removeClass("btn-info btn-primary btn-success btn-warning btn-danger").addClass(c),f.data(h).style=c},"{buttonSwatchItem} mouseover":function(a){clearTimeout(b.previewTimer);var c=a.data("style"),d=f.getBlockContent(h);b.button.inside(d).removeClass("btn-info btn-primary btn-success btn-warning btn-danger").addClass(c)},"{buttonSwatchItem} mouseout":function(){clearTimeout(b.previewTimer);var c=f.getBlockContent(h);
b.previewTimer=setTimeout(function(){b.button.inside(c).removeClass("btn-info btn-primary btn-success btn-warning btn-danger").addClass(f.data(h).style)},50)},"{buttonSize} click":function(a){var c=a.data("size"),d=f.getBlockContent(h);a.addClass("active").siblings().removeClass("active"),b.button.inside(d).removeClass("btn-sm btn-xs btn-lg btn-xlg").addClass(c),f.data(h).size=c},"{buttonSize} mouseover":function(a){clearTimeout(b.previewTimer);var c=a.data("size"),d=f.getBlockContent(h);b.button.inside(d).removeClass("btn-sm btn-xs btn-lg btn-xlg").addClass(c)
},"{buttonSize} mouseout":function(){clearTimeout(b.previewTimer);var c=f.getBlockContent(h);b.previewTimer=setTimeout(function(){b.button.inside(c).removeClass("btn-sm btn-xs btn-lg btn-xlg").addClass(f.data(h).size)},50)},"{buttonHyperlink} keyup":a.debounce(function(a){var c=f.getBlockContent(h),d=f.data(h);d.link=a.val(),b.button.inside(c).attr("href",a.val())},250),"{buttonNofollow} change":function(a){var c=f.getBlockContent(h),d=f.data(h);d.nofollow=1==a.val()?1:0,b.button.inside(c).attr("rel",1==a.val()?"nofollow":"")
},"{buttonTarget} change":function(a){var c=f.getBlockContent(h),d=f.data(h);d.target=a.val(),b.button.inside(c).attr("target",a.val())}}}),b.resolve()})}),EasyBlog.module("composer/blocks/handlers/code",function(a){var b=this,c=a.uri(a.require.defaultOptions.path).toPath("./ace"+("compressed"==a.mode?".min.js":".js")).toString();window.FD50_PSEUDO={module:function(b,c){c.call(a.Deferred(),a)}},EasyBlog.Controller("Composer.Blocks.Handlers.Code",{defaultOptions:{"{pre}":"> pre","{readOnly}":"[data-code-readonly]","{showGutter}":"[data-code-gutter]","{fontsize}":"[data-code-fontsize]","{themeSelection}":"[data-code-theme]","{modeSelection}":"[data-code-mode]",theme:"github",mode:"html",css:{position:"fixed",width:"100%",height:"100%",top:0,bottom:0,left:0,right:0,margin:0,padding:0}}},function(b,d,e,f,g,h,i){return{init:function(){g=b.blocks,f=g.composer,h=d.meta,i=a()
},toText:function(){},toData:function(a){{var c=g.data(a);a.data("uid")}return instance=b.editor.instances[a.data("uid")],contents=instance.editor.getSession().getValue(),c.code=contents,c},toEditableHTML:function(a){var b=a.clone(),c=g.getBlockContent(b);return c.find("[data-ebd-overlay-placeholder]").remove(),c.html()},toHTML:function(a){{var c=g.data(a);a.data("uid")}instance=b.editor.instances[a.data("uid")],contents=instance.editor.getSession().getValue();var e=a.clone(),f=b.deconstruct(e),h=g.getBlockContent(f),i=b.pre.inside(h);
i.html(contents),i.attr("data-mode",c.mode);var j=i.html();return j},activate:function(a){i=a,b.populate(a)},deactivate:function(){},construct:function(b){var b=a.extend({},d.data,b)},reconstruct:function(a){{var c=g.getBlockContent(a);g.data(a)}if(!a.data("overlay")){var e=f.document.overlay.create(a);e.placeholder().prependTo(c),e.attach(),a.data("overlay",e)}b.editor.get(a)},deconstruct:function(a){return a},reset:function(){},refocus:function(){},populate:function(a){var c=g.data(a);b.modeSelection().val(c.mode),b.themeSelection().val(c.theme),b.showGutter().val(c.show_gutter?1:0),b.showGutter().trigger("change")
},getEditor:function(a){b.editor.get(i).done(a)},switchMode:function(a){var c=g.data(i);b.getEditor(function(b,d){d.setMode("ace/mode/"+a),c.mode=a})},switchTheme:function(a){var c=g.data(i);b.getEditor(function(b){b.setTheme(a),c.theme=a})},switchInvisible:function(a){var c=g.data(current);b.getEditor(function(b){b.setShowInvisibles(a),c.show_invisible=a})},toggleGutter:function(a){var c=g.data(i);b.getEditor(function(b){b.renderer.setShowGutter(a),c.show_gutter=a})},updateFontSize:function(a){var c=g.data(i);
b.getEditor(function(b){b.setFontSize(a),c.fontsize=a})},"{fontsize} change":function(c){var e=parseInt(a(c).val());b.updateFontSize(e)},"{readOnly} change":function(){},"{showGutter} change":function(c){var e=1==a(c).val()?!0:!1;b.toggleGutter(e)},"{modeSelection} change":function(c){var e=a(c).val();b.switchMode(e)},"{themeSelection} change":function(c){var e=a(c).val();b.switchTheme(e)},editor:{instances:{},get:function(a){var c=b.editor.instances[a.data("uid")];return c||b.editor.create(a)},create:function(e){var h=e.data("uid"),i=g.getBlockContent(e),j=b.pre.inside(i),k=b.editor.instances[h]=a.Deferred(),l=g.data(e),m=k.overlay=e.data("overlay");
m||(m=f.document.overlay.create(e),m.placeholder().prependTo(i),m.attach(),e.data("overlay",m));var n=a.create("iframe"),o=a.rootPath+"/media/index.html";return n.attr("src",o).one("load",function(){var e=n[0].contentWindow,f=e.document,g=f.head,i=f.body,m=j.clone().css(d.css).appendTo(i)[0];e.eval("window.FD50 = window.parent.FD50_PSEUDO;"),a.script({url:c,head:g}).done(function(){var b=e.ace,c=b.edit(m),f=l.theme||j.data("theme")||d.theme,g=l.mode||j.data("mode")||d.mode,h=l.fontsize||j.data("fontsize")||d.fontsize,i=l.show_gutter||j.data("gutter")||d.show_gutter;
c.setTheme(f),c.setFontSize(h),c.renderer.setShowGutter(i),l.code&&c.setValue(l.code),a(m).css("height","100%"),c.resize();var n=c.getSession();n.setMode("ace/mode/"+g),k.editor=c,k.resolve(c,n,j)}).fail(function(){k.reject(a.Exception("ACE Editor could not be loaded.")),delete b.instances[h]})}),m.element().append(n),k}}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/codepen",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Codepen",{defaultOptions:{"{form}":"> [data-codepen-form]","{insert}":"[data-codepen-insert]","{source}":"[data-codepen-source]","{loader}":"> [data-codepen-loader]","{preview}":"> [data-codepen-preview]","{fsSource}":"[data-fs-codepen-source]","{fsUpdate}":"[data-fs-codepen-update]","{errorMessage}":"[data-codepen-error]"}},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},toText:function(a){var b=f.data(a);return b.url},toData:function(a){var b=f.data(a);return b},toEditableHTML:function(){return""},toHTML:function(a){var b=f.data(a);return b.embed},activate:function(a){h=a,b.populate(a)},deactivate:function(){},construct:function(){},reconstruct:function(c){var d=f.data(c),e=c.data("overlay"),h=f.getBlockContent(c);d.embed&&!e&&b.setOverlay(c,d.embed),d.embed||h.html(a(g.html))},deconstruct:function(a){var c=f.getBlockContent(a);return b.form.inside(c).remove(),b.loader.inside(c).remove(),a
},refocus:function(){},reset:function(){},populate:function(a){var c=f.data(a);b.fsSource().val(c.url)},loading:function(){var a=f.getBlockContent(h);b.isLoading?(b.loader.inside(a).addClass("hidden"),b.form.inside(a).removeClass("hidden"),b.isLoading=!1):(b.loader.inside(a).removeClass("hidden"),b.form.inside(a).addClass("hidden"),b.isLoading=!0)},setOverlay:function(a,b){var c=a.data("overlay");if(c)c.element().empty(),c.element().append(b);else{c=e.document.overlay.create(a);var d=f.getBlockContent(a);c.placeholder().css("height","300px").appendTo(d),c.element().append(b),c.attach()
}a.data("overlay",c)},getUrl:function(a){return"http://codepen.io/api/oembed?url="+a},isUrlValid:function(a){if(""==a)return!1;var b=/^http:\/\/codepen\.io\/(.*)\/pen\/(.*)$/,c=b.test(a);return c},crawl:function(a,c){var d=b.getUrl(c),e=f.data(a),g=f.getBlockContent(a);if(!b.isUrlValid(c))return b.errorMessage().removeClass("hide"),!1;var h=a.data("overlay");h&&h.element().empty(),b.loading(),EasyBlog.ajax("site/views/crawler/crawl",{url:d}).done(function(f){var g=f[d];e.url=c,e.embed=g.oembed.html,b.setOverlay(a,e.embed)
}).fail(function(a){b.errorMessage().removeClass("hide").html(a)}).always(function(){b.loading(),b.form.inside(g).addClass("hidden")})},"{insert} click":function(a){if(h.length<1){var c=b.block.of(a);f.activateBlock(c)}var e=(f.data(h),f.getBlockContent(h)),g=b.source.inside(e).val();b.fsSource().val(g),b.crawl(h,g)},"{fsUpdate} click":function(){{var a=b.fsSource().val();f.data(h)}b.crawl(h,a)}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/columns",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Columns",{defaultOptions:{"{columnsHeader}":".row","{columns}":".row > div","{wrapper}":"> div[data-col-wrapper]","{columnRange}":"[data-eb-composer-block-column-range]","{control}":"[data-columns-control]","{controlWidth}":"[data-select-width]","{dropdown}":".eb-composer-manage-tab-name > select ","{listboxItem}":"[data-listbox-item]"}},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},matchWrapperHeight:function(c){var d=0;b.wrapper.inside(c).css("height","").each(function(){d=Math.max(d,a(this).height())}).css("height",d)},removeWrapperHeight:function(a){b.wrapper.inside(a).css("height","")},"{blocks.root} sortactivate":function(){f.getBlocksByType("columns").each(function(){var c=f.getBlockContent(a(this));b.matchWrapperHeight(c)})},"{blocks.root} sortdeactivate":function(){f.getBlocksByType("columns").each(function(){var c=f.getBlockContent(a(this));b.removeWrapperHeight(c)})},"{wrapper} sortchange":function(a){var e=a.closest(EBD.block);
b.matchWrapperHeight(e)},"{wrapper} sortout":function(a){var e=a.closest(EBD.block);b.matchWrapperHeight(e)},activate:function(a){h=a,b.populate(a)},deactivate:function(){},construct:function(b){var b=a.extend({},c.data,b);return content},reconstruct:function(){},deconstruct:function(b){var c=f.getBlockContent(b),d=c.find("> .row > .col > [data-col-wrapper]");return d.each(function(){var b=a(this),c=b.parent();b.children().appendTo(c),c.removeAttr("contenteditable"),b.remove()}),b},refocus:function(a){var c=f.getBlockContent(a),d=a.data("lastFocused")||b.columns.inside(c).filter(":first");
d.focus()},reset:function(){},populate:function(c){var d=f.data(c);b.control().listbox().listbox("populate",d.columns);var e=f.getBlockContent(c),g=b.columns.inside(e);g.each(function(c,e){var f=b.listboxItem().eq(c),g=b.controlWidth.inside(f);a(e).attr("data-size",d.columns[c].size),a(e).data("size",d.columns[c].size);var h=a(e).data("size");g.val(h)})},toHTML:function(a){var c=a.clone(),d=b.deconstruct(c),e=f.getBlockContent(d);return e.html()},toData:function(a){var b=f.data(a);return b},toText:function(a){var b=f.getBlockContent(a).clone();
return b.text()},column:{activate:function(a){var c=f.getBlockContent(h),d=b.columns.inside(c);d.eq(a).addClass("active-column")},deactivate:function(a){var c=f.getBlockContent(h),d=b.columns.inside(c);d.eq(a).removeClass("active-column")},create:function(c){var d=f.getBlockContent(h),g=(b.columns.inside(d),"col col-md-"+c),i=f.createBlockNest();i.attr("data-col-wrapper","").addClass("ui-sortable");var j=f.constructNestedBlock("text");i.append(j);var k=a("<div></div>");k.addClass(g).attr("data-size",c).append(i),b.columnsHeader.inside(d).append(k)
},remove:function(a){var c=f.getBlockContent(h);b.columns.inside(c).eq(a).remove();var d=b.columns.inside(c).length,e=Math.ceil(12/d),g=!1;if(5==d){var e=2;g=!0}var i="col col-md-"+e;b.columnsHeader.inside(c).find("div.col").removeClass().addClass(i),g&&(b.columns.inside(c).first().addClass("col-md-offset-1"),b.columns.inside(c).last().addClass("col-md-offset-0"))},change:function(a,c){var d=f.getBlockContent(h),e=b.columns.inside(d).length,g=f.data(h);if(c>4&&3==e&&b.columns.inside(d).last().addClass("col col-md-2"),4==c&&4==e&&b.columns.inside(d).last().addClass("col col-md-2"),!(c>4)||4!=e&&5!=e){if(6==e)return b.dropdown().val("2"),void 0;
b.columns.inside(d).first().removeClass("col-md-offset-1"),b.columns.inside(d).last().removeClass("col-md-offset-0");{var i="col col-md-"+c;b.columns.inside(d).eq(a)}g.columns[a].size=c,b.columns.inside(d).eq(a).attr("data-size",c).removeClass().addClass(i)}}},"{listboxItem} mouseover":function(a){var d=a.index();b.column.activate(d)},"{listboxItem} mouseout":function(a){var d=a.index();b.column.deactivate(d)},"{control} listboxBeforeAddItem":function(){},"{control} listboxAfterAddItem":function(){f.data(h).columns=b.control().listbox("toData"),b.column.create(1)
},"{control} listboxBeforeRemoveItem":function(a,c,d){var e=d.index();b.column.remove(e)},"{control} listboxAfterRemoveItem":function(){f.data(h).columns=b.control().listbox("toData")},"{controlWidth} change":function(a){var d=a.parents(b.listboxItem.selector),e=d.index(),f=a.val();b.column.change(e,f)}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/compare",function(a){var b=this;EasyBlog.require().library("imgareaselect").done(function(){EasyBlog.Controller("Composer.Blocks.Handlers.Compare",{defaultOptions:{image:"[data-type=compare] img"}},function(b,c,d,e,f,g,i){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,i=a()
},toData:function(a){return f.getData(a)},activate:function(c){i=c,b.populate(c),i.find("img").on("click.compare dragstart.compare",function(a){a.preventDefault(),a.stopPropagation()}).on("mousedown.compare",function(c){if(!b.drawing){c.stopPropagation(),c.preventDefault();var e=a(this),f=e.parents(".ebd-block:first");images=f.find("img"),console.log(f),b.drawing=!0,d.addClass("active");var g=parseInt(e.css("top")),i=parseInt(e.css("left")),j=e.width()-e.parent().width();h=e.height()-e.parent().height();var k=c.pageX,l=c.pageY;
a(document).on("mousemove.compare mouseup.compare",function(a){if(b.drawing){var c=-1*(k-a.pageX),d=-1*(l-a.pageY),e=0==j?0:i+(c||0),f=0==h?0:g+(d||0);images.css({top:g=f,left:i=e}),k=a.pageX,l=a.pageY}}).on("mouseup.compare",function(){a(document).off("mousemove.compare mouseup.compare"),f.removeClass("active"),b.drawing=!1})}})},construct:function(){},reconstruct:function(){},refocus:function(){},reset:function(){},populate:function(){},drawing:!1,"{image} mousedown":function(){}}}),b.resolve()})}),EasyBlog.module("composer/blocks/handlers/file",function(a){var b=this;
EasyBlog.Controller("Composer.Blocks.Handlers.File",{defaultOptions:{"{browseButton}":".eb-composer-placeholder-file [data-eb-mm-browse-button]","{fileError}":"[data-eb-file-error]","{placeholder}":"[data-eb-composer-file-placeholder]","{player}":"[data-file-preview]","{dropElement}":"[data-plupload-drop-element]","{showIcon}":"[data-file-fieldset-icon]","{showSize}":"[data-file-fieldset-size]","{fileName}":"[data-file-name]","{fileType}":"[data-file-type]","{fileIcon}":"[data-file-icon]","{fileSize}":"[data-file-size]","{fileUrl}":"[data-file-url]"}},function(b,c,d,e,f,g,h,i){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a(),i=EasyBlog.MediaManager
},toData:function(a){var b=f.data(a);return b},toText:function(){},toHTML:function(a){var c=f.data(a);if(!c.url)return"";var d=a.clone(),e=b.deconstruct(d),g=f.getBlockContent(e);return g.html()},constructFromMediaFile:function(a){{var c=a.data("key"),d=i.getUri(c),e=f.createBlockContainer("file");f.getBlockContent(e),f.data(e)}return e.addClass("is-loading"),i.getMedia(d).done(function(a){var c=a.meta;b.createPreview(e,c.url,c.title,c.extension,c.size)}).fail(function(){}).always(function(){e.removeClass("is-loading")
}),e},toLegacyHTML:function(b,c){var e=(f.data(c),a("<a>").attr({href:b.url}).html(b.title));return e.prop("outerHTML")},activate:function(a){h=a,b.populate(a)},deactivate:function(){},construct:function(b){var c=f.createBlockContainer("file"),d=f.data(c);return a.extend(d,b),c},reconstruct:function(a){var c=f.data(a),d=b.placeholder.inside(a),e=b.dropElement.inside(d);c.url&&b.createPreview(a,c.url,c.name,c.type,c.size),e.length>0&&EasyBlog.MediaManager.uploader.register(d)},deconstruct:function(a){var c=f.getBlockContent(a);
return b.fileName.inside(c).editable(!1),a},refocus:function(){},reset:function(){},populate:function(a){var c=f.data(a);b.showIcon().val(c.showicon?1:0).trigger("change"),b.showSize().val(c.showsize?1:0).trigger("change")},getPreviewTemplate:function(){a(g.preview);return a(g.preview)},createPreview:function(c,d,e,g,h){var i=f.getBlockContent(c),j=b.getPreviewTemplate(),k=f.data(c);k.url=d,k.name=e,k.type=g,k.size=h,j.attr("id",k.uid),b.fileName.inside(j).text(k.name).editable(!0),b.fileType.inside(j).text(k.type);
var l=a.plupload2.formatSize(k.size);b.fileSize.inside(j).text(l),b.fileUrl.inside(j).attr("href",k.url).on("click",function(a){a.preventDefault()}),i.html(j)},"{showIcon} change":function(a){var d=f.getBlockContent(h),e=f.data(h);e.showicon=1==a.val()?!0:!1,e.showicon?b.fileIcon.inside(d).removeClass("hide"):b.fileIcon.inside(d).addClass("hide")},"{showSize} change":function(a){var d=f.getBlockContent(h),e=f.data(h);e.showsize=1==a.val()?!0:!1,e.showsize?b.fileSize.inside(d).parent("div").removeClass("hide"):b.fileSize.inside(d).parent("div").addClass("hide")
},"{placeholder} mediaUploaderFilesAdded":function(a,b,c,d){EasyBlog.MediaManager.uploader.addItem(d[0],a)},"{placeholder} mediaUploaderFileUploaded":function(a,c,d,e,g){var h=g.response,i=h.media,j=i.meta,k=f.block.of(a);setTimeout(function(){b.createPreview(k,j.url,j.title,j.extension,j.size)},600)},"{placeholder} mediaUploaderFileError":function(c,d,e,f){f.code==a.plupload2.FILE_EXTENSION_ERROR&&b.fileError.inside(h).removeClass("hide")},"{placeholder} mediaUploaderError":function(){},"{self} mediaInfoDisplay":function(b,c,d,e){"file"==e.meta.type&&a(d).find("[data-file-url]").on("click",function(a){a.preventDefault()
})},"{browseButton} mediaSelect":function(a,c,d){var g=f.block.of(a);if("file"==d.meta.type){var h=d.meta,i=e.document,j=i.isLegacy();j?(content=b.toLegacyHTML(g),i.insertContent(content)):b.createPreview(g,h.url,h.title,h.type,h.size)}},"{self} mediaInsert":function(a,c,d,g){if("file"==d.meta.type){var h=e.document,i=h.isLegacy();if(i)content=b.toLegacyHTML(d.meta,g),h.insertContent(content);else{var g=f.constructBlock("file",{name:d.meta.title,type:d.meta.extension,size:d.meta.size,url:d.meta.url});f.addBlock(g),f.activateBlock(g)
}}}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/gist",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Gist",{defaultOptions:a.extend({"{form}":"> [data-gist-form]","{insert}":"[data-gist-insert]","{source}":"[data-gist-source]","{preview}":"[data-gist-preview]","{fsSource}":"[data-fs-gist-source]","{fsRefreshButton}":"[data-fs-gist-refresh]","{errorMessage}":"[data-gist-error]"},EBD.selectors)},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},toData:function(a){var b=f.data(a);return b},toText:function(a){var b=f.data(a);return b.source},toEditableHTML:function(){return""},toHTML:function(a){var c=(f.data(a),a.data("overlay"));return c?c.element().html():void 0},activate:function(a){f.getBlockContent(a),f.data(a);h=a,b.populate(a)},deactivate:function(){},construct:function(){},reconstruct:function(a){var c=f.data(a),d=a.data("overlay"),e=f.getBlockContent(a);c.source&&!d?b.createIframe(a,c.source):e.html(g.html),a.find(b.source.selector).off("paste").on("paste",function(a){a.stopPropagation()
})},deconstruct:function(){},refocus:function(){},reset:function(){},populate:function(a){var c=f.data(a);b.fsSource().val(c.source)},setOverlay:function(a,b){var c=a.data("overlay");if(c)c.element().empty(),c.element().append(b);else{var c=e.document.overlay.create(a),d=f.getBlockContent(a);c.placeholder().css("height","400px").appendTo(d),c.element().append(b),c.attach()}a.data("overlay",c)},isUrlValid:function(a){if(""==a)return!1;var b=/^https:\/\/gist\.github\.com\/(.*)\/(.*)$/,c=b.test(a);return c},createIframe:function(c,d){var e=document.createElement("iframe"),g=f.getBlockContent(c),h=f.data(c);
h.source=d,e.setAttribute("width","100%"),e.id="gistFrame",b.setOverlay(c,e);var i=a.callback(function(a){a+="px",g.find("iframe").css("height",a)}),j='<html><body onload="parent.'+i+'(document.body.scrollHeight);"><script type="text/javascript" src="'+d+'.js"></script></body></html>',k=e.document;return e.contentDocument?k=e.contentDocument:e.contentWindow&&(k=e.contentWindow.document),k.open(),k.writeln(j),k.close(),e},"{insert} click":function(a){if(h.length<1){var c=b.block.of(a);f.activateBlock(c)}{var d=f.getBlockContent(h),e=b.source.inside(d).val();
f.data(h)}return b.isUrlValid(e)?(b.fsSource().val(e),b.createIframe(h,e),b.form.inside(d).addClass("hidden"),void 0):(b.errorMessage().removeClass("hide"),void 0)},"{fsRefreshButton} click":function(){{var a=f.getBlockContent(h),c=b.fsSource().val();f.data(h)}return b.isUrlValid(c)?(b.createIframe(h,c),b.form.inside(a).addClass("hidden"),void 0):(b.errorMessage.inside(a).removeClass("hide"),void 0)}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/heading",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Heading",{defaultOptions:{"{headingElement}":"h1, h2, h3, h4, h5, h6","{levelSelection}":"[data-eb-composer-block-heading-level] [data-level]"}},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},activate:function(a){h=a,b.populate(a)},deactivate:function(){},construct:function(b){return a.create(b.level).html(b.content)},reconstruct:function(){},deconstruct:function(a,c){return c&&(a=a.clone()),b.headingElement.inside(a).editable(!1),a},refocus:function(a){var c=b.headingElement.inside(a);c.focus(),a.hasClass("is-new")&&e.editor.caret.setEnd(c[0])},reset:function(a){a.html(g.content)},populate:function(a){var c=b.level(a);b.levelSelection().where("level",c).activateClass("active")},toData:function(a){return f.getData(a)
},toHTML:function(a){var a=f.getBlockContent(a);return b.deconstruct(a,!0).html()},toText:function(a){return a.text()},heading:{inside:function(a){return a.children(":first")}},level:function(a,c){var d=f.getBlockContent(a),e=b.headingElement.inside(d),g=e.tagName();return c&&g!==c&&(d.html(b.construct({level:c,content:e.html()})),b.headingElement.inside(a).editable(!0),g=c),g},setLevel:function(a,c){var c=b.level(a,c),d=b.headingElement.inside(a),e=[a,b,d];b.trigger("composerBlockHeadingSetLevel",e),b.trigger("composerBlockChange",e)
},previewLevel:function(a,c){clearTimeout(b.previewTimer);var d=b.headingElement.inside(a),e=d.tagName();a.defineData("originalLevel",e).addClass("is-preview"),b.level(a,c);var f=[a,b,d];b.trigger("composerBlockHeadingPreviewLevel",f),b.trigger("composerBlockChange",f)},previewTimer:null,"{levelSelection} mouseover":function(a){var c=a.data("level");b.previewLevel(h,c)},"{levelSelection} mouseout":function(){clearTimeout(b.previewTimer),b.previewTimer=setTimeout(function(){var a=h.data("originalLevel");a&&b.setLevel(h,a)
},50)},"{levelSelection} click":function(a){var c=a.data("level");b.setLevel(h,c),b.refocus(h)},"{self} composerBlockHeadingSetLevel":function(a,c,d){clearTimeout(b.previewTimer),d.removeClass("is-preview").removeData("originalLevel"),d.is(h)&&b.populate(d)}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/html",function(){var b=this;EasyBlog.require().library("ace").done(function(a){EasyBlog.Controller("Composer.Blocks.Handlers.Html",{defaultOptions:{"{pre}":"[data-eb-composer-blocks-html-pre]"}},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},activate:function(a){h=a,b.populate(a)},deactivate:function(a){var b=f.getBlockContent(a),c=b.html();""==c&&b.html(g.html)},construct:function(){},reconstruct:function(){},deconstruct:function(){},refocus:function(){},reset:function(){},toText:function(a){var c=(f.data(a),a.clone()),d=f.getBlockContent(c),e=d.text();return e},toData:function(a){var b=f.data(a);return b},toHTML:function(a){var d=(f.data(a),a.clone()),e=f.getBlockContent(d),g=b.editor(),h=g.getSession();return h.setValue(e.html()),e.html()},editor:a.memoize(function(){var c=e.find(b.pre)[0];
void 0==c&&(c=a.create("pre")[0]);var d=ace.edit(c);d.setTheme("ace/theme/github");var f=d.getSession();return f.setMode("ace/mode/html"),f.on("change",a.debounce(b.sync,150)),d}),populate:function(c){var d=b.editor(),e=d.getSession(),g=f.getBlockContent(c),i=a.trim(g.html());e.setValue(i),h=c},sync:function(){var a=b.editor(e),c=a.getSession(),d=f.getBlockContent(h),g=c.getValue();d.html(g)},reset:function(){}}}),b.resolve()})}),EasyBlog.module("composer/blocks/handlers/image",function(a){function m(a){return a.replace(/image-/,"")
}function n(a){return a.toString().match("%")?"%":"px"}function o(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}function p(b){if(a.isNumeric(b))return b;var c=b.split(":");return c[0]/c[1]}function r(a,b){return o(1/p(a)*100,b||3)+"%"}function s(a,b){return o(100*a,b||3)+"%"}function t(b){if(b=a.trim(b),/\:/.test(b)){var c=b.split(":");return parseInt(c[0])+":"+parseInt(c[1])}return parseFloat(b)||0}function u(a,b){return a.css("width",b)}function v(a,b){return a.css("top",b)}function w(a,b){return a.css("left",b)
}function x(a,b){return a.css("padding-top",b)}function y(a,b){return a.css("height",b)}var b=this,c="view-selectratio",d="view-customratio",e=/fit|fill/,f="is-fluid",g="is-loading",h="is-failed",i="is-different",j="Variation could not be retrieved because media meta does not exist in library!",k=["image-width","image-height"],l=["numslider","numslider-toggle","numslider-widget","numslider-value","numslider-input","numslider-units","numslider-unit","numslider-current-unit"],z=a.Image.resizeWithin,A=a.Image.resizeToFill;
EasyBlog.require().library("plupload2","imgareaselect").done(function(){EasyBlog.Controller("Composer.Blocks.Handlers.Image",{elements:["[data-eb-composer-image-{placeholder|browse-button}]","[data-eb-image-{url-fieldset|url-field|url-field-text|url-field-update-button}]","[data-eb-image-{source-fieldset|source-field|source-thumbnail|source-title|source-size|source-url|source-change-button}]","[data-eb-image-{variation-field|variation-list-container|variation-new-button|variation-create-button|variation-rebuild-button|variation-delete-button|variation-cancel-button|variation-cancel-failed-button}]","[data-eb-image-source-fieldset] [data-eb-mm-{variation-list|variation-list-item-group|variation-item}]","[data-eb-image-{variation-name|variation-width|variation-height}]","[data-eb-{image-size-fieldset|image-size-simple-field|image-size-advanced-field}]","^imageSize [data-eb-image-size-{preset-toggle|current-preset|preset|retry-button}]","[data-eb-image-size-fieldset] [data-eb-{"+l.join("|")+"}]","^imageSizeField .eb-composer-field[data-name={"+k.join("|")+"}]","[data-eb-image-{alignment-selection}]","[data-eb-image-{ratio-lock|ratio-button|ratio-label|ratio-customize-button|ratio-cancel-button|ratio-use-custom-button|ratio-cancel-custom-button|ratio-selection|ratio-preview|ratio-input}]","[data-eb-image-{map|map-container|map-figure|map-viewport|map-preview|map-picker}]","[data-eb-image-{strategy-menu-item|strategy-menu-content}]","[data-eb-image-{resize-input-field|resize-ratio-lock|resize-reset-button}]","[data-eb-image-{style-toggle|style-selection}]","[data-eb-image-{caption-toggle|caption-text-field}]","[data-eb-image-{link-toggle}]","[data-eb-image-link-fieldset] [data-eb-{link-url-field|link-title-field|link-blank-option}]","[data-eb-image-{popup-toggle|popup-fieldset|popup-field|popup-thumbnail|popup-title|popup-size|popup-url|popup-change-button}]","[data-eb-image-{popup-variation-field|popup-variation-list-container}]","^popup [data-eb-image-popup-fieldset] [data-eb-mm-{variation-list|variation-list-item-group|variation-item}]"],defaultOptions:a.extend({uploader:{runtimes:"html5,flash",url:"/echo/json",max_file_size:"10mb",filters:[{title:"Image files",extensions:"jpg,gif,png"}]},"{browseButton}":".eb-composer-placeholder-image [data-eb-mm-browse-button]","{imagePlaceholder}":"[data-eb-composer-image-placeholder]","{imageContainer}":".eb-image","{imageFigure}":".eb-image-figure","{imageViewport}":".eb-image-viewport","{imageElement}":".eb-image-figure img","{imagePopupButton}":".eb-image-popup-button","{imageCaption}":".eb-image-caption","{imageCaptionText}":".eb-image-caption > span","{imageHint}":".eb-image-hint","{imageUrlForm}":"[data-eb-image-url-form]","{imageUrlTextbox}":"[data-eb-image-url-textbox]","{imageUrlAdd}":"[data-eb-image-url-add]","{imageUrlCancel}":"[data-eb-image-url-cancel]"},EBD.selectors)},function(b,k,o,q,B,C,D,E,F){function G(a){return"image"==B.getBlockType(a)
}return{init:function(){B=b.blocks,q=B.composer,C=k.meta,D=a(),E=EasyBlog.MediaManager,F=q.panels.fieldset,a.each(l,function(c,d){var e=a.camelize(d),f={};b[e].of=function(a){var c=f[a];if(!c){var d=b.getImageSizeField(a);c=b[e].under(d),c.length&&(f[a]=c)}return c}})},deactivate:function(){},activate:function(a){D=a,a.hasClass("is-new")&&a.css("text-align","center"),b.populate(a)},construct:function(c){var d=B.createBlockContainer("image"),c=a.extend(B.data(d),c),e=B.getBlockContent(d).empty(),f=b.constructImage(c);
return e.append(f),d.css("text-align","center"),d},constructFromMediaFile:function(c){var d=c.data("key"),e=E.getUri(d),f=B.createBlockContainer("image"),g=B.getBlockContent(f),h=B.data(f);return f.css("text-align","center"),f.addClass("is-loading"),E.getMedia(e).done(function(a){var c=a.meta,d=E.getVariation(c.uri,"thumbnail");h.uri=c.uri,h.url=d.url,h.simple="simple",h.ratio_lock=!0,h.variation=d.key;var e=b.constructImage(h);g.html(e),f.hasClass("active")&&b.populate(f)}).fail(function(){var b=a(C.html);b.addClass("state-failed"),g.html(b)
}).always(function(){f.removeClass("is-loading")}),f},constructImage:function(c){var d=a(C.imageContainer),e=b.imageFigure.inside(d),g=b.imageElement.inside(d);if(g.attr("src",c.url),c.fluid&&d.addClass(f),d.addClass("style-"+c.style),c.caption_text&&(d.append(C.imageCaption),b.imageCaptionText.inside(d).html(c.caption_text)),c.popup_url){var h=a(C.imagePopupButton);h.attr("href",c.popup_url),e.append(h)}return d},toData:function(a){var b=B.data(a);return b},toHTML:function(a){if(!b.hasImage(a))return"";var c=a.clone(),d=b.deconstruct(c),e=B.getBlockContent(d);
return e.html()},toLegacyHTML:function(c){var d=b.toData(c),e=a("<img>").attr({src:d.url,width:d.width,height:d.height});if(d.caption_text&&e.addClass("easyblog-image-caption").attr("title",d.caption_text),d.popup_url&&e.attr("data-popup",d.popup_url),d.style&&e.attr("data-style",d.style),d.link_url){var f=a("<a>").attr({href:d.link_url,title:d.link_title,target:d.link_target}).append(e);return f.prop("outerHTML")}return e.prop("outerHTML")},toText:function(a){var c=b.imageCaptionText.inside(a).text(),d=b.imageElement.inside(a).attr("alt");
return c+"\n"+d},reconstruct:function(a){var c=b.imagePlaceholder.inside(a);c.length>0&&EasyBlog.MediaManager.uploader.register(c)},hasImage:function(a){return b.imageContainer.inside(a).length>0},"{imagePlaceholder} mediaUploaderFilesAdded":function(a,b,c,d){EasyBlog.MediaManager.uploader.addItem(d[0],a)},"{imagePlaceholder} mediaUploaderFileUploaded":function(a,c,d,e,f){var g=f.response,h=g.media,i=h.meta,j=B.block.of(a);setTimeout(function(){b.updateImageSource(j,i)},600)},"{browseButton} mediaSelect":function(a,c,d){var e=B.block.of(a);
if("image"==d.meta.type){var f=d.meta,g=q.document,h=g.isLegacy();h?(content=b.toLegacyHTML(e),g.insertContent(content)):b.setImageSource(e,f)}},"{popupChangeButton} mediaSelectStart":function(a){var d=D.data("uid");a.data("uid",d)},"{popupChangeButton} mediaSelect":function(a,c,d){if("image"==d.meta.type){{var e=D.data("uid"),f=a.data("uid"),g=d.meta,h=q.document;h.isLegacy()}if(e!=f){var j=B.getBlock(f);b.setImagePopup(j,g.uri)}else b.updateImagePopup(D,g.uri)}},"{sourceChangeButton} mediaSelectStart":function(a){var b=D.data("uid");
a.data("uid",b)},"{sourceChangeButton} mediaSelect":function(a,c,d){if("image"==d.meta.type){var e=D.data("uid"),f=a.data("uid"),g=d.meta,h=q.document,i=h.isLegacy();if(i)content=b.toLegacyHTML(j),h.insertContent(content);else if(e!=f){var j=B.getBlock(f);b.setImageSource(j,g)}else b.updateImageSource(D,g)}},"{self} mediaInsert":function(a,c,d,e){if("image"==d.meta.type){var f=q.document,g=f.isLegacy();if(b.normalizeImageSize(e),g)content=b.toLegacyHTML(e),f.insertContent(content);else{var h=B.data(e),e=B.constructBlock("image",h);
B.addBlock(e),B.activateBlock(e)}}},deconstruct:function(a){return a},refocus:function(){},reset:function(){},populate:function(a){var c=b.hasImage(a),d=B.panel.fieldgroup.get("image");d.toggleClass("is-new",!c),c&&(b.populateImageUrl(a),b.populateImageSource(a),b.populateImageSize(a),b.populateImageCaption(a),b.populateImageLink(a),b.populateImagePopup(a),b.populateImageStyle(a))},showImageHint:function(c,d){b.imageHint.inside(c).remove();var e=a(C.imageHint);e.find(".eb-hint-text").html(d);var f=b.imageViewport.inside(c);
f.append(e),e.removeClassAfter("is-new",1e3),setTimeout(function(){e.remove()},2500)},setImageSource:function(a,c){var d=B.data(a),e=E.getVariation(c.uri,"thumbnail");d.variation=e.key,d.url=e.url,d.uri=c.uri,d.natural_width=e.width,d.natural_height=e.height,d.natural_ratio=e.width/e.height;var f=b.constructImage(d);B.getBlockContent(a).empty().append(f)},updateImageSource:function(a,c){b.setImageSource(a,c),b.populate(a)},getSourceThumbnailImage:function(b){return a("<img>").attr("src",b)[0]},populateImageUrl:function(a){var c=B.data(a),d=b.urlFieldset();
return d.removeClass("hidden"),c.isurl?(b.urlFieldText().val(c.url),void 0):(d.addClass("hidden"),void 0)},populateImageSource:function(c){var d=B.data(c),e=b.sourceFieldset();if(e.removeClass("hidden"),d.isurl)return e.addClass("hidden"),void 0;var f=d.uri,e=b.sourceFieldset();e.addClass(g),E.getMedia(f).done(function(d){var e=d.meta,f=b.getSourceThumbnailImage(e.thumbnail);b.sourceThumbnail().empty().append(f),b.sourceTitle().text(e.title);var g=a(d.variations);b.variationListContainer().empty().append(g),b.populateImageVariation(c)
}).fail(function(){e.addClass(h)}).always(function(){e.removeClass(g)})},populateImageVariation:function(c){var d=B.data(c),e=d.uri,f=d.variation,g=E.getVariation(e,f);if(!g)return console.error(j),void 0;var h=b.variationItem().where("key",'"'+f+'"').activateClass("active");b.sourceSize().text(a.plupload2.formatSize(g.size||"")),b.sourceUrl().text(g.url||"");var i=h.hasClass("is-system"),k=h.hasClass("is-missing");b.variationField().toggleClass("can-delete",!i).toggleClass("is-missing",k)},setImageVariation:function(c,d){var e=B.data(c),f=e.uri,g=E.getVariation(f,d);
return g?(b.imageElement.inside(c).attr("src",g.url),b.showImageHint(c,a.String.capitalize(g.name)+'<br/><span style="font-weight: normal;">'+g.width+"x"+g.height+"</span>"),e.variation=d,e.url=g.url,void 0):EasyBlog.debug&&console.error(j)},updateImageVariation:function(a,c){b.setImageVariation(a,c),b.populateImageVariation(a)},"{variationItem} click":function(a){var c=a.data("key");b.updateImageVariation(D,c)},"{variationNewButton} click":function(){b.variationField().addClass("show-create-form");var c=B.data(D),d=c.uri,e=E.getVariation(d,"system/original"),f=e.width,g=e.height,h=f/g;
b.variationWidth().val(f).data("value",f).data("ratio",h),b.variationHeight().val(g).data("value",g).data("ratio",h)},"{variationCancelButton} click":function(){b.variationField().removeClass("show-create-form")},"{variationCreateButton} click":function(){var d=b.variationField(),e=a.trim(b.variationName().val()),f=b.variationWidth().val(),g=b.variationHeight().val();if(""!=a.trim(e)){d.addClass("is-creating");var h=D,i=B.data(h),j=i.uri;E.createVariation(j,e,f,g).done(function(c){var e=a(c.variations);b.variationListContainer().empty().append(e),b.populateImageVariation(h),d.removeClass("show-create-form")
}).fail(function(){d.removeClass("is-creating").addClass("is-failed")}).always(function(){d.removeClass("is-creating")})}},"{variationCancelFailedButton} click":function(){b.variationField().removeClass("is-failed")},"{variationRebuildButton} click":function(){var d=B.data(D),e=d.uri,f=b.variationItem(".active"),g=f.data("key"),h=E.getVariation(e,g),i=h.name,j=E.getKey(e);EasyBlog.ajax("site/views/mediamanager/rebuildVariation",{name:i,key:j}).done(function(c){var d=a(c.variations);b.variationListContainer().empty().append(d),b.populateImageVariation(D),E.setMedia(e,c)
})},"{variationDeleteButton} click":function(){var d=B.data(D),e=d.uri,f=b.variationItem(".active"),g=f.data("key"),h=E.getVariation(e,g),i=h.name;E.removeVariation(e,i).done(function(c){var d=a(c.variations);b.variationListContainer().empty().append(d);var f=E.getVariation(e,"thumbnail");b.updateImageVariation(D,f.key)})},"{variationWidth} input":function(c){var d=c.data("ratio"),e=Math.round(parseFloat(c.val()));if(a.isNumeric(e)){var f=Math.round(e/d);b.variationHeight().val(f)}},"{variationHeight} input":function(c){var d=c.data("ratio"),e=Math.round(parseFloat(c.val()));
if(a.isNumeric(e)){var f=Math.round(e*d);b.variationWidth().val(f)}},"{variationWidth} focus":function(a){a.select()},"{variationHeight} focus":function(a){a.select()},"{variationWidth} blur":function(c){var d=c.data("ratio"),e=Math.round(parseFloat(c.val()));if(c.val(e),!a.isNumeric(e)){var f=b.variationHeight(),g=Math.round(parseFloat(f.val()));a.isNumeric(g)?(e=Math.round(g*d),c.val(e),f.val(g)):b.resetVariationFields()}},"{variationHeight} blur":function(c){var d=c.data("ratio"),e=Math.round(parseFloat(c.val()));
if(c.val(e),!a.isNumeric(e)){var f=b.variationWidth(),g=Math.round(parseFloat(f.val()));a.isNumeric(g)?(e=Math.round(g/d),f.val(g),c.val(e)):b.resetVariationFields()}},resetVariationFields:function(){var a=b.variationWidth(),c=b.variationHeight();a.val(a.data("width")),c.val(c.data("height"))},populateImageMode:function(c){var d=B.data(c),e=d.mode,f=d.mode_lock;B.isRootBlock(c)&&(e="simple",f=!0),b.imageSizeFieldset().toggleClass("mode-lock",f);var g=b.imageSizePreset().removeClass("active").where("type",e).addClass("active"),h=a.trim(g.text());
b.imageSizeCurrentPreset().html(h);var i="preset-"+e;b.imageSizeFieldset().switchClass(i)},setImageMode:function(a,c){"simple"==c&&b.toSimpleImageMode(a),"advanced"==c&&b.toAdvancedImageMode(a)},toSimpleImageMode:function(a){var c=B.data(a);c.mode="simple",c.ratio=c.natural_ratio,c.ratio_lock=!0,c.element_width="",c.element_height="",c.element_top="",c.element_left="";var d=b.imageElement.inside(a);d.css({width:"",height:"",top:"",left:""}),b.normalizeImageSize(a)},toAdvancedImageMode:function(a){var c=B.data(a);
c.mode="advanced",c.ratio||(c.ratio=c.natural_ratio),c.element_ratio||(c.element_ratio=c.ratio),b.normalizeImageSize(a),b.resizeToFitViewport(a)},updateImageMode:function(a,c){b.setImageMode(a,c),b.populateImageSize(a)},"{imageSizePreset} click":function(a){var c=a.data("type");b.updateImageMode(D,c)},populateImageSize:function(){var c=function(a){if(a.is(D)){for(var d,c=c||["width","height"];d=c.shift();){var e="width"==d?b.getImageWidth(a):b.getImageHeight(a),f=parseFloat(e),g=n(e);if(b.resizingFromSlider!==d){if("px"==g)var h={start:f,step:1,range:{min:1,max:1600},pips:{mode:"values",values:[64,320,640,960,1280,1600],density:4}};
if("%"==g)var h={start:f,step:1,range:{min:1,max:100},pips:{mode:"values",values:[0,20,40,60,80,100],density:5}};b.numsliderWidget.of(d).find(".noUi-pips").remove().end().noUiSlider(h,!0).noUiSlider_pips(h.pips)}b.numsliderInput.of(d).val(Math.round(f)),b.numsliderCurrentUnit.of(d).html(g),b.numsliderUnit.of(d).removeClass("active").where("unit",'"'+g+'"').addClass("active")}var i=B.data(a),j=i.width_lock&&i.height_lock;b.imageSizeFieldset().toggleClass("hide-simple-field",j),b.populateImageMode(a),b.populateImageRatio(a),b.populateImageAlignment(a),b.populateImageAdvancedFields(a)
}};return function(d){var e=B.data(d),f=b.imageSizeFieldset(),g=b.imageElement.inside(d),h=e.size_enabled;if(F.toggle("image-size",h),g[0].complete)f.removeClass("is-loading is-failed"),c(d);else{var i=g.attr("src");f.addClass("is-loading"),a.Image.get(i).done(function(){c(d)}).fail(function(){f.switchClass("is-failed")}).always(function(){f.removeClass("is-loading is-failed")})}}}(),"{imageSizeRetryButton} click":function(){b.populateImageSize(D)},setImageSize:function(a,c,d){"width"==c&&b.setImageWidth(a,d),"height"==c&&b.setImageHeight(a,d)
},updateImageSize:function(a,c,d){b.setImageSize(a,c,d),b.populateImageSize(a)},normalizeImageSize:function(a){var c=B.data(a),d=b.isFluidImage(a);if(B.isRootBlock(a))var e=b.imageFigure.inside(a).width();if(B.isNestedBlock(a))var e=B.dimensions.getFluidWidth(a);b.setImageWidth(a,e),(d||"advanced"==c.mode)&&b.toFluidImage(a)},resetImageSize:function(a){var c=B.data(a);c.mode="simple";var d=b.imageContainer.inside(a),e=b.imageFigure.inside(a),f=b.imageElement.inside(a),g={width:"",height:"",top:"",left:"",paddingTop:"","float":""};
d.css(g),e.css(g),f.css(g),B.isRootBlock(a)&&b.setImageWidth(a,"100%"),B.isNestedBlock(a)&&b.setImageWidth(a,"30%")},getImageWidth:function(a){var c=b.imageFigure.inside(a),d=c[0].style;if(B.isRootBlock(a)){var e=b.imageContainer.inside(a),f=e[0].style.width;if(/%/.test(f))return f}if(B.isNestedBlock(a)){var g=a[0].style.width;if(/%/.test(g))return g}return d.width||c.css("width")},setImageWidth:function(a,c){var d=B.getData(a),e=n(c),g=parseFloat(c),h="%"==e,i="px"==e,j="simple"==d.mode,k="advanced"==d.mode,l=b.imageContainer.inside(a),m=b.imageElement.inside(a),q=(b.imageViewport.inside(a),b.imageFigure.inside(a)),t=(m.width(),m.height());
h&&(d.fluid=!0,l.addClass(f)),i&&(d.fluid=!1,l.removeClass(f)),k&&b.toFixedElement(a),B.isRootBlock(a)&&(a.css("width",""),h&&(u(l,c),u(q,"100%"),j&&(u(m,"100%"),d.element_width="100%")),i&&(u(l,""),u(q,c),j&&(u(m,c),d.element_width=parseFloat(c)))),B.isNestedBlock(a)&&(h&&(u(a,c),u(q,""),j&&(u(m,"100%"),d.element_width="100%")),i&&(u(a,"auto"),u(q,c),j&&(u(m,c),d.element_width=parseFloat(c)))),d.width=h?c:g;var v=d.ratio,w=d.ratio_lock,z=d.natural_ratio;if(w){var A=j?z:v;if(h&&(y(q,""),x(q,r(A)),j&&(y(m,"100%"),d.element_height="100%"),d.height="100%"),i){var C=m.width(),D=C/p(A);
y(q,D),x(q,""),j&&(y(m,D),d.element_height=D),d.height=D}d.ratio=A,j&&(d.element_ratio=A)}else{var C=m.width(),v=C/t;h&&x(q,r(v)),i&&x(q,""),d.ratio=v,j&&(d.element_ratio=v)}if(k){b.toFluidElement(a);var E=d.strategy;/fit|fill/.test(E)&&b.resizeToViewport(a,E)}var F=b.imageCaption.inside(a);h&&u(F,"100%"),i&&u(F,c)},updateImageWidth:function(a,c){b.setImageWidth(a,c),b.populateImageSize(a)},getImageHeight:function(a){var c=b.imageFigure.inside(a),d=c[0].style;return d.height||c.css("height")},setImageHeight:function(a,c){var d=B.data(a),c=parseFloat(c),e=d.ratio,f=d.ratio_lock,g=d.natural_ratio,h="simple"==d.mode,i="advanced"==d.mode,j=b.imageElement.inside(a),l=(b.imageViewport.inside(a),b.imageFigure.inside(a));
if(b.isFluidImage(a)){if(f){var m=h?g:e,n=c*p(m);b.setImageWidth(a,n),b.toFluidImage(a),d.ratio=m,h&&(d.element_ratio=m)}else{i&&b.toFixedElement(a);var o=j.width(),e=o/c;if(x(l,r(e)),d.ratio=e,h&&(d.element_ratio=e),i){b.toFluidElement(a);var q=d.strategy;/fit|fill/.test(q)&&b.resizeToViewport(a,q)}}d.height="100%"}if(b.isFixedImage(a))if(f){var m=h?g:e,n=c*p(m);b.setImageWidth(a,n)}else y(l,c),y(j,c),d.height=c,d.element_width=parseFloat(c)},updateImageHeight:function(a,c){b.setImageHeight(a,c),b.populateImageSize(a)
},isFluidImage:function(a){return b.imageContainer.inside(a).hasClass(f)},isFixedImage:function(a){return!b.isFluidImage(a)},toFixedImage:function(a){var c=B.data(a),d=b.imageElement.inside(a),e=d.width(),f=d.height();b.setImageWidth(a,e);var g=c.ratio_lock;g||b.setImageHeight(a,f)},toFluidImage:function(a){var c=B.data(a),d=b.imageContainer.inside(a),e=b.imageElement.inside(a);if(B.isRootBlock(a))var f=d.width(),g=a.width(),h=Math.round(f/g*100)+"%";if(B.isNestedBlock(a))var h=B.dimensions.getFluidWidth(a);
var i=e.height();b.setImageWidth(a,h);var j=c.ratio_lock;j||b.setImageHeight(a,i)},getImageSizeField:function(c){var d=b["imageSizeFieldImage"+a.capitalize(a.camelize(c))]();return d},getImageSizeProp:function(a){var c=a.closest(b.numslider.selector),d=m(c.data("name"));return d},getImageSizeUnit:function(c){var d=b.getImageSizeField(c);return a.trim(b.numsliderCurrentUnit.under(d).text())},handleNumsliderWidget:function(a,c){var d=b.getImageSizeProp(a),e=b.getImageSizeUnit(d),c=Math.round(c)+e;b.resizingFromSlider=d,b.updateImageSize(D,d,c),b.resizingFromSlider=null
},"{numsliderWidget} nouislide":function(a,c,d){b.handleNumsliderWidget(a,d)},"{numsliderWidget} set":function(a,c,d){b.handleNumsliderWidget(a,d)},"{numsliderInput} input":function(c){function d(a){c.on("blur.numslider",function(){c.val(a)})}c.off("blur.numslider");var e=b.getImageSize(D),f=b.getImageSizeProperty(c),g=c.val();return a.isNumeric(g)?(g=Math.round(g),b.updateImageSize(D,f,g),void 0):d(e[a.camelize(f)])},"{numsliderUnit} click":function(a){var c=a.data("unit");"px"==c&&b.toFixedImage(D),"%"==c&&b.toFluidImage(D),b.populateImageSize(D)
},"{self} composerBlockResizeStart":function(a,c,d){if(G(d)&&b.hasImage(d)){var f=b.imageFigure.inside(d),g={width:f.width(),height:f.outerHeight(),fluid:b.isFluidImage(d)};d.data("initialImageSize",g)}},"{self} composerBlockBeforeResize":function(a,c,d,e){function k(){var a=f.width+i;b.setImageWidth(d,a)}function l(){var a=f.height+j;b.setImageHeight(d,a)}if(G(d)&&b.hasImage(d)){c.preventDefault();var f=d.data("initialImageSize"),g=e.originalSize,h=e.size,i=h.width-g.width,j=h.height-g.height,m=B.data(d),n=m.ratio_lock;
n?0==i?l():k():(0!==i&&k(),0!==j&&l()),f.fluid&&b.toFluidImage(d),b.populateImageSize(d)}},"{self} composerBlockResizeStop":function(a,c,d){G(d)&&b.hasImage(d)&&d.removeData("initialImageSize")},"{self} composerBlockNestIn":function(a,c,d){G(d)&&b.hasImage(d)&&(b.resetImageSize(d),b.populateImageSize(d))},"{self} composerBlockNestOut":function(a,c,d){G(d)&&b.hasImage(d)&&(b.resetImageSize(d),b.populateImageSize(d))},populateImageRatio:function(a){var e=B.data(a),f=e.ratio,g=e.ratio_lock;b.ratioLabel().html(f),b.ratioButton().toggleClass("ratio-unlocked",!g);
var h=".ar-original",i=e.natural_ratio,j=r(i);b.ratioSelection(h).attr("data-value",i),b.ratioPreview(h).find("> div").css("padding-top",j).find("span").text(i),b.imageSizeFieldset().removeClass(d).removeClass(c)},lockImageRatio:function(a){var c=B.data(a);c.ratio_lock=!0,b.normalizeImageSize(a)},unlockImageRatio:function(a){var b=B.data(a);b.ratio_lock=!1},setImageRatio:function(a,c){var d=B.data(a);d.ratio=c;var f=d.ratio_lock=0!==c;if(f){var g="simple"==d.mode,h="advanced"==d.mode;if(g&&(d.element_ratio=c,b.normalizeImageSize(a)),h){var i=d.strategy;
e.test(i)?(b.normalizeImageSize(a),b.resizeToViewport(a,i)):(b.toFixedElement(a),b.normalizeImageSize(a),b.toFluidElement(a))}}},updateImageRatio:function(a,c){b.setImageRatio(a,c),b.populateImageSize(a)},"{ratioLock} change":function(a){a.is(":checked")?b.lockImageRatio(D):b.unlockImageRatio(D)},"{ratioButton} click":function(){b.imageSizeFieldset().switchClass(c)},"{ratioCustomizeButton} click":function(){b.imageSizeFieldset().switchClass(d)},"{ratioCancelButton} click":function(){b.imageSizeFieldset().removeClass(c)
},"{ratioCancelCustomButton} click":function(){b.imageSizeFieldset().switchClass(c)},"{ratioOkCustomButton} click":function(){b.imageSizeFieldset().removeClass(d)},"{ratioUseCustomButton} click":function(){var c=b.ratioInput(),e=t(c.val());0!=e&&(b.updateImageRatio(D,e),b.ratioSelection().removeClass("active"),b.imageSizeFieldset().removeClass(d))},"{ratioSelection} click":function(a){b.ratioSelection().removeClass("active"),a.addClass("active"),b.imageSizeFieldset().removeClass(c);var d=a.data("value");b.updateImageRatio(D,d)
},setImageAlignment:function(a,c){var d=b.imageContainer.inside(a);/left|right/.test(c)&&(d.css("float",c),a.css("text-align","")),/center/.test(c)&&(d.css("float",""),a.css("text-align","center"));var e=B.data(a);e.alignment=c},updateImageAlignment:function(a,c){b.setImageAlignment(a,c),b.populateImageAlignment(a)},populateImageAlignment:function(a){if(B.isNestedBlock(a))return b.imageSizeFieldset().addClass("no-alignment"),void 0;b.imageSizeFieldset().removeClass("no-alignment");var c=B.data(a),d=c.alignment;
b.alignmentSelection().val(d)},"{alignmentSelection} change":function(a){var c=a.val();b.updateImageAlignment(D,c)},populateImageAdvancedFields:function(a){var c=B.data(a);"advanced"===c.mode&&(b.populateImageResizeStrategy(a),b.populateImageResizeMap(a),b.populateImageResizeFields(a))},populateImageResizeStrategy:function(a){var c=B.data(a),d=c.strategy;b.strategyMenuItem().where("strategy",d).activateClass("active"),b.strategyMenuContent().where("strategy",d).activateClass("active")},setImageResizeStrategy:function(a,c){var d=B.data(a);
d.strategy=c,e.test(c)&&b.resizeToViewport(a,c)},updateImageResizeStrategy:function(a,c){b.setImageResizeStrategy(a,c),b.populateImageAdvancedFields(a)},resizeToViewport:function(a,c){var d=B.data(a),e=d.natural_width,f=d.natural_height,g=b.imageViewport.inside(a),h=g.width(),i=g.height(),j=("fit"==c?z:A)(e,f,h,i),k=d.element_width=s(j.width/h),l=d.element_height=s(j.height/i),m=d.element_top=s(j.top/i),n=d.element_left=s(j.left/h),o=b.imageElement.inside(a);o.css({width:k,height:l,top:m,left:n})},resizeToFillViewport:function(a){b.setImageResizeStrategy(a,"fill")
},resizeToFitViewport:function(a){b.setImageResizeStrategy(a,"fit")},"{strategyMenuItem} click":function(a){var c=a.data("strategy");b.updateImageResizeStrategy(D,c)},populateImageResizeMap:function(c){var d=B.data(c);if("custom"===d.strategy){var e=b.mapFigure(),f=e.width(),g=e.height(),h=b.imageViewport(),i=h.width(),j=h.height(),k=b.mapViewport(),l=z(i,j,f,g);k.css(l);var m=b.mapPreview(),n=["n","s","w","e","sw","se","nw","ne"],o=b.createResizeHandleElements(n),p=b.createResizeHandleSelectors(n);m.hasClass("ui-resizable")&&m.resizable("destroy"),m.hasClass("ui-draggable")&&m.draggable("destroy"),m.css({backgroundImage:a.cssUrl(d.url),width:d.element_width,height:d.element_height,top:d.element_top,left:d.element_left}).empty().append(o).resizable({handles:p,aspectRatio:d.element_ratio_lock}).draggable()
}},createResizeHandleSelectors:function(b){var c=[];return a.each(b,function(a,b){c[b]="> .ui-resizable-"+b}),c},createResizeHandleElements:function(b){var c=[];return a.each(b,function(b,d){var e=a('<div class="ui-resizable-handle ui-resizable-'+d+'"><div></div></div>')[0];c.push(e)}),c},getElementSizeFromMap:function(){var a=b.mapViewport(),c=a.width(),d=a.height(),e=b.mapPreview(),f=e.position(),g=f.top,h=f.left,i=e.width(),j=e.height(),k=s(g/d),l=s(h/c),m=s(i/c),n=s(j/d);return{top:k,left:l,width:m,height:n}
},setElementSizeFromMap:function(a){var c=B.data(a),d=b.getElementSizeFromMap(),e=b.imageElement.inside(a);e.css(d),b.setElementSizeOnBlockData(d,c)},updateElementSizeFromMap:function(a){b.setElementSizeFromMap(a),b.populateImageResizeFields(a)},setElementSizeOnBlockData:function(a,b){for(var d,c=["top","left","width","height"];d=c.shift();)b["element_"+d]=a[d]},toFixedElement:function(a){var c=b.imageElement.inside(a),d=c.position(),e=d.top,f=d.left,g=c.width(),h=c.height();c.css({width:g,height:h,top:e,left:f})
},toFluidElement:function(a){var c=B.data(a),d=b.imageElement.inside(a),e=d.position(),f=e.top,g=e.left,h=d.width(),i=d.height(),j=b.imageViewport.inside(a),k=j.width(),l=j.height(),m=c.element_top=s(f/l),n=c.element_left=s(g/k),o=c.element_width=s(h/k),p=c.element_height=s(i/l);d.css({top:m,left:n,width:o,height:p})},"{mapPreview} resize":function(){b.updateElementSizeFromMap(D)},"{mapPreview} drag":function(){b.updateElementSizeFromMap(D)},populateImageResizeFields:function(a){for(var f,c=B.data(a),d=b.resizeInputField(),e=["width","height","top","left"];f=e.shift();){if(b.resizingFromInput==f)return;
d.where("prop",f).val(c["element_"+f])}b.resizeRatioLock().prop("checked",c.element_ratio_lock)},setElementSize:function(c,d,e){return b["setElement"+a.capitalize(d)](c,e)},updateElementSize:function(a,c,d){b.setElementSize(a,c,d),b.populateImageAdvancedFields(a)},setElementWidth:function(a,c){var d=B.data(a),f=(parseFloat(c),n(c)),g=d.element_ratio,h=d.element_ratio_lock,i=b.imageViewport.inside(a),j=b.imageElement.inside(a);if("%"==f)if(h){var k=d.element_width,l=j.width(),m=c,o=l*(parseFloat(m)/parseFloat(k)),p=o/g,q=i.height(),r=s(p/q);
d.element_width=m,d.element_height=r,u(j,m),y(j,r)}else{var m=c;d.element_width=parseFloat(m),u(j,m)}},setElementHeight:function(a,c){var d=B.data(a),f=(parseFloat(c),n(c)),g=d.element_ratio,h=d.element_ratio_lock,i=b.imageViewport.inside(a),j=b.imageElement.inside(a);if("%"==f)if(h){var k=d.element_height,l=j.height(),m=c,o=l*(parseFloat(m)/parseFloat(k)),p=o*g,q=i.width(),r=s(p/q);d.element_width=r,d.element_height=m,u(j,r),y(j,m)}else{var m=c;d.element_height=m,y(j,m)}},setElementTop:function(a,c){var d=B.data(a);
d.element_top=c;var e=b.imageElement.inside(a);v(e,c)},setElementLeft:function(a,c){var d=B.data(a);d.element_left=c;var e=b.imageElement.inside(a);w(e,c)},setElementRatio:function(a,c){var d=B.data(a);d.element_ratio=c,b.setElementWidth(a,d.element_width)},updateElementRatio:function(a,c){b.setElementRatio(a,c),b.populateImageAdvancedFields(a)},resetElementSize:function(a){b.setImageResizeStrategy(a,"fit"),b.setImageResizeStrategy(a,"custom"),b.populateImageAdvancedFields(a)},lockElementRatio:function(a){var c=B.data(a);
c.element_ratio_lock=!0;var d=c.natural_ratio;b.updateElementRatio(a,d)},unlockElementRatio:function(a){var c=B.data(a);c.element_ratio_lock=!1,b.populateImageAdvancedFields(a)},"{resizeInputField} input":function(c){var e=c.data("prop"),f=c.val(),g=a.trim(f.replace(/\%/gi,""));a.isNumeric(g)&&(f=parseFloat(g)+"%",b.resizingFromInput=e,b.updateElementSize(D,e,f),b.resizingFromInput=null)},"{resizeInputField} focus":function(a){a.select()},"{resizeInputField} blur":function(a){var b=B.data(D),c=a.data("prop"),d=b["element_"+c];
a.val(d)},"{resizeResetButton} click":function(){b.resetElementSize(D)},"{resizeRatioLock} click":function(a){var c=a.is(":checked");c?b.lockElementRatio(D):b.unlockElementRatio(D)},populateImageCaption:function(a){var c=B.data(a),d=c.caption_enabled;F.toggle("image-caption",d);var e=b.imageCaption.inside(a).length;F.enable("image-caption",e);var f=c.caption_text;f&&b.captionTextField().val(f)},getImageCaption:function(a){var b=B.data(a);return b.caption_text},setImageCaption:function(c,d){var e=b.imageCaption.inside(c);
if(!e.length){var e=a(C.imageCaption),f=b.imageContainer.inside(c);f.append(e)}var g=b.imageCaptionText.inside(c);g.text(d);var h=B.data(c);h.caption_text=d},removeImageCaption:function(a){var c=b.imageCaption.inside(a);c.remove()},enableImageCaption:function(a){var c=B.data(a);c.caption_text||(c.caption_text=b.captionTextField().val()),b.setImageCaption(a,c.caption_text),b.populateImageCaption(a)},disableImageCaption:function(a){b.removeImageCaption(a),b.populateImageCaption(a)},"{captionToggle} change":function(a){a.is(":checked")?b.enableImageCaption(D):b.disableImageCaption(D)
},"{captionTextField} input":function(a){var d=a.val();b.setImageCaption(D,d)},populateImageStyle:function(a){var c=B.data(a),d=c.style_enabled;F.toggle("image-style",d),b.styleSelection().where("value",c.style).activateClass("active")},setImageStyle:function(a,c){var d=b.imageContainer.inside(a);d.switchClass("style-"+c);var e=B.data(a);e.style=c},updateImageStyle:function(a,c){b.setImageStyle(a,c),b.populateImageStyle(a)},"{styleSelection} click":function(a){var d=a.data("value");b.updateImageStyle(D,d)},populateImageLink:function(a){var c=B.data(a),d=c.link_enabled;
F.toggle("image-link",d),b.linkUrlField().val(c.link_url),b.linkTitleField().val(c.link_title),b.linkBlankOption().prop("checked","_blank"==c.link_target);var e=""!==c.link_url;F.enable("image-link",e)},setImageLinkUrl:function(c,d){var e=B.data(c);e.link_url=d=a.trim(d);var f=b.imageViewport.inside(c);d?f.attr("href",d):f.removeAttr("href")},setImageLinkTitle:function(a,c){var d=B.data(a);d.link_title=c,b.imageViewport.inside(a).attr("title",d.link_title)},setImageLinkTarget:function(a,c){var d=B.data(a);d.link_target=c;
var e=b.imageViewport.inside(a);c?e.attr("target",c):e.removeAttr("target")},removeImageLink:function(a){var c=B.data(a);c.link_url="",c.link_title="",c.link_target="";var d=b.imageViewport.inside(a);d.removeAttr("href").removeAttr("title").removeAttr("target"),b.populateImageLink(a)},"{linkUrlField} input":function(a){var c=a.val();b.setImageLinkUrl(D,c)},"{linkTitleField} input":function(a){var c=a.val();b.setImageLinkTitle(D,c)},"{linkBlankOption} change":function(a){var c=a.is(":checked"),d=c?"_blank":"";
b.setImageLinkTarget(D,d)},"{linkToggle} change":function(a){a.is(":checked")||b.removeImageLink(D)},"{imageViewport} click":function(a,b){b.preventDefault()},setImagePopup:function(a,c,d){var e=B.data(a);b.imagePopupButton.inside(a).remove();var c=e.popup_uri=c||e.popup_uri||e.uri,d=e.popup_variation=d||e.popup_variation,f=E.getMedia(c).done(function(f){var h=(f.meta,E.getVariation(c,[d,"system/large","system/original"]));e.popup_url=h.url,e.popup_variation=h.key,b.imagePopupButton.inside(a).attr("href",e.popup_url)
});return f},unsetImagePopup:function(a){var c=B.data(a);c.popup_url="",c.popup_uri="",c.popup_variation="",b.imagePopupButton.inside(a).remove()},updateImagePopup:function(a,c,d){b.setImagePopup(a,c,d).always(function(){b.populateImagePopup(a)})},removeImagePopup:function(a){b.unsetImagePopup(a),b.populateImagePopup(a)},populateImagePopup:function(c){var d=B.data(c);if(b.popupFieldset().removeClass("hidden"),d.isurl)return b.popupFieldset().addClass("hidden"),void 0;var e=d.popup_uri,f=d.popup_variation,j=d.popup_enabled;
F.toggle("image-popup",j);var k=!!e;F.enable("image-popup",k);var l=d.uri,m=b.popupFieldset();m.toggleClass(i,k&&e!==l),k&&(m.addClass(g),E.getMedia(e).done(function(c){var d=c.meta;b.popupTitle().text(d.title);var g=b.getSourceThumbnailImage(d.thumbnail);b.popupThumbnail().empty().append(g);var h=a(c.variations);b.popupVariationListContainer().empty().append(h);{var i=E.getVariation(e,[f,"system/large","system/original"]);b.popupVariationItem().where("key",'"'+i.key+'"').activateClass("active")}b.popupSize().text(a.plupload2.formatSize(i.size)),b.popupUrl().text(i.url)
}).fail(function(){m.addClass(h)}).always(function(){m.removeClass(g)}))},"{popupToggle} change":function(a){var c=a.is(":checked");c?b.updateImagePopup(D):b.removeImagePopup(D)},"{popupVariationItem} click":function(a){if(!a.hasClass("is-missing")){var c=a.data("key");b.updateImagePopup(D,null,c)}},"{imageUrlAdd} click":function(){var d=b.imageUrlTextbox().val();if(d){var f=(B.getBlockContent(D),B.data(D));D.css("text-align","center"),f.uri=d,f.url=d,f.simple="simple",f.ratio_lock=!0,f.isurl=!0;var g=b.constructImage(f);
B.getBlockContent(D).empty().append(g),D.hasClass("active")&&b.populate(D)}},"{urlFieldUpdateButton} click":function(){var d=b.urlFieldText().val();if(d){var e=B.data(D);e.uri=d,e.url=d;var f=b.constructImage(e);B.getBlockContent(D).empty().append(f)}}}}),b.resolve()})}),EasyBlog.module("composer/blocks/handlers/instagram",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Instagram",{defaultOptions:a.extend({"{form}":"> [data-instagram-form]","{insert}":"[data-instagram-insert]","{source}":"[data-instagram-source]","{preview}":"[data-instagram-preview]","{fsSource}":"[data-fs-instagram-source]","{fsRefreshButton}":"[data-fs-instagram-refresh]","{errorMessage}":"[data-instagram-error]"},EBD.selectors)},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},toData:function(a){var b=f.data(a);return b},toText:function(a){var b=f.data(a);return b.source},toEditableHTML:function(){return""},toHTML:function(a){var b=a.data("overlay");return b?b.element().html():void 0},activate:function(a){h=a,b.populate(a)},deactivate:function(){},construct:function(){},deconstruct:function(a){var c=f.getBlockContent(a);return b.form.inside(c).remove(),a},reconstruct:function(a){var c=f.data(a),d=a.data("overlay"),e=f.getBlockContent(a);c.source&&!d?b.createIframe(a,c.source):e.html(g.html),a.find(b.source.selector).off("paste").on("paste",function(a){a.stopPropagation()
})},refocus:function(){},reset:function(){},populate:function(a){var c=f.data(a);b.fsSource().val(c.source)},createIframe:function(c,d){var e=a.create("iframe"),g=f.data(c);d=b.sanitizeUrl(d),g.source=d,e.attr("src",d),b.setOverlay(c,e)},sanitizeUrl:function(a){return a=a.replace("?modal=true",""),a=a.replace(/\/$/,""),a.match(/\/embed/)||(a+="/embed/"),a},setOverlay:function(a,b){var c=a.data("overlay");if(c)c.element().empty(),c.element().append(b);else{c=e.document.overlay.create(a);var d=f.getBlockContent(a);
c.placeholder().css("height","400px").appendTo(d),c.element().append(b),c.attach()}a.data("overlay",c)},isUrlValid:function(a){if(""==a)return!1;var b=/^(?:http(?:s)?:\/\/)?instagram\.com\/p\/(.*)\/$/,c=b.test(a);return c},"{insert} click":function(a){if(h.length<1){var d=b.block.of(a);f.activateBlock(d)}var e=f.getBlockContent(h),g=b.source.inside(e).val();return b.isUrlValid(g)?(b.fsSource().val(g),b.createIframe(h,g),b.form.inside(e).addClass("hidden"),void 0):(b.errorMessage().removeClass("hide"),void 0)
},"{fsRefreshButton} click":function(){var a=f.getBlockContent(h),c=b.fsSource().val();return b.isUrlValid(c)?(b.createIframe(h,c),b.form.inside(a).addClass("hidden"),void 0):(b.errorMessage().removeClass("hide"),void 0)}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/links",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Links",{defaultOptions:{"{loader}":"> [data-link-loader]","{form}":"> [data-link-form]","{addLink}":"[data-link-add]","{linkInput}":"[data-link-input]","{errorMessage}":"[data-link-error]","{preview}":"> [data-link-preview]","{previewTitle}":"> [data-link-preview] [data-preview-title]","{previewContent}":"> [data-link-preview] [data-preview-content]","{previewLink}":"> [data-link-preview] [data-preview-link]","{previewImage}":"> [data-link-preview] [data-preview-image]","{imageWrapper}":"> [data-link-preview] [data-preview-image-wrapper]","{settings}":"[data-eb-composer-block-links-image]","{imageList}":"[data-eb-composer-block-links-image] [data-images]","{imagePlaceholder}":"[data-eb-composer-block-links-image] [data-image-placeholder]","{currentIndex}":"[data-eb-composer-block-links-image] [data-image-current-index]","{totalImages}":"[data-eb-composer-block-links-image] [data-images-total]","{previousImage}":"[data-eb-composer-block-links-image] [data-images-previous]","{nextImage}":"[data-eb-composer-block-links-image] [data-images-next]","{showImage}":"[data-links-image]"}},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},activate:function(a){h=a,b.populate(a)},deactivate:function(){},construct:function(){},toText:function(a){var c=f.getBlockContent(a),d=b.previewLink.inside(c).html();return d},toData:function(a){var b=f.data(a);return b},toHTML:function(a){var c=f.data(a);if(!c.url)return"";var d=a.clone(),e=b.deconstruct(d),g=f.getBlockContent(e);return g.html()},makeEditable:function(a){var c=f.getBlockContent(a);b.previewTitle.inside(c).editable(!0).on("click",function(a){a.preventDefault()}),b.previewContent.inside(c).editable(!0),b.previewLink.inside(c).on("click",function(a){a.preventDefault()
}),b.imageWrapper.inside(c).on("click",function(a){a.preventDefault()})},reconstruct:function(a){var c=f.data(a),d=f.getBlockContent(a);c.url||c.title||d.html(g.html),b.makeEditable(a)},deconstruct:function(a){var c=f.getBlockContent(a),d=f.data(a),e=b.preview.inside(c);return d.showImage||b.imageWrapper.inside(c).remove(),b.previewTitle.inside(c).editable(!1),b.previewContent.inside(c).editable(!1),b.loader.inside(c).remove(),b.form.inside(c).remove(),b.preview.inside(c).removeAttr("data-link-preview"),b.previewImage.inside(c).removeAttr("data-preview-image"),b.previewTitle.inside(c).removeAttr("data-preview-title"),b.previewContent.inside(c).removeAttr("data-preview-content"),c.html(e.html()),e.remove(),a
},refocus:function(){},reset:function(){},populate:function(a){var c=f.data(a);c.images&&c.images.length>0&&b.populateImages(c.images,c.image),c.images.length>=1?b.settings().removeClass("hide"):b.settings().addClass("hide"),b.showImage().val(c.showImage?1:0),b.showImage().trigger("change")},populateImages:function(c,d){var e=a.inArray(d,c);return b.currentIndex().html(e+1),b.totalImages().html(c.length),b.imageList().children("img").remove(),c?(a.each(c,function(e,f){var g=a(new Image);g.attr("src",f),b.imagePlaceholder().addClass("hidden"),g.addClass("hidden"),e==a.inArray(d,c)&&g.removeClass("hidden"),b.imageList().append(g)
}),void 0):!1},updatePreview:function(){var a=f.getBlockContent(h),c=f.data(h);b.previewTitle.inside(a).html(c.title).attr("href",c.url),b.previewContent.inside(a).html(c.content),b.previewLink.inside(a).html(c.url).attr("href",c.url),b.previewImage.inside(a).attr("src",c.image),b.imageWrapper.inside(a).attr("href",c.url)},getSuggestions:function(a,c,d){EasyBlog.ajax("site/views/crawler/crawl",{url:a}).done(d).fail(function(a){b.showForm(c),b.errorMessage().html(a).removeClass("hide")})},hideForm:function(a){var c=f.getBlockContent(a);
b.form.inside(c).addClass("hidden"),b.loader.inside(c).removeClass("hidden")},showForm:function(a){var c=f.getBlockContent(a);b.form.inside(c).removeClass("hidden"),b.loader.inside(c).addClass("hidden")},"{showImage} change":function(a){var d=f.getBlockContent(h),e=f.data(h),g=a.val();0==g?(e.showImage=!1,b.imageWrapper.inside(d).addClass("hide")):(e.showImage=!0,b.imageWrapper.inside(d).removeClass("hide"))},"{previousImage} click":function(c){var e=b.imageList().children("img"),g=b.imageList().children("img:not(.hidden)"),i=a(g).prev("img"),j=parseInt(b.currentIndex().html()),k=f.data(h);
if(i.length>0){k.image=i.attr("src"),b.updatePreview(),a(e).addClass("hidden"),a(i).removeClass("hidden");var l=j-1;console.log(l),b.currentIndex().html(l)}b.nextImage().disabled(!1),j-1==1?a(c).disabled(!0):a(c).disabled(!1)},"{nextImage} click":function(c){var e=b.imageList().children("img"),g=b.imageList().children("img:not(.hidden)"),i=a(g).next("img"),j=parseInt(b.currentIndex().html()),k=f.data(h);i.length>0&&(k.image=i.attr("src"),b.updatePreview(),a(e).addClass("hidden"),a(i).removeClass("hidden"),b.currentIndex().html(j+1)),b.previousImage().disabled(!1),j+1==e.length?a(c).disabled(!0):a(c).disabled(!1)
},"{addLink} click":function(){var c=f.getBlockContent(h),d=b.linkInput.inside(c).val(),e=f.data(h);return d?(b.hideForm(h),b.getSuggestions(d,h,function(a){var f=a[d];e.title=f.title,e.content=f.description,e.url=d,e.images=f.images,e.image=f.images[0],e.showImage=!0,b.updatePreview(),b.loader.inside(c).addClass("hidden"),b.preview.inside(c).removeClass("hidden"),b.makeEditable(),b.populate(h)}),void 0):(b.errorMessage().removeClass("hide"),void 0)}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/note",function(a){var b=this;
EasyBlog.require().done(function(){EasyBlog.Controller("Composer.Blocks.Handlers.Note",{defaultOptions:{data:{type:"warning",content:"Enter an important note here"},"{note}":".alert","{alertSelection}":"[data-eb-composer-block-alert-type] [data-type]"}},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a(),c.data.content=a(g.content).html()},activate:function(a){h=a,b.populate(a)},construct:function(b){{var b=a.extend({},c.data,b);a(g.content).switchClass("alert-"+b.type).html(b.content)
}},reconstruct:function(){},deconstruct:function(a){var c=f.getBlockContent(a);return b.note.inside(c).editable(!1),a},refocus:function(a){var c=f.getBlockContent(a),d=b.note.inside(c);d.focus(),a.hasClass("is-new")&&e.editor.caret.setEnd(d[0])},toText:function(a){var c=f.getBlockContent(a),d=b.note.inside(c).text();return d},toData:function(a){var b=f.data(a);return b},toHTML:function(a){var c=a.clone(),d=b.deconstruct(c),e=f.getBlockContent(d);return e.html()},reset:function(a){var c=f.getBlockContent(a);c.html(b.construct())
},populate:function(a){var c=f.data(a);b.alertSelection().where("type",c.type).activateClass("selected")},setAlertType:function(a){var c=f.getBlockContent(h),d=c.find(b.note);d.switchClass("alert-"+a)},previewType:function(a){{var c=f.getBlockContent(h),d=b.note.inside(c),e=d.attr("class");f.getData(h)}h.hasClass("is-preview")||(h.data("originalClass",e),h.addClass("is-preview")),b.setAlertType(a);var i=[h,b,d];b.trigger("composerBlockNotePreviewType",i),b.trigger("composerBlockChange",i)},previewTimer:null,"{alertSelection} mouseover":function(){},"{alertSelection} mouseout":function(){},"{alertSelection} click":function(c){var d=c.data("type"),e=f.data(h);
b.alertSelection().removeClass("selected"),a(c).addClass("selected"),h.removeClass("is-preview"),h.removeData("originalClass"),b.setAlertType(d),e.type=d,b.populate(h)}}}),b.resolve()})}),EasyBlog.module("composer/blocks/handlers/post",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Post",{defaultOptions:{"{block}":".ebd-block[data-type=text]","{wrapper}":"> div[data-text-wrapper]","{lastParagraph}":"> div > p:last","{mediaPreview}":"[data-post-media]","{introPreview}":"[data-post-intro]","{linkPreview}":"[data-post-link-preview]","{titlePreview}":"[data-preview-title]","{showImage}":"[data-post-option-image]","{showIntro}":"[data-post-option-intro]","{showHyperlink}":"[data-post-option-link]"}},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},activate:function(a){var c=f.data(a);h=a,b.showImage().val(0==c.show_image?0:1).trigger("change"),b.showIntro().val(0==c.show_intro?0:1).trigger("change"),b.showHyperlink().val(0==c.show_link?0:1).trigger("change"),b.populate()},deactivate:function(){},construct:function(b){var c=f.createBlockContainer("post"),b=a.extend({},g.data,b),d=a(b.content);return d.find("[data-post-title]").html(b.title),d.find("[data-post-link]").attr("href",b.url),d.on("click",function(a){a.preventDefault()}),d.find("[data-post-link-preview]").html(b.url),d.find("[data-post-intro]").html(b.intro),b.image?d.find("[data-post-image]").attr("src",b.image):d.find("[data-post-image]").remove(),f.content.inside(c).append(d),c.data("block",b),c
},reconstruct:function(a){{var b=f.getBlockContent(a);f.data(a)}b.find("[data-post-link]").on("click",function(a){a.preventDefault()})},deconstruct:function(a){var c=b.wrapper.inside(a),d=c.parent();return c.children().appendTo(d),c.remove(),a},refocus:function(a){var c=b.wrapper.inside(a),d=b.lastParagraph.inside(a);c.focus(),e.editor.caret.setEnd(d)},reset:function(a){a=f.getBlockContent(a),a.html(g.content)},populate:function(){},recover:function(){},revert:function(){},toText:function(a){var a=f.getBlockContent(a);
return a.text()},toHTML:function(a){{var a=f.getBlockContent(a),c=a.clone();b.deconstruct(c).html()}return b.deconstruct(c).html()},toData:function(a){var c=f.data(a);return c.content=b.toHTML(a),c},"{showImage} change":function(a){var d=f.getBlockContent(h),e=0==a.val()?!1:!0,g=f.data(h);return g.show_image=e,e?(b.mediaPreview.inside(d).show(),void 0):(b.mediaPreview.inside(d).hide(),void 0)},"{showIntro} change":function(a){var d=f.getBlockContent(h),e=0==a.val()?!1:!0,g=f.data(h);return g.show_intro=e,e?(b.introPreview.inside(d).show(),void 0):(b.introPreview.inside(d).hide(),void 0)
},"{showHyperlink} change":function(a){var d=f.getBlockContent(h),e=0==a.val()?!1:!0,g=f.data(h);return g.show_link=e,e?(b.linkPreview.inside(d).show(),void 0):(b.linkPreview.inside(d).hide(),void 0)}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/quotes",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Quotes",{defaultOptions:{"{styleSelection}":"[data-eb-composer-block-quotes-style] [data-style]","{citation}":"[data-quotes-citation]","{blockquote}":"> blockquote","{cite}":"> blockquote > cite","{text}":"> blockquote > p"}},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},reconstruct:function(){},deconstruct:function(a){var c=f.getBlockContent(a);return b.text.inside(c).editable(!1),b.cite.inside(c).editable(!1),a},toData:function(a){var b=f.data(a);return b},toText:function(){},toHTML:function(a){var c=a.clone(),d=b.deconstruct(c),e=f.getBlockContent(d);return e.html()},activate:function(a){h=a,b.populate(a)},deactivate:function(){},construct:function(b){var b=a.extend({},c.data,b);return content},refocus:function(a){var c=f.data(a);c.style&&b.setStyle(a,c.style)},reset:function(a){if(!a.hasClass("is-new")){var c=f.getBlockContent(a);
c.html(b.construct())}},populate:function(a){var c=f.data(a);b.styleSelection("[data-style="+c.style+"]").activateClass("active"),b.citation().val(c.citation).trigger("change")},setStyle:function(a,c){f.data(a,"current",c),b.styleSelection().removeClass("selected"),b.styleSelection().where("style",c).addClass("selected");var d=[a,b,c];b.trigger("composerBlockQuotesSetStyle",d),b.trigger("composerBlockChange",d)},previewType:function(a,c){clearTimeout(b.previewTimer);var d=[a,b,c];b.trigger("composerBlockQuotesSetStyle",d),b.trigger("composerBlockChange",d)
},"{styleSelection} mouseover":function(a){var c=a.data("style");b.previewType(h,c)},"{styleSelection} mouseout":function(){clearTimeout(b.previewTimer),b.previewTimer=a.delay(function(){var a=f.data(h).current;a&&b.setStyle(h,a)},50)},"{styleSelection} click":function(a){var c=a.data("style"),d=f.data(h);d.style=c,b.setStyle(h,c)},"{self} composerBlockQuotesSetStyle":function(a,c,d,e,g){clearTimeout(b.previewTimer);var i=f.getBlockContent(h);b.blockquote.inside(i).switchClass(g),b.populate(d)},"{citation} change":function(c){var e=f.data(h),g=1==a(c).val()?1:0,i=g?!1:!0,j=f.getBlockContent(h);
e.citation=g,b.cite.inside(j).toggleClass("hidden",i)}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/readmore",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Readmore",{defaultOptions:{}},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()},toData:function(a){var b=f.data(a);return b},toText:function(){},toHTML:function(){var c=a.create("hr");return c.attr("id","system-readmore"),c.toHTML()},deactivate:function(){},activate:function(a){h=a,b.populate(a)
},deconstruct:function(){},construct:function(){},reconstruct:function(a){var d=(f.data(a),f.getBlockContent(a));b.hideMenu(),d.html(g.html)},refocus:function(){},reset:function(){},populate:function(){},showMenu:function(){var a=f.menu().where("type","readmore");a.removeClass("hide")},hideMenu:function(){var a=f.menu().where("type","readmore");a.addClass("hide")},"{self} composerBlockAdd":function(a,c,d){var e=f.getBlockType(d);"readmore"==e&&b.hideMenu()},"{self} composerBlockRemove":function(a,c,d){var e=f.getBlockType(d);
"readmore"==e&&b.showMenu()}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/rule",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Rule",{defaultOptions:{"{rule}":"hr","{styleSelection}":"[data-eb-composer-rule-style] [data-style]"}},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()},activate:function(a){h=a,b.populate(a)},construct:function(b){var b=a.extend({},c.data,b),d=a("<hr/>");return d},toText:function(){},toData:function(a){var b=f.data(a);
return b},toHTML:function(a){var c=(f.data(a),f.getBlockContent(a));return c.html()},reconstruct:function(a){f.data(a)},refocus:function(a){var c=f.data(a);c.style&&b.setStyle(a,c.style)},reset:function(a){var c=f.getBlockContent(a);c.html(b.construct())},populate:function(a){var c=f.data(a);b.styleSelection("[data-style="+c.style+"]").activateClass("active")},setStyle:function(a,c){f.data(a,"current",c),b.styleSelection().removeClass("selected"),b.styleSelection().where("style",c).addClass("selected");var d=[a,b,c];
b.trigger("composerBlockRuleSetStyle",d),b.trigger("composerBlockChange",d)},previewType:function(a,c){clearTimeout(b.previewTimer);var d=[a,b,c];b.trigger("composerBlockRuleSetStyle",d),b.trigger("composerBlockChange",d)},"{styleSelection} mouseover":function(a){var c=a.data("style");b.previewType(h,c)},"{styleSelection} mouseout":function(){clearTimeout(b.previewTimer),b.previewTimer=a.delay(function(){var a=f.data(h).current;a&&b.setStyle(h,a)},50)},"{styleSelection} click":function(a){var c=a.data("style"),d=f.data(h);
d.style=c,b.setStyle(h,c),b.refocus(h)},"{self} composerBlockRuleSetStyle":function(a,c,d,e,g){clearTimeout(b.previewTimer);var h=f.getBlockContent(d);b.rule.inside(h).switchClass(g),b.populate(d)}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/slideshare",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Slideshare",{defaultOptions:a.extend({"{form}":"> [data-slideshare-form]","{insert}":"[data-slideshare-insert]","{source}":"[data-slideshare-source]","{loader}":"> [data-slideshare-loader]","{preview}":"> [data-slideshare-preview]","{fsSource}":"[data-fs-slideshare-source]","{fsUpdate}":"[data-fs-slideshare-update]","{errorMessage}":"[data-slideshare-error]"},EBD.selectors)},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},toText:function(a){var b=f.data(a);return b.url},toData:function(a){var b=f.data(a);return b},toEditableHTML:function(){return""},toHTML:function(a){var b=f.data(a);return b.embed},activate:function(a){h=a,b.populate(a)},deactivate:function(){},construct:function(){},reconstruct:function(c){var d=f.data(c),e=c.data("overlay"),h=f.getBlockContent(c);d.embed&&!e&&b.setOverlay(c,d.embed),d.embed||h.html(a(g.html)),c.find(b.source.selector).off("paste").on("paste",function(a){a.stopPropagation()})},deconstruct:function(a){var c=f.getBlockContent(a);
return b.form.inside(c).remove(),b.loader.inside(c).remove(),a},refocus:function(){},reset:function(){},populate:function(a){var c=f.data(a);b.fsSource().val(c.url)},loading:function(){var a=f.getBlockContent(h);b.isLoading?(b.loader.inside(a).addClass("hidden"),b.form.inside(a).removeClass("hidden"),b.isLoading=!1):(b.loader.inside(a).removeClass("hidden"),b.form.inside(a).addClass("hidden"),b.isLoading=!0)},setOverlay:function(a,b){var c=a.data("overlay");if(!c){c=e.document.overlay.create(a);var d=f.getBlockContent(a);
return c.placeholder().css("height","600px").appendTo(d),c.element().append(b),c.attach(),a.data("overlay",c),void 0}c.element().empty(),c.element().append(b)},isUrlValid:function(a){if(""==a)return!1;var b=/^http:\/\/www\.slideshare\.net\/(.*)$/,c=b.test(a);return c},crawl:function(a,c){var d=f.getBlockContent(a),e=f.data(a);if(!b.isUrlValid(c))return b.errorMessage().removeClass("hide"),!1;var g=a.data("overlay");g&&g.element().empty(),b.loading(),EasyBlog.ajax("site/views/crawler/crawl",{url:c}).done(function(d){var f=d[c];
e.url=c,e.embed=f.oembed.html,b.setOverlay(a,e.embed)}).fail(function(a){b.errorMessage().removeClass("hide").html(a)}).always(function(){b.loading(),b.form.inside(d).addClass("hidden")})},"{insert} click":function(a){if(h.length<1){var c=b.block.of(a);f.activateBlock(c)}{var d=f.getBlockContent(h),e=b.source.inside(d).val();f.data(h)}b.crawl(h,e),b.fsSource().val(e)},"{fsUpdate} click":function(){{var a=b.fsSource().val();f.data(h)}b.crawl(h,a)}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/soundcloud",function(a){var b=this;
EasyBlog.Controller("Composer.Blocks.Handlers.Soundcloud",{defaultOptions:a.extend({"{form}":"> [data-soundcloud-form]","{insert}":"[data-soundcloud-insert]","{source}":"[data-soundcloud-source]","{loader}":"> [data-soundcloud-loader]","{preview}":"> [data-soundcloud-preview]","{fsSource}":"[data-fs-soundcloud-source]","{fsUpdate}":"[data-fs-soundcloud-update]","{errorMessage}":"[data-soundcloud-error]"},EBD.selectors)},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()},toText:function(a){var b=f.data(a);
return b.url},toData:function(a){var b=f.data(a);return b},toEditableHTML:function(){return""},toHTML:function(a){var b=f.data(a);return b.embed},normalize:function(b){return a.extend({},g.data,b)},activate:function(a){h=a,b.populate(a)},deactivate:function(){},construct:function(){},reconstruct:function(c){var d=f.data(c),e=c.data("overlay"),h=f.getBlockContent(c);d.embed&&!e&&b.setOverlay(c,d.embed),d.embed||h.html(a(g.html)),c.find(b.source.selector).off("paste").on("paste",function(a){a.stopPropagation()
})},deconstruct:function(a){var c=f.getBlockContent(a);return b.form.inside(c).remove(),b.loader.inside(c).remove(),a},refocus:function(){},reset:function(){},populate:function(a){var c=f.data(a);b.fsSource().val(c.url)},isLoading:!1,loading:function(){var a=f.getBlockContent(h);b.isLoading?(b.loader.inside(a).addClass("hidden"),b.form.inside(a).removeClass("hidden"),b.isLoading=!1):(b.loader.inside(a).removeClass("hidden"),b.form.inside(a).addClass("hidden"),b.isLoading=!0)},setOverlay:function(a,b){var c=a.data("overlay"),d=f.getBlockContent(a);
c?(c.element().empty(),c.element().append(b)):(c=e.document.overlay.create(a),c.placeholder().css("height","350px").appendTo(d),c.element().append(b),c.attach()),a.data("overlay",c)},isUrlValid:function(a){if(""==a)return!1;var b=/^https:\/\/soundcloud\.com\/(.*)$/,c=b.test(a);return c},crawl:function(a,c){var d=f.data(a),e=f.getBlockContent(a);if(!b.isUrlValid(c))return b.errorMessage().removeClass("hide"),!1;var g=a.data("overlay");g&&g.element().empty(),b.loading(),EasyBlog.ajax("site/views/crawler/crawl",{url:c}).done(function(e){var f=e[c];
d.url=c,d.embed=f.oembed.html,b.setOverlay(a,d.embed)}).fail(function(a){b.errorMessage().removeClass("hide").html(a)}).always(function(){b.loading(),b.form.inside(e).addClass("hidden")})},"{insert} click":function(a){if(h.length<1){var c=b.block.of(a);f.activateBlock(c)}var d=f.getBlockContent(h),e=b.source.inside(d).val();b.fsSource().val(e),b.crawl(h,e)},"{fsUpdate} click":function(){var a=b.fsSource().val();b.crawl(h,a)}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/spotify",function(a){var b=this;
EasyBlog.Controller("Composer.Blocks.Handlers.Spotify",{defaultOptions:a.extend({"{form}":"> [data-spotify-form]","{insert}":"[data-spotify-insert]","{source}":"[data-spotify-source]","{loader}":"> [data-spotify-loader]","{errorMessage}":"[data-spotify-error]","{preview}":"> [data-spotify-preview]","{fsSource}":"[data-fs-spotify-source]","{fsRefreshButton}":"[data-fs-spotify-refresh]"},EBD.selectors)},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()},toData:function(a){var b=f.data(a);
return b},toText:function(a){var b=f.data(a);return b.url},toEditableHTML:function(){return""},toHTML:function(a){var b=f.data(a);return b.embed},activate:function(a){h=a,b.populate(a)},deactivate:function(){},construct:function(){},reconstruct:function(c){var d=f.data(c),e=c.data("overlay"),h=f.getBlockContent(c);d.embed&&!e&&b.setOverlay(c,d.embed),d.embed||h.html(a(g.html)),c.find(b.source.selector).off("paste").on("paste",function(a){a.stopPropagation()})},deconstruct:function(a){var c=f.getBlockContent(a);
return b.form.inside(c).remove(),b.loader.inside(c).remove(),a},refocus:function(){},reset:function(){},populate:function(a){var c=f.data(a);b.fsSource().val(c.url)},isLoading:!1,loading:function(){var a=f.getBlockContent(h);b.isLoading?(b.loader.inside(a).addClass("hidden"),b.form.inside(a).removeClass("hidden"),b.isLoading=!1):(b.loader.inside(a).removeClass("hidden"),b.form.inside(a).addClass("hidden"),b.isLoading=!0)},setOverlay:function(a,b){var c=a.data("overlay");if(c)c.element().empty(),c.element().append(b);
else{c=e.document.overlay.create(a);var d=f.getBlockContent(a);c.placeholder().css("height","400px").appendTo(d),c.element().append(b),c.attach()}a.data("overlay",c)},showForm:function(a){var c=f.getBlockContent(a);b.form.inside(c).removeClass("hidden")},hideForm:function(a){var c=f.getBlockContent(a);b.form.inside(c).addClass("hidden")},crawl:function(a,c){var e=(f.getBlockContent(a),f.data(a));if(!b.isUrlValid(c))return b.errorMessage().removeClass("hide"),!1;var g=a.data("overlay");g&&g.element().empty(),b.loading(),EasyBlog.ajax("site/views/crawler/crawl",{url:c}).done(function(d){b.loading();
var f=d[c];e.url=c,e.embed=f.oembed.html,b.hideForm(a),b.setOverlay(a,e.embed)}).fail(function(a){b.loading(),b.errorMessage().html(a).removeClass("hide")})},isUrlValid:function(a){if(""==a)return!1;var b=/^http(s):\/\/open\.spotify\.com\/(track|artist|album)\/(.*)$/,c=b.test(a);return c},"{insert} click":function(a){if(h.length<1){var c=b.block.of(a);f.activateBlock(c)}var d=f.getBlockContent(h),e=b.source.inside(d).val();b.fsSource().val(e),b.crawl(h,e)},"{fsRefreshButton} click":function(){var a=b.fsSource().val();
b.crawl(h,a)}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/table",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Table",{defaultOptions:{"{tableContainer}":"> .table-container","{table}":"table","{row}":"tr","{cell}":"td","{cellContent}":"td div[contenteditable]","{loading}":"[data-table-loading]","{tableStriped}":"[data-table-striped]","{tableBordered}":"[data-table-bordered]","{tableHover}":"[data-table-hover]","{tableCondensed}":"[data-table-condensed]","{tableRowFieldset}":"[data-table-rows]","{addRow}":"[data-table-rows-add]","{removeRow}":"[data-table-rows-remove]","{tableColumns}":"[data-table-columns]","{tableColumnsAdd}":"[data-table-columns-add]","{tableColumnsRemove}":"[data-table-columns-remove]"}},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},activate:function(c){h=c,b.populate(c),c.on("keydown.tab",b.cellContent.selector,function(c){if(9==c.which){var d=a(c.target).parent(),f=b.cell.inside(h),g=f.eq(Math.min(f.index(d)+1,f.length-1)).find("> div[contenteditable]");e.editor.caret.setAfter(g[0].lastChild),c.stopPropagation()}})},deactivate:function(a){a.off("keydown.tab")},construct:function(){return content},deconstruct:function(){},reconstruct:function(){},refocus:function(a){var c=f.getBlockContent(a),d=a.data("lastFocused")||b.cell.inside(c).filter(":first");
d.focus()},reset:function(){},populate:function(a){var c=f.data(a);b.tableStriped().val(c.striped).trigger("change"),b.tableBordered().val(c.bordered).trigger("change"),b.tableHover().val(c.hover).trigger("change"),b.tableCondensed().val(c.condensed).trigger("change"),b.tableRowFieldset().val(c.rows),b.tableColumns().val(c.columns)},toHTML:function(c){b.loader(!1);var d=f.getBlockContent(c),e=b.table.inside(d).clone();return a.each(e.find("td"),function(b,c){c=a(c),c.html(c.find("div[contenteditable]").html())
}),e[0].outerHTML},toData:function(a){var b=f.data(a);return b},toText:function(a){var c=f.getBlockContent(a);return b.table.inside(c).text()},"{tableStriped} change":function(a){var d=f.getBlockContent(h),e=a.val();b.table.inside(d).toggleClass("table-striped",1==e),f.data(h,"striped",1==e?1:0)},"{tableBordered} change":function(a){var d=f.getBlockContent(h),e=a.val();b.table.inside(d).toggleClass("table-bordered",1==e),f.data(h,"bordered",1==e?1:0)},"{tableHover} change":function(a){var d=f.getBlockContent(h),e=a.val();
b.table.inside(d).toggleClass("table-hover",1==e),f.data(h,"hover",1==e?1:0)},"{tableCondensed} change":function(a){var d=f.getBlockContent(h),e=a.val();b.table.inside(d).toggleClass("table-condensed",1==e),f.data(h,"condensed",1==e?1:0)},loader:function(c){var d=f.getBlockContent(h),e=b.tableContainer.inside(d);if(c===!1)return b.loading.inside(d).remove(),void 0;if(!(b.loading.inside(d).length>0)){var i=(b.table.inside(e),a.create("div").attr("data-table-loading","").css({top:0,left:0,width:"100%",height:"50px",position:"absolute",background:"rgba(0,0,0,0.5)"}).html(a.create("div").css({textAlign:"center",position:"relative",top:"50%",lineHeight:"20px",marginTop:"-10px"}).html('<i class="fa fa-circle-o-notch fa-spin"></i>')));
e.append(i)}},"{tableRowFieldset} change":function(c){var e=f.getBlockContent(h),g=c.val(),i=f.data(h);(isNaN(g)||parseInt(g)<1||a.isEmpty(g))&&c.val(g=1),g=parseInt(g);var j=g-b.row.inside(e).length;if(0!=j){i.rows=g;var k=b.table.inside(e);setTimeout(function(){if(0>j&&b.row.inside(k).slice(j).remove(),j>0){var a=parseInt(b.tableColumns().val()),c=Array(j+1).join("<tr>"+Array(a+1).join('<td><div contenteditable="true">&#8203;</div></td>')+"</tr>");k.append(c)}k.appendTo(e)},50)}},"{tableColumns} change":function(c){var e=f.getBlockContent(h),g=c.val(),i=f.data(h);
(isNaN(g)||parseInt(g)<1||a.isEmpty(g))&&(g=1,c.val(g)),g=parseInt(g);var j=b.row.inside(e).filter(":first-child"),k=g-b.cell.inside(j).length;if(0!=k){i.columns=g;var l=b.table.inside(e);setTimeout(function(){var c=b.row.inside(l);if(0>k&&a.each(c,function(a,c){b.cell.inside(c).slice(k).remove()}),k>0){var d=Array(k+1).join('<td><div contenteditable="true">&#8203;</div></td>');c.append(d)}l.appendTo(e)},50)}},"{addRow} click":function(){var e=(f.getBlockContent(h),parseInt(b.tableRowFieldset().val())+1);b.tableRowFieldset().val(e).trigger("change")
},"{removeRow} click":function(){var e=(f.getBlockContent(h),Math.max(parseInt(b.tableRowFieldset().val())-1,1));b.tableRowFieldset().val(e).trigger("change")},"{tableColumnsAdd} click":function(){var d=parseInt(b.tableColumns().val())+1;b.tableColumns().val(d).trigger("change")},"{tableColumnsRemove} click":function(){b.tableColumns().val(Math.max(parseInt(b.tableColumns().val())-1,1)).trigger("change")}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/tabs",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Tabs",{defaultOptions:{"{tabHeader}":".nav-tabs","{tabHeaderListItem}":".nav-tabs > li","{tabHeaderListItemContent}":".nav-tabs > li a","{tabContent}":".tab-content","{tabPane}":"> .tab-content > .tab-pane","{titleItem}":"[data-tab-header-item]","{control}":"[data-tabs-control]","{controlItemContent}":"[data-tabs-control] [data-listbox-item-content]"}},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},activate:function(a){h=a,b.populate(a)},deactivate:function(){},construct:function(b){var b=a.extend({},c.data,b);return content},reconstruct:function(){},deconstruct:function(c){return a.each(c.find("[data-tab-wrapper]"),function(d,e){e=a(e);var f=e.parent();f.removeAttr("contenteditable"),e.children().appendTo(f),e.remove(),b.tabHeaderListItemContent.inside(c).eq(d).removeAttr("contenteditable")}),c},refocus:function(a){var c=b.tabPane.inside(a).filter(".active");c.focus()},reset:function(){},recover:function(){},populate:function(a){var c=f.data(a);
b.control().listbox().listbox("populate",c.tabs,function(a,b){a.listboxitem("content",b)})},revert:function(){},toHTML:function(a){var c=a.clone(),d=b.deconstruct(c),e=f.getBlockContent(d);return e.html()},toData:function(a){var b=f.data(a);return b},toText:function(a){var c=a.clone();return b.deconstruct(c).text()},tab:{create:function(){var d=a.uid("tab-"),e='<li><a href="#'+d+'" role="tab" data-bp-toggle="tab" contenteditable="true"></a></li>',g=a("<div></div>",{"class":"tab-pane",id:d}),i=a("<div></div>",{"class":"ebd-nest","data-type":"block","data-tab-wrapper":""}),j=f.constructNestedBlock("text");
i.wrapInner(j),g.wrapInner(i),b.tabContent.inside(h).append(g),b.tabHeader.inside(h).append(e)},remove:function(a){b.tabPane.inside(h).eq(a).remove(),b.tabHeaderListItem.inside(h).eq(a).remove()},focus:function(a){b.tabHeaderListItem.inside(h).eq(a).find("a").tab("show")}},"{tabHeaderListItem} click":function(a){a.find("a").tab("show")},"{tabHeaderListItemContent} keyup":a.debounce(function(a,c){var d=c.keyCode?c.keyCode:c.which;if("13"!=d){var e=a.parents(".nav-tabs > li").index(),g=a.html().replace(/(<br>\s*)+$/,"");
b.control().listbox("getItems").eq(e).listboxitem("content",g),f.data(h).tabs[e].content=g}},250),"{tabHeaderListItemContent} click":function(a,b){b.preventDefault()},"{tabHeaderListItemContent} keydown":function(a,b){var c=b.keyCode?b.keyCode:b.which;"13"==c&&b.preventDefault()},"{control} listboxBeforeAddItem":function(a,c,d){b.tab.create();var e=d.listboxitem("toData");b.tabHeaderListItem.inside(h).filter(":last").find("a").html(e.content)},"{control} listboxAfterAddItem":function(){f.data(h).tabs=b.control().listbox("toData"),1==b.tabContent.inside(h).length&&b.tabHeaderListItem.inside(h).filter(":first").find("a").tab("show")
},"{control} listboxBeforeRemoveItem":function(a,c,d){var e=d.index();b.tab.remove(e)},"{control} listboxAfterRemoveItem":function(){f.data(h).tabs=b.control().listbox("toData"),1==b.tabContent.inside(h).length&&b.tabHeaderListItem.inside(h).filter(":first").find("a").tab("show")},"{control} listboxAfterToggleDefault":function(){f.data(h).tabs=b.control().listbox("toData")},"{controlItemContent} keyup":a.debounce(function(a,c){var d=c.keyCode?c.keyCode:c.which;if("13"!=d){var e=a.parents("[data-listbox-item]"),g=e.index(),i=a.html().replace(/(<br>\s*)+$/,"");
b.tabHeaderListItem.inside(h).eq(g).find("a").html(i),f.data(h).tabs[g].content=i}},250),"{controlItemContent} keypress":function(a,b){var c=b.keyCode?b.keyCode:b.which;"13"==c&&b.preventDefault()}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/text",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Text",{defaultOptions:{"{block}":".ebd-block[data-type=text]","{blockWrapper}":"> [data-eb-text-block-wrapper]","{contentWrapper}":"> [data-eb-text-block-wrapper] > [data-eb-text-content-wrapper]","{allContentWrapper}":"[data-eb-text-content-wrapper]","{lastParagraph}":"> p:last"}},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},activateKeys:function(){a(document).off("keydown.blocks.text")},deactivateKeys:function(){a(document).on("keydown.blocks.text",function(a){var b=a.which;return 33==b||34==b?(a.preventDefault(),!1):!0})},activate:function(a){b.deactivateKeys(),h=a,b.populate()},deactivate:function(){b.activateKeys()},construct:function(){var b=f.createBlock("text"),c=f.getBlockContent(b);return c.html(g.data.content),b},reconstruct:function(c){var d=f.getBlockContent(c),e=b.blockWrapper.inside(d);e.length||(e=a(g.blockWrapper).append(d[0].childNodes).appendTo(d));
var h=b.contentWrapper.inside(d);if(!h.length){var i=[];a.each(e[0].childNodes,function(){a(this).is(EBD.block)||i.push(this)}),h=a(g.contentWrapper).append(i).appendTo(e)}},deconstruct:function(a){var c=f.getBlockContent(a),d=b.contentWrapper.inside(c);if(0==d.length)return a;var e=d[0].childNodes,g=c.find(EBD.immediateNestedBlock);return c.empty().append(g).append(e),a},refocus:function(){},reset:function(){},populate:function(){},recover:function(){},revert:function(){},toText:function(a){var c=a.clone(),d=b.deconstruct(c),e=f.getBlockContent(d).text();
return e},toHTML:function(a){var c=a.clone(),d=b.deconstruct(c),e=f.getBlockContent(d).html();return e},toData:function(){},"{self} composerListFormat":function(c,d,e){var g=f.getBlockType(e);"text"==g&&(b.reconstruct(e),e.find(".redactor-selection-marker").each(function(){var b=a(this);b.find("ul, ol").length&&b.children().insertBefore(b)}))},"{allContentWrapper} mouseup":function(a){var b=f.block.of(a);f.font.populateFontFormatting(b)},"{allContentWrapper} keyup":a.debounce(function(a){var b=f.block.of(a);
f.font.populateFontFormatting(b)},100)}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/tweet",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Handlers.Tweet",{defaultOptions:a.extend({"{form}":"> [data-tweet-form]","{insert}":"[data-tweet-insert]","{source}":"[data-tweet-source]","{loader}":"> [data-codepen-loader]","{preview}":"> [data-tweet-preview]","{fsSource}":"[data-fs-tweet-source]","{fsUpdate}":"[data-fs-tweet-update]","{errorMessage}":"[data-tweet-error]"},EBD.selectors)},function(b,c,d,e,f,g,h){return{init:function(){f=b.blocks,e=f.composer,g=c.meta,h=a()
},toData:function(a){var b=f.data(a);return b},toText:function(a){var b=f.data(a);return b.source},toEditableHTML:function(){return""},toHTML:function(a){var b=f.data(a);return'<iframe src="'+b.source+'" />'},activate:function(a){h=a,b.populate(a)},deactivate:function(){},construct:function(){},reconstruct:function(c){var d=f.data(c),e=f.getBlockContent(c),h=c.data("overlay");d.embed&&!h&&b.setOverlay(c,d.embed),d.source||e.html(a(g.html)),c.find(b.source.selector).off("paste").on("paste",function(a){a.stopPropagation()
})},deconstruct:function(){},refocus:function(){},reset:function(){},populate:function(a){f.data(a)},loading:function(){var a=f.getBlockContent(h);b.isLoading?(b.loader.inside(a).addClass("hidden"),b.form.inside(a).removeClass("hidden"),b.isLoading=!1):(b.loader.inside(a).removeClass("hidden"),b.form.inside(a).addClass("hidden"),b.isLoading=!0)},isUrlValid:function(a){if(""==a)return!1;var b=/^https:\/\/twitter\.com\/(.*)\/status\/(.*)$/,c=b.test(a);return c},crawl:function(a,c){var d=f.getBlockContent(a),e=f.data(a);
if(!b.isUrlValid(c))return b.errorMessage().removeClass("hide"),!1;var g=a.data("overlay");g&&g.element().empty(),b.loading(),EasyBlog.ajax("site/views/crawler/crawl",{url:c}).done(function(f){b.loading();var g=f[c];e.url=c,e.embed=g.oembed.html,e.source=c,b.setOverlay(a,e.embed),b.form.inside(d).addClass("hidden")}).fail(function(a){b.loading(),b.errorMessage().html(a).removeClass("hide")}).always(function(){})},setOverlay:function(a,b){var c=f.getBlockContent(a),d=a.data("overlay");d?(d.element().empty(),d.element().append(b)):(d=e.document.overlay.create(a),d.placeholder().css("height","400px").appendTo(c),d.element().append(b),d.attach()),a.data("overlay",d)
},"{insert} click":function(a){if(h.length<1){var c=b.block.of(a);f.activateBlock(c)}var d=f.getBlockContent(h),e=b.source.inside(d).val();b.fsSource().val(e),b.crawl(h,e)},"{fsUpdate} click":function(){{var a=b.fsSource().val();f.data(h)}b.crawl(h,a)}}}),b.resolve()}),EasyBlog.module("composer/blocks/handlers/video",function(a){var b=this,c="view-selectratio",d="view-customratio",e=["video-width","video-height"],f=["numslider","numslider-toggle","numslider-widget","numslider-value","numslider-input","numslider-units","numslider-unit","numslider-current-unit"],g=function(a){return a.replace(/video-/,"")
},h=function(a){return a.toString().match("%")?"%":"px"},i=function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},j=ratioDecimal=function(b){if(a.isNumeric(b))return b;var c=b.split(":");return c[0]/c[1]},m=(ratioPercent=function(a,b){return i(100*j(a),2)+(b?"%":0)},ratioPadding=function(a){return i(1/j(a)*100,2)+"%"},function(b){if(b=a.trim(b),/\:/.test(b)){var c=b.split(":");return parseInt(c[0])+":"+parseInt(c[1])}return parseFloat(b)||0});EasyBlog.require().library("plupload2","videojs").done(function(){EasyBlog.Controller("Composer.Blocks.Handlers.Video",{elements:["[data-eb-{file-error}]","[data-eb-video-size-field] [data-eb-{"+f.join("|")+"}]","^videoSizeField .eb-composer-field[data-name={"+e.join("|")+"}]","[data-eb-video-{ratio-button|ratio-label|ratio-customize-button|ratio-cancel-button|ratio-use-custom-button|ratio-cancel-custom-button|alignment-selection|size-field|ratio-selection|ratio-input}]"],defaultOptions:{"{browseButton}":".eb-composer-placeholder-video [data-eb-mm-browse-button]","{placeholder}":"[data-eb-composer-video-placeholder]","{player}":"[data-video-player]","{dropElement}":"[data-plupload-drop-element]","{autoplay}":"[data-video-fieldset-autoplay]","{loop}":"[data-video-fieldset-loop]","{muted}":"[data-video-fieldset-muted]","{controls}":"[data-video-controls]","{videoContainer}":".eb-video","{videoViewport}":".eb-video-viewport","{videoPlayer}":"video","{videoSource}":"source"}},function(b,e,i,k,l,n,o,p,q,r){return{init:function(){l=b.blocks,k=l.composer,n=e.meta,o=a(),q=l.dimensions,r=EasyBlog.MediaManager,a.each(f,function(c,d){var e=a.camelize(d);
b[e].of=a.memoize(function(a){var c=b.getVideoSizeField(a);return b[e].under(c)})});var c={};p=function(d){return a(c[d.data("uid")]||(c[d.data("uid")]=b.videoContainer.inside(d)[0]))},getVideoViewport=a.memoize(function(a){return b.videoViewport.inside(a)},function(a){return a.data("uid")})},normalize:function(b){return a.extend({},n.data,b)},activate:function(a){o=a,b.populate(a)},deactivate:function(){},construct:function(b){var c=l.createBlockContainer("video"),d=l.data(c);return a.extend(d,b),c},constructFromMediaFile:function(a){{var c=a.data("key"),d=r.getUri(c),e=l.createBlockContainer("video");
l.getBlockContent(e),l.data(e)}return e.addClass("is-loading"),r.getMedia(d).done(function(a){setTimeout(function(){var c=a.meta,d=c.url;b.createPlayer(e,d)},250)}).fail(function(){}).always(function(){e.removeClass("is-loading")}),e},reconstruct:function(a){a.editable(!1);var c=l.data(a);if(b.hasVideo(a)){var c=l.data(a);b.createPlayer(a,c.url)}else{var d=b.placeholder.inside(a);d.length>0&&EasyBlog.MediaManager.uploader.register(d)}},deconstruct:function(){},refocus:function(){},reset:function(){},populate:function(a){var c=b.hasVideoContainer(a),d=l.panel.fieldgroup.get("video");
d.toggleClass("is-new",!c),c&&(b.populateVideoSize(a),b.populateVideoControls(a))},toData:function(a){var b=l.data(a),c=p(a);if(c.length>0){var d=c[0].style;b.width=d.width,b.height=d.height}return b},toText:function(){},toHTML:function(){},toLegacyShortcode:function(a,c){var d="[embed=video][/embed]",e=b.getVideoSize(c,"width"),f=b.getVideoSize(c,"height"),g=l.data(c),h={width:e,height:f,uri:a.uri,autoplay:g.autoplay?"1":"0",muted:g.muted?"1":"0",loop:g.loop?"1":"0"},d="[embed=video]"+JSON.stringify(h)+"[/embed]";
return d},toEditableHTML:function(){},"{placeholder} mediaUploaderFilesAdded":function(a,b,c,d){EasyBlog.MediaManager.uploader.addItem(d[0],a)},"{placeholder} mediaUploaderFileUploaded":function(a,c,d,e,f){var g=f.response,h=g.media,i=h.meta,j=l.block.of(a);setTimeout(function(){b.createPlayer(j,i.url),j.hasClass("active")&&b.populate(j)},600)},"{placeholder} mediaUploaderFileError":function(c,d,e,f){f.code==a.plupload2.FILE_EXTENSION_ERROR&&b.fileError.inside(o).removeClass("hide")},createPlayer:function(c,d){var e=l.data(c),f=e.uid||(e.uid=a.uid("video-")),g=a(n.player).clone(),h=b.videoPlayer.inside(g),i=b.videoSource.inside(g);
h.attr("id",f),i.attr("src",d),e.url=d,e.width&&g.css("width",e.width),e.height&&g.css("height",e.height),q.toFluidWidth(c),q.toFluidHeight(c),content=l.getBlockContent(c),l.getBlockContent(c).empty().append(g),videojs(f,{controls:!0,autoplay:!1},function(){this.muted(e.muted)})},populateVideoControls:function(a){var c=l.data(a);b.autoplay().val(c.autoplay?1:0).trigger("change"),b.loop().val(c.loop?1:0).trigger("change"),b.muted().val(c.muted?1:0).trigger("change")},"{muted} change":function(a){var c=l.data(o);
c.muted=1==a.val()?!0:!1},"{autoplay} change":function(a){var c=l.data(o);c.autoplay=1==a.val()?!0:!1},"{loop} change":function(a){var c=l.data(o);c.loop=1==a.val()?!0:!1},populateVideoSize:function(a,c){for(var d,c=c||["width","height"];d=c.shift();){var e="width"==d?b.getVideoWidth(a):b.getVideoHeight(a),f=parseFloat(e),g=h(e);if(b.resizingFromSlider!==d){if("px"==g)var i={start:f,step:1,range:{min:1,max:1600},pips:{mode:"values",values:[64,320,640,960,1280,1600],density:4}};if("%"==g)var i={start:f,step:1,range:{min:1,max:100},pips:{mode:"values",values:[0,20,40,60,80,100],density:5}};
b.numsliderWidget.of(d).find(".noUi-pips").remove().end().noUiSlider(i,!0).noUiSlider_pips(i.pips)}b.numsliderInput.of(d).val(Math.round(f)),b.numsliderCurrentUnit.of(d).html(g),b.numsliderUnit.of(d).removeClass("active").where("unit",'"'+g+'"').addClass("active")}b.populateVideoRatio(a),b.populateVideoAlignment(a)},getVideoWidth:function(a){var b=p(a),c=b[0].style;if(l.isNestedBlock(a)){var d=a[0].style.width;if(/%/.test(d))return d}return c.width||b.css("width")},getVideoHeight:function(a){var b=p(a),c=b[0].style;
return c.height||b.css("height")},getVideoSize:function(a,c){return"width"==c?b.getVideoWidth(a):"height"==c?b.getVideoHeight(a):void 0},getVideoComputedWidth:function(a){return p(a).width()},getVideoComputedHeight:function(a){return p(a).outerHeight()},setVideoWidth:function(a,c){{var d=p(a),f=(getVideoViewport(a),b.getVideoRatio(a)),g=h(c);b.getVideoComputedHeight(a)}d.toggleClass("is-responsive","%"==g),l.isNestedBlock(a)?("%"==g&&(a.css("width",c),d.css("width","")),"px"==g&&(a.css("width","auto"),d.css("width",c))):d.css("width",c),0==f&&"%"==g&&(f=null),b.adjustVideoRatio(a,f)
},setVideoFluidWidth:function(a,b){var c=p(a);if(l.isNestedBlock(a))q.toAutoWidth(a),c.css("width",b),q.toFluidWidth(a),c.css("width","");else{var d=l.getBlockContent(a),b=b/d.width()*100+"%";c.css("width",b)}},setVideoSize:function(a,c,d){"width"==c&&b.setVideoWidth(a,d),"height"==c&&b.setVideoHeight(a,d)},updateVideoSize:function(a,c,d){b.setVideoSize(a,c,d),b.populateVideoSize(a)},setVideoHeight:function(a,c){var d=p(a),e=getVideoViewport(a),f=b.getVideoRatio(a);if(b.isFluidVideo(a)){if(0==f){var g=b.getVideoComputedWidth(a),c=parseFloat(c);
f=g/c}else{var g=parseFloat(c)*f;b.setVideoFluidWidth(a,g)}d.css("height",""),e.css("padding-top",ratioPadding(f))}else if(d.css("height",c),0!==f){var g=parseFloat(c)*ratioDecimal(f);d.css("width",g),e.css("padding-top","")}},setVideoUnit:function(a,c,d){if("width"===c){{var f=(p(a),b.getVideoWidth(a)),g=b.getVideoComputedWidth(a);b.getVideoComputedHeight(a)}"px"==d&&/%/.test(f)&&b.setVideoWidth(a,g),"%"==d&&/px/.test(f)&&b.setVideoFluidWidth(a,g)}},getVideoUnit:function(a,c){var d=b.getVideoSize(a,c);return h(d)
},updateVideoUnit:function(a,c,d){b.setVideoUnit(a,c,d),b.populateVideoSize(a)},handleNumsliderWidget:function(a,c){var d=b.getVideoSizeProp(a),e=b.getVideoSizeUnit(d),c=Math.round(c)+e;b.resizingFromSlider=d,b.updateVideoSize(o,d,c),b.resizingFromSlider=null},"{numsliderWidget} nouislide":function(a,c,d){b.handleNumsliderWidget(a,d)},"{numsliderWidget} set":function(a,c,d){b.handleNumsliderWidget(a,d)},"{numsliderInput} input":function(c){function d(a){c.on("blur.numslider",function(){c.val(a)})}c.off("blur.numslider");
var e=b.getVideoSizeProp(c),f=b.getVideoSize(o,e),g=parseFloat(f),i=c.val(),j=h(f),k=i+j;return a.isNumeric(i)?(b.updateVideoSize(o,e,k),void 0):d(g)},"{numsliderUnit} click":function(a){var c=b.getVideoSizeProp(a),d=a.data("unit");b.updateVideoUnit(o,c,d)},"{self} composerBlockResizeStart":function(a,c,d){if("video"===l.getBlockType(d)){var f=b.getVideoComputedWidth(d),g=b.getVideoComputedHeight(d);d.data("initialWidth",f),d.data("initialHeight",g)}},"{self} composerBlockBeforeResize":function(a,c,d,e){function q(){b.isFluidVideo(d)?b.setVideoFluidWidth(d,n):b.setVideoWidth(d,n)
}function r(){b.setVideoHeight(d,o)}if("video"===l.getBlockType(d)&&b.hasVideoContainer(d)){c.preventDefault();var g=(d.data("initialImageSize"),e.originalSize),h=e.size,i=h.width-g.width,j=h.height-g.height,k=d.data("initialWidth"),m=d.data("initialHeight"),n=k+i,o=m+j,p=b.getVideoRatio(d);0==p?(0!==i&&q(),0!==j&&r()):0==i?0!==j&&r():q(),b.populateVideoSize(d)}},setVideoRatio:function(a,c){var d=l.data(a);d.ratio=c,b.adjustVideoRatio(a,c)},adjustVideoRatio:function(a,c){var d=p(a),e=getVideoViewport(a),f=b.getVideoComputedWidth(a),g=b.getVideoComputedHeight(a),h="",i="";
null==c&&(c=f/g),b.isFluidVideo(a)?i=ratioPadding(c):h=0==c?g:f/ratioDecimal(c),d.css("height",h),e.css("padding-top",i)},populateVideoRatio:function(a){var c=l.data(a),d=c.ratio;b.ratioButton().toggleClass("ratio-unlocked",0==d),b.ratioLabel().html(d)},updateVideoRatio:function(a,c){b.setVideoRatio(a,c),b.populateVideoRatio(a)},getVideoRatio:function(a){{var c=l.data(a);p(a)}if(void 0===c.ratio){var e=b.getVideoComputedWidth(a),f=b.getVideoComputedHeight(a);c.ratio=e/f}return j(c.ratio)},"{browseButton} mediaSelect":function(a,c,d){var e=l.block.of(a);
if("video"==d.meta.type){var f=d.meta,g=k.document,h=g.isLegacy();h?(content=b.toLegacyHTML(e),g.insertContent(content)):b.createPlayer(e,f.url)}},"{self} mediaInsert":function(a,c,d,e){if("video"==d.meta.type){var f=k.document,g=f.isLegacy();if(g)content=b.toLegacyShortcode(d.meta,e),f.insertContent(content);else{var e=(l.data(e),l.constructBlock("video",{url:d.meta.url}));l.addBlock(e),l.activateBlock(e)}}},"{self} mediaInfoDestroy":function(a,c,d,e){if(!e||"video"==e.meta.type){var f=b.videoPlayer.inside(d),g=f.attr("id");
videojs(g).dispose()}},"{ratioButton} click":function(){b.sizeField().switchClass(c)},"{ratioCustomizeButton} click":function(){b.sizeField().switchClass(d)},"{ratioCancelButton} click":function(){b.sizeField().removeClass(c)},"{ratioCancelCustomButton} click":function(){b.sizeField().switchClass(c)},"{ratioOkCustomButton} click":function(){b.sizeField().removeClass(d)},"{ratioUseCustomButton} click":function(){var c=b.ratioInput(),e=m(c.val());0!=e&&(b.updateVideoRatio(o,e),b.ratioSelection().removeClass("active"),b.sizeField().removeClass(d))
},"{ratioSelection} click":function(a){b.ratioSelection().removeClass("active"),a.addClass("active"),b.sizeField().removeClass(c);var d=a.data("value");b.updateVideoRatio(o,d)},"{alignmentSelection} change":function(a){var b=a.val();l.font.setFontFormatting(o,"align"+b)},populateVideoAlignment:function(a){if(l.isNestedBlock(a))return b.sizeField().addClass("no-alignment"),void 0;var c=l.getBlockContent(a),d=b.getVideoComputedWidth(a),e=d<c.width();b.sizeField().toggleClass("no-alignment",!e);var f=a.css("text-align");
b.alignmentSelection().val(f)},getVideoSizeField:function(c){var d=b["videoSizeFieldVideo"+a.capitalize(c)]();return d},getVideoSizeProp:function(a){var c=a.closest(b.numslider.selector),d=g(c.data("name"));return d},getVideoSizeUnit:function(c){var d=b.getVideoSizeField(c);return a.trim(b.numsliderCurrentUnit.under(d).text())},isFluidVideo:function(a){var b=p(a);return b.hasClass("is-responsive")},hasVideo:function(a){var b=l.data(a);return!!b.url},hasVideoContainer:function(a){return b.videoContainer.inside(a).length>0
}}}),b.resolve()})}),EasyBlog.module("composer/blocks/mobile",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Mobile",{defaultOptions:a.extend({"{blipp}":"[data-eb-blipp]","{viewport}":".eb-composer-viewport","{actionBar}":"[data-eb-composer-actions]"},EBD.selectors)},function(b,c,d,e,f){return{init:function(){f=b.blocks,e=f.composer},"{blipp} mousedown":function(c,d){d.stopPropagation(),d.preventDefault();var g;a(document).off("mousemove.blip mouseup.blip").on("mousemove.blip",function(d){var e=a.getPointerPosition(d),f=b.viewport(),h=f.offset(),i=30,j=f.width()-10,k=f.height()-30,l=h.left+30,m=e.x-h.left,n=e.y-h.top;
c.css("left",m),c.css("top",n),g=null,e.y<i&&(g="addBlock"),e.y>k&&(g="removeBlock"),e.x<l&&(g="viewBlockTree"),e.x>j&&(g="moveBlock")}).on("mouseup.blip",function(){return a(document).off("mousemove.blip"),b.actionBar().show(),e.blocks.droppable.destroyDropzones(),e.sidebar.deactivate("blocks"),e.sidebar.deactivate("explorer"),"addBlock"==g?(e.sidebar.activate("blocks"),e.blocks.droppable.populateDropzones(),b.trigger("ComposerMobileAddBlock"),void 0):"moveBlock"==g?(e.blocks.droppable.populateDropzones(),f.getAllBlocks().on("click.tapremove",function(b){b.stopPropagation();
var c=a(this);c.addClass("hide")}),void 0):"removeBlock"==g?(b.actionBar().hide(),f.getAllBlocks().on("click.tapremove",function(b){b.stopPropagation();var c=a(this);f.removeBlock(c)}),b.trigger("ComposerMobileRemoveBlock"),void 0):"viewBlockTree"==g?(EasyBlog.Composer.sidebar.activate("explorer"),b.trigger("ComposerMobileViewTree"),void 0):void 0})}}}),b.resolve()}),EasyBlog.module("composer/blocks/nestable",function(a){var b=this,c="is-nested";EasyBlog.require().library("ui/sortable").done(function(){EasyBlog.Controller("Composer.Blocks.Nestable",{defaultOptions:a.extend({},EBD.selectors)},function(b,d,e,f,g){return{init:function(){g=b.blocks,f=b.blocks.composer,currentNest=a()
},enable:function(){b.nest().each(function(){var c=a(this);b.initNestable(c)})},disable:function(){b.nest().each(function(){var c=a(this);b.destroyNestable(c)})},initNestable:function(a){a.hasClass("ui-sortable")||a.sortable({items:EBD.childBlock,connectWith:EBD.root+", "+EBD.nest,helper:"clone",appendTo:f.document.ghosts(),placeholder:"ebd-block is-placeholder is-nested",tolerance:"pointer",refreshPositions:!0,handle:EBD.immediateBlockSortHandle})},destroyNestable:function(a){a.hasClass("ui-sortable")&&a.sortable("destroy")
},"{self} composerBlockMechanicsChange":function(a,c,d){"sortable"==d?b.enable():b.disable()},isBlockNest:function(a){return"block"==a.data("type")},isContentNest:function(a){return"content"==a.data("type")},"{self} composerBlockCreate":function(){},"{self} composerBlockInit":function(c,d,e){e.is(EBD.nestableBlock)&&"sortable"!=!g.getMechanics()&&e.find(EBD.nest).each(function(){var c=a(this);b.initNestable(c)})},disableEditableNest:function(a){a.editable()&&(a.editable(!1),a.data("editable-nest",!0))},enableEditableNest:function(a){a.data("editable-nest")&&(a.editable(!0),a.removeData("editable-nest"))
},"{block} mouseover":function(a,c){if(!c.nestHandled){if(a.is(EBD.nestedBlock)){var d=b.nest.of(EBD.nestedBlock);b.disableEditableNest(d)}else{var d=b.nest.inside(a);if(d.length<1)return;b.enableEditableNest(d)}c.nestHandled=!0}},"{block} mouseout":function(a){if(a.is(EBD.nestedBlock)){var d=b.nest.of(EBD.nestedBlock);b.enableEditableNest(d)}},snap:function(a,d,e,f){if(b.isBlockNest(e))return f.addClass(c),void 0;var g=e.offset(),h=e.width(),i=g.left+h/2,j=b.position(e,i>a?"left":"right");f.addClass(c).switchClass("nest-"+j),e.data("snappedPosition",j)
},unsnap:function(a){a.removeClass(c).removeClass(function(a,b){return(b.match(/(^|\s)nest-\S+/g)||[]).join(" ")})},positions:function(a){return(a.data("positions")||"left,right").split(",")},availablePositions:function(c){var d=b.positions(c);return c.find(EBD.childBlock+":not(.is-sort-item)").each(function(){var c=b.extractPosition(a(this).attr("class"));c&&a.pull(d,c)}),d},extractPosition:function(b){return b instanceof a&&(b=b.attr("class")),((b.match(/nest-\w+/g)||[])[0]||"").split("nest-")[1]},position:function(c,d){var e=b.availablePositions(c);
return a.indexOf(e,d)>-1?d:e[0]},setTargetNest:function(a){b.clearTargetNest(),g.over(a)},unsetTargetNest:function(a){g.out(a)},clearTargetNest:function(){b.nest().each(function(){var b=a(this);g.out(b)})},trackNest:function(c,d){a(document).off("mousemove.nestable").on("mousemove.nestable",function(a){b.snap(a.pageX,a.pageY,c,d)})},untrackNest:function(){a(document).off("mousemove.nestable")},"{self} composerBlockBeforeDrop":function(a,d,e){var f=e.closest(EBD.nest),h=b.extractPosition(e);if(e.toggleClass(c,f.length>0),b.isContentNest(f)){var i=b.position(f,f.data("snappedPosition"));
e.switchClass("nest-"+i),e.hasClass("is-new")&&g.dimensions.toFluidWidth(e),h&&i!==h?b.trigger("composerBlockNestChange",[e,i,h]):b.trigger("composerBlockNestIn",[e,i])}else h&&(b.unsnap(e),b.trigger("composerBlockNestOut",[e]))},replaceWithCommentPlaceholder:function(c,d){var e=a("<div>").html(c[d]),f=e.find(EBD.immediateNestedBlock);if(!(f.length<=0)){f.each(function(){var d=a(this),e=g.getBlockUid(d),f=document.createComment("block"+e);d.replaceWith(f);var h=g.getBlock(e),i=g.exportBlock(h),j=b.extractPosition(h.attr("class"));
j&&(i.position=j),c.blocks.push(i)});var h=e.html();c[d]=h}},"{self} composerBlockExport":function(a,c,d,e){e.blocks=[],b.replaceWithCommentPlaceholder(e,"editableHtml"),b.replaceWithCommentPlaceholder(e,"html")}}}),b.resolve()})}),EasyBlog.module("composer/blocks/panel",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Panel",{elements:["[data-eb-composer-blocks-{props}]","[data-eb-composer-blocks-{prop-group|prop-action}]","[data-eb-composer-{panel}][data-id=blocks]","[data-eb-composer-blocks-{block-subpanel|removal-subpanel}]","[data-eb-composer-block-{fieldgroup}]","[data-eb-composer-blocks-props-{block-menu|text-menu|block-content|text-content}]","[data-eb-composer-blocks-{subpanel|subpanel-button}]"],defaultOptions:{"{blockTitle}":"[data-block-property-title]","{blockIcon}":"[data-block-property-icon]"}},function(b,c,d,e,f,g){return{init:function(){f=b.blocks,e=f.composer,g=a()
},"{self} composerBlockBeforeActivate":function(a,c,d){e.panels.activate("blocks"),g=d,b.panel().switchClass("show-block-subpanel"),b.fieldgroup.display(d)},fieldgroup:{get:a.memoize(function(c){var d=e.find(b.fieldgroup).where("type",c);if(d.length<1)var g=f.getBlockMeta(c),d=a(g.fieldgroup);return d}),hide:function(){b.panel().addClass("is-empty").find(b.fieldgroup).detach()},display:function(a){var c=a.attr("data-type"),d=b.panel();d.removeClass("is-empty").find(b.fieldgroup).detach();var e=d.find(b.propGroup).where("type","specific");
b.fieldgroup.get(c).toggleClass("is-standalone",f.isStandaloneBlock(a)).appendTo(e)}},openPanel:function(a){("block"==a||"text"==a)&&(b.panel().switchClass("show-"+a+"-subpanel"),b.subpanelButton().where("name",a).activateClass("active")),"removal"==a&&b.panel().switchClass("show-removal")},activatePanel:function(a){clearTimeout(b.revertToPostPanel);{var c=f.getBlockMeta(a);f.getAllParentBlocks(a),f.getChildBlocks(a)}b.subpanelButton().show(),c.properties.textpanel||b.subpanelButton().hide(),b.blockIcon().attr("class",c.icon),b.blockTitle().html(c.title)
},deactivatePanel:function(){b.revertToPostPanel=setTimeout(function(){e.document.workarea().hasClass("is-sorting")||e.panels.activate("post-options")},1),b.fieldgroup.hide()},"{self} composerBlockActivate":function(a,c,d){b.activatePanel(d)},"{self} composerBlockDeactivate":function(a,c,d){b.deactivatePanel(d)},"{self} composerBlockRemove":function(a,c,d){b.fieldgroup.hide(d)},"{subpanelButton} click":function(a){var c=a.data("name");b.openPanel(c)}}}),b.resolve()}),EasyBlog.module("composer/blocks/removal",function(){var b=this,c="is-removing";
EasyBlog.require().library("ui/droppable").done(function(){EasyBlog.Controller("Composer.Blocks.Removal",{defaultOptions:{"{workarea}":EBD.workarea,"{dropzone}":"[data-eb-composer-blocks-removal-subpanel]"}},function(a,b,d,e,f,g){return{init:function(){f=a.blocks,e=f.composer},"{self} composerBlockDrag":function(b,c,d){g=d,e.panels.activate("blocks"),f.panel.openPanel("removal");var h=a.dropzone();h.data("inited")||(h.droppable({accept:EBD.block,tolerance:"pointer"}),h.data("inited",!0))},"{self} composerBlockDrop":function(){a.workarea().hasClass(c)||f.panel.openPanel("block")
},"{dropzone} drop":function(b,d,e){var g=e.draggable,h=a.workarea();h.addClass(c),g.addClass(c),b.addClass(c),setTimeout(function(){f.removeBlock(g),setTimeout(function(){f.panel.openPanel("block"),h.removeClass("is-removing"),setTimeout(function(){b.removeClass("is-removing active")},250)},250)},100)},"{dropzone} dropout":function(a){a.removeClass("active")},"{dropzone} dropover":function(a){a.addClass("active")}}}),b.resolve()})}),EasyBlog.module("composer/blocks/resizable",function(a){var b=this;EasyBlog.require().library("ui/resizable").done(function(){EasyBlog.Controller("Composer.Blocks.Resizable",{defaultOptions:a.extend({"{resizeHandle}":".ui-resizable-handle"},EBD.selectors)},function(b,c,d,e,f){return{init:function(){f=b.blocks,e=b.blocks.composer
},initResizable:function(c){if(!b.hasResizable(c)){var d=b.determineResizeHandles(c);if(d){{var e=b.createResizeHandleElements(d),g=b.createResizeHandleSelectors(d);f.getBlockViewport(c).append(e).resizable({handles:g})}a(e).hide(),c.addClass("is-resizable")}}},destroyResizable:function(a){f.getBlockViewport(a).resizable("destroy"),a.removeClass("is-resizable")},hasResizable:function(a){return f.getBlockViewport(a).hasClass("ui-resizable")},handles:{right:{w:"dimension",sw:"dimension",s:"dimension"},left:{e:"dimension",se:"dimension",s:"dimension"}},determineResizeHandles:function(a){var c=f.nestable.extractPosition(a);
return b.handles[c]},createResizeHandleElements:function(b){var c=[];return a.each(b,function(b,d){var e=a('<div class="ui-resizable-handle"><div></div></div>').addClass("ui-resizable-"+b).attr({"data-direction":b,"data-role":d});c.push(e[0])}),c},createResizeHandleSelectors:function(b){var c=[];return a.each(b,function(a){c[a]="> .ui-resizable-"+a}),c},getResizeHandles:function(a){return f.getBlockViewport(a).children(b.resizeHandle.selector)},"{self} composerBlockActivate":function(a,c,d){b.initResizable(d),b.getResizeHandles(d).show()
},"{self} composerBlockDeactivate":function(a,c,d){b.getResizeHandles(d).hide()},"{self} composerBlockNestIn":function(a,c,d){b.initResizable(d)},"{self} composerBlockNestOut":function(a,c,d){b.destroyResizable(d)},"{self} composerBlockNestChange":function(a,c,d){b.destroyResizable(d),b.initResizable(d)},"{blocks.viewport} resizestart":function(a,c,d){b.workarea().addClass("is-resizing");var e=b.block.of(a);parentBlocks=f.getAllParentBlocks(e),parentBlocks.addClass("has-resizing-child"),b.trigger("composerBlockResizeStart",[e,d])
},"{blocks.viewport} resize":function(a,c,d){a.css({top:"",left:"",width:"",height:""}),c.stopPropagation();var e=b.block.of(a);if(f.isNestedBlock(e)&&"content"===f.getBlockNestType(e)){var g=b.trigger("composerBlockBeforeResize",[e,d]);if(!g.isDefaultPrevented()){var h=d.originalSize,i=d.size;if(h.width!==i.width){var j=f.getBlockNest(e),k=i.width/j.width();0>k&&(k=0),k>1&&(k=1),k=Math.floor(100*k)+"%",e.css("width",k)}if(h.height!==i.height){e.css("height","");var l=e.height(),m=i.height;l>m&&(m=""),e.css("height",m)
}}b.trigger("composerBlockResize",[e])}},"{blocks.viewport} resizestop":function(a,c,d){b.workarea().removeClassAfter("is-resizing");var e=b.block.of(a);parentBlocks=f.getAllParentBlocks(e),parentBlocks.removeClass("has-resizing-child"),b.trigger("composerBlockResizeStop",[e,d])}}})}),b.resolve()}),EasyBlog.module("composer/blocks/scrollable",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Scrollable",{defaultOptions:a.extend({},EBD.selectors)},function(b,c,d,e,f){return{init:function(){f=b.blocks,e=f.composer
},"{block} dragstart":function(){b.scrollstart()},"{blocks.menu} dragstart":function(){b.scrollstart()},"{block} dragstop":function(){b.scrollstop()},"{blocks.menu} dragstop":function(){b.scrollstop()},"{self} composerBlockDrop":function(){b.scrollstop()},stop:!1,scrollTimer:null,scrollstart:function(){var i,c=e.viewport(),d=e.document.viewportContent()[0],f=c.height(),g=50,h=f-50,j=function(){b.stop=!1,(i.y>h||i.y<g)&&(b.stop=!0,i.y>h&&(d.scrollTop+=f/2),i.y<g&&(d.scrollTop-=f/2),clearTimeout(b.scrollTimer),b.scrollTimer=setTimeout(j,1e3),b.trigger("composerDocumentScroll"))
};a(document).on(a.ns("mousemove touchmove",".scrollable"),function(c){i=a.getPointerPosition(c),b.stop&&i.y>g&&i.y<h&&(b.stop=!1),b.stop||j()})},scrollstop:function(){clearTimeout(b.scrollTimer),a(document).off(a.ns("mousemove touchmove",".scrollable"))}}}),b.resolve()}),EasyBlog.module("composer/blocks/search",function(a){var b=this,c="is-searching",d="is-empty";EasyBlog.Controller("Composer.Blocks.Search",{elements:["[data-eb-blocks-{search-input|search-toggle-button|search-panel}]"],defaultOptions:{}},function(b,e,f,g,h){return{init:function(){h=b.blocks,g=h.composer
},toggleSearch:function(){h.blocks().hasClass(c)?b.deactivateSearch():b.activateSearch()},activateSearch:function(){h.view().addClass(c),b.searchInput().val("").focus()},deactivateSearch:function(){h.view().removeClass(c),b.resetSearch()},resetSearch:function(){h.view().removeClass(d),b.searchInput().val(""),h.menu().show(),h.menuGroup().each(function(){a(this).parents(".eb-composer-fieldset").show()})},search:function(b){var b=a.trim(b.toLowerCase()),c=h.menu(),e=c.filter("[data-keywords*='"+b+"']"),f=""==b,g=!f&&e.length<1;
f?c.show():c.hide(),e.show(),h.view().toggleClass(d,g),h.menuGroup().each(function(){var b=a(this),c=b.parents(".eb-composer-fieldset").show();b.height()<1&&c.hide()})},"{searchToggleButton} click":function(){b.toggleSearch()},"{searchInput} keyup":function(a,c){var d=a.val();27===c.keyCode&&(""==d?b.deactivateSearch():b.resetSearch())},"{searchInput} input":a.debounce(function(a){b.search(a.val())},150)}}),b.resolve()}),EasyBlog.module("composer/blocks/text",function(a){var b=this;EasyBlog.require().library("colorpicker","nouislider").script("layout/elements").done(function(){EasyBlog.Controller("Composer.Blocks.Text",{elements:[".eb-composer-fieldset[data-name=text] [data-eb-{font-color-menu|font-family-menu|font-size-menu|font-color-content|font-color-picker|font-family-content|font-size-content|font-color-caption|font-family-caption|font-size-caption|font-family-option|font-format-option}]",".eb-composer-fieldset[data-name=text] [data-eb-{numslider-toggle|numslider-widget|numslider-value|numslider-input|numslider-units|numslider-unit|numslider-current-unit|numslider-unit-toggle}]",".eb-composer-fieldset[data-name=text] [data-eb-{colorpicker|colorpicker-toggle}]","[data-eb-{links|link-item-group|link|link-item|link-preview|link-preview-caption|link-url-field|link-title-field|link-blank-option|link-remove-button}]"],defaultOptions:a.extend({fontSizeUnits:{px:{start:12,step:2,range:{min:8,max:72},pips:{mode:"values",density:4,values:[8,12,18,24,48,72]}},"%":{start:100,step:10,range:{min:0,max:200},pips:{mode:"positions",values:[0,50,100],density:10}}},"{textFieldset}":".eb-composer-fieldset[data-name=text]","{linksFieldset}":".eb-composer-fieldset[data-name=links]","{fontSizeCheckbox}":"[data-eb-font-size-content] .eb-numslider-toggle input","{fontSizeToggle}":"[data-eb-font-size-content] .eb-numslider-toggle label","{linkBlankOptionField}":".eb-link-blank-option"},EBD.selectors)},function(b,c,d,e,f,g,h,i,j,k){return{init:function(){f=b.blocks,e=f.composer,b.textFieldset().on("touchstart click mousedown mouseup",function(a){a.preventDefault()
}),b.linksFieldset().on("touchstart click mousedown mouseup",function(a){a.preventDefault()})},"{self} composerDocumentReady":function(){g=e.editor,b.initFontColor(),b.initLinks(),b.initHandlers()},initHandlers:function(){},"{self} composerBlockActivate":function(a,c,d){var e=f.getBlockMeta(d);return e.properties.fonts?void 0:(b.textFieldset().hide(),b.linksFieldset().hide(),void 0)},"{self} composerTextSelect":function(a,c,d,e){var h=f.getBlockMeta(e);return h.properties.fonts?(k||(f.panel.blockSubpanel().addClass("has-text-selection"),b.textFieldset().show(),b.linksFieldset().show(),b.textFieldset().find(".eb-font-formatting.section-list").toggle("text"==e.data("type")),b.populateFont(),b.populateLinks()),void 0):(b.textFieldset().hide(),b.linksFieldset().hide(),void 0)
},"{self} composerTextDeselect":function(){k||b.workarea().hasClass("is-sorting")||(f.panel.blockSubpanel().removeClass("has-text-selection"),b.textFieldset().hide(),b.linksFieldset().hide(),b.removeTextMarkers(),b.linkItemGroup().empty())},populateFont:function(){b.populateFontColor(),b.populateFontFamily(),b.populateFontSize(),b.populateFontFormatting()},initFontColor:function(){b.fontColorPicker().colorpicker()},populateFontColor:function(){if(b.lastUpdatedViaFontColorUI)return b.lastUpdatedViaFontColorUI=!1,void 0;
var c=g.selection.getParent(),d=a(c).css("color");b.colorpickerToggle().prop("checked",c.style.color),b.updateFontColorUI(d)},setFontColor:function(a){b.removeFontColor(),g.inline.toggleStyle("color: "+a),b.updateFontColorUI(a),b.lastUpdatedViaFontColorUI=!0},updateFontColorUI:function(a){b.updatingFontColorUI=!0,!a&&(a="#000"),b.fontColorCaption().css("backgroundColor",a),b.fontColorPicker().colorpicker("setColor",a),b.updatingFontColorUI=!1},removeFontColor:function(){g.inline.removeStyleRule("color")},populateFontFamily:function(){if(b.lastUpdatedViaFontFamilyUI)return b.lastUpdatedViaFontFamilyUI=!1,void 0;
var a=g.selection.getParent(),c=a.style.fontFamily.replace(/\'\"/g,"");b.updateFontFamilyUI(c)},setFontFamily:function(a){b.lastUpdatedViaFontFamilyUI=!0,g.inline.format("span","style","font-family: "+a),b.updateFontFamilyUI(a)},updateFontFamilyUI:function(a){!a&&(a="");var c=b.fontFamilyOption().removeClass("active").where("value",'"'+a+'"').addClass("active"),d=c.length>0?c.html():a.split(",")[0];b.fontFamilyCaption().html(d)},removeFontFamily:function(){b.lastUpdatedViaFontFamilyUI=!0,g.inline.removeStyleRule("font-family")
},populateFontSize:function(){if(b.lastUpdatedViaFontSizeUI)return b.lastUpdatedViaFontSizeUI=!1,void 0;var c=g.selection.getParent(),d=a(c).css("fontSize"),e=!!c.style.fontSize;b.updateFontSizeUI(d),b.numsliderToggle().prop("checked",!!e)},setFontSize:function(c){if(a.isNumeric(c)){var d=b.getFontSizeUnit();c+=d}b.lastUpdatedViaFontSizeUI=!0,g.inline.format("span","style","font-size: "+c);var e=g.selection.getParent(),f=a(e).css("fontSize");b.updateFontSizeUI(c||f),b.numsliderToggle().prop("checked",!!c)},updateFontSizeUI:function(a){b.updatingFontSizeUI=!0;
var c=Math.abs(a.replace(/\%|px/gi,""));unit=a.match("%")?"%":"px",b.getFontSizeUnit()!==unit&&b.setFontSizeUnit(unit),b.fontSizeCaption().html(a),b.numsliderCurrentUnit().html(unit),b.numsliderUnit().removeClass("active").where("unit",'"'+unit+'"').addClass("active"),b.numsliderWidget().val(c),b.numsliderInput().val(c),b.updatingFontSizeUI=!1},removeFontSize:function(){g.inline.removeStyleRule("font-size")},getFontSizeUnit:function(){return b.fontSizeContent().data("unit")||"%"},setFontSizeUnit:function(d){b.fontSizeContent().data("unit",d);
var e=c.fontSizeUnits[d];b.numsliderWidget().find(".noUi-pips").remove().end().noUiSlider(a.extend({document:i},e),!0).noUiSlider_pips(e.pips)},formattingTags:{bold:"strong",italic:"em",underline:"u",strikethrough:"del",code:"code",superscript:"sup",subscript:"sub",orderedlist:"ol",unorderedlist:"ul"},populateFontFormatting:function(){b.lastUpdatedViaFontFormattingUI?b.lastUpdatedViaFontFormattingUI=!1:b.removeTextMarkers();var c=g.selection.getCurrent(),d=a(c).parentsUntil(EBD.block).filter("ul, ol").eq(0);
b.fontFormatOption().each(function(){var e=a(this),f=e.data("format"),g=b.formattingTags[f];hasFormatting=/unorderedlist|orderedlist/.test(f)?d.is(g):0!==a(c).closest(g).length,e.toggleClass("active",hasFormatting)})},toggleFontFormatting:function(a){switch(a){case"orderedlist":case"unorderedlist":g.list.toggle(a);break;case"indent":g.indent.increase();break;case"outdent":g.indent.decrease();break;case"clear":b.selectWithinTextMarkers(),g.inline.removeFormat(),b.removeTextMarkers();break;default:!b.hasTextMarkers()&&b.createTextMarkers(),g.inline.format(a),b.lastUpdatedViaFontFormattingUI=!0
}},hasTextMarkers:function(){return b.workarea().find(".composer-text-marker").length>0},createTextMarkers:function(){g.selection.removeMarkers(),g.selection.createMarkers();var c=a.makeArray(b.workarea().find(".redactor-selection-marker").each(function(){a(this).removeClass("redactor-selection-marker").addClass("composer-text-marker").attr("id",this.id.replace("selection-","text-"))}));return b.selectWithinTextMarkers(c),c},getTextMarkers:function(){var c=a.makeArray(b.workarea().find("span#text-marker-1, span#text-marker-2"));
return c[0]&&c[1]?c:void 0},selectWithinTextMarkers:function(a){a||(a=b.getTextMarkers()),a&&g.caret.set(a[0].nextSibling,0,a[1],0)},removeTextMarkers:function(){b.workarea().find(".composer-text-marker").remove()},startEditingSelection:function(){k=!0,b.removeTextMarkers(),b.workarea().off("mousedown.stopEditingSelection").one("mousedown.stopEditingSelection",function(){b.stopEditingSelection()})},stopEditingSelection:function(){k=!1},initLinks:function(){b.linkItem.template=b.linkItem(".is-blank").detach().removeClass("is-blank")[0]
},populateLinks:function(){var c=g.selection.getNodesInRange(),d=a(c).filter("a"),e=b.linkItemGroup().empty();a.each(d,function(a,c){var d=b.createLinkItem().appendTo(e);b.processLinkItem(d),b.updateLinkItem(d,c)}),b.linkItemGroup().toggleClass("has-existing-links",d.length>0);var f=b.createLinkItem().addClass("is-new").appendTo(e);b.processLinkItem(f);var h=g.selection.getText();b.linkPreviewCaption.inside(f).html(h)},createLinkItem:function(){var c=a(b.linkItem.template).clone();return c},processLinkItem:function(c){var d=b.linkUrlField.inside(c),e=b.linkTitleField.inside(c);
c.data("linkUrlField",d[0]),c.data("linkTitleField",e[0]),d.data("linkItem",c).on("input",b.linkUrlFieldInputHandler).on("mousedown",function(){if(a.IE){var b=c.data("anchorNode");b||g.selection.save()}}),e.data("linkItem",c).on("input",b.linkTitleFieldInputHandler).on("mousedown",function(){if(a.IE){var b=c.data("anchorNode");b||g.selection.save()}});var f=c.find(".eb-link-input");d.css({padding:"6px 12px",display:"block",fontSize:"13px",lineHeight:"24px",fontWeight:"bold",paddingBottom:"0px",color:"#555555",width:"100%",border:"none",outline:"none",position:"relative",zIndex:2}),a.IE&&d.css({height:"28px"}),e.css({border:"none",resize:"none",fontSize:"12px",padding:"12px",paddingTop:"32px",overflow:"hidden",outline:"none",position:"absolute",width:"100%",height:"100%",color:"#555555",fontFamily:"Arial, Helvetica, sans-serif",top:0,left:0,zIndex:1});
try{var h=a("<iframe>");h.on("load",function(){a(h[0].contentWindow.document.body).css({margin:0,overflow:"hidden"}).append(d).append(e)}),f.append(h)}catch(i){console.error("There may a cross-iframe security issue. Unable to create text link item properly",i)}},updateLinkItem:function(c,d){b.linkPreviewCaption.inside(c).html(a(d).text()),a(c.data("linkUrlField")).val(d.getAttribute("href")),a(c.data("linkTitleField")).val(d.title),b.linkBlankOption.inside(c).prop("checked","_blank"==d.target),c.data("anchorNode",d)
},removeLinkItem:function(a){return b.removeAnchorNode(a),a.hasClass("is-new")?(b.resetLinkItem(a),void 0):(a.remove(),b.linkItem(":not(.is-new)").length<1&&b.linkItemGroup().removeClass("has-existing-links"),void 0)},resetLinkItem:function(a){b.linkUrlField.inside(a).val(""),b.linkTitleField.inside(a).val(""),b.linkBlankOption.inside(a).prop("checked",!1)},createAnchorNode:function(b){var c=g.selection.getHtml(),d=a.uid("link-"),e=a("<a />").attr("id",d).html(c)[0];return g.insert.node(e),e=a("#"+d).removeAttr("id")[0],g.selection.selectElement(e),b.data("anchorNode",e),e
},updateAnchorNode:function(c){var d=c.data("anchorNode");if(d){var e=a(c.data("linkUrlField")),f=a(c.data("linkTitleField")),g=b.linkBlankOption.inside(c);d.href=a.trim(e.val()),d.title=f.val(),g.is(":checked")?d.target="_blank":d.removeAttribute("target")}},removeAnchorNode:function(b){var c=b.data("anchorNode");c&&(g.selection.save(),$anchorNode=a(c),$anchorNode.contents().insertAfter($anchorNode),$anchorNode.remove(),g.selection.restore(),b.removeData("anchorNode"))},"{fontFormatOption} click":function(a){var c=a.data("format");
"clear"!=c&&a.toggleClass("active"),b.toggleFontFormatting(c)},"{fontFamilyOption} click":function(a){var c=a.data("value");b.setFontFamily(c)},"{colorpicker} colorpickerChange":function(a,c,d){b.updatingFontColorUI||(b.colorpickerToggle().prop("checked",!0),b.setFontColor(d))},"{colorpickerToggle} change":function(a){a.checked()||b.removeFontColor()},"{fontSizeToggle} click":function(){var c=b.fontSizeCheckbox();c.is(":checked")?(c.prop("checked",!1),b.removeFontSize()):c.prop("checked",!0)},"{numsliderWidget} nouislide":function(a,c,d){b.numsliderInput().val(Math.abs(d))
},"{numsliderWidget} set":function(a,c,d){b.updatingFontSizeUI||b.setFontSize(Math.abs(d))},"{numsliderInput} input":function(c){if(!b.updatingFontSizeUI){var d=Math.abs(a.trim(c.val()));b.setFontSize(d)}},"{numsliderUnit} click":function(a){var c=a.data("unit");b.setFontSizeUnit(c),b.numsliderUnits().removeClass("open")},"{numsliderUnitToggle} click":function(){b.numsliderUnits().toggleClass("open")},"{linkItem} mouseover":function(b){var d=b.data("anchorNode");d&&a(d).addClass("is-highlighting")},"{linkItem} mouseout":function(b){var d=b.data("anchorNode");
d&&a(d).removeClass("is-highlighting")},linkUrlFieldInputHandler:function(){var d=a(this);b.startEditingSelection();var e=a(d.data("linkItem")),f=a.trim(d.val()),h=e.data("anchorNode");return""===f||h||(a.IE&&g.selection.restore(),h=b.createAnchorNode(e),a.IE&&d.focus().val(d.val())),""==f&&h?(b.removeAnchorNode(e),void 0):(b.updateAnchorNode(e),void 0)},linkTitleFieldInputHandler:function(){var d=a(this);b.startEditingSelection();var e=a(d).data("linkItem");b.updateAnchorNode(e)},"{linkBlankOptionField} click":function(a){var d=a.find("input");
d.is(":checked")?d.prop("checked",!1):d.prop("checked",!0),b.startEditingSelection();var e=b.linkItem.of(a);b.updateAnchorNode(e)},"{linkRemoveButton} click":function(a){b.startEditingSelection();var d=b.linkItem.of(a);b.removeLinkItem(d)}}}),b.resolve()})}),EasyBlog.module("composer/blocks/tree",function(a){var b=this;EasyBlog.require().done(function(){EasyBlog.Controller("Composer.Blocks.Tree",{elements:["[data-eb-{block|block-icon|block-title|block-level-count|block-child-count}]","[data-eb-blocks-{tree-field|tree|tree-item|tree-item-template|tree-item-icon|tree-item-title|tree-item-group|tree-toggle-button}]"]},function(b,c,d,e,f,g){return{init:function(){f=b.blocks,e=f.composer,g=b.createTreeItem,b.treeItemTemplate=b.treeItemTemplate().detach().html()
},setCurrentBlock:function(a){var c=f.getBlockType(a),d=f.getBlockMeta(c);b.blockTitle().text(d.title),b.blockIcon().attr("class",d.icon);var e=f.getAllParentBlocks(a),g=f.getChildBlocks(a),h=g.length,i=e.length+1;b.blockChildCount().text(h),b.blockLevelCount().text(i),b.block().toggleClass("has-child",h)},populate:function(c){if(!c)var c=f.getCurrentBlock();if(c.length){var d=b.treeField(),e=f.getParentBlock(c),h=!!e.length,i=f.getChildBlocks(c),j=!!i.length;d.toggleClass("has-parent",h).toggleClass("has-children",j);
var k=[],l=b.getTreeDisplayMode();if("minimal"==l)if(h){k.push(g(e,1));var m=f.getChildBlocks(e);m.each(function(){var b=a(this);k.push(g(b,2)),b.is(c)&&i.each(function(){var b=a(this);k.push(g(b,3))})})}else k.push(g(c,1)),i.each(function(){var b=a(this);k.push(g(b,2))});else{var n=f.getRootBlocks(),o=function(b,c){var d=c;k.push(g(b,d));var e=f.getChildBlocks(b);e.each(function(){var b=a(this);o(b,d+1)})};n.each(function(){o(a(this),1)})}b.tree().toggle("full"==l||k.length>1),b.treeItemGroup().empty().append(k)
}},createTreeItem:function(a,c){var d=a.data("treeItem");return d||(d=b.renderTreeItem(a),a.data("treeItem",d)),d.toggleClass("active",a.hasClass("active")).toggleClass("is-nested",a.hasClass("is-nested")).switchClass("level-"+c),d},renderTreeItem:function(c){var d=f.getBlockUid(c),e=f.getBlockType(c),g=f.getBlockMeta(e),h=a(b.treeItemTemplate);return h.attr({"data-type":g.type,"data-uid":d}).find(b.treeItemIcon).addClass(g.icon).end().find(b.treeItemTitle).text(g.title),h},getTreeDisplayMode:function(){return b.treeField().hasClass("tree-minimal")?"minimal":"full"
},setTreeDisplayMode:function(a){b.treeField().switchClass("tree-"+a),b.populate()},"{self} composerBlockAdd":function(){b.populate()},"{self} composerBlockActivate":function(a,c,d){b.setCurrentBlock(d),b.populate(d)},"{self} composerBlockRemove":function(){b.populate()},"{treeItem} click":function(a){var b=a.data("uid"),c=f.getBlock(b);f.unhighlight(c),f.activateBlock(c)},"{treeItem} mouseenter":function(a){var b=a.data("uid"),c=f.getBlock(b);f.highlight(c),f.scrollTo(c)},"{treeItem} mouseleave":function(a){var b=a.data("uid"),c=f.getBlock(b);
f.unhighlight(c)},"{treeToggleButton} click":function(){var c=(b.treeField(),b.getTreeDisplayMode());b.setTreeDisplayMode("minimal"==c?"full":"minimal")}}}),b.resolve()})}),EasyBlog.module("composer/blocks",function(a){var b=this,c="is-new",d="is-editable",e="is-receiving",f="is-dropping",g="is-releasing",h="is-refocusing",i="is-highlighting",j="is-sorting",k="is-sort-item",l="is-nested",m="is-dragging-block",n="is-dropping-block",o="is-highlighting-block";EasyBlog.require().library("ui/draggable","scrollTo").script("composer/blocks/panel","composer/blocks/guide","composer/blocks/nestable","composer/blocks/droppable","composer/blocks/resizable","composer/blocks/scrollable","composer/blocks/font","composer/blocks/dimensions","composer/blocks/text","composer/blocks/removal","composer/blocks/tree","composer/blocks/search","composer/blocks/mobile","composer/blocks/media","composer/blocks/toolbar").done(function(){EasyBlog.Controller("Composer.Blocks",{hostname:"blocks",pluginExtendsInstance:!0,elements:["[data-eb-composer-{blocks}]","[data-eb-composer-block-{menu|menu-group|meta}]","[data-eb-composer-{editor}]","[data-ebd-block-{viewport|content}]"],defaultOptions:a.extend({"{view}":"[data-eb-composer-blocks]","{editableContent}":EBD.editableContent,"{immediateBlockViewport}":EBD.immediateBlockViewport,"{immediateBlockContent}":EBD.immediateBlockContent,"{sidebar}":"[data-eb-composer-blocks]","{mechswitch}":".mechswitch"},EBD.selectors)},function(b,p,q,r){return{init:function(){r=b.composer;
var c=["panel","guide","nestable","droppable","resizable","scrollable","font","dimensions","text","removal","tree","search","mobile","media","toolbar"];if("legacy"==r.getDoctype())var c=["panel","tree","dimensions","media"];a.each(c,function(a,c){b.addPlugin(c)});var d=["post","image","video","file","audio"];a.each(d,function(a,c){b.loadBlockHandler(c)})},getAllBlocks:function(){return b.root().find(EBD.block)},getCurrentBlock:function(){return b.root().find(EBD.block+".active")},getParentBlock:function(b){return b.is(EBD.nestedBlock)?a(b).parents(EBD.block).eq(0):a()
},getAllParentBlocks:function(a){return a.parentsUntil(EBD.root).filter(EBD.block)},getBlockTree:function(a){return b.getAllParentBlocks(a).add(b.root())},getRootBlocks:function(){return b.root().find(EBD.childBlock)},getChildBlocks:function(a){return a.is(EBD.root)?a.find(EBD.childBlock):a.find(EBD.nestedBlock+":not(.ebd-block[data-uid="+a.data("uid")+"] "+EBD.nest+" "+EBD.nest+" "+EBD.nestedBlock+")")},getAllChildBlocks:function(a){return a.find(EBD.block)},getBlocksByType:function(a){return b.root().find(EBD.block+"[data-type="+a+"]")
},getBlock:function(a){var b=q.find(EBD.block+"[data-uid="+a+"]");return b},getBlockUid:function(a){return a.attr("data-uid")||b.setBlockUid(a)},setBlockUid:function(b){return b.attr("data-uid")||function(){var c=a.uid();return b.attr("data-uid",c),c}()},getBlockType:function(b){return a(b).attr("data-type")},metas:{},getBlockMeta:function(c){return c instanceof a&&(c=b.getBlockType(c)),b.metas[c]||function(){var a=b.meta().where("type",c).val();return a?b.metas[c]=JSON.parse(a):null}()},getBlockViewport:function(a){return b.immediateBlockViewport.inside(a)
},getBlockContent:function(a){return b.immediateBlockContent.inside(a)},getBlockFragment:function(c){var d=function(a){var c=b.getBlockType(a),d=b.getBlockHandler(c),e=b.createBlockContainer(c),f=d.toHTML(a);return a.is(EBD.nested)&&a.addClass(l),e.append(f),e},e=d(c);return e.find(EBD.nestedBlock).each(function(){var b=a(this),c=d(b);b.replaceWith(c)}),e},getBlockHTML:function(a){return b.getBlockFragment(a).toHTML()},getBlockText:function(){},getBlockNest:function(a){return a.closest(EBD.nest)},getBlockNestType:function(a){return b.getBlockNest(a).data("type")
},isBlock:function(a){return a.is(EBD.block)},isNestedBlock:function(a){return a.is(EBD.nestedBlock)},isRootBlock:function(a){return!b.isNestedBlock(a)},isStandaloneBlock:function(a){return a.is(EBD.standaloneBlock)},restoreInlineBlockData:function(a){var c=a.next();if(c.is("textarea[data-block]")){var d=c.val(),e=JSON.parse(d);b.dataset[b.getBlockUid(a)]=e,c.remove()}},initBlock:function(e){var f=arguments,g=b.getBlockType(e);b.setBlockUid(e),b.restoreInlineBlockData(e),b.loadBlockHandler(g).done(function(a){if(e.hasClass(c)){b.trigger("composerBlockBeforeAdd",f);
try{a.reset(e),a.reconstruct(e)}catch(h){EasyBlog.debug&&console.error("Error initializing new block of type '%s'.",g,h)}b.trigger("composerBlockAdd",f),b.release(e),e.removeClass(c).addClass(d),b.trigger("composerBlockInit",f)}else if(!e.hasClass(d)){try{a.reconstruct(e)}catch(h){EasyBlog.debug&&console.error("Error initializing existing block of type '%s'.",g,h)}e.addClass(d),b.trigger("composerBlockInit",f)}}),b.getChildBlocks(e).each(function(){var c=a(this);b.initBlock(c)})},createBlockContainer:function(c){var e=(b.getBlockMeta(c),a(a("[data-eb-block-template]").clone().html()));
return e.attr("data-type",c),e},createBlock:function(c){var d=b.getBlockMeta(c);if(d){var e=a(d.block);return b.setBlockUid(e),b.trigger("composerBlockCreate",[e,d]),e}},createBlockFromMenu:function(a){var d=a.attr("data-type"),e=b.createBlock(d).addClass(c);return e},createBlockFromMediaFile:function(a){var c=a.data("type"),d=b.getBlockHandler(c),e=d.constructFromMediaFile(a);return e},constructBlock:function(a,c){var d=b.getBlockHandler(a),e=d.construct(c);return b.setBlockUid(e),b.trigger("composerBlockConstruct",[e]),e
},constructNestedBlock:function(a,c){var d=b.constructBlock(a,c);return d.addClass(l),d},constructIsolatedBlock:function(a,c){var d=b.constructBlock(a,c);return d.addClass(l).addClass(isIsolated),d},createBlockNest:function(){return a('<div class="ebd-nest" data-type="block">')},createContentNest:function(b){var c=a('<div class="ebd-nest" data-type="content">'),d={editable:!0},b=a.extend(d,b);return b.editable&&c.editable(!0),c},exportBlock:function(a){var c=b.getBlockUid(a),d=b.getBlockType(a),e=b.getBlockHandler(d),f=a.is(EBD.nestedBlock),g=a.is(EBD.isolatedBlock),h={uid:c,type:d,html:"",data:{},blocks:[],nested:f,isolated:g,style:a.attr("style")};
if(EasyBlog.debug&&b.verifyBlockHandler(e,["toData","toText","toHTML"]),e.toData&&(h.data=e.toData(a)||{}),e.toText&&(h.text=e.toText(a)||""),e.toHTML&&(h.html=e.toHTML(a)||""),e.toEditableHTML)h.editableHtml=e.toEditableHTML(a)||"";else{var i=blocks.getBlockContent(a);h.editableHtml=i.html()}return b.trigger("composerBlockExport",[a,h]),h},addBlock:function(a){b.root().append(a),b.initBlock(a)},removeBlock:function(c){b.trigger("composerBlockBeforeRemove",[c]),c.find(EBD.nestedBlock).each(function(){var c=a(this);
b.removeBlock(c)}),c.remove(),b.trigger("composerBlockRemove",[c])},scrollTo:function(a){var b=r.viewport();r.viewportContent().stop(!0).scrollTo(a,500,{axis:"y",offset:{top:(b.height()-a.height())/-2,left:0}})},blockHandlers:{},loadBlockHandler:a.memoize(function(c){if(!c)return a.Deferred().reject(a.Exception("Invalid block type given."));var d=b.getBlockMeta(c);if(!d)return a.Deferred().reject(a.Exception("Block of type '"+c+"' is not installed!"));var e=a.Deferred();return EasyBlog.require().script("composer/blocks/handlers/"+c).done(function(){var f="handler/"+c,g="EasyBlog.Controller.Composer.Blocks.Handlers."+a.String.capitalize(c),h={meta:d},i=b.addPlugin(f,g,h);
b.blockHandlers[c]=i,EasyBlog.debug&&b.verifyBlockHandler(i),e.resolve(i,d)}).fail(function(){b.loadBlockHandler.reset(c),e.reject(a.Exception("Could not load block handler for "+c+"."))}),e}),getBlockHandler:function(c){return c instanceof a&&(c=b.getBlockType(c)),b.blockHandlers[c]},verifyBlockHandler:function(b,c){for(var d,c=c||["activate","deactivate","construct","reconstruct","deconstruct","refocus","reset","populate","toHTML","toData","toText"],e=[];d=c.shift();)a.isFunction(b[d])||e.push(d);e.length>0&&console.warn("Block handler of type '%s' is missing the following method: %s.",b.options.meta.type,e.join(", "))
},activateBlock:function(a){if(!b.workarea().hasClass("is-removing")){b.deactivateBlock();var c=b.getBlockType(a);b.loadBlockHandler(c).done(function(c){var d=[a,c];b.trigger("composerBlockBeforeActivate",d),b.initBlock(a),c.activate&&c.activate(a),c.refocus(a),b.trigger("composerBlockActivate",d)}).fail(function(a){b.trigger("composerBlockActivateError",[a])})}},deactivateBlock:function(a){if(a=a||b.getCurrentBlock(),a.length){var c=b.getBlockHandler(a);c&&c.deactivate&&c.deactivate(a),b.trigger("composerBlockDeactivate",[a,c])
}},"{menu} mouseover":function(a){if(!a.data("uiDraggable")){var c=a.clone();c.find(b.meta.selector).remove(),a.draggable({helper:function(){return c.css({width:a.outerWidth(),height:a.outerHeight()})},appendTo:r.document.ghosts(),connectToSortable:EBD.root})}},selectBlock:function(a){r.views.hide("blocks"),r.manager().addClass(n),b.trigger("composerBlockMenuSelected",[a]),r.blocks.droppable.populateDropzones()},"{menu} touchend":function(){},"{menu} touchstart":function(){},"{menu} click":function(a){b.selectBlock(a)
},"{menu} dragstart":function(a){b.drag(a),r.manager().addClass(m),r.views.hide("blocks")},"{menu} dragstop":function(a){b.release(a),r.manager().removeClass(m)},"{menu} dblclick":function(){},drag:function(a){b.workarea().addClass(j),a.is(b.menu)||(a.addClass(k),r.editor.selection.remove(),b.trigger("composerBlockDrag",[a]))},drop:function(a){a.is(b.menu)||(b.trigger("composerBlockBeforeDrop",[a]),a.addClass(f),b.trigger("composerBlockDrop",[a]),b.activateBlock(a))},release:function(a){b.workarea().removeClass(j),a.is(b.menu)||(a.removeClass(f).addClass(g).removeClassAfter(g+" "+k),b.trigger("composerBlockBeforeRelease",[a]),setTimeout(function(){b.trigger("composerBlockRelease",[a])
},1e3))},over:function(a){a.addClass(e),a.hasClass(l)&&b.nest.of(a).addClass(e),b.block.of(a).addClass(e)},out:function(a){a.removeClass(e),a.hasClass(l)&&b.nest.of(a).removeClass(e),b.block.of(a).removeClass(e)},highlight:function(a){b.root().addClass(o),a.addClass(i)},unhighlight:function(a){b.root().removeClass(o),a.removeClass(i)},dataset:{},"{block} click":function(a,c){c.clickHandled||b.refocusing||b.workarea().hasClass("is-resizing")||(c.clickHandled=!0,a.is(b.menu)||a.hasClass("active")||b.activateBlock(a))
},data:function(c,d){if(void 0===c)return b.dataset;var f=parseInt(c);isNaN(f)?f=b.getBlockUid(c):c=b.getBlock(f);var g=b.getBlockHandler(b.getBlockType(c)),h=blocks.getBlockMeta(c),i=b.dataset[f];return b.dataset[f]=g.normalize?g.normalize(i):a.extend({},h.data,i),0==arguments.length||1==arguments.length||2==arguments.length&&a.isString(d)?b.getData(c,d):b.setData.apply(b,arguments)},getData:function(a,c){var d=b.dataset;if(void 0===a)return d;var e=parseInt(a);isNaN(e)?e=b.getBlockUid(a):a=b.getBlock(a);var f=d[e];
return void 0===c?f:f[c]},setData:function(c,d,e){if(void 0===c)return b.dataset;var f=parseInt(c);return isNaN(f)?f=b.getBlockUid(c):c=b.getBlock(c),a.isPlainObject(d)&&void 0===e?a.extend(b.dataset[f],d):b.dataset[f][d]=e},getMechanics:function(){return r.settings.get("blocks.mechanics")},setMechanics:function(a){r.settings.set("blocks.mechanics",a),b.trigger("composerBlockMechanicsChange",a)},"{mechswitch} click":function(a){b.mechswitch().removeClass("btn-primary"),a.addClass("btn-primary"),b.setMechanics(a.attr("data-value"))
},"{block} mouseover":function(a,c){c.hovered||(c.hovered=!0,b.trigger("composerBlockHoverIn",[a]))},"{block} mouseout":function(a){b.trigger("composerBlockHoverOut",[a])},"{self} composerDocumentInit":function(){var c=b.getAllBlocks();c.each(function(){var c=a(this);b.initBlock(c)})},"{self} composerDocumentBlur":function(){return b.refocusing?(b.refocusing=!1,void 0):(b.deactivateBlock(),void 0)},"{editableContent} focusin":function(a,c){c.focusHandled||b.refocusing||r.document.isLegacy()||(b.refocusing=!0,c.focusHandled=!0,setTimeout(function(){var c=(b.workarea(),r.editor.selection.get()),d=c.focusNode;
if(!d)return b.refocusing=!1,void 0;var e=b.block.of(d);if(!e.length)return b.refocusing=!1,void 0;if(!e.hasClass(h)){e.addClass(h);try{if(e.hasClass("active")){var f=b.getBlockHandler(e);f.refocus(e)}else b.activateBlock(e)}catch(g){}e.removeClass(h),setTimeout(function(){b.refocusing=!1},100)}},1))}}}),b.resolve()})}),EasyBlog.module("composer/blocks/media",function(a){var b=this;EasyBlog.Controller("Composer.Blocks.Media",{defaultOptions:a.extend({},EBD.selectors)},function(a,b,c,d,e){return{init:function(){e=a.blocks,d=e.composer
},"{self} mediaInfoShow":function(){d.frame().addClass("layout-media"),d.panels.activate("blocks")},"{self} mediaInfoDisplay":function(a,b,c){var f=c.find(".ebd-block");e.activateBlock(f),f.addClass("active")},"{self} mediaInfoHide":function(){e.panel.deactivatePanel(),d.frame().removeClass("layout-media")},"{self} mediaInsert":function(){e.panel.deactivatePanel(),d.frame().removeClass("layout-media")}}}),b.resolve()}),EasyBlog.module("composer/blocks/toolbar",function(a){var b=this,c="is-editing-block",d="is-moving-block";
EasyBlog.Controller("Composer.Blocks.Toolbar",{elements:["[data-eb-blocks-{close-button|done-button|parent-button|cancel-drop-button|move-button|cancel-move-button|remove-button}]","[data-ebd-block-{toolbar|sort-handle}]"],defaultOptions:a.extend({},EBD.selectors)},function(a,b,e,f,g){return{init:function(){g=a.blocks,f=a.blocks.composer},"{self} composerBlockActivate":function(b,d,e){e.hasClass("is-standalone")||(a.moveButton().toggle(!e.hasClass("is-isolated")),f.manager().addClass(c))},"{self} composerBlockDeactivate":function(){f.manager().removeClass(c)
},"{moveButton} click":function(){f.blocks.droppable.populateDropzones(),f.manager().addClass(d);var c=g.getCurrentBlock();c.addClass("hide").addClass("is-sort-item"),a.trigger("composerBlockMove",[c])},"{cancelMoveButton} click":function(){f.manager().removeClass(d),f.blocks.droppable.dropStop();var b=g.getCurrentBlock();b.removeClass("hide").removeClass("is-sort-item")},"{doneButton} click":function(){g.deactivateBlock()},"{parentButton} click":function(){var b=g.getCurrentBlock();if(b.length){var c=g.getParentBlock(b);
c.length?g.activateBlock(c):g.deactivateBlock()}},"{cancelDropButton} click":function(){f.blocks.droppable.selectedMenu=null,f.blocks.droppable.selectedBlock=null,f.blocks.droppable.dropStop(),f.manager().removeClass("is-dropping-block")},"{closeButton} click":function(){f.views.hide("blocks")},"{toolbar} mouseenter":function(a){var b=g.block.of(a);b.addClass("show-block-hint")},"{toolbar} mouseleave":function(a){var c=g.block.of(a);c.removeClass("show-block-hint")},"{removeButton} click":function(){var c=g.getCurrentBlock();
g.removeBlock(c),f.manager().removeClass("is-editing-block")}}}),b.resolve()}),EasyBlog.module("composer/blogimage",function(a){var b=this;EasyBlog.require().library("image","plupload2","ui/droppable").done(function(){EasyBlog.Controller("Composer.Blogimage",{elements:["[data-eb-composer-blogimage-{browse-button|remove-button|image|workarea}]",".eb-composer-{field}-blogimage"],defaultOptions:{"{browseButton}":"[data-eb-composer-blogimage-placeholder] [data-eb-mm-browse-button]","{placeholder}":"[data-eb-composer-blogimage-placeholder]","{data}":"[data-eb-composer-blogimage-value]","{progress}":"[data-eb-mm-upload-progress]","{addCoverButton}":".eb-document-add-cover-button"}},function(b){return{defaultUri:null,init:function(){var a=b.placeholder();
a.length>0&&EasyBlog.MediaManager.uploader.register(a);var c=b.data().val();b.defaultUri=c,b.workarea().droppable({accept:".eb-mm-file",tolerance:"pointer"})},"{browseButton} mediaSelect":function(a,c,d){b.data().val(d.meta.uri),b.setImage(d.meta.url)},"{placeholder} mediaUploaderFilesAdded":function(a,b,c,d){EasyBlog.MediaManager.uploader.addItem(d[0],a)},"{placeholder} mediaUploaderFileUploaded":function(a,c,d,e,f){var g=f.response,h=g.media,i=h.meta;b.data().val(i.uri),b.setImage(i.url)},"{placeholder} mediaUploaderFileError":function(){},"{placeholder} mediaUploaderError":function(){},setImage:function(c){b.image().css("backgroundImage",a.cssUrl(c)),setTimeout(function(){b.placeholder().addClass("has-image has-art state-done"),b.addCoverButton().addClass("has-cover")
},250)},show:function(){b.composer.document.artboard.show("cover")},hide:function(){b.composer.document.artboard.hide("cover")},toggle:function(){},"{removeButton} click":function(){b.placeholder().removeClass("has-image is-uploading has-art"),b.addCoverButton().removeClass("has-cover"),setTimeout(function(){b.image().css("backgroundImage",""),b.data().val("")},750)}}}),b.resolve()})}),EasyBlog.module("composer/category",function(a){var b=this;EasyBlog.Controller("Composer.Category",{defaultOptions:{"{itemGroupTemplate}":"[data-category-item-group-template]","{itemTemplate}":"[data-category-item-template]","{viewport}":"[data-eb-composer-category-viewport]","{tree}":"[data-eb-composer-category-tree]","{itemGroup}":"[data-eb-composer-category-item-group]","{itemGroupHeader}":"[data-eb-composer-category-item-group-header]","{item}":"[data-eb-composer-category-item]","{itemCount}":"[data-eb-composer-category-item-count]","{itemCheckbox}":"[data-eb-composer-category-item-checkbox]","{count}":"[data-eb-composer-category-count]","{searchTextfield}":"[data-eb-composer-category-search-textfield]","{jsondata}":"[data-eb-composer-category-jsondata]"}},function(b,c,d,e){return{init:function(){e=b.composer,b.initializeTemplates(),b.viewport().on("mousewheel",function(a){a.stopPropagation()
});var a=0,c=JSON.parse(b.jsondata().val());for(b.build(c);category=c[a++];)category.selected&&b.selectCategory(category.id);b.go(0),b.jsondata().remove(),window.catz=b},initializeTemplates:function(){c.templates={},c.templates.itemGroup=b.itemGroupTemplate().detach().html(),c.templates.item=b.itemTemplate().detach().html()},categories:{0:{id:0,title:"",parent_id:null},search:{id:"search",title:"",parent_id:null}},children:{search:[]},keys:{},clones:{},selected:{},build:function(a){for(var d,c=0;d=a[c++];){var e=parseInt(d.id),f=parseInt(d.parent_id);
b.categories[e]=d,(b.children[f]||(b.children[f]=[])).push(d);var g=d.key=d.title.toLowerCase()+" [#"+e+"]";b.keys[g]=d}},childrens:a.memoize(function(c,d){var e=b.children[c];if(!e)return[];var h,f=d?[].concat(b.childrens(c)):a.flatten(e,"id"),g=f.length;if(d)for(h=0;g>h;h++)f=f.concat(b.childrens(f[h],d));return f},function(a,b){return a+(b?"_deep":"")}),parents:a.memoize(function(a){var c=b.categories[a];if(c){if(0==a)return[0];for(var d=[];c=b.categories[c.parent_id];)d.unshift(c.id);return d}}),itemGroup:{get:a.memoize(function(c){var d=b.children[c];
if(d){for(var g,e=b.categories[c],f=b.getItemGroupTemplate(e),h=[],i=0;g=d[i++];)h.push(b.item.get(g.id));return a(f).locate("viewport").append(h),f}})},item:{get:a.memoize(function(a){var c=b.categories[a];if(c){var d=b.children[a],e=b.getItemTemplate(c,d||null);return e}})},getItemGroupTemplate:function(b){var d=a(c.templates.itemGroup);return d.attr("data-id",b.id),d.find("[data-title]").html(b.title),d[0]},getItemTemplate:function(b,d){var e=a(c.templates.item);return e.attr("data-id",b.id),e.find("[data-title]").html(b.title),d&&e.addClass("has-children"),e[0]
},itemCount:{get:a.memoize(function(c){return a(b.item.get(c)).find(b.itemCount.selector)[0]}),set:function(c,d){a(b.itemCount.get(c)).find("span").html(d)}},populate:function(c){var d=b.children[c];if(d){a(b.itemGroup.get(c)).locate("header").removeClass("active");for(var f,e=0,g=b.selected,h=a.values(g);f=d[e++];){var i=f.id,j=b.childrens(i,!0),k=a.intersection(h,j),l=b.childrens(i),m=a.intersection(k,l);if(a(b.item.get(i)).toggleClass("selected",a.has(g,i)).toggleClass("has-selected-children",k.length>0).toggleClass("is-primary",f.isprimary).removeClass("active"),l.length>0){var n=m.length+"/"+l.length;
b.itemCount.set(i,n)}}}},query:a.memoize(function(c){var d=b.keys,e={},f=new RegExp("^"+a.regExpEscape(c),"i");for(key in d)if(key.match(f)){var g=d[key],h=g.parent_id;(e[h]||(e[h]=[])).push(g)}return e}),search:function(c){var d=b.query(c),e=b.clones,f=[],g=[];for(parentId in d){for(var k,h=b.categories[parentId],i=b.getItemGroupTemplate(h),j=d[parentId],g=[],l=0;k=j[l++];){var m=k.id,n=e[m]||(e[m]=a(b.item.get(m)).clone()[0]);g.push(n)}a(i).locate("viewport").append(g),f[0==parentId?"unshift":"push"](i)}b.itemGroup().detach(),a(b.itemGroup.get("search")).empty().append(f).appendTo(b.tree().switchClass("level-0").data("level",0))
},currentTree:[],go:function(c){var d=b.categories[c];if(d){var e=b.tree(),f=b.parents(c),g=f.length-1,h=a.map(f,function(a){return b.itemGroup.get(a)}),i=e.data("level")||0;i>g&&h.push(b.itemGroup().eq(i)),b.itemGroup().detach(),b.populate(a.last(f)),e.append(h).switchClass("level-"+g).data("level",g),b.searchTextfield().val("")}},open:function(c){var d=b.children[c];d&&(a(b.item.get(c)).addClass("active"),b.go(d[0].id))},selectCategory:function(a){b.toggle(a,!0)},deselect:function(a){b.toggle(a,!1)},toggle:function(c,d){var e=a(b.item.get(c)),f=a(b.clones[c]),g=b.selected;
void 0===d&&(d=!e.hasClass("selected")),d?g[c]=parseInt(c):delete g[c];var h=(d?"add":"remove")+"Class";if(e[h]("selected"),f[h]("selected"),0==a.keys(b.selected).length){var h=(d?"remove":"add")+"Class";return e[h]("selected"),f[h]("selected"),EasyBlog.dialog({content:"You must have at least one category assigned to this blog post."}),d?delete g[c]:g[c]=parseInt(c),void 0}b.trigger("category"+(d?"select":"deselect"),[b.categories[c]]),b.count().html(a.keys(b.selected).length)},enableKeyboardNavigation:function(){a(document).off("keydown.composer.category").on("keydown.composer.category",function(a){var c=a.keyCode,d={38:"up",40:"down",37:"left",39:"right"};
switch(c){case 38:case 40:case 37:case 39:b.navigate(d[c]);break;case 32:}})},disableKeyboardNavigation:function(){a(document).off("keydown.composer.category")},navigate:function(a){console.log(a);var c=b.currentClickedItem;switch(a){case"up":c.prev().click();break;case"down":c.next().click();break;case"left":b.go(c.data("id"));break;case"right":}},toArray:function(){if(!b.selected)return[];var a=[];for(id in b.selected){var c=b.categories[id];a.push(c)}return a},lastClickedItem:a(),currentClickedItem:a(),"{item} click":function(a){b.lastClickedItem=b.currentClickedItem,b.currentClickedItem=a
},"{self} composerSave":function(c,d,e){e.data.categories=a.values(b.selected)},"{self} categorysetprimary":function(c,d,e){b.item().removeClass("is-primary"),a(b.item.get(e.id)).addClass("is-primary")},"{itemGroup} click":function(a,c){var d=a.find(b.item.selector),e=b.lastClickedItem,f=b.currentClickedItem;if(c.metaKey||c.ctrlKey||d.removeClass("active"),f.toggleClass("active"),c.shiftKey&&e.length>0){var g=d.index(e),h=d.index(f);d.slice.apply(d,h>g?[g,h]:[h,g]).addClass("active")}d.filter(".active").length>0?b.enableKeyboardNavigation():b.disableKeyboardNavigation()
},"{item} dblclick":function(a){var c=a.data("id");b.open(c)},"{itemCount} click":function(a){var c=b.item.of(a).data("id");b.open(c)},"{itemCheckbox} click":function(a,c){var d=b.item.of(a).data("id");b.toggle(d),c.stopPropagation()},"{itemGroupHeader} click":function(a){var c=b.itemGroup.of(a).data("id");a.addClass("active"),b.go(c)},"{searchTextfield} keyup":a.debounce(function(c){var d=a.trim(c.val());""==d?b.go(0):b.search(d)},250),"{self} composerValidate":function(){}}}),b.resolve()}),EasyBlog.module("composer/datetime",function(a){var b=this;
EasyBlog.require().library("moment","datetimepicker").done(function(){EasyBlog.Controller("Post.Datetime",{defaultOptions:{format:"Do MMM, YYYY HH:mm",originalValue:"","{preview}":"[data-preview]","{calendar}":"[data-calendar]","{cancel}":"[data-cancel]","{datetime}":"[data-datetime]"}},function(b,c){return{init:function(){b.calendar()._datetimepicker({component:"eb",format:c.format}),b.datetimepicker=b.calendar().data("DateTimePicker"),c.originalValue=b.datetime().val(),a.isEmpty(c.originalValue)||b.datetimepicker.setDate(a.moment(c.originalValue))
},"{calendar} dp.change":function(a,d){b.preview().text(d.date.format(c.format)),b.datetime().val(d.date.format("YYYY-MM-DD HH:mm:ss")),b.toggleCancelButton()},"{cancel} click":function(){var d=a.isEmpty(c.originalValue);d||"0000-00-00 00:00:00"==c.originalValue?(b.preview().text(c.emptyText),b.datetime().val("0000-00-00 00:00:00")):b.datetimepicker.setDate(a.moment(c.originalValue)),b.toggleCancelButton()},toggleCancelButton:function(){b.cancel()[b.datetime().val()==c.originalValue?"hide":"show"]()}}}),b.resolve()
})}),EasyBlog.module("composer/debugger",function(a){var b=this;EasyBlog.Controller("Composer.Debugger",{defaultOptions:{"{nestableBlock}":EBD.nestableBlock}},function(b,c,d,e,f){return{id:1,init:function(){e=b.composer,f=b.console;for(method in window.console)!function(a){b.console[a]=function(){b.active&&window.console[a].apply(window.console,arguments)}}(method);return},console:{},active:!1,activate:function(){b.active=!0,b.trigger("composerDebugActivate")},deactivate:function(){b.active=!1,b.trigger("composerDebugDeactivate")
},toggle:function(){b.active?b.activate():b.deactivate()}}}),b.resolve()}),EasyBlog.module("composer/document/overlay",function(a){var b=this;EasyBlog.Controller("Composer.Document.Overlay",{defaultOptions:a.extend({"{overlay}":"[data-ebd-overlay]","{placeholder}":"[data-ebd-overlay-placeholder]","{sortable}":".ui-sortable","{placeholderInsideSortHelper}":".ebd-block.is-helper .ebd-overlay-placeholder"},EBD.selectors)},function(b,c,d,e){return{id:1,init:function(){composer=b.document.composer,e=composer.blocks,b.DocumentOverlay=function(c){this.id=b.id++,this.uid=c.data("uid"),this.type=c.data("type"),this._element=a("<div>",{"class":"ebd-overlay","data-id":this.id,"data-type":this.type,"data-ebd-overlay":""})[0],this._placeholder=a("<div>",{"class":"ebd-overlay-placeholder","data-id":this.id,"data-ebd-overlay-placeholder":""})[0]
},a.extend(b.DocumentOverlay.prototype,{block:function(){return e.getBlock(this.uid)},element:function(){return a(this._element)},placeholder:function(){return a(this._placeholder)},attach:function(){this.element().appendTo(b.document.workarea()),this.reposition()},refresh:function(){this.element().hasClass("is-animating")||this.reposition()},reposition:function(){var c=this.element(),d=c.hasClass("is-sorting")?a(b.placeholderInsideSortHelper().where("id",this.id)[0]||this._placeholder):this.placeholder();c.css({width:d.width(),height:d.height()}).position({my:"left top",at:"left top",of:d})
},emerge:function(){this.element().addClass("hover"),this.block().addClass("hover")},submerge:function(){this.element().removeClass("hover"),this.block().removeClass("hover")},remove:function(){b.remove(this.id)}});var c=a.throttle(function(){b.refresh()},25,{leading:!0,trailing:!0}),d=a.ns("keydown keypress keyup input mousedown click mousemove mouseup touchstart touchmove touchend",".overlay"),f=a.ns("sortactivate sortchange sortover sortout sortdeactivate sortstop",".overlay");composer.document.root().on(d,c),composer.views().on("scrolly.overlay",c),b.element.on(f,b.sortable.selector,c)
},blocks:{},instances:[],keys:{},get:function(a){return b.keys[a]},getInstancesByBlock:function(a){var c=e.getBlockUid(a);return b.blocks[c]||[]},create:function(a){var c=new b.DocumentOverlay(a);b.instances.push(c),b.keys[c.id]=c;var d=b.blocks;return(d[c.uid]||(d[c.uid]=[])).push(c),c},remove:function(c){var d=b.get(c);d.element().remove(),d.placeholder().remove(),a.pull(b.blocks[c],d),delete b.keys[c],a.pull(b.instances,d)},of:function(a){return b.blocks[a.data("uid")]||[]},refresh:function(c){var d=c?b.of(c):b.instances;
a.each(d,function(a,b){b.refresh()})},"{self} composerBlockDrag":function(c,d,e){setTimeout(function(){b.refresh()},1),a.each(b.of(e),function(a,b){b.element().addClass("is-sorting")})},"{dropzone} dropover":function(){setTimeout(function(){b.refresh()},1)},"{block} drag":function(a){b.refresh(a)},drop:function(c){a.each(b.of(c),function(a,b){b.element().removeClass("is-sorting").addClass("is-dropping")}),b.refresh()},"{self} composerBlockDrop":function(a,c,d){b.drop(d)},"{self} composerBlockAdd":function(a,c,d){b.drop(d)
},"{self} composerBlockBeforeRelease":function(c,d,e){a.each(b.of(e),function(a,b){b.element().removeClass("is-dropping").addClass("is-releasing is-animating").removeClassAfter("is-releasing")}),b.refresh(),setTimeout(function(){b.refresh()},50)},"{self} composerBlockRelease":function(c,d,e){a.each(b.of(e),function(a,b){b.element().removeClass("is-animating")}),b.refresh()},"{self} composerDocumentRefresh":function(){b.refresh()},"{self} composerBlockRemove":function(c,d,e){var f=b.getInstancesByBlock(e);a.each(f,function(a,b){b.remove()
})},"{placeholder} click":function(a){var c=a.data("id"),d=b.get(c);d.emerge()},"{placeholder} mouseover":function(a){var c=a.data("id"),d=b.get(c);d.block().hasClass("active")&&d.emerge()},"{overlay} mouseout":function(a){var c=a.data("id"),d=b.get(c);d.submerge()}}}),b.resolve()}),EasyBlog.module("composer/document",function(a){var b=this;EasyBlog.require().script("composer/document/toolbar","composer/document/artboard").done(function(){EasyBlog.Controller("Composer.Document",{hostname:"document",pluginExtendsInstance:!0,elements:["[data-eb-composer-document] .eb-composer-{viewport|viewport-content}","[data-eb-composer-{page|page-viewport|page-header|page-body}]","[data-ebd-{workarea|textarea}]","[data-ebd-workarea-{ghosts}]"],defaultOptions:{"{root}":"[data-ebd-workarea] "+EBD.root,"{block}":EBD.block,"{nest}":EBD.nest,"{titleField}":"[data-eb-composer-form=page] [name=title]"}},function(b,c,d,e,f){return{init:function(){composer=b.composer,b.initPlugins(),b.initTitlebar(),b.isLegacy()?b.initLegacyDocument():b.initEasyBlogDocument()
},initPlugins:function(){b.addPlugin("toolbar"),b.addPlugin("artboard")},initTitlebar:function(){EasyBlog.require().library("expanding").done(function(){var a=b.titleField().one("focus",function(){a.expandingTextarea()})})},initLegacyDocument:function(){if(window.tinyMCE){var c=function(){if(tinyMCE.activeEditor){var d=tinyMCE.activeEditor.editorContainer;a.isString(d)||(d.style.width="100%",a(tinyMCE.activeEditor.contentDocument).find("html").css({height:"100%"}).end().find("body").css({height:"100%",margin:"1em"})),b.setLayout()
}else setTimeout(c,500)};c()}b.trigger("composerDocumentReady")},initEasyBlogDocument:function(){EasyBlog.require().library("selectionchange").script("composer/redactor10","composer/document/overlay").done(function(){e=b.composer.editor=b.workarea().composer({replaceDivs:!1,toolbar:!1}).data("redactor"),f=b.composer.blocks,b.initDocument(),b.setLayout(),b.addPlugin("overlay"),b.initSelectionChange(),b.trigger("composerDocumentReady")})},isLegacy:function(){return"legacy"==composer.getDoctype()},initDocument:function(){b.trigger("composerDocumentInit"),b.workarea().removeClass("is-loading")
},loadDocument:function(a){b.trigger("composerDocumentLoad"),b.root().html(a),b.initDocument()},"{window} resize":a.throttle(function(){b.setLayout()},250),setLayout:function(){b.updateEditorHeight(),b.trigger("composerDocumentRefresh")},updateEditorHeight:function(){b.page().css("height","auto");var c=b.viewport().height(),d=b.pageViewport().height(),e=b.pageHeader().height(),f=d-e,g=108,h=60,i=50,j=c-i-h-g-e;if(window.tinyMCE){if(!tinyMCE.activeEditor)return;var k=tinyMCE.activeEditor.editorContainer;if(a.isString(k)){var l=b.pageBody(),k=a("#"+k);
k.find("#content_tbl").css("height","auto");var m=a(tinyMCE.activeEditor.contentAreaContainer).find("iframe"),n=l.height()-m.height(),o=f-n;m.css("height",o);var p=a(tinyMCE.activeEditor.getElement()),q=f-l.find(".toggle-editor").height();p.css("height",q)}else{var k=a(k).parent(),m=a(k).find("iframe"),n=k.height()-m.height(),o=f-n;m.css("height",o)}}else b.root().css({minHeight:j})},setTitle:function(a){b.titleField().val(a)},insertContent:function(c){if(b.isLegacy())EasyBlog.LegacyEditor.insert(c);else{var d=a(c);
d.is(EBD.block)&&f.addBlock(d)}},setContent:function(a){return b.isLegacy()?EasyBlog.LegacyEditor.setContent(a):void 0},getContent:function(){if(b.isLegacy())return EasyBlog.LegacyEditor.getContent();var c="";return f.getRootBlocks().each(function(){var b=a(this);c+=f.getBlockHTML(b)}),c},getText:function(){if(b.isLegacy())return a(b.getContent()).text();var c=[];return f.getRootBlocks().each(function(){var b=a(this),d=f.getBlockType(b);blockHandler=f.getBlockHandler(d),blockHandler.toText&&c.push(a.trim(blockHandler.toText(b)))
}),c.join("\n")},initSelectionChange:function(){a.selectionchange.start();var c,d=a.debounce(function(){if(e){var d=e.selection.get(),f=d.toString(),g=!1;if(""!=f){var h=d.focusNode,i=b.block.of(h);if(i.closest(".is-standalone").length)return;if(i.hasClass("active"))for(;h!=i[0];){var j=a(h);if(j.editable()){g=!0;break}h=h.parentNode}}g?(b.trigger("composerTextSelect",[d,i,e]),c=!1):!c&&b.trigger("composerTextDeselect",[e])}},100);a(document).on("selectionchange",d)},saveLegacyDocument:function(b){var c=b.data,d=a.sanitizeHTML(EasyBlog.LegacyEditor.getContent());
a.IE<9&&(d=a.toXHTML(d)),c.intro="",c.content=d;var e=d.split('<hr id="system-readmore" />');e.length>1&&(c.intro=e[0],c.content=e[1])},saveEasyBlogDocument:function(b){var c=f.getRootBlocks(),d=[],e=[],g=b.add("Saving document"),h={title:b.data.title,permalink:b.data.permalink,type:composer.getDoctype(),version:"1.0"};a.when.apply(null,e).always(function(){c.each(function(){var b=a(this),c=f.exportBlock(b);d.push(c)}),h.blocks=d,b.data.document=JSON.stringify(h)}).done(function(){g.resolve()}).fail(function(){g.reject(a.Exception("Error saving document."))
})},"{self} composerSave":function(a,c,d){"legacy"==composer.getDoctype()?b.saveLegacyDocument(d):b.saveEasyBlogDocument(d)},"{titleField} keydown":function(a,b){13==b.keyCode&&b.preventDefault()},"{titleField} keyup":function(a){var d=a.val();b.trigger("composerTitleChange",[d])},"{self} composerDebugActivate":function(){},"{self} composerDebugDeactivate":function(){},"{viewport} click":function(c,d){if(!b.isLegacy()){var e=b.workarea();if(!e.hasClass("is-resizing")){var f=a(d.target).parentsUntil(c).andSelf().filter(EBD.block);
f.length||b.trigger("composerDocumentBlur")}}},"{self} composerValidate":function(){}}}),b.resolve()})}),EasyBlog.module("composer/document/toolbar",function(a){var b=this;EasyBlog.Controller("Composer.Document.Toolbar",{elements:["[data-eb-composer-{add-block-button|add-media-button|add-post-button|show-drawer-button}]","[data-eb-composer-{embed-video-button}]","[data-eb-composer-{mobile-blip}]"],defaultOptions:{}},function(b,c,d,e){return{init:function(){e=b.document.composer},activate:function(){b.mobileBlip().addClass("show-menu")
},deactivate:function(){b.mobileBlip().removeClass("show-menu")},isActive:function(){return b.mobileBlip().hasClass("show-menu")},"{mobileBlip} click":function(){return b.isActive()?(b.deactivate(),void 0):(b.activate(),void 0)},"{addBlockButton} click":function(){b.deactivate(),e.views.show("blocks")},"{addMediaButton} click":function(){b.deactivate(),e.views.show("media")},"{embedVideoButton} click":function(){EasyBlog.dialog({content:EasyBlog.ajax("site/views/composer/embedVideoDialog"),bindings:{"{insertButton} click":function(){var a=this.videoUrl().val(),b=this.videoWidth().val(),c=this.videoHeight().val(),d='[embed=videolink]{"video":"'+a+'","width":"'+b+'","height":"'+c+'"}[/embed]';
EasyBlog.LegacyEditor.insert(d),EasyBlog.dialog().close(),this.videoUrl().val("")}}})},"{addPostButton} click":function(){b.deactivate(),e.views.show("posts")},"{showDrawerButton} click":function(){a("[data-eb-composer-frame]").toggleClass("show-drawer")}}}),b.resolve()}),EasyBlog.module("composer/redactor10",function(a){function d(a,b){return new d.prototype.init(a,b)}var b=this;Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a)}});var c=0;a.fn.composer=function(b){var c=[],e=Array.prototype.slice.call(arguments,1);
return"string"==typeof b?this.each(function(){var f,d=a.data(this,"redactor");if("-1"!=b.search(/\./)?(f=b.split("."),"undefined"!=typeof d[f[0]]&&(f=d[f[0]][f[1]])):f=d[b],"undefined"!=typeof d&&a.isFunction(f)){var g=f.apply(d,e);void 0!==g&&g!==d&&c.push(g)}else a.error('No such method "'+b+'" for Redactor')}):this.each(function(){a.data(this,"redactor",{}),a.data(this,"redactor",d(this,b))}),0===c.length?this:1===c.length?c[0]:c},a.Redactor=d,a.Redactor.VERSION="10.0.6",a.Redactor.modules=["alignment","block","buffer","build","caret","clean","core","focus","indent","inline","insert","keydown","keyup","list","paragraphize","paste","selection","shortcuts","tabifier","tidy","utils"],a.Redactor.opts={direction:"ltr",plugins:!1,focus:!1,focusEnd:!1,visual:!0,tabindex:!1,linebreaks:!1,replaceDivs:!0,paragraphize:!0,cleanStyleOnEnter:!1,enterKey:!0,cleanOnPaste:!0,cleanSpaces:!0,pastePlainText:!1,preSpaces:4,tabAsSpaces:!1,tabKey:!0,scrollTarget:!1,formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,tabifier:!0,deniedTags:["html","head","link","body","meta","script","style","applet"],allowedTags:!1,removeComments:!1,replaceTags:[["strike","del"]],replaceStyles:[["font-weight:\\s?bold","strong"],["font-style:\\s?italic","em"],["text-decoration:\\s?underline","u"],["text-decoration:\\s?line-through","del"]],removeDataAttr:!1,removeAttr:!1,allowedAttr:!1,removeWithoutAttr:["span"],removeEmpty:["p"],shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,buffer:[],rebuffer:[],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",imageTypes:["image/png","image/jpeg","image/gif"],indentValue:20,verifiedTags:["a","img","b","strong","sub","sup","i","em","u","small","strike","del","cite","ul","ol","li"],inlineTags:["strong","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],alignmentTags:["P","H1","H2","H3","H4","H5","H6","DL","DT","DD","DIV","TD","BLOCKQUOTE","OUTPUT","FIGCAPTION","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],blockLevelElements:["PRE","UL","OL","LI"]},d.fn=a.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(b,d){this.$element=a(b),this.uuid=c++,this.rtePaste=!1,this.$pasteBox=!1,this.loadOptions(d),this.loadModules(),this.formatting={},a.merge(this.opts.blockLevelElements,this.opts.alignmentTags),this.reIsBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i"),this.tidy.setupAllowed(),a.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.core.setCallback("start"),this.start=!0,this.build.run()
},loadOptions:function(b){this.opts=a.extend({},a.extend(!0,{},a.Redactor.opts),this.$element.data(),b)},getModuleMethods:function(a){return Object.getOwnPropertyNames(a).filter(function(b){return"function"==typeof a[b]})},loadModules:function(){for(var b=a.Redactor.modules.length,c=0;b>c;c++)this.bindModuleMethods(a.Redactor.modules[c])},bindModuleMethods:function(a){if("undefined"!=typeof this[a]){this[a]=this[a]();for(var b=this.getModuleMethods(this[a]),c=b.length,d=0;c>d;d++)this[a][b[d]]=this[a][b[d]].bind(this)
}},block:function(){return{formatting:function(a){this.block.clearStyle=!1;var b,c;"undefined"!=typeof this.formatting[a].data?b="data":"undefined"!=typeof this.formatting[a].attr?b="attr":"undefined"!=typeof this.formatting[a].class&&(b="class"),"undefined"!=typeof this.formatting[a].clear&&(this.block.clearStyle=!0),b&&(c=this.formatting[a][b]),this.block.format(this.formatting[a].tag,b,c)},format:function(b,c,d){"quote"==b&&(b="blockquote");var e=["p","pre","blockquote","h1","h2","h3","h4","h5","h6"];-1!=a.inArray(b,e)&&(this.block.isRemoveInline="pre"==b||-1!=b.search(/h[1-6]/i),this.utils.browser("msie")||this.$editor.focus(),this.block.blocks=this.selection.getBlocks(),this.block.blocksSize=this.block.blocks.length,this.block.type=c,this.block.value=d,this.buffer.set(),this.selection.save(),this.block.set(b),this.selection.restore())
},set:function(a){this.selection.get(),this.block.containerTag=this.range.commonAncestorContainer.tagName,this.range.collapsed?this.block.setCollapsed(a):this.block.setMultiple(a)},setCollapsed:function(b){var c=this.block.blocks[0];if(c!==!1){if("LI"==c.tagName){if("blockquote"!=b)return;return this.block.formatListToBlockquote(),void 0}var d="TD"==this.block.containerTag||"TH"==this.block.containerTag;if(d&&!this.opts.linebreaks)document.execCommand("formatblock",!1,"<"+b+">"),c=this.selection.getBlock(),this.block.toggle(a(c));
else if(c.tagName.toLowerCase()!=b)if(this.opts.linebreaks&&"p"==b)a(c).prepend("<br>").append("<br>"),this.utils.replaceWithContents(c);else{var e=this.utils.replaceToTag(c,b);this.block.toggle(e),"p"!=b&&"blockquote"!=b&&e.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(e),("p"==b||this.block.headTag)&&e.find("p").contents().unwrap(),this.block.formatTableWrapping(e)}else if("blockquote"==b&&c.tagName.toLowerCase()==b)if(this.opts.linebreaks)a(c).prepend("<br>").append("<br>"),this.utils.replaceWithContents(c);
else{var f=this.utils.replaceToTag(c,"p");this.block.toggle(f)}else c.tagName.toLowerCase()==b&&this.block.toggle(a(c))}},setMultiple:function(b){var c=this.block.blocks[0],d="TD"==this.block.containerTag||"TH"==this.block.containerTag;if(c!==!1&&1===this.block.blocksSize)if(c.tagName.toLowerCase()==b&&"blockquote"==b)if(this.opts.linebreaks)a(c).prepend("<br>").append("<br>"),this.utils.replaceWithContents(c);else{var e=this.utils.replaceToTag(c,"p");this.block.toggle(e)}else if("LI"==c.tagName){if("blockquote"!=b)return;
this.block.formatListToBlockquote()}else if("BLOCKQUOTE"==this.block.containerTag)this.block.formatBlockquote(b);else if(this.opts.linebreaks&&(d||this.range.commonAncestorContainer!=c))this.block.formatWrap(b);else if(this.opts.linebreaks&&"p"==b)a(c).prepend("<br>").append("<br>"),this.utils.replaceWithContents(c);else if("TD"===c.tagName)this.block.formatWrap(b);else{var f=this.utils.replaceToTag(c,b);this.block.toggle(f),this.block.isRemoveInline&&this.utils.removeInlineTags(f),("p"==b||this.block.headTag)&&f.find("p").contents().unwrap()
}else if(this.opts.linebreaks||"p"!=b){if("blockquote"==b){for(var g=0,h=0;h<this.block.blocksSize;h++)"BLOCKQUOTE"==this.block.blocks[h].tagName&&g++;if(g==this.block.blocksSize)return a.each(this.block.blocks,a.proxy(function(b,c){this.opts.linebreaks?(a(c).prepend("<br>").append("<br>"),this.utils.replaceWithContents(c)):this.utils.replaceToTag(c,"p")},this)),void 0}this.block.formatWrap(b)}else{var i=0,j=!1;"class"==this.block.type&&(j="toggle",i=a(this.block.blocks).filter("."+this.block.value).size(),this.block.blocksSize==i?j="toggle":this.block.blocksSize>i?j="set":0===i&&(j="set"));
var k=["ul","ol","li","td","th","dl","dt","dd"];a.each(this.block.blocks,a.proxy(function(c,d){if(-1==a.inArray(d.tagName.toLowerCase(),k)){var e=this.utils.replaceToTag(d,b);j?"toggle"==j?this.block.toggle(e):"remove"==j?this.block.remove(e):"set"==j&&this.block.setForce(e):this.block.toggle(e),"p"!=b&&"blockquote"!=b&&e.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(e),("p"==b||this.block.headTag)&&e.find("p").contents().unwrap()}},this))}},setForce:function(a){return this.block.clearStyle&&a.removeAttr("class").removeAttr("style"),"class"==this.block.type?(a.addClass(this.block.value),void 0):"attr"==this.block.type||"data"==this.block.type?(a.attr(this.block.value.name,this.block.value.value),void 0):void 0
},toggle:function(a){return this.block.clearStyle&&a.removeAttr("class").removeAttr("style"),"class"==this.block.type?(a.toggleClass(this.block.value),void 0):"attr"==this.block.type||"data"==this.block.type?(a.attr(this.block.value.name)==this.block.value.value?a.removeAttr(this.block.value.name):a.attr(this.block.value.name,this.block.value.value),void 0):(a.removeAttr("style class"),void 0)},remove:function(a){a.removeClass(this.block.value)},formatListToBlockquote:function(){var b=a(this.block.blocks[0]).closest("ul, ol");
a(b).find("ul, ol").contents().unwrap(),a(b).find("li").append(a("<br>")).contents().unwrap();var c=this.utils.replaceToTag(b,"blockquote");this.block.toggle(c)},formatBlockquote:function(b){document.execCommand("outdent"),document.execCommand("formatblock",!1,b),this.clean.clearUnverified(),this.$editor.find("p:empty").remove();var c=this.selection.getBlock();"p"!=b&&a(c).find("img").remove(),this.opts.linebreaks||this.block.toggle(a(c)),this.$editor.find("ul, ol, tr, blockquote, p").each(a.proxy(this.utils.removeEmpty,this)),this.opts.linebreaks&&"p"==b&&this.utils.replaceWithContents(c)
},formatWrap:function(b){if("UL"==this.block.containerTag||"OL"==this.block.containerTag){if("blockquote"!=b)return;this.block.formatListToBlockquote()}var c=this.selection.wrap(b);if(c!==!1){var d=a(c);this.block.formatTableWrapping(d);var e=d.find(this.opts.blockLevelElements.join(",")+", td, table, thead, tbody, tfoot, th, tr");(this.opts.linebreaks&&"p"==b||"pre"==b||"blockquote"==b)&&e.append("<br />"),e.contents().unwrap(),"p"!=b&&"blockquote"!=b&&d.find("img").remove(),a.each(this.block.blocks,a.proxy(this.utils.removeEmpty,this)),d.append(this.selection.getMarker(2)),this.opts.linebreaks||this.block.toggle(d),this.$editor.find("ul, ol, tr, blockquote, p").each(a.proxy(this.utils.removeEmpty,this)),d.find("blockquote:empty").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(d),this.opts.linebreaks&&"p"==b&&this.utils.replaceWithContents(d)
}},formatTableWrapping:function(a){0!==a.closest("table").size()&&(0===a.closest("tr").size()&&a.wrap("<tr>"),0===a.closest("td").size()&&0===a.closest("th").size()&&a.wrap("<td>"))},removeData:function(b){var d=this.selection.getBlocks();a(d).removeAttr("data-"+b)},setData:function(b,c){var d=this.selection.getBlocks();a(d).attr("data-"+b,c)},toggleData:function(b,c){var d=this.selection.getBlocks();a.each(d,function(){a(this).attr("data-"+b)?a(this).removeAttr("data-"+b):a(this).attr("data-"+b,c)})},removeAttr:function(b){var d=this.selection.getBlocks();
a(d).removeAttr(b)},setAttr:function(b,c){var d=this.selection.getBlocks();a(d).attr(b,c)},toggleAttr:function(b,c){var d=this.selection.getBlocks();a.each(d,function(){a(this).attr(name)?a(this).removeAttr(name):a(this).attr(name,c)})},removeClass:function(b){var c=this.selection.getBlocks();a(c).removeClass(b),this.utils.removeEmptyAttr(c,"class")},setClass:function(b){var c=this.selection.getBlocks();a(c).addClass(b)},toggleClass:function(b){var c=this.selection.getBlocks();a(c).toggleClass(b)}}},buffer:function(){return{set:function(a){"undefined"==typeof a||"undo"==a?this.buffer.setUndo():this.buffer.setRedo()
},setUndo:function(){this.selection.save(),this.opts.buffer.push(this.$editor.html()),this.selection.restore()},setRedo:function(){this.selection.save(),this.opts.rebuffer.push(this.$editor.html()),this.selection.restore()},getUndo:function(){this.$editor.html(this.opts.buffer.pop())},getRedo:function(){this.$editor.html(this.opts.rebuffer.pop())},add:function(){this.opts.buffer.push(this.$editor.html())},undo:function(){0!==this.opts.buffer.length&&(this.buffer.set("redo"),this.buffer.getUndo(),this.selection.restore())
},redo:function(){0!==this.opts.rebuffer.length&&(this.buffer.set("undo"),this.buffer.getRedo(),this.selection.restore())}}},build:function(){return{run:function(){this.build.createContainerBox(),this.build.loadEditor(),this.build.enableEditor(),this.build.setCodeAndCall()},createContainerBox:function(){this.$box=this.$element},enableEditor:function(){this.$editor.attr({dir:this.opts.direction})},loadEditor:function(){this.$editor=this.$element},setCodeAndCall:function(){this.build.setOptions(),this.build.callEditor()
},callEditor:function(){this.build.disableMozillaEditing(),this.build.setEvents(),this.build.setHelpers(),this.opts.toolbar&&(this.opts.toolbar=this.toolbar.init(),this.toolbar.build()),this.build.plugins(),this.core.setCallback("init")},setOptions:function(){this.opts.linebreaks&&this.$editor.addClass("redactor-linebreaks"),this.opts.tabindex&&this.$editor.attr("tabindex",this.opts.tabindex)},setEvents:function(){this.$editor.on("drop.redactor",a.proxy(function(b){if(b=b.originalEvent||b,void 0===window.FormData||!b.dataTransfer)return!0;
var c=b.dataTransfer.files.length;return 0===c?(setTimeout(a.proxy(this.clean.clearUnverified,this),1),this.core.setCallback("drop",b),!0):(b.preventDefault(),setTimeout(a.proxy(this.clean.clearUnverified,this),1),this.core.setCallback("drop",b),void 0)},this)),this.$editor.on("click.redactor",a.proxy(function(a){var b="click";("click"==this.core.getEvent()||"arrow"==this.core.getEvent())&&(b=!1),this.core.addEvent(b),this.core.setCallback("click",a)},this)),this.$editor.on("paste.redactor",a.proxy(this.paste.init,this)),this.$editor.on("keydown.redactor",a.proxy(this.keydown.init,this)),this.$editor.on("keyup.redactor",a.proxy(this.keyup.init,this)),this.$editor.on("dragstart.redactor",function(a,b){b||(a.preventDefault(),a.stopPropagation())
}),a.isFunction(this.opts.focusCallback)&&this.$editor.on("focus.redactor",a.proxy(this.opts.focusCallback,this));var b;a(document).on("mousedown",function(c){b=a(c.target)})},setHelpers:function(){this.opts.focus&&setTimeout(a.proxy(this.focus.setStart,this),100),this.opts.focusEnd&&setTimeout(a.proxy(this.focus.setEnd,this),100)},plugins:function(){this.opts.plugins&&RedactorPlugins&&a.each(this.opts.plugins,a.proxy(function(b,c){if("undefined"!=typeof RedactorPlugins[c]){if(-1!==a.inArray(c,a.Redactor.modules))return a.error('Plugin name "'+c+"\" matches the name of the Redactor's module."),void 0;
if(a.isFunction(RedactorPlugins[c])){this[c]=RedactorPlugins[c]();for(var d=this.getModuleMethods(this[c]),e=d.length,f=0;e>f;f++)this[c][d[f]]=this[c][d[f]].bind(this);a.isFunction(this[c].init)&&this[c].init()}}},this))},disableMozillaEditing:function(){if(this.utils.browser("mozilla")){document.designMode="on";try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(a){}document.designMode="off"}}}},caret:function(){return{setStart:function(b){if(this.utils.isBlock(b))this.caret.set(b,0,b,0);
else{var c=this.utils.createSpaceElement();a(b).prepend(c),this.caret.setEnd(c)}},setEnd:function(a){this.caret.set(a,1,a,1)},set:function(b,c,d,e){if(this.utils.browser("msie")||this.$editor.focus(),b=b[0]||b,d=d[0]||d,this.utils.isBlockTag(b.tagName)&&""===b.innerHTML&&(b.innerHTML=this.opts.invisibleSpace),"BR"==b.tagName&&this.opts.linebreaks===!1){var f=a(this.opts.emptyHtml)[0];a(b).replaceWith(f),b=f,d=b}this.selection.get();try{this.range.setStart(b,c),this.range.setEnd(d,e)}catch(g){}this.selection.addRange()
},setAfter:function(b){try{var c=a(b)[0].tagName;if("BR"==c||this.utils.isBlock(b))"BR"!=c&&this.utils.browser("msie")?this.caret.setStart(a(b).next()):this.caret.setAfterOrBefore(b,"after");else{var d=this.utils.createSpaceElement();a(b).after(d),this.caret.setEnd(d)}}catch(e){var d=this.utils.createSpaceElement();a(b).after(d),this.caret.setEnd(d)}},setBefore:function(b){this.utils.isBlock(b)?this.caret.setEnd(a(b).prev()):this.caret.setAfterOrBefore(b,"before")},setAfterOrBefore:function(a,b){if(this.utils.browser("msie")||this.$editor.focus(),a=a[0]||a,this.selection.get(),"after"==b)try{this.range.setStartAfter(a),this.range.setEndAfter(a)
}catch(c){}else try{this.range.setStartBefore(a),this.range.setEndBefore(a)}catch(c){}this.range.collapse(!1),this.selection.addRange()},getOffsetOfElement:function(b){b=b[0]||b,this.selection.get();var c=this.range.cloneRange();return c.selectNodeContents(b),c.setEnd(this.range.endContainer,this.range.endOffset),a.trim(c.toString()).length},getOffset:function(){var a=0,b=window.getSelection();if(b.rangeCount>0){var c=window.getSelection().getRangeAt(0),d=c.cloneRange();d.selectNodeContents(this.$editor[0]),d.setEnd(c.endContainer,c.endOffset),a=d.toString().length
}return a},setOffset:function(a,b){"undefined"==typeof b&&(b=a),this.focus.isFocused()||this.focus.setStart();for(var d,e=(this.selection.get(),0),f=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);d=f.nextNode();)if(e+=d.nodeValue.length,e>a&&(this.range.setStart(d,d.nodeValue.length+a-e),a=1/0),e>=b){this.range.setEnd(d,d.nodeValue.length+b-e);break}this.range.collapse(!1),this.selection.addRange()},setToPoint:function(a,b){this.caret.setOffset(a,b)},getCoords:function(){return this.caret.getOffset()
}}},clean:function(){return{onSet:function(b){b=this.clean.savePreCode(b),b=b.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" style="display: none;" $1>$2</pre>'),b=b.replace(/\$/g,"&#36;"),b=b.replace(/\u201d/g,'"'),b=b.replace(/\u2018/g,"'"),b=b.replace(/\u2019/g,"'"),this.opts.replaceDivs&&(b=this.clean.replaceDivs(b)),this.opts.linebreaks&&(b=this.clean.replaceParagraphsToBr(b)),b=this.clean.saveFormTags(b);var c=a("<div>");c.html(b);var d=c.find("font[style]");return 0!==d.length&&(d.replaceWith(function(){var b=a(this),c=a("<span>").attr("style",b.attr("style"));
return c.append(b.contents())}),b=c.html()),c.remove(),b=b.replace(/<font(.*?[^<])>/gi,""),b=b.replace(/<\/font>/gi,""),b=this.tidy.load(b),this.opts.paragraphize&&(b=this.paragraphize.load(b)),b=this.clean.setVerified(b),b=this.clean.convertInline(b)},onSync:function(b){if(b=b.replace(/[\u200B-\u200D\uFEFF]/g,""),b=b.replace(/&#x200b;/gi,""),this.opts.cleanSpaces&&(b=b.replace(/&nbsp;/gi," ")),-1!=b.search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i))return"";b=b.replace(/<pre class="redactor-script-tag" style="display: none;"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2</script>"),b=this.clean.restoreFormTags(b);
var c={"\u2122":"&trade;","\xa9":"&copy;","\u2026":"&hellip;","\u2014":"&mdash;","\u2010":"&dash;"};return a.each(c,function(a,c){b=b.replace(new RegExp(a,"g"),c)}),b=b.replace(new RegExp("<br\\s?/?></li>","gi"),"</li>"),b=b.replace(new RegExp("</li><br\\s?/?>","gi"),"</li>"),b=b.replace(new RegExp('<div(.*?[^>]) data-tagblock="redactor"(.*?[^>])>',"gi"),"<div$1$2>"),b=b.replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>"),b=b.replace(new RegExp('<span(.*?[^>])srel="(.*?[^>])"(.*?[^>])>',"gi"),"<span$1$3>"),b=b.replace(new RegExp('<img(.*?[^>])srel="(.*?[^>])"(.*?[^>])>',"gi"),"<img$1$3>"),b=b.replace(new RegExp('<img(.*?[^>])sstyle="" (.*?[^>])>',"gi"),"<img$1 $2>"),b=b.replace(new RegExp("<img(.*?[^>])sstyle (.*?[^>])>","gi"),"<img$1 $2>"),b=b.replace(new RegExp('<span class="redactor-invisible-space">(.*?)</span>',"gi"),"$1"),b=b.replace(/ data-save-url="(.*?[^>])"/gi,""),b=b.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>"),b=b.replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,""),b=b.replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,""),b=b.replace(/<font(.*?[^<])>/gi,""),b=b.replace(/<\/font>/gi,""),b=this.tidy.load(b),this.opts.linkNofollow&&(b=b.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>"),b=b.replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">')),b=b.replace(/<(.*?) data-redactor-tag="(.*?)"(.*?[^>])>/gi,"<$1$3>"),b=b.replace(/<(.*?) data-redactor-class="(.*?)"(.*?[^>])>/gi,"<$1$3>"),b=b.replace(/<(.*?) data-redactor-style="(.*?)"(.*?[^>])>/gi,"<$1$3>"),b=b.replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>"),b=b.replace(new RegExp('<(.*?) data-verified="redactor">',"gi"),"<$1>")
},onPaste:function(b,c){if(b=a.trim(b),b=b.replace(/\$/g,"&#36;"),b=b.replace(/\u201d/g,'"'),b=b.replace(/\u201c/g,'"'),b=b.replace(/\u2018/g,"'"),b=b.replace(/\u2019/g,"'"),b=b.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," "),b=b.replace(/<span class="Apple-tab-span"[^>]*>\t<\/span>/gi,"	"),b=b.replace(/<span[^>]*>(\s|&nbsp;)<\/span>/gi," "),this.opts.pastePlainText)return this.clean.getPlainText(b);if("undefined"==typeof c){if(this.utils.isCurrentOrParent(["FIGCAPTION","A"]))return this.clean.getPlainText(b,!1);
if(this.utils.isCurrentOrParent("PRE"))return this.clean.getPreCode(b);if(this.utils.isCurrentOrParent(["BLOCKQUOTE","H1","H2","H3","H4","H5","H6"])){if(b=this.clean.getOnlyImages(b),!this.utils.browser("msie")){var d=this.selection.getBlock();d&&"P"==d.tagName&&(b=b.replace(/<img(.*?)>/gi,"<p><img$1></p>"))}return b}if(this.utils.isCurrentOrParent(["TD"]))return b=this.clean.onPasteTidy(b,"td"),this.opts.linebreaks&&(b=this.clean.replaceParagraphsToBr(b)),b=this.clean.replaceDivsToBr(b);if(this.utils.isCurrentOrParent(["LI"]))return this.clean.onPasteTidy(b,"li")
}return b=this.clean.isSingleLine(b,c),this.clean.singleLine||(this.opts.linebreaks&&(b=this.clean.replaceParagraphsToBr(b)),this.opts.replaceDivs&&(b=this.clean.replaceDivs(b)),b=this.clean.saveFormTags(b)),b=this.clean.onPasteWord(b),b=this.clean.onPasteExtra(b),b=this.clean.onPasteTidy(b,"all"),!this.clean.singleLine&&this.opts.paragraphize&&(b=this.paragraphize.load(b)),b=this.clean.removeDirtyStyles(b),b=this.clean.onPasteRemoveSpans(b),b=this.clean.onPasteRemoveEmpty(b),b=this.clean.convertInline(b)},onPasteWord:function(a){return a=a.replace(/<!--[\s\S]*?-->/gi,""),a=a.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,""),/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(a)&&(a=this.clean.onPasteIeFixLinks(a),a=a.replace(/<img(.*?)v:shapes=(.*?)>/gi,""),a=a.replace(/src="file\:\/\/(.*?)"/,'src=""'),a=a.replace(/<p(.*?)class="MsoListParagraphCxSpFirst"([\w\W]*?)<\/p>/gi,"<ul><li$2</li>"),a=a.replace(/<p(.*?)class="MsoListParagraphCxSpMiddle"([\w\W]*?)<\/p>/gi,"<li$2</li>"),a=a.replace(/<p(.*?)class="MsoListParagraphCxSpLast"([\w\W]*?)<\/p>/gi,"<li$2</li></ul>"),a=a.replace(/<p(.*?)class="MsoListParagraph"([\w\W]*?)<\/p>/gi,"<ul><li$2</li></ul>"),a=a.replace(/\xb7/g,""),a=a.replace(/<p class="Mso(.*?)"/gi,"<p"),a=a.replace(/ class=\"(mso[^\"]*)\"/gi,""),a=a.replace(/ class=(mso\w+)/gi,""),a=a.replace(/<o:p(.*?)>([\w\W]*?)<\/o:p>/gi,"$2"),a=a.replace(/\n/g," "),a=a.replace(/<p>\n?<li>/gi,"<li>")),this.opts.cleanSpaces&&(a=a.replace(/(\s|&nbsp;)+/g," ")),a
},onPasteExtra:function(a){return a=a.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),a=a.replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3"),a=a.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>/gi,'<span style="font-weight: bold;"><span style="font-style: italic;">'),a=a.replace(/<span[^>]*font-style: italic[^>]*>/gi,'<span style="font-style: italic;">'),a=a.replace(/<span[^>]*font-weight: bold[^>]*>/gi,'<span style="font-weight: bold;">'),a=a.replace(/<span[^>]*text-decoration: underline[^>]*>/gi,'<span style="text-decoration: underline;">'),a=a.replace(/<img>/gi,""),a=a.replace(/\n{3,}/gi,"\n"),a=a.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2"),a=a.replace(/<p><p>/gi,"<p>"),a=a.replace(/<\/p><\/p>/gi,"</p>"),a=a.replace(/<li>(\s*|\t*|\n*)<p>/gi,"<li>"),a=a.replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,"</li>"),a=a.replace(/<\/p>\s<p/gi,"</p><p"),a=a.replace(/<img src="webkit-fake-url\:\/\/(.*?)"(.*?)>/gi,""),a=a.replace(/<p>\u2022([\w\W]*?)<\/p>/gi,"<li>$1</li>"),this.utils.browser("mozilla")&&(a=a.replace(/<br\s?\/?>$/gi,"")),a
},onPasteTidy:function(a,b){var c=["span","a","pre","blockquote","small","em","strong","code","kbd","mark","address","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","p","br","video","audio","iframe","embed","param","object","img","table","td","th","tr","tbody","tfoot","thead","h1","h2","h3","h4","h5","h6"],d=!1,e=[["a","*"],["img",["src","alt"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]];
"all"==b?(d=["p","span","h1","h2","h3","h4","h5","h6"],e=[["table","class"],["td",["colspan","rowspan"]],["a","*"],["img",["src","alt","data-redactor-inserted-image"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]]):"td"==b?c=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","br","iframe","video","audio","embed","param","object","img","h1","h2","h3","h4","h5","h6"]:"li"==b&&(c=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","br","iframe","video","audio","embed","param","object","img"]);
var f={deniedTags:!1,allowedTags:c,removeComments:!0,removePhp:!0,removeAttr:!1,allowedAttr:e,removeEmpty:d};return this.tidy.load(a,f)},onPasteRemoveEmpty:function(a){return a=a.replace(/<(p|h[1-6])>(|\s|\n|\t|<br\s?\/?>)<\/(p|h[1-6])>/gi,""),this.opts.linebreaks||(a=a.replace(/<br>$/i,"")),a},onPasteRemoveSpans:function(a){return a=a.replace(/<span>(.*?)<\/span>/gi,"$1"),a=a.replace(/<span[^>]*>\s|&nbsp;<\/span>/gi," ")},onPasteIeFixLinks:function(b){if(!this.utils.browser("msie"))return b;var c=a.trim(b);
return 0===c.search(/^<a(.*?)>(.*?)<\/a>$/i)&&(b=b.replace(/^<a(.*?)>(.*?)<\/a>$/i,"$2")),b},isSingleLine:function(a,b){if(this.clean.singleLine=!1,"undefined"==typeof b){var c=this.opts.blockLevelElements.join("|").replace("P|","").replace("DIV|",""),d=a.match(new RegExp("</("+c+")>","gi")),e=a.match(/<\/(p|div)>/gi);if(!d&&(null===e||e&&e.length<=1)){var f=a.match(/<br\s?\/?>/gi),g=a.match(/<img(.*?[^>])>/gi);f||g||(this.clean.singleLine=!0,a=a.replace(/<\/?(p|div)(.*?)>/gi,""))}}return a},stripTags:function(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");
var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return a.replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""})},savePreCode:function(b){var c=b.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/gi);return null!==c&&a.each(c,a.proxy(function(a,c){var d=c.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/i);d[3]=d[3].replace(/<br\s?\/?>/g,"\n"),d[3]=d[3].replace(/&nbsp;/g," "),this.opts.preSpaces&&(d[3]=d[3].replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),d[3]=this.clean.encodeEntities(d[3]),d[3]=d[3].replace(/\$/g,"&#36;"),b=b.replace(c,"<"+d[1]+d[2]+">"+d[3]+"</"+d[1]+">")
},this)),b},getTextFromHtml:function(b){b=b.replace(/<br\s?\/?>|<\/H[1-6]>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n");var c=document.createElement("div");return c.innerHTML=b,b=c.textContent||c.innerText,a.trim(b)},getPlainText:function(a,b){return a=this.clean.getTextFromHtml(a),a=a.replace(/\n/g,"<br />"),this.opts.paragraphize&&"undefined"==typeof b&&(a=this.paragraphize.load(a)),a},getPreCode:function(a){return a=a.replace(/<img(.*?) style="(.*?)"(.*?[^>])>/gi,"<img$1$3>"),a=a.replace(/<img(.*?)>/gi,"&lt;img$1&gt;"),a=this.clean.getTextFromHtml(a),this.opts.preSpaces&&(a=a.replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),a=this.clean.encodeEntities(a)
},getOnlyImages:function(a){return a=a.replace(/<img(.*?)>/gi,"[img$1]"),a=a.replace(/<([Ss]*?)>/gi,""),a=a.replace(/\[img(.*?)\]/gi,"<img$1>")},getOnlyLinksAndImages:function(a){return a=a.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]'),a=a.replace(/<img(.*?)>/gi,"[img$1]"),a=a.replace(/<(.*?)>/gi,""),a=a.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),a=a.replace(/\[img(.*?)\]/gi,"<img$1>")},encodeEntities:function(a){return a=String(a).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")
},removeDirtyStyles:function(b){if(this.utils.browser("msie"))return b;var c=document.createElement("div");return c.innerHTML=b,this.clean.clearUnverifiedRemove(a(c)),b=c.innerHTML,a(c).remove(),b},clearUnverified:function(){if(!this.utils.browser("msie")){this.clean.clearUnverifiedRemove(this.$editor);var a=this.$editor.find("h1, h2, h3, h4, h5, h6");a.find("span").removeAttr("style"),a.find(this.opts.verifiedTags.join(", ")).removeAttr("style")}},clearUnverifiedRemove:function(b){b.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),b.find("span").not('[data-verified="redactor"]').removeAttr("style"),b.find('span[data-verified="redactor"], img[data-verified="redactor"]').each(function(b,c){var d=a(c);
d.attr("style",d.attr("rel"))})},setVerified:function(a){if(this.utils.browser("msie"))return a;a=a.replace(new RegExp("<img(.*?[^>])>","gi"),'<img$1 data-verified="redactor">'),a=a.replace(new RegExp("<span(.*?)>","gi"),'<span$1 data-verified="redactor">');var b=a.match(new RegExp('<(span|img)(.*?)style="(.*?)"(.*?[^>])>',"gi"));if(b)for(var c=b.length,d=0;c>d;d++)try{var e=b[d].replace(/style="(.*?)"/i,'style="$1" rel="$1"');a=a.replace(new RegExp(b[d],"gi"),e)}catch(f){}return a},convertInline:function(b){var c=a("<div />").html(b),d=this.opts.inlineTags;
return d.push("span"),c.find(d.join(",")).each(function(){var b=a(this),c=this.tagName.toLowerCase();b.attr("data-redactor-tag",c),"span"==c&&(b.attr("style")?b.attr("data-redactor-style",b.attr("style")):b.attr("class")&&b.attr("data-redactor-class",b.attr("class")))}),b=c.html(),c.remove(),b},normalizeLists:function(){this.$editor.find("li").each(function(b,c){var d=a(c).next();0===d.length||"UL"!=d[0].tagName&&"OL"!=d[0].tagName||a(c).append(d)})},removeSpaces:function(a){return a=a.replace(/\n/g,""),a=a.replace(/[\t]*/g,""),a=a.replace(/\n\s*\n/g,"\n"),a=a.replace(/^[\s\n]*/g," "),a=a.replace(/[\s\n]*$/g," "),a=a.replace(/>\s{2,}</g,"> <"),a=a.replace(/\n\n/g,"\n"),a=a.replace(/[\u200B-\u200D\uFEFF]/g,"")
},replaceDivs:function(a){return this.opts.linebreaks?(a=a.replace(/<div><br\s?\/?><\/div>/gi,"<br />"),a=a.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2<br />")):a=a.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>"),a},replaceDivsToBr:function(a){return a=a.replace(/<div\s(.*?)>/gi,"<p>"),a=a.replace(/<div><br\s?\/?><\/div>/gi,"<br /><br />"),a=a.replace(/<div>([\w\W]*?)<\/div>/gi,"$1<br /><br />")},replaceParagraphsToBr:function(a){return a=a.replace(/<p\s(.*?)>/gi,"<p>"),a=a.replace(/<p><br\s?\/?><\/p>/gi,"<br />"),a=a.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br /><br />"),a=a.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>")
},saveFormTags:function(a){return a.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(a){return a.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")}}},core:function(){return{getObject:function(){return a.extend({},this)},getEditor:function(){return this.$editor},getBox:function(){return this.$box},getElement:function(){return this.$element},addEvent:function(a){this.core.event=a},getEvent:function(){return this.core.event
},setCallback:function(b,c,d){var e=this.opts[b+"Callback"];return a.isFunction(e)?"undefined"==typeof d?e.call(this,c):e.call(this,c,d):"undefined"==typeof d?c:d},destroy:function(){this.core.setCallback("destroy"),this.$element.off(".redactor").removeData("redactor"),this.$editor.off(".redactor"),this.$pasteBox&&this.$pasteBox.remove(),a(".redactor-toolbar-tooltip").remove()}}},focus:function(){return{setStart:function(){this.$editor.focus();var a=this.$editor.children().first();if(0!==a.size()&&0!==a[0].length&&"BR"!=a[0].tagName&&3!=a[0].nodeType){if("UL"==a[0].tagName||"OL"==a[0].tagName){a=a.find("li").first();
var b=a.children().first();if(!this.utils.isBlock(b)&&""===b.text())return this.caret.setStart(b),void 0}return this.opts.linebreaks&&!this.utils.isBlockTag(a[0].tagName)?(this.selection.get(),this.range.setStart(this.$editor[0],0),this.range.setEnd(this.$editor[0],0),this.selection.addRange(),void 0):(this.caret.setStart(a),void 0)}},setEnd:function(){if(this.utils.browser("mozilla")||this.utils.browser("msie")){var a=this.$editor.children().last();this.caret.setEnd(a)}else{this.selection.get();try{this.range.selectNodeContents(this.$editor[0]),this.range.collapse(!1),this.selection.addRange()
}catch(b){}}},isFocused:function(){var a=document.getSelection().focusNode;return null===a?!1:this.utils.isRedactorParent(a.parentNode)?this.$editor.is(":focus"):!1}}},indent:function(){return{increase:function(){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var b=this.selection.getBlock();b&&"LI"==b.tagName?this.indent.increaseLists():b===!1&&this.opts.linebreaks,setTimeout(a.proxy(function(){this.selection.restore()},this),1)},increaseLists:function(){document.execCommand("indent"),this.indent.fixEmptyIndent(),this.clean.normalizeLists(),this.clean.clearUnverified()
},increaseBlocks:function(){a.each(this.selection.getBlocks(),a.proxy(function(a,b){if("TD"!==b.tagName&&"TH"!==b.tagName){var c=this.utils.getAlignmentElement(b),d=this.utils.normalize(c.css("margin-left"))+this.opts.indentValue;c.css("margin-left",d+"px")}},this))},increaseText:function(){var b=this.selection.wrap("div");a(b).attr("data-tagblock","redactor"),a(b).css("margin-left",this.opts.indentValue+"px")},decrease:function(){this.buffer.set(),this.selection.save();var a=this.selection.getBlock();a&&"LI"==a.tagName&&this.indent.decreaseLists(),this.selection.restore()
},decreaseLists:function(){document.execCommand("outdent");var b=this.selection.getCurrent(),c=a(b).closest("li"),d=c.parent();0!==c.size()&&0!==d.size()&&"LI"==d[0].tagName&&d.after(c),this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==c.size()||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote, p").each(a.proxy(this.utils.removeEmpty,this))),this.clean.clearUnverified()},decreaseBlocks:function(){a.each(this.selection.getBlocks(),a.proxy(function(a,b){var c=this.utils.getAlignmentElement(b),d=this.utils.normalize(c.css("margin-left"))-this.opts.indentValue;
0>=d?this.opts.linebreaks&&"undefined"!=typeof c.data("tagblock")?c.replaceWith(c.html()+"<br />"):(c.css("margin-left",""),this.utils.removeEmptyAttr(c,"style")):c.css("margin-left",d+"px")},this))},fixEmptyIndent:function(){var b=this.selection.getBlock();if(this.range.collapsed&&b&&"LI"==b.tagName&&this.utils.isEmpty(a(b).text())){var c=a(b);c.find("span").not(".redactor-selection-marker").contents().unwrap(),c.append("<br>")}}}},inline:function(){return{formatting:function(a){var b,c;"undefined"!=typeof this.formatting[a].style?b="style":"undefined"!=typeof this.formatting[a].class&&(b="class"),b&&(c=this.formatting[a][b]),this.inline.format(this.formatting[a].tag,b,c)
},format:function(a,b,c){if(!this.utils.isCurrentOrParent("PRE")&&!this.utils.isCurrentOrParentHeader()){for(var d=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],e=["strong","strong","em","em","u","del","del","sup","sub"],f=0;f<d.length;f++)a==d[f]&&(a=e[f]);this.inline.type=b||!1,this.inline.value=c||!1,this.buffer.set(),this.$editor.focus(),this.selection.get(),this.range.collapsed?this.inline.formatCollapsed(a):this.inline.formatMultiple(a)}},formatCollapsed:function(b){var c=this.selection.getCurrent(),d=a(c).closest(b+"[data-redactor-tag="+b+"]");
if(0!==d.size())return this.caret.setAfter(d[0]),this.utils.isEmpty(d.text())&&d.remove(),void 0;var e=a("<"+b+">").attr("data-verified","redactor").attr("data-redactor-tag",b);e.html(this.opts.invisibleSpace),e=this.inline.setFormat(e);var e=this.insert.node(e);this.caret.setEnd(e)},formatMultiple:function(b){if(this.inline.formatConvert(b),this.selection.save(),document.execCommand("strikethrough"),this.$editor.find("strike").each(a.proxy(function(c,d){var e=a(d);this.inline.formatRemoveSameChildren(e,b);var f;
if(this.inline.type?(f=a("<span>").attr("data-redactor-tag",b).attr("data-verified","redactor"),f=this.inline.setFormat(f)):f=a("<"+b+">").attr("data-redactor-tag",b).attr("data-verified","redactor"),e.replaceWith(f.html(e.contents())),"span"==b){var g=f.parent();if(g&&"SPAN"==g[0].tagName&&"style"==this.inline.type)for(var h=this.inline.value.split(";"),i=0;i<h.length;i++){if(""===h[i])return;var j=h[i].split(":");g.css(j[0],""),this.utils.removeEmptyAttr(g,"style")&&g.replaceWith(g.contents())}}},this)),"span"!=b&&this.$editor.find(this.opts.inlineTags.join(", ")).each(a.proxy(function(b,c){var d=a(c),e=d.css("text-decoration");
"line-through"==e&&(d.css("text-decoration",""),this.utils.removeEmptyAttr(d,"style"))},this)),"del"!=b){var c=this;this.$editor.find("inline").each(function(a,b){c.utils.replaceToTag(b,"del")})}this.selection.restore()},formatRemoveSameChildren:function(b,c){b.children(c).each(function(){var b=a(this);b.hasClass("redactor-selection-marker")||b.contents().unwrap()})},formatConvert:function(b){this.selection.save();var c="";if("class"==this.inline.type?c="[data-redactor-class="+this.inline.value+"]":"style"==this.inline.type&&(c='[data-redactor-style="'+this.inline.value+'"]'),"del"!=b){var d=this;
this.$editor.find("del").each(function(a,b){d.utils.replaceToTag(b,"inline")})}this.$editor.find('[data-redactor-tag="'+b+'"]'+c).each(function(){if(""!==c||"span"!=b||this.tagName.toLowerCase()!=b){var d=a(this);d.replaceWith(a("<strike />").html(d.contents()))}}),this.selection.restore()},setFormat:function(a){switch(this.inline.type){case"class":a.hasClass(this.inline.value)?(a.removeClass(this.inline.value),a.removeAttr("data-redactor-class")):(a.addClass(this.inline.value),a.attr("data-redactor-class",this.inline.value));
break;case"style":a[0].style.cssText=this.inline.value,a.attr("data-redactor-style",this.inline.value)}return a},removeStyle:function(){this.buffer.set();var b=this.selection.getCurrent(),c=this.selection.getInlines();if(this.selection.save(),b&&"SPAN"===b.tagName){var d=a(b);d.removeAttr("style"),0===d[0].attributes.length&&d.replaceWith(d.contents())}a.each(c,a.proxy(function(b,c){var d=a(c);-1==a.inArray(c.tagName.toLowerCase(),this.opts.inlineTags)||d.hasClass("redactor-selection-marker")||(d.removeAttr("style"),0===d[0].attributes.length&&d.replaceWith(d.contents()))
},this)),this.selection.restore()},removeStyleRule:function(b){this.buffer.set();var c=this.selection.getParent(),d=this.selection.getInlines();if(this.selection.save(),c&&"SPAN"===c.tagName){var e=a(c);e.css(b,""),this.utils.removeEmptyAttr(e,"style"),0===e[0].attributes.length&&e.replaceWith(e.contents())}a.each(d,a.proxy(function(c,d){var e=a(d);-1==a.inArray(d.tagName.toLowerCase(),this.opts.inlineTags)||e.hasClass("redactor-selection-marker")||(e.css(b,""),this.utils.removeEmptyAttr(e,"style"),0===e[0].attributes.length&&e.replaceWith(e.contents()))
},this)),this.selection.restore()},removeFormat:function(){this.buffer.set();var b=this.selection.getCurrent();this.selection.save(),document.execCommand("removeFormat"),b&&"SPAN"===b.tagName&&a(b).replaceWith(a(b).contents()),a.each(this.selection.getNodes(),a.proxy(function(b,c){var d=a(c);-1==a.inArray(c.tagName.toLowerCase(),this.opts.inlineTags)||d.hasClass("redactor-selection-marker")||d.replaceWith(d.contents())},this)),this.selection.restore()},toggleClass:function(a){this.inline.format("span","class",a)
},toggleStyle:function(a){this.inline.format("span","style",a)}}},insert:function(){return{set:function(b,c){b=this.clean.setVerified(b),"undefined"==typeof c&&(b=this.clean.onPaste(b,!1)),this.$editor.html(b),this.selection.remove(),this.focus.setEnd(),this.clean.normalizeLists(),"undefined"==typeof c&&setTimeout(a.proxy(this.clean.clearUnverified,this),10)},text:function(b){if(b=b.toString(),b=a.trim(b),b=this.clean.getPlainText(b,!1),this.$editor.focus(),this.utils.browser("msie"))this.insert.htmlIe(b);else{this.selection.get(),this.range.deleteContents();
var c=document.createElement("div");c.innerHTML=b;for(var e,f,d=document.createDocumentFragment();e=c.firstChild;)f=d.appendChild(e);if(this.range.insertNode(d),f){var g=this.range.cloneRange();g.setStartAfter(f),g.collapse(!0),this.sel.removeAllRanges(),this.sel.addRange(g)}}this.clean.clearUnverified()},htmlWithoutClean:function(a){this.insert.html(a,!1)},html:function(b,c){"undefined"==typeof c&&(c=!0),this.$editor.focus(),b=this.clean.setVerified(b),c&&(b=this.clean.onPaste(b)),this.utils.browser("msie")?this.insert.htmlIe(b):(this.clean.singleLine?this.insert.execHtml(b):document.execCommand("insertHTML",!1,b),this.insert.htmlFixMozilla()),this.clean.normalizeLists(),this.opts.linebreaks||this.$editor.find("p").each(a.proxy(this.utils.removeEmpty,this)),c&&this.clean.clearUnverified()
},htmlFixMozilla:function(){if(this.utils.browser("mozilla")){var b=a(this.selection.getBlock()).next();b.length>0&&"P"==b[0].tagName&&""===b.html()&&b.remove()}},htmlIe:function(b){if(this.utils.isIe11()){var c=this.utils.isCurrentOrParent("P"),d=a("<div>").append(b),e=d.contents().is("p, :header, dl, ul, ol, div, table, td, blockquote, pre, address, section, header, footer, aside, article");return c&&e?this.insert.ie11FixInserting(c,b):this.insert.ie11PasteFrag(b),void 0}document.selection.createRange().pasteHTML(b)
},execHtml:function(a){a=this.clean.setVerified(a),this.selection.get(),this.range.deleteContents();var b=document.createElement("div");b.innerHTML=a;for(var d,e,c=document.createDocumentFragment();d=b.firstChild;)e=c.appendChild(d);this.range.insertNode(c),this.range.collapse(!0),this.caret.setAfter(e)},node:function(b,c){b=b[0]||b;var d=this.utils.getOuterHtml(b);return d=this.clean.setVerified(d),b=a(d)[0],this.selection.get(),c!==!1&&this.range.deleteContents(),this.range.insertNode(b),this.range.collapse(!1),this.selection.addRange(),b
},nodeToPoint:function(a,b,c){a=a[0]||a,this.selection.get();var d;if(document.caretPositionFromPoint){var e=document.caretPositionFromPoint(b,c);this.range.setStart(e.offsetNode,e.offset),this.range.collapse(!0),this.range.insertNode(a)}else if(document.caretRangeFromPoint)d=document.caretRangeFromPoint(b,c),d.insertNode(a);else if("undefined"!=typeof document.body.createTextRange){d=document.body.createTextRange(),d.moveToPoint(b,c);var f=d.duplicate();f.moveToPoint(b,c),d.setEndPoint("EndToEnd",f),d.select()
}},nodeToCaretPositionFromPoint:function(a,b){b=b[0]||b;var c,d=a.clientX,e=a.clientY;if(document.caretPositionFromPoint){var f=document.caretPositionFromPoint(d,e),g=document.getSelection();c=g.getRangeAt(0),c.setStart(f.offsetNode,f.offset),c.collapse(!0),c.insertNode(b)}else if(document.caretRangeFromPoint)c=document.caretRangeFromPoint(d,e),c.insertNode(b);else if("undefined"!=typeof document.body.createTextRange){c=document.body.createTextRange(),c.moveToPoint(d,e);var h=c.duplicate();h.moveToPoint(d,e),c.setEndPoint("EndToEnd",h),c.select()
}},ie11FixInserting:function(b,c){var d=document.createElement("span");d.className="redactor-ie-paste",this.insert.node(d);var e=a(b).html();e="<p>"+e.replace(/<span class="redactor-ie-paste"><\/span>/gi,"</p>"+c+"<p>")+"</p>",a(b).replaceWith(e)},ie11PasteFrag:function(a){this.selection.get(),this.range.deleteContents();var b=document.createElement("div");b.innerHTML=a;for(var d,e,c=document.createDocumentFragment();d=b.firstChild;)e=c.appendChild(d);this.range.insertNode(c)}}},keydown:function(){return{init:function(b){if(!a(b.target).is("input, textarea")&&!this.rtePaste){var c=b.which,d=c>=37&&40>=c;
this.keydown.ctrl=b.ctrlKey||b.metaKey,this.keydown.current=this.selection.getCurrent(),this.keydown.parent=this.selection.getParent(),this.keydown.block=this.selection.getBlock(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.shortcuts.init(b,c),this.keydown.checkEvents(d,c),this.keydown.setupBuffer(b,c),this.keydown.addArrowsEvent(d);var e=this.core.setCallback("keydown",b);
if(e===!1)return b.preventDefault(),!1;if(this.opts.enterKey&&(this.utils.browser("msie")||this.utils.browser("mozilla"))&&(c===this.keyCode.DOWN||c===this.keyCode.RIGHT)){var f=!1,g=!1;if(this.keydown.block&&"TD"===this.keydown.block.tagName&&(g=a(this.keydown.block).closest("table")),g&&g.find("td").last()[0]===this.keydown.block&&(f=!0),this.utils.isEndOfElement()&&f){var h=a(this.opts.emptyHtml);g.after(h),this.caret.setStart(h)}}if(this.opts.enterKey&&c===this.keyCode.DOWN&&this.keydown.onArrowDown(),!this.opts.enterKey&&c===this.keyCode.ENTER)return b.preventDefault(),this.range.collapsed||this.range.deleteContents(),void 0;
if(c==this.keyCode.ENTER&&!b.shiftKey&&!b.ctrlKey&&!b.metaKey){var i=this.core.setCallback("enter",b);if(i===!1)return b.preventDefault(),!1;var j,k;if(this.keydown.pre)return this.keydown.insertNewLine(b);if("text"==this.utils.getEditableContentType(this.keydown.block))return j=this.selection.getEndNode(),k=a(j).next(),0!==k.size()&&"BR"==k[0].tagName?this.keydown.insertBreakLine(b):this.utils.isEndOfElement()&&j&&"SPAN"!=j?this.keydown.insertDblBreakLine(b):this.keydown.insertBreakLine(b);if(this.opts.linebreaks&&!this.keydown.block)return j=this.selection.getCurrent(),k=a(this.keydown.current).next(),j!==!1&&a(j).hasClass("redactor-invisible-space")?(a(j).remove(),this.keydown.insertDblBreakLine(b)):0===k.length&&j===!1&&"undefined"!=typeof k.context?this.keydown.insertDblBreakLine(b):this.keydown.insertBreakLine(b);
if(this.opts.linebreaks&&this.keydown.block)setTimeout(a.proxy(this.keydown.replaceDivToBreakLine,this),1);else if(!this.opts.linebreaks&&this.keydown.block&&"LI"!==this.keydown.block.tagName)setTimeout(a.proxy(this.keydown.replaceDivToParagraph,this),1);else if(!this.opts.linebreaks&&!this.keydown.block)return this.keydown.insertParagraph(b)}return c===this.keyCode.ENTER&&(b.ctrlKey||b.shiftKey)?this.keydown.onShiftEnter(b):c===this.keyCode.TAB||b.metaKey&&221===c||b.metaKey&&219===c?this.keydown.onTab(b,c):(c===this.keyCode.BACKSPACE&&(this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(b)),void 0)
}},checkEvents:function(a,b){a||"click"!=this.core.getEvent()&&"arrow"!=this.core.getEvent()||(this.core.addEvent(!1),this.keydown.checkKeyEvents(b)&&this.buffer.set())},checkKeyEvents:function(b){var c=this.keyCode,d=[c.BACKSPACE,c.DELETE,c.ENTER,c.SPACE,c.ESC,c.TAB,c.CTRL,c.META,c.ALT,c.SHIFT];return-1==a.inArray(b,d)?!0:!1},addArrowsEvent:function(a){return a?"click"==this.core.getEvent()||"arrow"==this.core.getEvent()?(this.core.addEvent(!1),void 0):(this.core.addEvent("arrow"),void 0):void 0},setupBuffer:function(a,b){return this.keydown.ctrl&&90===b&&!a.shiftKey&&!a.altKey&&this.opts.buffer.length?(a.preventDefault(),this.buffer.undo(),void 0):this.keydown.ctrl&&90===b&&a.shiftKey&&!a.altKey&&0!==this.opts.rebuffer.length?(a.preventDefault(),this.buffer.redo(),void 0):(this.keydown.ctrl||(b==this.keyCode.BACKSPACE||b==this.keyCode.DELETE||b==this.keyCode.ENTER&&!a.ctrlKey&&!a.shiftKey||b==this.keyCode.SPACE)&&this.buffer.set(),void 0)
},onArrowDown:function(){for(var a=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],b=0;b<a.length;b++)if(a[b])return this.keydown.insertAfterLastElement(a[b]),!1},onShiftEnter:function(a){return this.buffer.set(),this.utils.isEndOfElement()?this.keydown.insertDblBreakLine(a):this.keydown.insertBreakLine(a)},onTab:function(a,b){if(!this.opts.tabKey)return!0;a.preventDefault();if((!this.keydown.pre||a.shiftKey)&&this.opts.tabAsSpaces===!1)return a.metaKey&&219===b?this.indent.decrease():a.metaKey&&221===b?this.indent.increase():a.shiftKey?this.indent.decrease():this.indent.increase(),!1
},replaceDivToBreakLine:function(){var b=this.selection.getBlock(),c=b.innerHTML.replace(/<br\s?\/?>/gi,"");if(("DIV"===b.tagName||"P"===b.tagName)&&""===c&&!a(b).hasClass("redactor-editor")){var d=document.createElement("br");return a(b).replaceWith(d),this.caret.setBefore(d),!1}},replaceDivToParagraph:function(){var b=this.selection.getBlock(),c=b.innerHTML.replace(/<br\s?\/?>/gi,"");if("DIV"===b.tagName&&""===c&&!a(b).hasClass("redactor-editor")){var d=document.createElement("p");return d.innerHTML=this.opts.invisibleSpace,a(b).replaceWith(d),this.caret.setStart(d),!1
}this.opts.cleanStyleOnEnter&&"P"==b.tagName&&a(b).removeAttr("class").removeAttr("style")},insertParagraph:function(a){a.preventDefault(),this.selection.get();var b=document.createElement("p");return b.innerHTML=this.opts.invisibleSpace,this.range.deleteContents(),this.range.insertNode(b),this.caret.setStart(b),!1},exitFromBlockquote:function(b){if(this.utils.isEndOfElement()){var c=a.trim(a(this.keydown.block).html());if(-1!=c.search(/(<br\s?\/?>){2}$/i)){if(b.preventDefault(),this.opts.linebreaks){var d=document.createElement("br");
a(this.keydown.blockquote).after(d),this.caret.setBefore(d),a(this.keydown.block).html(c.replace(/<br\s?\/?>$/i,""))}else{var e=a(this.opts.emptyHtml);a(this.keydown.blockquote).after(e),this.caret.setStart(e)}return!0}}},insertAfterLastElement:function(b){if(this.utils.isEndOfElement())if(this.buffer.set(),this.opts.linebreaks){var c=a("<div>").append(a.trim(this.$editor.html())).contents(),d=c.last()[0];if("SPAN"==d.tagName&&""===d.innerHTML&&(d=c.prev()[0]),this.utils.getOuterHtml(d)!=this.utils.getOuterHtml(b))return;
var e=document.createElement("br");a(b).after(e),this.caret.setAfter(e)}else{if(this.$editor.contents().last()[0]!==b)return;var f=a(this.opts.emptyHtml);a(b).after(f),this.caret.setStart(f)}},insertNewLine:function(a){a.preventDefault();var b=document.createTextNode("\n");return this.selection.get(),this.range.deleteContents(),this.range.insertNode(b),this.caret.setAfter(b),!1},insertBreakLine:function(a){return this.keydown.insertBreakLineProcessing(a)},insertDblBreakLine:function(a){return this.keydown.insertBreakLineProcessing(a,!0)
},insertBreakLineProcessing:function(a,b){a.stopPropagation(),this.selection.get();var c=document.createElement("br");if(this.range.deleteContents(),this.range.insertNode(c),b===!0){var d=document.createElement("br");this.range.insertNode(d),this.caret.setAfter(d)}else this.caret.setAfter(c);return!1},removeInvisibleSpace:function(){var b=a(this.keydown.current);0===b.text().search(/^\u200B$/g)&&b.is(":not([contenteditable])")&&b.remove()},removeEmptyListInTable:function(b){var c=a(this.keydown.current),d=a(this.keydown.parent),e=c.closest("td");
if(0!==e.size()&&c.closest("li")&&1===d.children("li").size()){if(!this.utils.isEmpty(c.text()))return;b.preventDefault(),c.remove(),d.remove(),this.caret.setStart(e)}}}},keyup:function(){return{init:function(b){if(!a(b.target).is("input, textarea")&&!this.rtePaste){var c=b.which;this.keyup.current=this.selection.getCurrent(),this.keyup.parent=this.selection.getParent();var d=this.utils.isRedactorParent(a(this.keyup.parent).parent()),e=this.core.setCallback("keyup",b);if(e===!1)return b.preventDefault(),!1;if(!this.opts.linebreaks&&3==this.keyup.current.nodeType&&this.keyup.current.length<=1&&(this.keyup.parent===!1||"BODY"==this.keyup.parent.tagName)&&this.keyup.replaceToParagraph(),!this.opts.linebreaks&&this.utils.isRedactorParent(this.keyup.current)&&"DIV"===this.keyup.current.tagName&&this.keyup.replaceToParagraph(!1),this.opts.linebreaks||!a(this.keyup.parent).hasClass("redactor-invisible-space")||d!==!1&&"BODY"!=d[0].tagName||(a(this.keyup.parent).contents().unwrap(),this.keyup.replaceToParagraph()),c===this.keyCode.DELETE||c===this.keyCode.BACKSPACE)return this.clean.clearUnverified(),this.$editor.find("p:not([contenteditable])").each(a.proxy(this.utils.removeEmpty,this)),this.keyup.current&&"DIV"==this.keyup.current.tagName&&this.utils.isEmpty(this.keyup.current.innerHTML)&&this.opts.linebreaks&&(a(this.keyup.current).after(this.selection.getMarkerAsHtml()),this.selection.restore(),a(this.keyup.current).remove()),this.keyup.formatEmpty(b);
{var f=this.utils.getEditableContainer(b.target),g=this.utils.getEditableContentType(b.target);a(f)}"text"==g&&""==a(f).text()&&(f.innerHTML=this.opts.invisibleSpace,this.caret.setEnd(f))}},replaceToParagraph:function(b){return},formatEmpty:function(b){var c=this.utils.getEditableContainer(b.target),d=this.utils.getEditableContentType(b.target),e=a(c);if("html"===d){var f=a.trim(e.html());if(this.utils.isEmpty(f)){if(b.preventDefault(),this.opts.linebreaks)e.html(this.selection.getMarkerAsHtml()),this.selection.restore();
else{var g=document.createElement("p");g.innerHTML=this.opts.invisibleSpace,e.empty().append(g),this.caret.setEnd(g)}return!1}}}}},list:function(){return{toggle:function(b){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var c=this.selection.getParent(),d=a(c).closest("ol, ul"),e=a(c).closest(EBD.block);this.utils.isRedactorParent(d)||0===d.size()||(d=!1);var f,g,h=!1;if(d&&d.length){h=!0;var i=d[0].tagName;f="orderedlist"===b&&"UL"===i,g="unorderedlist"===b&&"OL"===i
}f?this.utils.replaceToTag(d,"ol"):g?this.utils.replaceToTag(d,"ul"):h?this.list.remove(b):this.list.insert(b),this.$editor.trigger("composerListFormat",[e]),this.selection.restore()},insert:function(b){var c=this.selection.getParent(),d=this.selection.getCurrent(),e=a(d).closest("td, th");this.utils.browser("msie")&&this.opts.linebreaks?this.list.insertInIe(b):document.execCommand("insert"+b);var f=a(this.selection.getParent()).closest("ol, ul");if(0!==e.size()){var g=e.prev(),h=e.html();e.html(""),!g||1!==g.length||"TD"!==g[0].tagName&&"TH"!==g[0].tagName?a(c).prepend(e):a(g).after(e),e.html(h)
}if(this.utils.isEmpty(f.find("li").text())){var i=f.children("li");i.find("br").remove(),i.append(this.selection.getMarkerAsHtml())}if(f.length){var j=f.parent();this.utils.isRedactorParent(j)&&"LI"!=j[0].tagName&&this.utils.isBlock(j[0])&&j.replaceWith(j.contents())}this.utils.browser("msie")||this.$editor.focus(),this.clean.clearUnverified()},insertInIe:function(b){var c=this.selection.wrap("div"),d=a(c).html(),e="orderedlist"==b?a("<ol>"):a("<ul>"),f=a("<li>");if(""===a.trim(d))f.append(this.selection.getMarkerAsHtml()),e.append(f),this.$editor.find("#selection-marker-1").replaceWith(e);
else{var g=d.split(/<br\s?\/?>/gi);if(g)for(var h=0;h<g.length;h++)""!==a.trim(g[h])&&e.append(a("<li>").html(g[h]));else f.append(d),e.append(f);a(c).replaceWith(e)}},remove:function(b){document.execCommand("insert"+b);var c=a(this.selection.getCurrent());this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==c.closest("li, th, td").size()||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote").each(a.proxy(this.utils.removeEmpty,this)));var d=a(this.selection.getCurrent()).closest("table"),e=d.prev();
this.opts.linebreaks||0===d.size()||0===e.size()||"BR"!=e[0].tagName||e.remove(),this.clean.clearUnverified()}}},paragraphize:function(){return{load:function(b){return this.opts.linebreaks?b:""===b||"<p></p>"===b?this.opts.emptyHtml:(this.paragraphize.blocks=["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],b+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,b=b.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>"),b=this.paragraphize.getSafes(b),b=this.paragraphize.getSafesComments(b),b=this.paragraphize.replaceBreaksToNewLines(b),b=this.paragraphize.replaceBreaksToParagraphs(b),b=this.paragraphize.clear(b),b=this.paragraphize.restoreSafes(b),b=b.replace(new RegExp("<br\\s?/?>\n?<("+this.paragraphize.blocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),a.trim(b))
},getSafes:function(b){var c=a("<div />").append(b);return c.find("blockquote p").replaceWith(function(){return a(this).append("<br />").contents()}),b=c.html(),c.find(this.paragraphize.blocks.join(", ")).each(a.proxy(function(a,c){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=c.outerHTML,b=b.replace(c.outerHTML,"\n{replace"+this.paragraphize.z+"}")},this)),b},getSafesComments:function(b){var c=b.match(/<!--([\w\W]*?)-->/gi);return c?(a.each(c,a.proxy(function(a,c){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=c,b=b.replace(c,"\n{replace"+this.paragraphize.z+"}")
},this)),b):b},restoreSafes:function(b){return a.each(this.paragraphize.safes,function(a,c){b=b.replace("{replace"+a+"}",c)}),b},replaceBreaksToParagraphs:function(a){var b=a.split(new RegExp("\n","g"),-1);if(a="",b)for(var c=b.length,d=0;c>d;d++){if(!b.hasOwnProperty(d))return;-1==b[d].search("{replace")?(b[d]=b[d].replace(/<p>\n\t?<\/p>/gi,""),b[d]=b[d].replace(/<p><\/p>/gi,""),""!==b[d]&&(a+="<p>"+b[d].replace(/^\n+|\n+$/g,"")+"</p>")):a+=b[d]}return a},replaceBreaksToNewLines:function(a){return a=a.replace(/<br \/>\s*<br \/>/gi,"\n\n"),a=a.replace(/<br\s?\/?>\n?<br\s?\/?>/gi,"\n<br /><br />"),a=a.replace(new RegExp("\r\n","g"),"\n"),a=a.replace(new RegExp("\r","g"),"\n"),a=a.replace(new RegExp("/\n\n+/"),"g","\n\n")
},clear:function(a){return a=a.replace(new RegExp("</blockquote></p>","gi"),"</blockquote>"),a=a.replace(new RegExp("<p></blockquote>","gi"),"</blockquote>"),a=a.replace(new RegExp("<p><blockquote>","gi"),"<blockquote>"),a=a.replace(new RegExp("<blockquote></p>","gi"),"<blockquote>"),a=a.replace(new RegExp("<p><p ","gi"),"<p "),a=a.replace(new RegExp("<p><p>","gi"),"<p>"),a=a.replace(new RegExp("</p></p>","gi"),"</p>"),a=a.replace(new RegExp("<p>\\s?</p>","gi"),""),a=a.replace(new RegExp("\n</p>","gi"),"</p>"),a=a.replace(new RegExp("<p>	?	?\n?<p>","gi"),"<p>"),a=a.replace(new RegExp("<p>	*</p>","gi"),"")
}}},paste:function(){return{init:function(b){if(!a(b.target).is("input, textarea")&&this.opts.cleanOnPaste){this.rtePaste=!0,this.buffer.set(),this.selection.save();var c=b.originalEvent.clipboardData;if(c){var d=c.types,e="";a.indexOf(d,"text/html")>-1?e=c.getData("text/html"):a.indexOf(d,"text/plain")>-1&&(e=c.getData("text/plain")),this.selection.restore();var f=a("<div>").html(e);f.find(":not(p, br, ol, ul, li, span, b, i, u, a, small, strong, sup, sub, pre)").each(function(){a(this).replaceWith(a(this).text())
}),e=f.html(),this.paste.insert(e),b.preventDefault()}else this.utils.saveScroll(),this.paste.createPasteBox(),a(window).on("scroll.redactor-freeze",a.proxy(function(){a(window).scrollTop(this.saveBodyScroll)},this)),setTimeout(a.proxy(function(){var b=this.$pasteBox.html();this.$pasteBox.remove(),this.selection.restore(),this.utils.restoreScroll(),this.paste.insert(b),a(window).off("scroll.redactor-freeze")},this),1)}},createPasteBox:function(){this.$pasteBox=a("<div>").html("").attr("contenteditable","true").css({position:"fixed",width:0,top:0,left:"-9999px"}),this.$box.parent().append(this.$pasteBox),this.$pasteBox.focus()
},insert:function(b){b=this.core.setCallback("pasteBefore",b);var c=this.selection.getCurrent(),d=this.utils.getEditableContentType(c);"text"==d&&(this.opts.pastePlainText=!0),b=this.clean.onPaste(b),"text"==d&&(b=this.clean.replaceParagraphsToBr(b)),b=this.core.setCallback("paste",b),this.insert.html(b,!1),this.opts.pastePlainText=!1,this.rtePaste=!1,setTimeout(a.proxy(this.clean.clearUnverified,this),10),setTimeout(a.proxy(function(){var b=this.$editor.find("span");a.each(b,function(b,c){var d=c.innerHTML.replace(/[\u200B-\u200D\uFEFF]/,"");
""===d&&0===c.attributes.length&&a(c).remove()})},this),10)}}},selection:function(){return{get:function(){return this.sel=document.getSelection(),this.range=document.getSelection&&this.sel.getRangeAt&&this.sel.rangeCount?this.sel.getRangeAt(0):document.createRange(),this.sel},addRange:function(){try{this.sel.removeAllRanges()}catch(a){}this.sel.addRange(this.range)},getCurrent:function(){var a=!1;return this.selection.get(),this.sel&&this.sel.rangeCount>0&&(a=this.sel.getRangeAt(0).startContainer),this.utils.isRedactorParent(a)
},getStartNode:function(){var a=!1;return this.selection.get(),this.sel&&this.sel.rangeCount>0&&(a=this.range.startContainer,/3|4|8/.test(a.nodeType)||(a=a.childNodes[this.range.startOffset])),this.utils.isRedactorParent(a)},getEndNode:function(){var a=!1;return this.sel&&this.sel.rangeCount>0&&(a=this.range.endContainer,/3|4|8/.test(a.nodeType)||(a=a.childNodes[this.range.endOffset])),this.utils.isRedactorParent(a)},getParent:function(b){return b=b||this.selection.getCurrent(),b?this.utils.isRedactorParent(a(b).parent()[0]):!1
},getBlock:function(b){for(b=b||this.selection.getCurrent();b;){if(this.utils.isBlockTag(b.tagName))return a(b).hasClass("ebd")?!1:b;b=b.parentNode}return!1},getInlines:function(b){if(this.selection.get(),this.range&&this.range.collapsed)return!1;var c=[];b="undefined"==typeof b?this.selection.getNodes():b;var d=this.opts.inlineTags;return d.push("span"),a.each(b,a.proxy(function(b,e){-1!=a.inArray(e.tagName.toLowerCase(),d)&&c.push(e)},this)),0===c.length?!1:c},getBlocks:function(b){if(this.selection.get(),this.range&&this.range.collapsed)return[this.selection.getBlock()];
var c=[];return b="undefined"==typeof b?this.selection.getNodes():b,a.each(b,a.proxy(function(b,d){return 0==a(d).parents("div.ebd").size()?!1:(this.utils.isBlock(d)&&(this.selection.lastBlock=d,c.push(d)),void 0)},this)),0===c.length?[this.selection.getBlock()]:c},getLastBlock:function(){return this.selection.lastBlock},getNodes:function(){this.selection.get();var b=this.selection.getNodesMarker(1),c=this.selection.getNodesMarker(2);this.selection.setNodesMarker(this.range,b,!0),this.range.collapsed===!1?this.selection.setNodesMarker(this.range,c,!1):c=b;
var d=[],e=0,f=this;this.$editor.find("*").each(function(){if(this==b){var g=a(this).parent();0!==g.length&&"BODY"!=g[0].tagName&&f.utils.isRedactorParent(g[0])&&d.push(g[0]),d.push(this),e=1}else e>0&&(d.push(this),e+=1);return this==c?!1:void 0});for(var g=[],h=d.length,i=0;h>i;i++)"nodes-marker-1"!=d[i].id&&"nodes-marker-2"!=d[i].id&&g.push(d[i]);return this.selection.removeNodesMarkers(),g},getNodesInRange:function(b){function c(a){if(a.firstChild)return a.firstChild;for(;a;){if(a.nextSibling)return a.nextSibling;
a=a.parentNode}}var i,b=b||this.range,d=b.startContainer.childNodes[b.startOffset]||b.endContainer.childNodes[b.endOffset],e=b.startContainer.childNodes[b.startOffset]||b.startContainer,f=b.endContainer.childNodes[b.endOffset]||b.endContainer,g=b.commonAncestorContainer,h=[];for(i=e.parentNode;i&&(h.push(i),i!=g);i=i.parentNode);for(h.reverse(),i=e;i&&(!d||a(i.parentNode).closest(g)[0])&&(h.push(i),i!=f);i=c(i));return h},getNodesMarker:function(b){return a('<span id="nodes-marker-'+b+'" class="redactor-nodes-marker" data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]
},setNodesMarker:function(a,b,c){a=a.cloneRange();try{a.collapse(c),a.insertNode(b)}catch(d){}},removeNodesMarkers:function(){a(document).find("span.redactor-nodes-marker").remove(),this.$editor.find("span.redactor-nodes-marker").remove()},fromPoint:function(a,b){this.caret.setOffset(a,b)},wrap:function(a){if(this.selection.get(),this.range.collapsed)return!1;var b=document.createElement(a);return b.appendChild(this.range.extractContents()),this.range.insertNode(b),b},selectElement:function(a){this.caret.set(a,0,a,1)
},selectAll:function(){this.selection.get(),this.range.selectNodeContents(this.$editor[0]),this.selection.addRange()},remove:function(){this.selection.get(),this.sel.removeAllRanges()},save:function(){this.selection.createMarkers()},createMarkers:function(){this.selection.get();var a=this.selection.getMarker(1);if(this.selection.setMarker(this.range,a,!0),this.range.collapsed===!1){var b=this.selection.getMarker(2);this.selection.setMarker(this.range,b,!1)}this.savedSel=this.$editor.html()},getMarker:function(b){return"undefined"==typeof b&&(b=1),a('<span id="selection-marker-'+b+'" class="redactor-selection-marker"  data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]
},getMarkerAsHtml:function(a){return this.utils.getOuterHtml(this.selection.getMarker(a))},setMarker:function(a,b,c){a=a.cloneRange();try{a.collapse(c),a.insertNode(b)}catch(d){this.focus.setStart()}},restore:function(){var a=this.$editor.find("span#selection-marker-1"),b=this.$editor.find("span#selection-marker-2");0!==a.length&&0!==b.length?this.caret.set(a,0,b,0):0!==a.length?this.caret.set(a,0,a,0):this.$editor.focus(),this.selection.removeMarkers(),this.savedSel=!1},removeMarkers:function(){this.$editor.find("span.redactor-selection-marker").remove()
},getText:function(){return this.selection.get(),this.sel.toString()},getHtml:function(){var a="";if(this.selection.get(),this.sel.rangeCount){for(var b=document.createElement("div"),c=this.sel.rangeCount,d=0;c>d;++d)b.appendChild(this.sel.getRangeAt(d).cloneContents());a=b.innerHTML}return this.clean.onSync(a)}}},shortcuts:function(){return{init:function(b,c){return this.opts.shortcuts?(a.each(this.opts.shortcuts,a.proxy(function(c,d){for(var e=c.split(","),f=e.length,g=0;f>g;g++)"string"==typeof e[g]&&this.shortcuts.handler(b,a.trim(e[g]),a.proxy(function(){var a;
"-1"!=d.func.search(/\./)?(a=d.func.split("."),"undefined"!=typeof this[a[0]]&&this[a[0]][a[1]].apply(this,d.params)):this[d.func].apply(this,d.params)},this))},this)),void 0):(!b.ctrlKey&&!b.metaKey||66!==c&&73!==c||b.preventDefault(),!1)},handler:function(b,c,d){var e={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},f={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"};
c=c.toLowerCase().split(" ");var g=e[b.keyCode],h=String.fromCharCode(b.which).toLowerCase(),i="",j={};a.each(["alt","ctrl","meta","shift"],function(a,c){b[c+"Key"]&&g!==c&&(i+=c+"+")}),g&&(j[i+g]=!0),h&&(j[i+h]=!0,j[i+f[h]]=!0,"shift+"===i&&(j[f[h]]=!0));for(var k=0,l=c.length;l>k;k++)if(j[c[k]])return b.preventDefault(),d.apply(this,arguments)}}},tabifier:function(){return{get:function(a){if(!this.opts.tabifier)return a;var b=["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"],c=["li","dt","dt","h[1-6]","option","script"],d=["blockquote","div","dl","fieldset","form","frameset","map","ol","p","pre","select","td","th","tr","ul"];
this.tabifier.lineBefore=new RegExp("^<(/?"+b.join("|/?")+"|"+c.join("|")+")[ >]"),this.tabifier.lineAfter=new RegExp("^<(br|/?"+b.join("|/?")+"|/"+c.join("|/")+")[ >]"),this.tabifier.newLevel=new RegExp("^</?("+d.join("|")+")[ >]");var e=0,f=a.length,g=0,h=null,i=null,j="",k="",l="";for(this.tabifier.cleanlevel=0;f>e;e++){if(g=e,-1==a.substr(e).indexOf("<"))return k+=a.substr(e),this.tabifier.finish(k);for(;f>g&&"<"!=a.charAt(g);)g++;for(e!=g&&(l=a.substr(e,g-e),l.match(/^\s{2,}$/g)||("\n"==k.charAt(k.length-1)?k+=this.tabifier.getTabs():"\n"==l.charAt(0)&&(k+="\n"+this.tabifier.getTabs(),l=l.replace(/^\s+/,"")),k+=l),l.match(/\n/)&&(k+="\n"+this.tabifier.getTabs())),h=g;f>g&&">"!=a.charAt(g);)g++;
j=a.substr(h,g-h),e=g;var m;if("!--"==j.substr(1,3)){if(!j.match(/--$/)){for(;"-->"!=a.substr(g,3);)g++;g+=2,j=a.substr(h,g-h),e=g}"\n"!=k.charAt(k.length-1)&&(k+="\n"),k+=this.tabifier.getTabs(),k+=j+">\n"}else"!"==j[1]?k=this.tabifier.placeTag(j+">",k):"?"==j[1]?k+=j+">\n":(m=j.match(/^<(script|style|pre)/i))?(m[1]=m[1].toLowerCase(),j=this.tabifier.cleanTag(j),k=this.tabifier.placeTag(j,k),i=String(a.substr(e+1)).toLowerCase().indexOf("</"+m[1]),i&&(l=a.substr(e+1,i),e+=i,k+=l)):(j=this.tabifier.cleanTag(j),k=this.tabifier.placeTag(j,k))
}return this.tabifier.finish(k)},getTabs:function(){for(var a="",b=0;b<this.tabifier.cleanlevel;b++)a+="	";return a},finish:function(a){return a=a.replace(/\n\s*\n/g,"\n"),a=a.replace(/^[\s\n]*/,""),a=a.replace(/[\s\n]*$/,""),a=a.replace(/<script(.*?)>\n<\/script>/gi,"<script$1></script>"),this.tabifier.cleanlevel=0,a},cleanTag:function(a){var b="";a=a.replace(/\n/g," "),a=a.replace(/\s{2,}/g," "),a=a.replace(/^\s+|\s+$/g," ");var c="";a.match(/\/$/)&&(c="/",a=a.replace(/\/+$/,""));for(var d;d=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(a);)d[2]?b+=d[1].toLowerCase()+"="+d[2]:d[1]&&(b+=d[1].toLowerCase()),b+=" ",a=a.substr(d[0].length);
return b.replace(/\s*$/,"")+c+">"},placeTag:function(a,b){var c=a.match(this.tabifier.newLevel);return(a.match(this.tabifier.lineBefore)||c)&&(b=b.replace(/\s*$/,""),b+="\n"),c&&"/"==a.charAt(1)&&this.tabifier.cleanlevel--,"\n"==b.charAt(b.length-1)&&(b+=this.tabifier.getTabs()),c&&"/"!=a.charAt(1)&&this.tabifier.cleanlevel++,b+=a,(a.match(this.tabifier.lineAfter)||a.match(this.tabifier.newLevel))&&(b=b.replace(/ *$/,""),b+="\n"),b}}},tidy:function(){return{setupAllowed:function(){if(this.opts.allowedTags&&(this.opts.deniedTags=!1),this.opts.allowedAttr&&(this.opts.removeAttr=!1),!this.opts.linebreaks){var a=["p","section"];
this.opts.allowedTags&&this.tidy.addToAllowed(a),this.opts.deniedTags&&this.tidy.removeFromDenied(a)}},addToAllowed:function(b){for(var c=b.length,d=0;c>d;d++)-1==a.inArray(b[d],this.opts.allowedTags)&&this.opts.allowedTags.push(b[d])},removeFromDenied:function(b){for(var c=b.length,d=0;c>d;d++){var e=a.inArray(b[d],this.opts.deniedTags);-1!=e&&this.opts.deniedTags.splice(e,1)}},load:function(b,c){return this.tidy.settings={deniedTags:this.opts.deniedTags,allowedTags:this.opts.allowedTags,removeComments:this.opts.removeComments,replaceTags:this.opts.replaceTags,replaceStyles:this.opts.replaceStyles,removeDataAttr:this.opts.removeDataAttr,removeAttr:this.opts.removeAttr,allowedAttr:this.opts.allowedAttr,removeWithoutAttr:this.opts.removeWithoutAttr,removeEmpty:this.opts.removeEmpty},a.extend(this.tidy.settings,c),b=this.tidy.removeComments(b),this.tidy.$div=a("<div />").append(b),this.tidy.replaceTags(),this.tidy.replaceStyles(),this.tidy.removeTags(),this.tidy.removeAttr(),this.tidy.removeEmpty(),this.tidy.removeParagraphsInLists(),this.tidy.removeDataAttr(),this.tidy.removeWithoutAttr(),b=this.tidy.$div.html(),this.tidy.$div.remove(),b
},removeComments:function(a){return this.tidy.settings.removeComments?a.replace(/<!--[\s\S]*?-->/gi,""):a},replaceTags:function(b){if(!this.tidy.settings.replaceTags)return b;for(var c=this.tidy.settings.replaceTags.length,d=[],e=[],f=0;c>f;f++)e.push(this.tidy.settings.replaceTags[f][1]),d.push(this.tidy.settings.replaceTags[f][0]);return this.tidy.$div.find(d.join(",")).each(a.proxy(function(b,c){var d=e[b];a(c).replaceWith(function(){for(var b=a("<"+d+" />").append(a(this).contents()),c=0;c<this.attributes.length;c++)b.attr(this.attributes[c].name,this.attributes[c].value);
return b})},this)),b},replaceStyles:function(){if(this.tidy.settings.replaceStyles){var b=this.tidy.settings.replaceStyles.length;this.tidy.$div.find("span").each(a.proxy(function(c,d){for(var e=a(d),f=e.attr("style"),g=0;b>g;g++)if(f&&f.match(new RegExp("^"+this.tidy.settings.replaceStyles[g][0],"i"))){var h=this.tidy.settings.replaceStyles[g][1];e.replaceWith(function(){var b=document.createElement(h);return a(b).append(a(this).contents())})}},this))}},removeTags:function(){!this.tidy.settings.deniedTags&&this.tidy.settings.allowedTags&&this.tidy.$div.find("*").not(this.tidy.settings.allowedTags.join(",")).each(function(b,c){""===c.innerHTML?a(c).remove():a(c).contents().unwrap()
}),this.tidy.settings.deniedTags&&this.tidy.$div.find(this.tidy.settings.deniedTags.join(",")).each(function(b,c){""===c.innerHTML?a(c).remove():a(c).contents().unwrap()})},removeAttr:function(){var b;if(!this.tidy.settings.removeAttr&&this.tidy.settings.allowedAttr){var c=[],d=[];b=this.tidy.settings.allowedAttr.length;for(var e=0;b>e;e++)c.push(this.tidy.settings.allowedAttr[e][0]),d.push(this.tidy.settings.allowedAttr[e][1]);this.tidy.$div.find("*").each(a.proxy(function(b,e){var f=a(e),g=a.inArray(f[0].tagName.toLowerCase(),c),h=this.tidy.removeAttrGetRemoves(g,d,f);
h&&a.each(h,function(a,b){f.removeAttr(b)})},this))}if(this.tidy.settings.removeAttr){b=this.tidy.settings.removeAttr.length;for(var e=0;b>e;e++){var f=this.tidy.settings.removeAttr[e][1];a.isArray(f)&&(f=f.join(" ")),this.tidy.$div.find(this.tidy.settings.removeAttr[e][0]).removeAttr(f)}}},removeAttrGetRemoves:function(b,c,d){var e=[];return-1==b?a.each(d[0].attributes,function(a,b){e.push(b.name)}):"*"==c[b]?e=[]:a.each(d[0].attributes,function(d,f){a.isArray(c[b])?-1==a.inArray(f.name,c[b])&&e.push(f.name):c[b]!=f.name&&e.push(f.name)
}),e},removeAttrs:function(b,c){return c=new RegExp(c,"g"),b.each(function(){for(var b=a(this),d=this.attributes.length-1,e=d;e>=0;e--){var f=this.attributes[e];f&&f.specified&&f.name.search(c)>=0&&b.removeAttr(f.name)}})},removeEmpty:function(){this.tidy.settings.removeEmpty&&this.tidy.$div.find(this.tidy.settings.removeEmpty.join(",")).each(function(){var b=a(this),c=b.text();c=c.replace(/[\u200B-\u200D\uFEFF]/g,""),c=c.replace(/&nbsp;/gi,""),c=c.replace(/\s/g,""),""===c&&0===b.children().length&&b.remove()
})},removeParagraphsInLists:function(){this.tidy.$div.find("li p").contents().unwrap()},removeDataAttr:function(){if(this.tidy.settings.removeDataAttr){var b=this.tidy.settings.removeDataAttr;a.isArray(this.tidy.settings.removeDataAttr)&&(b=this.tidy.settings.removeDataAttr.join(",")),this.tidy.removeAttrs(this.tidy.$div.find(b),"^(data-)")}},removeWithoutAttr:function(){this.tidy.settings.removeWithoutAttr&&this.tidy.$div.find(this.tidy.settings.removeWithoutAttr.join(",")).each(function(){0===this.attributes.length&&a(this).contents().unwrap()
})}}},utils:function(){return{isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isString:function(a){return"[object String]"==Object.prototype.toString.call(a)},isEmpty:function(b,c){return b=b.replace(/[\u200B-\u200D\uFEFF]/g,""),b=b.replace(/&nbsp;/gi,""),b=b.replace(/<\/?br\s?\/?>/g,""),b=b.replace(/\s/g,""),b=b.replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,""),b=b.replace(/<iframe(.*?[^>])>$/i,"iframe"),c!==!1&&(b=b.replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),b=b.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")),b=a.trim(b),""===b
},normalize:function(a){return"undefined"==typeof a?0:parseInt(a.replace("px",""),10)},hexToRgb:function(a){if("undefined"!=typeof a){if(-1==a.search(/^#/))return a;var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return"rgb("+parseInt(c[1],16)+", "+parseInt(c[2],16)+", "+parseInt(c[3],16)+")"}},getOuterHtml:function(b){return a("<div>").append(a(b).eq(0).clone()).html()},getAlignmentElement:function(b){return-1!==a.inArray(b.tagName,this.opts.alignmentTags)?a(b):a(b).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0])
},removeEmptyAttr:function(b,c){var d=a(b);return"undefined"==typeof d.attr(c)?!0:""===d.attr(c)?(d.removeAttr(c),!0):!1},removeEmpty:function(b,c){var d=a(c);if(d.find(".redactor-invisible-space").removeAttr("style").removeAttr("class"),0===d.find("hr, br, img, iframe").length){var e=a.trim(d.text());this.utils.isEmpty(e,!1)&&d.remove()}},saveScroll:function(){this.saveEditorScroll=this.$editor.scrollTop(),this.saveBodyScroll=a(window).scrollTop(),this.opts.scrollTarget&&(this.saveTargetScroll=a(this.opts.scrollTarget).scrollTop())
},restoreScroll:function(){("undefined"!=typeof this.saveScroll||"undefined"!=typeof this.saveBodyScroll)&&(a(window).scrollTop(this.saveBodyScroll),this.$editor.scrollTop(this.saveEditorScroll),this.opts.scrollTarget&&a(this.opts.scrollTarget).scrollTop(this.saveTargetScroll))},createSpaceElement:function(){var a=document.createElement("span");return a.className="redactor-invisible-space",a.innerHTML=this.opts.invisibleSpace,a},removeInlineTags:function(b){var c=this.opts.inlineTags;c.push("span"),"PRE"==b.tagName&&c.push("a"),a(b).find(c.join(",")).not("span.redactor-selection-marker").contents().unwrap()
},replaceWithContents:function(b,c){var d=this;a(b).replaceWith(function(){return c===!0&&d.utils.removeInlineTags(this),a(this).contents()})},replaceToTag:function(b,c,d){var e,f=this;return a(b).replaceWith(function(){e=a("<"+c+" />").append(a(this).contents());for(var b=0;b<this.attributes.length;b++)e.attr(this.attributes[b].name,this.attributes[b].value);return d===!0&&f.utils.removeInlineTags(e),e}),e},isStartOfElement:function(){var a=this.selection.getBlock();if(!a)return!1;var b=this.caret.getOffsetOfElement(a);
return 0===b?!0:!1},isEndOfElement:function(){var b=this.selection.getBlock();if(!b)return!1;var c=this.caret.getOffsetOfElement(b),d=a.trim(a(b).text()).replace(/\n\r\n/g,"");return c==d.length?!0:!1},isBlock:function(a){return a=a[0]||a,a&&this.utils.isBlockTag(a.tagName)},isBlockTag:function(a){return"undefined"==typeof a?!1:this.reIsBlock.test(a)},isTag:function(b,c){var d=a(b).closest(c);return 1==d.size()?d[0]:!1},isRedactorParent:function(b){return b?0===a(b).parents(".ebd").length||a(b).hasClass("ebd")?!1:b:!1
},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(b){var c=this.selection.getParent(),d=this.selection.getCurrent();if(a.isArray(b)){var e=0;return a.each(b,a.proxy(function(a,b){this.utils.isCurrentOrParentOne(d,c,b)&&e++},this)),0===e?!1:!0}return this.utils.isCurrentOrParentOne(d,c,b)},isCurrentOrParentOne:function(a,b,c){return c=c.toUpperCase(),b&&b.tagName===c?b:a&&a.tagName===c?a:!1},isOldIe:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<9?!0:!1
},isLessIe10:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<10?!0:!1},isIe11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},browser:function(a){var b=navigator.userAgent.toLowerCase(),c=/(opr)[\/]([\w.]+)/.exec(b)||/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||b.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(b)||b.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[];
return"version"==a?c[2]:"webkit"==a?"chrome"==c[1]||"webkit"==c[1]:"rv"==c[1]?"msie"==a:"opr"==c[1]?"webkit"==a:a==c[1]},getEditableContainer:function(b){var c=a(b).parentsUntil(this.$editor).andSelf().closest("[contenteditable=true]")[0];return this.utils.isRedactorParent(c)},isEditableContent:function(a){return!!this.utils.getEditableContainer(a)},getEditableContentType:function(b){var c=this.utils.getEditableContainer(b),d=a(c).attr("data-content-type");return"html"==d?"html":"text"==d?"text":"text"}}}},d.prototype.init.prototype=d.prototype,b.resolve()
}),EasyBlog.module("composer/location",function(a){var b=this;EasyBlog.Controller("Composer.Location",{elements:["[data-eb-composer-location-{remove-button|label|textfield|places|autocomplete|form|map|form-message|detect-button}]",".eb-composer-{field}-location"],defaultOptions:{foursquare:{client_id:null,client_secret:null,v:"20140905",m:"foursquare",intent:"browse",radius:800},geomode:"native",searchmode:"detect","{container}":"[data-eb-composer-location]","{place}":"[data-eb-composer-location-places] li","{addLocationButton}":".eb-document-add-location-button"}},function(b,c,d,e,f){return{init:function(){d=b.container(),navigator.geolocation||(c.geomode="external"),b.setupAutocomplete()
},setupAutocomplete:function(){e=b.autocomplete().detach(),f=e.find(b.places),textfield=b.textfield(),a(document).on("click",function(b){var c=a(b.target).parents().andSelf();c.filter(textfield).length<1&&e.detach()})},searching:function(a){b.form().toggleClass("is-searching",a);var c=b.textfield();c.attr("placeholder",a?c.data("placeholder-searching"):c.data("placeholder"))},userCoords:null,getUserCoords:function(){var d=a.Deferred(),e=b.userCoords;return e?(d.resolve(e),d):("native"==c.geomode?navigator.geolocation.getCurrentPosition(function(a){var b=a.coords;
d.resolve({latitude:b.latitude,longitude:b.longitude})},function(){b.getUserCoordsByIP().done(d.resolve).fail(d.reject)}):d=b.getUserCoordsByIP(),d.done(function(a){b.userCoords=a}))},getUserCoordsByIP:function(){a.getJSON("//www.telize.com/geoip?callback=?").then(function(a){return{latitude:a.latitude,longitude:a.longitude}})},search:function(a){var c=b.getUserCoords().then(function(c){b.searching(!0);var d=EasyBlog.ajax("site/views/composer/getLocations",{latitude:c.latitude,longitude:c.longitude,query:a||""});
return d}).fail(function(c){b.container().addClass("has-errors"),b.formMessage().html(c),b.search.reset(a)}).always(function(){b.searching(!1)});return c},searchManual:a.memoize(function(c){var d=a.Deferred();b.searching(!0);var e=EasyBlog.ajax("site/views/composer/getLocations",{query:c}).done(function(){d.resolve()}).always(function(){b.searching(!1)});return e}),populate:function(){var c=b.textfield(),d=a.trim(c.val()),e=b.searchmode;if("detect"==e)b.search(d).done(a.debounce(function(c){var d=[];a.each(c,function(b,c){var e=a.create("li").html("<strong>"+c.name+"</strong><small>"+c.address+"</small>").data("venue",c)[0];
d.push(e)}),f.empty().append(d),b.reposition()},50)).fail(function(){});else{if(""==d)return;b.searchManual(d).done(a.debounce(function(c){var d=[];a.each(c,function(b,c){var e=a.create("li").html("<strong>"+c.name+"</strong><small>"+c.address+"</small>").data("venue",c)[0];d.push(e)}),f.empty().append(d),b.reposition()},100)).fail(function(){})}},_populate:a.debounce(function(){b.populate()},350),show:function(){b.composer.document.artboard.show("location")},hide:function(){b.composer.document.artboard.hide("location")
},reposition:function(){var a=b.textfield();e.appendTo(b.composer.document.artboard.container()).css({width:a.outerWidth()}).position({my:"left top",at:"left bottom",of:a})},currentLocation:null,setLocation:function(c){b.currentLocation=c;var e=b.field();e.addClass("has-location"),e.find("[name=address]").val(c.name),e.find("[name=latitude]").val(c.latitude),e.find("[name=longitude]").val(c.longitude),b.label().html(c.name),b.addLocationButton().addClass("has-location"),d.addClass("has-location is-loading has-art");
var f=b.map(),g=c.latitude+","+c.longitude,h=a.param({size:"1280x1280",sensor:!0,scale:2,zoom:15}),i="//maps.googleapis.com/maps/api/staticmap?"+h+"&center="+g+"&markers="+g;a.Image.get(i).done(function(){f.css("backgroundImage",a.cssUrl(i)),setTimeout(function(){f.addClass("is-ready")},1)}).always(function(){d.removeClass("is-loading")})},removeLocation:function(){var a=b.map();a.removeClass("is-ready"),d.removeClass("has-location has-art"),b.addLocationButton().removeClass("has-location");var c=b.field();c.removeClass("has-location"),c.find("[name=address]").val(""),c.find("[name=latitude]").val(""),c.find("[name=longitude]").val(""),b.label().html("")
},"{window} resize":function(){e.parent().length<1||b.reposition()},"{label} click":function(){b[b.field().hasClass("active")?"hide":"show"]()},"{self} composerArtboardShow":function(a,c,d){b.field().toggleClass("active","location"==d)},"{self} composerArtboardHide":function(){b.field().removeClass("active")},"{textfield} input":function(){b.searchmode="manual",e.detach(),b._populate()},"{detectButton} click":function(){b.textfield().val(""),b.searchmode="detect",e.detach(),b.populate()},"{place} click":function(a){var c=a.data("venue");
b.setLocation(c)},"{removeButton} click":function(){b.removeLocation()}}}),b.resolve()}),EasyBlog.module("composer/media",function(){var b=this;EasyBlog.require().script("mediamanager").done(function(){EasyBlog.Controller("Composer.Media",{defaultOptions:{}},function(a,b,c,d){return{init:function(){d=a.composer}}}),b.resolve()})}),EasyBlog.module("mediamanager",function(a){var b=this,c="is-searching",d="is-search-result",e="has-search-results",f="is-notfound";EasyBlog.require().library("pageslide","plupload2","ui/draggable").script("mediamanager/uploader").done(function(){var g=EasyBlog.Controller("MediaManager",{hostname:"mediaManager",pluginExtendsInstance:!0,elements:["[data-eb-mm-{frame|close-button}]","[data-eb-mm-{pages|places|place|hints}]","[data-eb-mm-{folder|filegroup|filelist}]","[data-eb-mm-{folder-back-button|folder-upload-button|folder-upload-dropzone}]","[data-eb-mm-{file|filegroup|filegroup-header|file-title}]","[data-eb-mm-{info-viewport|info-container|info|info-back-button|info-filename}]","^media [data-eb-mm-{workarea|document}]","[data-eb-mm-{show-new-files-button|show-all-files-button}]","[data-eb-mm-{search-panel|search-input|search-toggle-button}]","[data-eb-mm-{upload-thumbnail|upload-name-upload-size}]","[data-eb-mm-{folder-upload-current-file|folder-upload-stat|folder-upload-completed|folder-upload-total|folder-upload-progress-bar}]","[data-eb-mm-{new-file-count}]","[data-eb-mm-{filegroup-show-all-button}]","[data-eb-mm-{file-remove-button|file-insert-button|file-rename-button|file-move-button}]","[data-eb-mm-{folder-content-panel}]","[data-eb-mm-{foldertree|tree|tree-item}]","[data-eb-mm-{show-move-dialog-button|move-filename}]","[data-eb-mm-{folder-rename-button|folder-move-button|folder-remove-button}]","[data-eb-mm-{open-button}]","[data-eb-mm-{upload-template}]","[data-eb-mm-{folder-title}]","[data-eb-mm-{browse-button}]","[data-eb-mm-{selecting-cancel}]","[data-eb-mm-{go-to-folder|close-message-button}]","[data-eb-mm-{insert-gallery}]","[data-eb-mm-{pagination-previous|pagination-next|pagination-current|pagination-total}]"],defaultOptions:{types:{image:["jpg","jpeg","png","gif"],video:["3gp","m4v","mp4","flv","wmv","mp3","webm","swf"],audio:["mp3","m4a","aac","ogg"]},templates:{},"{thumbnail}":"[data-eb-mm-file].type-image i[data-thumbnail]","{flickrButton}":"[data-flickr-login]","{createFolder}":"[data-eb-mm-create-folder]"}},function(b,g,h,i){return{init:function(){g.templates.upload=b.uploadTemplate().detach().html(),a.each(g.types,function(a,c){for(var e,d=0;e=c[d++];)b.types[e]=a
}),b.addPlugin("uploader"),b.places.node=b.places()[0],b.hints.node=b.hints().detach()[0],window.ebmm=b,EasyBlog.MediaManager=b},"{self} composerReady":function(){i=EasyBlog.Composer},types:{"":"file"},getExtension:function(a){var a=b.getUri(a),c=a.lastIndexOf(".");return c>-1?a.slice(c+1).toLowerCase():""},getType:function(a){return b.types[b.getExtension(a)]||"file"},getKey:function(b){return"_"==b.substring(0,1)?b:"_"+a.moxie.btoa(b).replace(/\+/g,".").replace(/\=/g,"-").replace(/\//g,"~")},getUri:function(b){if(b instanceof a){var c=b;
b=c.data("key")||""}return"_"!==b.substring(0,1)?b:a.moxie.atob(b.slice(1).replace(/\./g,"+").replace(/\-/g,"="))},getParent:function(a){var a=b.getUri(a),c=a.lastIndexOf("/");return c>-1?a.slice(0,c):null},getFilename:function(a){var a=b.getUri(a),c=a.lastIndexOf("/");return c>-1?a.slice(c+1):a},isRoot:function(a){return b.getUri(a).indexOf("/")<0},getCurrentPostUri:function(){return"post:"+EasyBlog.Composer.getPostId()},medias:{},mediaLoaders:{},getMedia:function(a){var c=b.getKey(a),d=b.mediaLoaders[a];return d||(d=EasyBlog.ajax("site/views/mediamanager/media",{key:c}).done(function(a){var c=a.uri;
b.setMedia(c,a)})),d},setMedia:function(c,d){b.medias[c]=d,b.mediaLoaders[c]=a.Deferred().resolve(d)},getVariations:function(a){var c=b.medias[a];if(c)return c.meta.variations||{}},getVariation:function(c,d){if(a.isString(d)){var e=d;switch(e){case"icon":d=["system/icon","system/small","system/small 320","system/thumbnail","system/original"];break;case"small":d=["system/small","system/small 320","system/thumbnail","system/original"];break;case"medium":d=["system/medium","system/large","system/original"];break;
case"thumbnail":d=["system/thumbnail","system/original"];break;case"large":d=["system/large","system/original"];break;case"original":d=["system/original"];break;default:d=[e,"system/original"]}}var g,f=b.getVariations(c);return a.each(d,function(b,c){return a.has(f,c)?(g=f[c],!1):void 0}),g},createVariation:function(a,c,d,e){var f=b.getKey(a),g=EasyBlog.ajax("site/views/mediamanager/createVariation",{key:f,name:c,width:d,height:e}).done(function(c){b.setMedia(a,c)});return g},removeVariation:function(a,c){var d=b.getKey(a),e=EasyBlog.ajax("site/views/mediamanager/deleteVariation",{key:d,name:c}).done(function(c){b.setMedia(a,c)
});return e},mode:"standard",currentFilterType:"all",currentBrowseButton:null,currentFolderUri:null,closeMediaManager:function(){i.views.hide("media"),i.frame().removeClass("layout-media"),b.currentFilterType="all",b.mode="standard",b.currentBrowseButton=null,b.frame().removeClass("is-selecting"),b.frame().switchClass("filter-"+b.currentFilterType)},openMediaManager:function(a,c){i.views.show("media"),c&&(b.currentFilterType=c),a&&b.navigate(a)},currentUri:"places",places:{node:null},"{place} click":function(a){var c=a.data("id"),d=a.data("key"),e=b.getUri(d);
"post"==c&&(e=b.getCurrentPostUri()),b.navigate(e)},open:function(a){b.navigate(a)},navigate:function(c){var d=b.currentUri;if(d!==c){var e,f=0===d.indexOf(c)?"prev":"next",g=/post(s)*|user(s)*/.test(d)?d:null;switch(c){case"places":e=b.places.node,f="prev";break;case"posts":e=b.getHint("loading"),/post\:(.*)/.test(g)&&(f="prev"),EasyBlog.ajax("site/views/mediamanager/posts",{}).done(function(a){e.replaceWith(a)});break;case"users":e=b.getHint("loading"),/user\:(.*)/.test(g)&&(f="prev"),EasyBlog.ajax("site/views/mediamanager/users",{}).done(function(a){e.replaceWith(a)
});break;case"Flickr":case"flickr":e=b.getHint("loading"),EasyBlog.ajax("site/views/mediamanager/flickr",{}).done(function(a){e.replaceWith(a),b.revealThumbnails()});break;case"easysocial":case"jomsocial":e=b.getHint("loading"),EasyBlog.ajax("site/views/mediamanager/folder",{key:b.getKey(c)}).done(function(a){e.replaceWith(a);var d=b.getFolder(c);b.trigger("mediaFolderDisplay",[d])});break;default:var e=b.getFolder(c);e.length<1?(e=b.getHint("loading"),contentNode=e[0],b.loadFolder(c).done(function(c){a(contentNode).replaceWith(c),b.revealThumbnails(),g&&c.data("referer",g)
})):b.refreshFolder(e)}e&&(b.currentUri=c,b.display(e,f),b.trigger("mediaNavigate",[c,d,e]))}},display:function(a,c){b.pages().pageslide(a,c),b.destroyInfo()},"{folderBackButton} click":function(a){var c=b.folder.of(a),d=b.getUri(c.data("key")),e=c.data("referer");c.removeClass("folder-moved").removeClass("file-moved"),targetUri=e?e:b.isRoot(d)?"places":b.getParent(d),b.navigate(targetUri)},"{infoBackButton} click":function(a){var c=b.info.of(a),d=b.getUri(c.data("key")),e=b.getParent(d);b.destroyInfo(),b.navigate(e)
},hints:{node:null},getHint:function(c){var d=a(b.hints.node).find(".hint-"+c).clone();return("loading"==c||"error"==c)&&b.folderBackButton.inside(d).attr("data-key",b.getKey(b.currentUri)),d},getUploadTemplate:function(b){var c=a(g.templates.upload);return c.attr("data-id",b.id),c.find("[data-eb-mm-upload-name]").html(b.name),c[0]},folder:{nodes:{},get:function(a){var a=b.getKey(a),c=b.folder.selector+"[data-key='"+a+"']",d=h.find(c);return d},insert:function(a,c){a.removeClass("is-empty").find(".eb-mm-filegroup.type-folder").removeClass("is-empty"),b.getFilelist(a,"folder").prepend(c)
}},getCurrentFolder:function(){},getFolder:function(c){return a(b.folder.nodes[c])},setFolder:function(a,c){b.folder.nodes[a]=c[0]},folderLoaders:{},loadFolder:function(c){var d=b.getMedia(c).then(function(d){var e=a(d.folder).filter(b.folder.selector);return b.setFolder(c,e),b.initFolder(e),e});return b.folderLoaders[c]=d,d},initFolder:function(c){var d=b.getUri(c),e=a.Script(function(){c.data("inited")||(c.hasClass("can-upload")&&b.uploader.register(c),c.data("inited",!0),b.trigger("mediaFolderInit",[d,c]),b.refreshFolder(c))
});c.append(e)},renameFolder:function(c,d){EasyBlog.ajax("site/views/mediamanager/rename",{key:c,filename:d}).done(function(d,e,f){var g=b.folder.get(c),h=a(f);b.initFolder(h),g.replaceWith(h);var i=b.getUri(h);b.currentUri=i;var j=b.getParent(i),k=b.getFolder(j),l=k.find(b.file.getSelector(c));l.replaceWith(d)}).fail(function(){})},refreshFolder:function(a){b.syncUploadItems(a),b.trigger("mediaFolderRefresh",[a])},uploadItems:{},createUploadItem:function(c){var d=b.getUploadTemplate(c);if(b.uploadItems[c.id]=d,c.type.match("image")){var e=new a.moxie.Image;
e.onload=function(){e.downsize(100),b.uploadThumbnail.inside(d).css("backgroundImage",a.cssUrl(e.getAsDataURL()))},e.load(c.getSource())}return b.uploader.addItem(c,d),d},addUploadItem:function(a,c){var d=b.uploadItems[c.id]||b.createUploadItem(c),e=b.getType(c.name);b.getFilelist(a,e).prepend(d),b.filegroup.inside(a).filter(".type-"+e).addClass("has-new-files")},syncUploadItems:function(a){for(var f,h,c=a.data("uri"),d=b.uploader.getFiles(c),e={image:[],video:[],audio:[],file:[]},g=0;file=d[g++];)f=b.uploadItems[file.id],f||(f=b.createUploadItem(file)),h=b.getType(file.name),i[h].push(f);
for(h in e){var i=e[h],j=i.length<1,k=b.getFilelist(a,h).toggleClass("is-uploading",!j);j||k.prepend(i)}},"{selectingCancel} click":function(){b.closeMediaManager()},"{browseButton} click":function(a){var d=a.data("eb-mm-filter"),e=a.data("eb-mm-start-uri"),f=b.getUri(e),g=a.data("eb-mm-browse-place"),h=a.data("eb-mm-browse-type");"post"==f&&(f=b.getCurrentPostUri()),b.mode="select",b.currentBrowseType=h,b.currentBrowseButton=a,b.currentBrowseButton.trigger("mediaSelectStart",[b.currentBrowseButton]),b.openMediaManager(f,d),b.frame().switchClass("filter-"+b.currentFilterType),b.frame().addClass("is-selecting"),"local"==g?b.frame().addClass("show-local"):b.frame().removeClass("show-local")
},"{self} mediaUploaderFileFiltered":function(a,c,d,e){var f=d.uri,g=b.getFolder(f);g.length<1||(g.addClass("is-uploading"),g.removeClass("is-empty").find(".eb-mm-filegroup").removeClass("is-empty"),f==b.currentUri&&b.addUploadItem(g,e))},"{self} mediaUploaderFileUploaded":function(c,d,e,f,g){var h=g.response,i=h.media;b.setMedia(i.uri,i),setTimeout(function(){var c=b.uploadItems[f.id];if(c){var d=a(i.file).addClass("is-new");a(c).replaceWith(d)}},600)},"{self} mediaUploaderUploadComplete":function(){},"{self} mediaUploaderChange":function(c,d,e){var j,f=a.plupload2,g=e.uri,h=b.getFolder(g),i=b.uploader.getFiles(g),k=0,l=0,m=0;
a.each(i,function(a,b){b.finalized||b.status==f.FAILED||(b.status==f.UPLOADING&&(j=b),b.status==f.DONE&&k++,m+=b.percent,l++)}),l>0&&l!==k?(h.addClass("is-uploading"),j&&b.folderUploadCurrentFile().html(j.name),b.folderUploadTotal().html(l),b.folderUploadCompleted().html(k),b.folderUploadProgressBar().width(m/(100*l)*100+"%")):(h.removeClass("is-uploading"),a.each(i,function(a,b){b.finalized=!0})),b.newFileCount().html(b.file(".is-new").length)},getFilelist:function(a,c){var d=b.filegroup.inside(a).filter(".type-"+c).find(b.filelist);
return d},file:{active:a(),get:function(a){var a=b.getKey(a),c=b.file.getSelector(a);return h.find(c)},getSelector:function(a){return b.file.selector+"[data-key='"+a+"']"},activate:function(a){b.file.deactivate(),b.file.active=a.addClass("active")},deactivate:function(){b.file.active.removeClass("active")},rename:function(a,c){EasyBlog.ajax("site/views/mediamanager/rename",{key:a,filename:c}).done(function(c,d){b.file.get(a).replaceWith(c),b.info.get(a).replaceWith(d)}).fail(function(){})}},"{file} click":function(a){var c=a.data("key"),d=b.getUri(c);
if(b.file.activate(a),a.hasClass("type-folder"))return b.navigate(d),void 0;b.folder.of(a);b.showInfo(d)},"{filegroupHeader} click":function(a){var c=b.filegroup.of(a);c[c.hasClass("is-collapsed")?"removeTransitionClass":"addTransitionClass"]("is-collapsed",500)},"{showNewFilesButton} click":function(a){b.folder.of(a).addClass("filter-new")},"{showAllFilesButton} click":function(a){b.folder.of(a).removeClass("filter-new")},info:{get:function(a){var c=b.getKey(a);return b.info().where("key",c)}},showInfo:function(c){b.destroyInfo(),b.trigger("mediaInfoShow",[c]);
var d=b.getHint("loading"),e=b.getParent(c),f=b.getKey(e);b.folderBackButton.inside(d).attr("data-key",f),b.pages().pageslide(d,"next"),b.currentUri=c,b.getMedia(c).done(function(c){var e=a(c.info);d.replaceWith(e),"cover"!=b.currentBrowseType&&b.trigger("mediaInfoDisplay",[e,c])}).fail(function(){var a=b.getHint("error");d.replaceWith(a)})},destroyInfo:function(){var a=b.info(),c=a.data("uri");if(b.trigger("mediaInfoHide",[c]),c){var d=b.medias[c];b.trigger("mediaInfoDestroy",[a,d])}},"{flickrButton} click":function(a){var c=a.data("url"),e=(b.folder.of(a),960),f=650,g=screen.width/2-e/2,h=screen.height/2-f/2;
window.doneLogin=function(){var a=b.getHint("loading");b.display(a,"next"),EasyBlog.ajax("site/views/mediamanager/flickr").done(function(a){b.display(a,"next")})},window.open(c,"","scrollbars=no,resizable=no, width="+e+",height="+f+",left="+g+",top="+h)},toggleSearch:function(a){a.hasClass(c)?b.deactivateSearch(a):b.activateSearch(a)},activateSearch:function(a){a.addClass(c),b.searchInput.inside(a).val("").focus()},deactivateSearch:function(a){a.removeClass(c),b.resetSearch(a)},resetSearch:function(a){b.searchInput.inside(a).val(""),b.search(a,"")
},search:function(c,g){var g=g.toUpperCase(),h=""!==g;c.removeClass(f).toggleClass(e,h);var i=b.filegroup.inside(c),j=b.file.inside(c);if(!h)return j.removeClass(d),i.removeClass(e),void 0;var k={},l=0;j.each(function(){var b=a(this),c=b.text().toUpperCase().indexOf(g)>=0;c&&(k[b.data("type")]=!0,l++),b.toggleClass(d,c)}),a.each(k,function(a){i.filter(".type-"+a).addClass(e)}),c.toggleClass(f,1>l)},"{searchToggleButton} click":function(a){var c=b.folder.of(a);b.toggleSearch(c)},"{searchInput} keyup":function(a,c){if(27===c.keyCode){var d=b.folder.of(a),e=a.val();
""==e?b.deactivateSearch(d):b.resetSearch(d)}},"{searchInput} input":a.debounce(function(c){var d=b.folder.of(c),e=a.trim(c.val()).toUpperCase();b.search(d,e)},150),"{createFolder} click":function(a){var c=b.folder.of(a),d=b.getKey(b.currentUri);EasyBlog.dialog({content:EasyBlog.ajax("site/views/mediamanager/createFolderDialog"),bindings:{"{submitButton} click":function(){EasyBlog.ajax("site/views/mediamanager/createFolder",{key:d,folder:this.folderName().val()}).done(function(a){b.folder.insert(c,a),EasyBlog.dialog().close()
})}}})},"{self} mediaFolderDisplay":function(){},"{self} mediaRemove":function(a,c,d){var e=b.getKey(d);b.file().where("key",e).remove(),b.infoViewport().removeClass("active");var f=b.getParent(d),g=b.getFolder(f),h=g.find("[data-eb-mm-file][data-key='"+e+"']");h.remove(),setTimeout(function(){b.info().where("key",e).detach()},500)},"{filegroupShowAllButton} click":function(a){b.filegroup.of(a).addClass("show-all"),b.revealThumbnails()},revealThumbnails:function(){var c=b.folderContentPanel();if(!(c.length<1)){{var d=c.offset().top;
d+c.height()}b.thumbnail.inside(c).each(function(){var b=a(this);if(!b.is(":hidden")){{var c=b.offset().top;c+b.height()}return b.css("backgroundImage",a.cssUrl(b.data("thumbnail"))).removeAttr("data-thumbnail"),!0}})}},"{pages} pageslidestop":function(){b.revealThumbnails()},"{folderContentPanel} scrolly":a.debounce(function(){b.revealThumbnails()},150),"{fileInsertButton} click":function(a){var c=b.info.of(a),d=c.data("key"),e=b.getUri(d),f=b.mediaDocument(),g=f.find(EBD.standaloneBlock);b.pauseVideoObject(),b.getMedia(e).done(function(a){"select"==b.mode?(b.currentBrowseButton.trigger("mediaSelect",[a]),i.blocks.panel.fieldgroup.hide()):b.trigger("mediaInsert",[a,g]),b.closeMediaManager()
}).fail(function(){}).always(function(){})},"{fileRemoveButton} click":function(a){var c=b.info.of(a),d=c.data("key"),e=b.getUri(d);b.getMedia(e).done(function(a){EasyBlog.dialog({content:EasyBlog.ajax("site/views/mediamanager/deleteFileDialog",{file:a.title}),bindings:{"{submitButton} click":function(){EasyBlog.ajax("site/views/mediamanager/delete",{key:d}).done(function(){EasyBlog.dialog().close(),b.removeMedia(e);var a=b.getParent(e);b.navigate(a)}).fail(function(){})}}})})},"{fileRenameButton} click":function(c){var d=b.info.of(c),e=d.data("key"),f=a.trim(b.infoFilename.inside(d).text());
EasyBlog.dialog({content:EasyBlog.ajax("site/views/mediamanager/renameFileDialog",{current:f}),bindings:{"{submitButton} click":function(){var c=this.fileName().val();""!=a.trim(c)&&b.file.rename(e,c)}}})},"{fileMoveButton} click":function(c){var d=b.treeItem(".active");if(!(d.length<1)){var e=c.data("key"),f=b.getUri(e),g=d.data("key"),h=b.getUri(g),i=b.getParent(f),j=b.getFolder(i);EasyBlog.dialog({content:EasyBlog.ajax("site/views/mediamanager/confirmMoveItem",{source:e,target:g}),bindings:{"{submitButton} click":function(){EasyBlog.ajax("site/views/mediamanager/move",{source:e,target:g}).done(function(c){b.removeMedia(e),b.refreshMedia(h),EasyBlog.dialog().close();
var f=a(c),g=f.data("type");"folder"==g?(j.addClass("folder-moved"),b.frame().removeClass("show-foldermove-message show-filemove-message has-messages").addClass("show-foldermove-message")):(j.addClass("file-moved"),b.frame().removeClass("show-foldermove-message show-filemove-message has-messages").addClass("show-filemove-message")),b.goToFolder().on("click",function(){j.removeClass("folder-moved").removeClass("file-moved"),b.navigate(h)}),b.navigate(i)}).fail(function(){alert("Unable to move file.")})}}})}},refreshMedia:function(a){a=b.getUri(a),delete b.medias[a],delete b.mediaLoaders[a],delete b.folderLoaders[a],delete b.folder.nodes[a]
},removeMedia:function(a){a=b.getUri(a),b.refreshMedia(a),b.trigger("mediaRemove",[a])},"{showMoveDialogButton} click":function(a){var c=b.getHint("move"),d=b.info.of(a),e=b.folder.of(a),g=(e.data("key"),d.data("key")),h=b.getUri(g),i=b.infoFilename.inside(d).text(),j=b.getParent(h),k=b.getKey(j);b.openButton.inside(c).attr("data-key",k),b.moveFilename.inside(c).html(i),b.fileMoveButton.inside(c).attr("data-key",g),b.pages().pageslide(c,"next"),b.destroyInfo(),b.currentUri=h+"/?move"},"{treeItem} click":function(a,c){if(c.stopPropagation(),b.treeItem().removeClass("active"),a.addClass("active").toggleClass("is-expanded"),a.hasClass("is-expanded")&&!a.data("childTree")){a.addClass("is-loading");
var d=a.data("key"),e=b.getUri(d);"post"==e&&(e=b.getCurrentPostUri(),d=b.getKey(e),a.attr("data-key",d)),EasyBlog.ajax("site/views/mediamanager/tree",{key:d}).done(function(b){a.append(b).data("childTree",b)}).fail(function(){}).always(function(){a.removeClass("is-loading")})}},"{openButton} click":function(a){var c=a.data("key"),d=b.getUri(c);b.navigate(d)},"{insertGallery} click":function(a){var c=b.folder.of(a),d=c.data("key"),e=b.getUri(d),f=EasyBlog.Composer,g={uri:e},h="[embed=gallery]"+JSON.stringify(g)+"[/embed]";
f.document.insertContent(h),b.closeMediaManager()},"{folderMoveButton} click":function(a){var c=b.getHint("move"),d=b.folder.of(a),e=d.data("key"),f=b.getUri(e),g=b.getFilename(e);b.openButton.inside(c).attr("data-key",e),b.moveFilename.inside(c).html(g),b.fileMoveButton.inside(c).attr("data-key",e),b.pages().pageslide(c,"next"),b.currentUri=f+"/?move"},"{folderRenameButton} click":function(c){var d=b.folder.of(c),e=d.data("key"),f=b.getFilename(e);EasyBlog.dialog({content:EasyBlog.ajax("site/views/mediamanager/renameFolderDialog",{current:f}),bindings:{"{submitButton} click":function(){var c=this.folderName().val();
""!=a.trim(c)&&(b.renameFolder(e,c),EasyBlog.dialog().close())}}})},"{folderRemoveButton} click":function(a){var c=b.folder.of(a),d=c.data("key"),e=b.getUri(d);EasyBlog.dialog({content:EasyBlog.ajax("site/views/mediamanager/deleteFolderDialog"),bindings:{"{submitButton} click":function(){EasyBlog.ajax("site/views/mediamanager/delete",{key:d}).done(function(){EasyBlog.dialog().close(),b.navigate(b.getParent(e)),b.removeMedia(e)}).fail(function(){})}}})},"{paginationPrevious} click, {paginationNext} click":function(a){var c=a.data("page"),d=b.getHint("loading");
EasyBlog.ajax("site/views/mediamanager/users",{page:c}).done(function(a){d.replaceWith(a)}),b.display(d)},"{file} mouseover":function(a){if("folder"!=a.data("type")){var b=EasyBlog.Composer;b.document.isLegacy()||a.data("uiDraggable")||a.draggable({helper:function(){var b=a.clone();return"image"==a.data("type")?b.addClass("layout-tile").css({width:a.outerWidth(),height:a.outerHeight()}):b.addClass("layout-list"),b},start:function(b,c){var d=c.helper;if(d.hasClass("layout-list")){var e=b.pageX-a.offset().left,f=c.helper.width(),g=e-f/2;
c.helper.css("margin-left",g)}},appendTo:b.ghosts(),connectToSortable:EBD.root})}},"{file} dragstart":function(a){{var d=a.data("key");b.getUri(d)}b.getMedia(d),b.closeMediaManager()},"{closeButton} click":function(){b.pauseVideoObject(),b.closeMediaManager()},"{closeMessageButton} click":function(){b.frame().removeClass("show-foldermove-message show-filemove-message has-messages")},pauseVideoObject:function(){a("video").length>0&&a("video").get(0).pause()}}});a("body").addController(g),b.resolve(g)})}),EasyBlog.module("mediamanager/uploader",function(a){var b=this;
EasyBlog.require().library("plupload2").done(function(){EasyBlog.Controller("MediaManager.Uploader",{elements:["[data-eb-mm-{upload-progress|upload-name|upload-size|upload-progress-value|upload-progress-bar}]","[data-eb-mm-upload-{error-text|error-retry}]"],defaultOptions:{}},function(b,c,d,e){return{init:function(){e=b.mediaManager;var c={runtimes:"html5, html4",autostart:!0},d=e.frame().htmlData("mm-uploader");b.defaultUploadOptions=a.extend(c,d)},instances:{},register:function(c,d){var d=a.extend({},b.defaultUploadOptions,d),f=c.data("key"),g=EasyBlog.MediaManager.getUri(f);
"post"==g&&(f=EasyBlog.MediaManager.getKey(EasyBlog.MediaManager.getCurrentPostUri()));var h=d.extensions.split(",");a.each(EasyBlog.MediaManager.options.types,function(b,c){a(c).filter(function(b,c){return a.inArray(c,h)})}),EasyBlog.MediaManager.options.types.file=h;var i=c.data("type")||"file";d.extensions=EasyBlog.MediaManager.options.types[i].join(","),d.url=a.uri(d.url).replaceQueryParam("key",f).toString();var j=c.plupload2(d,!1),k=j.id;return j.uri=e.getUri(f),j.container=c,b.instances[k]=j,a.each(b.plupload,function(a,d){j.bind(a,function(){d.apply(this,arguments),b.trigger("mediaUploader"+a,arguments),c.trigger("mediaUploader"+a,arguments),b.trigger("mediaUploaderChange",arguments),c.trigger("mediaUploaderChange",arguments)
})}),j.init(),j},plupload:{FileFiltered:function(a,b){b.items=[],b.addedDate=(new Date).getTime()},FilesAdded:function(a){a.settings.autostart&&a.start()},BeforeUpload:function(a,c){b.updateAllItems(c)},UploadFile:function(a,c){b.updateAllItems(c)},UploadProgress:function(a,c){b.updateAllItems(c)},ChunkUploaded:function(a,c){b.updateAllItems(c)},FileUploaded:function(c,d,e){try{var f=a.parseJSON(e.response);e.response=f}catch(g){}b.updateAllItems(d)},Error:function(c,d){var e=d.file;if(e){if("-600"==d.code)return e.status=4,e.error=d.message,EasyBlog.dialog({content:EasyBlog.ajax("site/views/composer/cancelFileSizeWarning")}),b.updateAllItems(e),b.trigger("mediaUploaderFileError",arguments),c.container.trigger("mediaUploaderFileError",arguments),void 0;
e.status=4,e.error=a.parseJSON(d.response),b.updateAllItems(e),b.trigger("mediaUploaderFileError",arguments),c.container.trigger("mediaUploaderFileError",arguments)}},FilesRemoved:function(a,c){c.status=6,b.updateAllItems(c)},Destroy:function(a){delete b.instances[a.id]},Init:a.noop,PostInit:a.noop,OptionChanged:a.noop,StateChanged:a.noop,QueueChanged:a.noop,Refresh:a.noop,UploadComplete:a.noop},getInstances:function(c){return a.map(b.instances,function(a){return a.uri==c?a:null})},getFiles:function(c){var d=b.getInstances(c),e=a.chain(d).pluck("files").flatten(!0).sortBy("addedDate").value();
return e},status:{0:"idle",1:"queued",2:"uploading",3:"unused",4:"failed",5:"done",6:"removed"},addItem:function(a,c){a.items.push(c),b.updateItem(a,c)},updateItem:function(c,d){var d=a(d),e=b.status[c.status];return d.switchClass("state-"+e),c.error?(d.find(b.errorText).html(c.error.message),d.find(b.errorRetry).off("click.mmupload.retry").on("click.mmupload.retry",function(){d.switchClass("state-idle")}),void 0):(d.find(b.uploadName).html(c.name),d.find(b.uploadSize).html(a.plupload2.formatSize(c.size)),d.find(b.uploadProgressValue).html(c.percent+"%"),d.find(b.uploadProgressBar).width(c.percent+"%"),void 0)
},updateAllItems:function(c){c.items&&a.each(c.items,function(a,d){b.updateItem(c,d)})},removeItem:function(b,c){a.pull(b.items,c)}}}),b.resolve()})}),EasyBlog.module("composer/panels/authorship",function(a){var b=this;EasyBlog.Controller("Composer.Panels.Authorship",{defaultOptions:{"{authorArea}":"[data-eb-composer-author]","{currentAuthor}":"[data-eb-composer-current-author]","{searchAssociates}":"[data-associates-search]","{cancelSearchAssociates}":"[data-associates-search-cancel]","{searchAuthor}":"[data-author-search]","{cancelSearchAuthor}":"[data-author-search-cancel]","{tab}":"[data-author-type]","{tabContent}":"[data-tab-content]","{changeAuthor}":"[data-eb-composer-switch-author]","{authorPicker}":"[data-eb-composer-author-picker]","{authorItem}":"[data-eb-author-item]","{authorList}":"[data-eb-composer-author-list]","{authorCheckbox}":"[data-eb-composer-authoritem]","{activeAuthorId}":"[data-eb-composer-authorid]","{activeAuthorAvatar}":"[data-eb-composer-authoravatar]","{activeAuthorName}":"[data-eb-composer-authorname]","{authorPrevBtn}":"[data-eb-author-prev]","{authorNextBtn}":"[data-eb-author-next]","{associatesList}":"[data-eb-composer-associates-list]","{associateItem}":"[data-associates-item]","{associateCheckbox}":"[data-associates-checkbox]","{activeAssociateName}":"[data-eb-composer-associatename]","{activeAssociateId}":"[data-eb-composer-associateid]","{activeAssociateType}":"[data-eb-composer-associatetype]","{activeAssociateAvatar}":"[data-eb-composer-associateavatar]"}},function(b){return{init:function(){},"{cancelSearchAssociates} click":function(){b.associateItem().removeClass("hide"),b.searchAssociates().val("")
},"{cancelSearchAuthor} click":function(){b.authorItem().removeClass("hide");var c=a.trim(b.searchAuthor().val());b.searchAuthor().val(""),c&&b.loadAuthors(0,"")},"{searchAssociates} keydown":a.debounce(function(c){var e=a.trim(c.val()).toLowerCase();if(!e)return b.associateItem().removeClass("hide"),void 0;var f=b.associateItem().filter(function(){var b=a.trim(a(this).data("title")).toLowerCase();return 0==b.indexOf(e)?!0:!1});f&&(b.associateItem().addClass("hide"),f.removeClass("hide"))},300),"{searchAuthor} keydown":a.debounce(function(c){var e=a.trim(c.val()).toLowerCase();
""!=e&&b.loadAuthors(0,e)},300),associatesLoaded:!1,"{tab} click":function(a){var d=a.data("type");"associates"==d&&b.loadAssociates(),b.tab().removeClass("active"),b.tab().where("type",d).addClass("active"),b.tabContent().removeClass("active"),b.tabContent().where("type",d).addClass("active")},"{changeAuthor} click":function(){return b.authorArea().toggleClass("is-opened"),b.authorPicker().toggleClass("pulled"),1==b.tab().length?(b.loadAssociates(),void 0):(b.loadAuthors("0",""),void 0)},"{authorPrevBtn} click":function(c,d){d.preventDefault();
var e=a.trim(b.searchAuthor().val()).toLowerCase(),f=a(c).data("start");f=parseInt(f),0>f&&(f=0),b.loadAuthors(f,e)},"{authorNextBtn} click":function(c,d){d.preventDefault();var e=a(c).data("start"),f=a.trim(b.searchAuthor().val()).toLowerCase();b.loadAuthors(e,f)},loadAuthors:function(c,d){var e=a("<div />",{"class":"loading-authors"});e.html('<i class="fa fa-circle-o-notch fa-spin"></i>'),b.authorList().html(e),EasyBlog.ajax("site/views/composer/listAuthors",{selected:b.activeAuthorId().val(),limitstart:c,search:d}).done(function(a){b.authorList().html(a)
})},loadAssociates:function(){b.associatesLoaded||EasyBlog.ajax("site/views/composer/listAssociates",{source_id:b.activeAssociateId().val(),source_type:b.activeAssociateType().val()}).done(function(a){b.associatesLoaded=!0,b.associatesList().html(a)})},"{authorCheckbox} change":function(a){var d=a.parents(b.authorItem.selector).data("avatar"),e=a.parents(b.authorItem.selector).data("id"),f=a.parents(b.authorItem.selector).data("title");b.setActiveAuthor(e,f,d)},"{associateCheckbox} change":function(a){var d=a.parents(b.associateItem.selector).data("avatar"),e=a.parents(b.associateItem.selector).data("id"),f=a.parents(b.associateItem.selector).data("title"),g=a.parents(b.associateItem.selector).data("type");
return"easyblog.sitewide"==g?(b.removeAssociate(),void 0):(b.setActiveAssociate(e,g,f,d),void 0)},removeAssociate:function(){b.activeAssociateId().val(0),b.activeAssociateType().val("easyblog.sitewide"),b.activeAssociateName().addClass("hidden"),b.activeAssociateAvatar().addClass("hide")},setActiveAssociate:function(a,c,d,e){b.activeAssociateId().val(a),b.activeAssociateName().html(d).removeClass("hidden"),b.activeAssociateType().val(c),b.activeAssociateAvatar().attr("src",e).removeClass("hide")},setActiveAuthor:function(a,c,d){b.activeAuthorId().val(a),b.activeAuthorName().html(c),b.activeAuthorAvatar().attr("src",d),composer.options.authorId!=a?b.currentAuthor().removeClass("hide"):b.currentAuthor().addClass("hide")
},"{self} composerValidate":function(){}}}),b.resolve()}),EasyBlog.module("composer/panels/autopost",function(a){var b=this;EasyBlog.Controller("Composer.Panels.AutoPost",{defaultOptions:{"{twitterCheckbox}":"[data-autopost-twitter]","{facebookCheckbox}":"[data-autopost-facebook]","{linkedinCheckbox}":"[data-autopost-linkedin]"}},function(b){return{init:function(){},itemUpdated:function(b){var c=a(b).is(":checked");return c?(a(b).parent().addClass("checked"),void 0):(a(b).parent().removeClass("checked"),void 0)
},"{twitterCheckbox} change":function(a){b.itemUpdated(a)},"{facebookCheckbox} change":function(a){b.itemUpdated(a)},"{linkedinCheckbox} change":function(a){b.itemUpdated(a)}}}),b.resolve()}),EasyBlog.module("composer/panels/post",function(a){var b=this;EasyBlog.Controller("Composer.Panels.Post",{defaultOptions:{"{title}":"[data-post-title]",permalink:"","{permalinkData}":"[data-permalink-data]","{permalinkInput}":"[data-permalink-input]","{savePermalink}":"[data-permalink-save]","{editPermalink}":"[data-permalink-edit]","{cancelEditPermalink}":"[data-permalink-edit-cancel]","{permalinkEditor}":"[data-permalink-editor]","{permalinkPreview}":"[data-permalink-preview]","{languageSelect}":"[data-composer-language]"}},function(b,c){return{init:function(){c.permalink=b.permalinkInput().val()
},hidePermalinkForm:function(){b.permalinkEditor().addClass("hide"),b.permalinkPreview().removeClass("hide")},showPermalinkForm:function(){b.permalinkPreview().addClass("hide"),b.permalinkEditor().removeClass("hide")},savePermalinkForm:function(){var a=b.permalinkInput().val();EasyBlog.ajax("site/views/composer/normalizePermalink",{permalink:a}).done(function(a){c.permalink=a,b.permalinkInput().val(c.permalink),b.permalinkData().html(a),b.hidePermalinkForm()})},"{languageSelect} change":function(b){var d=a(b).val();
"*"==d?a("[data-composer-association]").addClass("hide"):(a("[data-composer-association]").removeClass("hide"),a("[data-composer-association-item]").each(function(){var b=a(this),c=b.data("id"),e=b.data("code");e==d?(a(this).find("input#assoc-postname"+c).val(""),a(this).find("input#assoc-postid"+c).val(""),a(this).addClass("hide")):a(this).hasClass("hide")&&a(this).removeClass("hide")}))},"{cancelEditPermalink} click":function(){b.permalinkInput().val(c.permalink),b.hidePermalinkForm()},"{permalinkInput} keyup":function(a,c){var d=c.keyCode?c.keyCode:c.which;
13==d&&b.savePermalinkForm()},"{savePermalink} click":function(){b.savePermalinkForm()},"{editPermalink} click":function(){b.showPermalinkForm()},"{title} change":function(d){var f=a(d).val();return""!=c.permalink?!1:(b.permalinkInput().val(f),b.savePermalinkForm(),void 0)},"{self} composerSelectTemplate":function(a,c,d,e,f){e&&b.title().val(e),f&&(b.permalinkInput().val(f),b.savePermalinkForm())}}}),b.resolve()}),EasyBlog.module("composer/panels/seo",function(a){var b=this;EasyBlog.require().library("textboxlist").done(function(){EasyBlog.Controller("Composer.Panels.Seo",{defaultOptions:{"{keywordTemplate}":"[data-keyword-template]","{metaInput}":"[data-meta-description]","{metaCounter}":"[data-meta-counter]","{keywordCounter}":"[data-keyword-counter]","{textboxlist}":"[data-eb-composer-seo-keywords-textboxlist]","{autofillButton}":"[data-eb-composer-seo-keywords-autofill-button]","{jsondata}":"[data-eb-composer-keywords-jsondata]"}},function(b){return{init:function(){if(0!=b.metaInput().length){a.template("composer/textboxlist/keywords",b.keywordTemplate().detach().html()),b.textboxlist().textboxlist({component:"eb",view:{item:"composer/textboxlist/keywords"}}),b.tagger=b.textboxlist().textboxlist("controller");
var d=JSON.parse(b.jsondata().val());a.each(d,function(a,c){b.tagger.addItem(c)})}},"{textboxlist} listChange":a.debounce(function(){b.keywordCounter().html(b.tagger.getAddedItems().length)},15),"{metaInput} keyup":function(c){var e=a(c).val().length;b.metaCounter().html(e)},"{autofillButton} click":function(c){var d=b.textboxlist().textboxlist("controller"),e=EasyBlog.Composer.document.getText(),f=a(c).parent();a(f).addClass("is-loading"),EasyBlog.ajax("site/views/composer/suggestKeywords",{data:e}).done(function(c){a(f).removeClass("is-loading"),c&&(a.each(c,function(a,b){d.addItem(b.title)
}),b.metaCounter().text(c.length))})},"{self} composerSave":function(c,d,e){e.data.keywords=0==b.metaInput().length?"":a.pluck(b.tagger.getAddedItems(),"title").join(", ")}}}),b.resolve()})}),EasyBlog.module("composer/panels",function(a){var b=this;EasyBlog.Controller("Composer.Panels",{hostname:"panels",defaultOptions:{"{panel}":"[data-eb-composer-panel]","{panelTab}":"[data-eb-composer-panel-tab]","{showDrawer}":"[data-eb-composer-panel-show-drawer]","{fieldset}":".eb-composer-fieldset","{fieldsetToggle}":".eb-composer-fieldset-toggle input"}},function(b){return{init:function(){var c=["autopost","association","seo","post","category","authorship"];
a.each(c,function(a,c){b.addPlugin(c)})},panel:{get:a.memoize(function(a){return b.panel().where("id",a)})},panelTab:{get:a.memoize(function(a){return b.panelTab().where("id",a)})},fieldset:{get:function(a){return b.fieldset().where("name",a)},enable:function(a,c){void 0===c&&(c=!0),b.fieldset.get(a).toggleClass("is-disabled",!c).find(b.fieldsetToggle).prop("checked",!!c)},disable:function(a,c){void 0===c&&(c=!1),b.fieldset.enable(a,c)},show:function(a){b.fieldset.get(a).removeClass("is-hidden")},hide:function(a){b.fieldset.get(a).addClass("is-hidden")
},toggle:function(a,c){b.fieldset.get(a).toggleClass("is-hidden",void 0===c?void 0:!c)}},activate:function(a){b.deactivate(),b.panel.get(a).addClass("active"),b.panelTab.get(a).addClass("active"),b.trigger("composerPanelActivate",[a])},deactivate:function(a){a||(a=b.panel(".active").data("id")),b.panel.get(a).removeClass("active"),b.panelTab.get(a).removeClass("active"),b.trigger("composerPanelDeactivate",[a])},"{panelTab} click":function(a){var c=a.data("id");b.activate(c)},"{showDrawer} click":function(){a("[data-eb-composer-frame]").toggleClass("show-drawer")
},"{fieldsetToggle} change":function(a){b.fieldset.of(a).toggleClass("is-disabled",!a.is(":checked"))}}}),b.resolve()}),EasyBlog.module("composer/posts",function(a){var b=this;EasyBlog.Controller("Composer.Posts",{elements:["[data-eb-posts-{close-button}]","[data-eb-composer-{posts}]","[data-eb-composer-posts-{search-toggle-button|search-cancel-button}]"],defaultOptions:{"{searchPanel}":"[data-eb-composer-sidebar-search-panel]","{hideSearch}":"[data-eb-composer-sidebar-search-cancel-button]","{wrapper}":"[data-eb-composer-posts]","{result}":"[data-eb-composer-posts-result]","{searchTextfield}":"[data-eb-composer-posts-search-textfield]","{openPostButton}":"[data-eb-composer-open-post]","{insertLinkButton}":"[data-eb-composer-insert-link]","{openMediaButton}":"[data-eb-composer-open-media]","{postTitle}":"[data-eb-composer-posts-item-title]"}},function(b,c,d,e){return{loaded:!1,initialResult:null,init:function(){e=b.composer,blocks=e.blocks,blocks.loadBlockHandler("post")
},"{closeButton} click":function(){b.hideViewport()},"{searchTextfield} keydown":a.debounce(function(c){var d=a.trim(c.val());return d.length<1?(b.wrapper().removeClass("searching"),void 0):(b.wrapper().removeClass("empty"),b.wrapper().addClass("searching"),EasyBlog.ajax("site/views/search/search",{query:d}).done(function(a){return b.wrapper().removeClass("searching"),0==a.length?(b.wrapper().addClass("empty"),void 0):(b.result().append(a),void 0)}).fail(function(){}),void 0)},500),insertPostLink:function(){},hideViewport:function(){e.views.hide("posts")
},"{searchToggleButton} click":function(){b.posts().addClass("is-searching")},"{searchCancelButton} click":function(){b.posts().removeClass("is-searching")},"{toggleSearch} click":function(){b.searchPanel().toggleClass("active")},"{hideSearch} click":function(){b.searchPanel().toggleClass("active"),b.wrapper().removeClass("empty"),b.searchTextfield().val(""),b.result().html(b.initialResult)},"{insertLinkButton} click":function(c){var e=EasyBlog.Composer.getDoctype(),f=c.data("title"),g=c.data("permalink"),h=c.data("image"),i=c.data("content");
if("ebd"==e){var j=blocks.constructBlock("post",{title:f,url:g,image:h,intro:i});blocks.addBlock(j)}else link=a.create("a").attr({href:g,title:f}).html(f),EasyBlog.LegacyEditor.insert(link.toHTML());b.hideViewport()},"{postTitle} click":function(c){var e=a(c).data("title"),f=a(c).data("permalink");b.insert(f,e)},"{composer} composerViewShow":function(a,c,d){"posts"!==d||b.loaded||(b.posts().addClass("is-loading"),EasyBlog.ajax("site/views/composer/listArticles",{exclude:e.getPostId()}).done(function(a){return b.posts().removeClass("is-loading"),b.loaded=!0,0==a.length?(b.posts().addClass("is-empty"),void 0):(b.posts().addClass("is-ready"),b.initialResult=a,b.result().append(a),void 0)
}).fail(function(){}))},"{composer} sidebarDeactivate":function(a,b,c){}}}),b.resolve()}),EasyBlog.module("composer/tags",function(a){var b=this,c={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,ENTER:13,ESCAPE:27,LEFT:37,RIGHT:39,SPACE:32,TAB:9,UP:38},d={38:"up",40:"down",37:"left",39:"right"};EasyBlog.require().library("textboxlist","nearest","scrollTo").done(function(){EasyBlog.Controller("Composer.Tags",{elements:["[data-eb-composer-tags-{textboxlist}]"],defaultOptions:{templates:{},"{tagTemplate}":"[data-tag-template]",pagination:30,"{tags}":"[data-eb-composer-tags]","{tag}":".textboxlist-item","{total}":"[data-eb-composer-tags-total]","{count}":"[data-eb-composer-tags-count]","{suggestions}":".eb-composer-tags-suggestions","{selection}":".eb-composer-tags-selection","{toggleButton}":"[data-eb-composer-tags-toggle-button]","{autofillButton}":"[data-eb-composer-tags-autofill-button]","{itemgroup}":".eb-composer-tags-selection-itemgroup","{item}":".eb-composer-tags-selection-itemgroup > div","{textfield}":"[data-textboxlist-textField]","{jsondata}":"[data-eb-composer-tags-jsondata]"}},function(b,e,f,g,h,i){return{init:function(){if("0"!=EasyBlog.Composer.options.tags.enabled){a.template("composer/textboxlist/item",b.tagTemplate().detach().html()),h=b.selection,g=b.suggestions;
var c=parseInt(b.tags().attr("data-eb-composer-tags-max"))||null;b.textboxlist().textboxlist({component:"eb",max:c,ignoreLocked:!0,view:{item:"composer/textboxlist/item"},filterItem:function(b){return a.isString(b)?i.sanitize(b):(b.title=i.sanitize(b.title),b)}}),i=b.tagger=a.extend(b.textboxlist().textboxlist("controller"),b.tagger),g.populate("",!0);for(var d=0,e=JSON.parse(b.jsondata().val());existingTag=e[d++];)i.addItem({id:existingTag.id,title:existingTag.title,key:i.getItemKey(existingTag.title),locked:!1});
window.tagz=b}},tagger:{sanitize:function(b){return a.trim(b).replace(/,/g,"")},addLockedItem:function(b){b=a.trim(b);var c=i.get(b),d=c&&!c.locked;c&&i.deleteItem(c.id),i.addItem({id:a.uid("item-"),title:b,key:i.getItemKey(b),locked:!0,assigned:d},!0)}},"{textfield} keydown":function(a,e){var f=e.which,i=h.activeItem;switch(f){case c.UP:case c.DOWN:case c.LEFT:case c.RIGHT:var j=d[f];(i.length>0||"down"==j)&&(g.navigate(j),e.preventDefault());break;case c.ESCAPE:i.length>0?h.deactivate(i):b.suggestions().hasClass("is-showing")?g.collapse():a.val("");
break;case c.ENTER:i.length>0&&(h.use(i),e.preventDefault());break;default:g.populateFromTextfield()}},"{item} mouseover":function(a){h.deactivate(),h.activate(a)},"{item} click":function(a){h.use(a)},"{textboxlist} addItem":function(b,c,d){a(h.get(d.title)).addClass("is-used")},"{textboxlist} removeItem":function(b,c,d){d.assigned?i.addItem(d.title):a(h.get(d.title)).removeClass("is-used")},"{textboxlist} listChange":a.debounce(function(){g.refresh();var a=b.tagger.getAddedItems().length;b.count().text(a)},15),"{self} categoryselect":function(b,c,d){if(!(d.tags.length<=0)){var e=(d.tags||"").split(",");
a.each(e,function(a,b){i.addLockedItem(b)})}},"{self} categorydeselect":function(c,d,e){if(!(e.tags.length<=0)){var f=b.composer.category.toArray(),g=(e.tags||"").split(","),h=a.pluck(f,"tags").join(",").split(","),j=a.without.apply(null,[g].concat(h));a.each(j,function(a,b){var c=i.get(b);c&&i.removeItem(c.id)})}},"{toggleButton} click":function(){g[b.suggestions().hasClass("is-showing")?"collapse":"expand"]()},"{autofillButton} click":function(c){var d=b.composer.document.getText(),e=a(c).parent();a(e).addClass("is-loading"),EasyBlog.ajax("site/views/composer/suggestKeywords",{data:d}).done(function(b){a(e).removeClass("is-loading"),b&&a.each(b,function(a,b){i.addItem(b.title)
})})},suggestions:{index:0,tags:[],expand:function(){g.tick++,b.suggestions().addClass("is-showing")},collapse:function(){g.tick++,b.suggestions().removeClass("is-showing")},refresh:function(){var a=b.item(":not(.is-used)");b.suggestions().toggleClass("is-empty",a.length<1),g.count()},show:function(){g.tick++,g.refresh(),g.expand()},hide:function(){var a=++g.tick;g.collapse(),setTimeout(function(){a===g.tick&&g.reset()},500)},set:function(a){a.length<1?(g.hide(),g.tags=[]):(g.reset(),g.tags=a)},reset:function(){g.tags=[],g.i=0,b.itemgroup().empty()
},pid:0,tick:0,currentQuery:null,query:a.memoize(function(a){return EasyBlog.ajax("site/views/tags/suggest",{search:a}).fail(function(){g.query.reset(a)})}),populate:function(a,c){g.tick++;var d=++g.pid;g.currentQuery&&g.currentQuery.abort(),a=i.sanitize(a),b.suggestions().addClass("is-busy"),g.currentQuery=g.query(a).done(function(a){g.pid===d&&(g.set(a),g.suggest(c))}).fail(function(){g.pid!==d}).always(function(){b.suggestions().removeClass("is-busy"),g.currentQuery=null})},populateTimer:null,populateFromTextfield:function(){g.tick++,clearTimeout(g.populateTimer),setTimeout(function(){var a=b.textfield(),c=i.sanitize(a.val());
""===c?(g.hide(),g.populate("",!0)):g.query.cache.hasOwnProperty(c)?g.populate(c):g.populateTimer=setTimeout(function(){g.populate(c)},250)},1)},suggest:function(c){var d=g.tags;if(!(d.length<1)){for(var k,l,n,f=0,j=e.pagination,m=[];j>f&&(k=d[g.i]);)l=k.title,n=h.get(l)||h.create(l),m.push(n),i.get(l)?a(n).addClass("is-used"):f++,g.i++;b.itemgroup().append(m),c?g.refresh():g.show()}},navigate:function(c){var d=b.item(),e=b.itemgroup(),f=h.activeItem,i=a(f[0]||b.textfield()[0]).nearest(d,c);i.length>0?(h.activate(i),e.scrollIntoView(i)):f.length>0&&("down"==c&&(g.suggest(),e.scrollIntoView(f)),"up"==c&&h.deactivate())
},count:function(){var c=a.pluck(g.tags,"title"),d=a.keys(i.itemsByTitle),e=a.without.apply(null,[c].concat(d)),f=e.length;b.total().text(f+"")}},selection:{items:{},activeItem:a(),create:function(a){var b=document.createElement("div");return b.innerHTML=a,h.items[a]=b},get:function(a){return h.items[a]},activate:function(a){h.deactivate(),h.activeItem=a.addClass("active")},deactivate:function(){h.activeItem.removeClass("active"),h.activeItem=a()},use:function(c){var c=a(c),d=c.text(),e=i.addItem(d);e&&(b.textfield().focus(),c.is(h.activeItem)&&(nextItem=c.next(b.item)[0]||c.prev(b.item)[0],h.deactivate(c),nextItem&&h.activate(a(nextItem))),g.refresh())
}},"{self} composerSave":function(c,d,e){if("0"!=EasyBlog.Composer.options.tags.enabled){var f=b.tagger.getAddedItems();e.data.tags=a.pluck(f,"title").join(",")}}}}),b.resolve()})}),EasyBlog.module("composer/templates",function(a){var b=this;EasyBlog.Controller("Composer.Templates",{defaultOptions:{"{updateTemplate}":"[data-eb-composer-update-template-button]","{templateId}":"[data-eb-composer-template-id]","{saveNewTemplate}":"[data-eb-composer-save-template-button]","{selectTemplate}":"[data-template-item]","{templateBlocks}":"[data-template-blocks]","{deleteTemplate}":"[data-template-delete]","{posts}":"[data-eb-composer-posts]","{searchTextfield}":"[data-eb-composer-posts-search-textfield]","{itemGroup}":"[data-eb-composer-posts-item-group]","{list}":"[data-eb-composer-templates-list]"}},function(b,c,d,e){return{init:function(){e=b.composer
},selectedTemplate:function(a){e.manager().addClass("is-editing-template"),b.templateId().val(a)},"{selectTemplate} click":function(a){var c=a.data("uid"),d=a.data("blank");return d?(e.frame().removeClass("show-templates"),void 0):(EasyBlog.ajax("site/views/composer/renderTemplate",{uid:c}).done(function(a,d,f){b.selectedTemplate(c),f&&e.document.loadDocument(f),e.frame().removeClass("show-templates"),b.trigger("composerSelectTemplate",[c,a,d,f])}),void 0)},"{deleteTemplate} click":function(a,c){c.stopPropagation();
var d=a.parents(b.selectTemplate.selector),e=d.data("uid");EasyBlog.dialog({content:EasyBlog.ajax("site/views/templates/confirmDelete",{id:e,deleteAction:"ajax"}),bindings:{"{submitButton} click":function(){EasyBlog.ajax("site/controllers/templates/delete",{ids:[e]}).done(function(){EasyBlog.dialog().close(),d.remove()})}}})},save:function(c){var d=a.Task();e.getSaveData(d.data),b.trigger("composerSave",[d,e]),c.template_id&&a.extend(d.data,{template_id:c.template_id}),c.title&&a.extend(d.data,{template_title:c.title}),c.system&&a.extend(d.data,{system:c.system}),d.process().done(function(){EasyBlog.ajax("site/views/templates/save",d.data).done(function(a,c){b.selectedTemplate(c.id),b.trigger("composerSave",[d,e,c]),e.setMessage(a)
})})},"{updateTemplate} click":function(){var c=b.templateId().val();b.save({template_id:c})},"{saveNewTemplate} click":function(){EasyBlog.dialog({content:EasyBlog.ajax("site/views/templates/saveTemplateDialog"),bindings:{"{submitButton} click":function(){var a=this.system().is(":checked")?1:0;b.save({template_id:"0",title:this.title().val(),system:a}),EasyBlog.dialog().close()}}})},"{composer} composerSidebarActivate":function(a,c,d){"templates"===d&&EasyBlog.ajax("site/views/templates/listTemplates",{}).done(function(a){return 0==a.length?(b.posts().addClass("empty"),void 0):(b.insertTemplates(a),void 0)
}).fail(function(){})},"{composer} composerSaveTemplate":function(){},"{composer} sidebarDeactivate":function(a,b,c){}}}),b.resolve()}),EasyBlog.module("composer",function(a){var b=this,c=window.EBD={};c.root=".ebd",c.block=".ebd-block:not(is-helper):not(.is-placeholder):not(.is-dropzone)",c.childBlock="> "+c.block,c.nest=".ebd-nest",c.nestedBlock=c.block+".is-nested",c.immediateNestedBlock=c.nestedBlock+":not("+c.nest+" "+c.nest+" "+c.nestedBlock+")",c.standaloneBlock=c.block+".is-standalone",c.isolatedBlock=c.block+".is-isolated",c.workarea="[data-ebd-workarea]",c.dropzone="[data-ebd-dropzone]",c.blockToolbar="[data-ebd-block-toolbar]",c.blockSortHandle="[data-ebd-block-sort-handle]",c.blockViewport="[data-ebd-block-viewport]",c.blockContent="[data-ebd-block-content]",c.immediateBlockSortHandle="> "+c.blockToolbar+" > "+c.blockSortHandle,c.immediateBlockViewport="> "+c.blockViewport,c.immediateBlockContent=c.immediateBlockViewport+"> "+c.blockContent,c.editableContent=c.block+".is-editable [contenteditable=true]",c.selectors={"{workarea}":c.workarea,"{root}":c.workarea+" "+c.root,"{nest}":c.workarea+" "+c.root+" "+c.nest,"{block}":c.workarea+" "+c.root+" "+c.block,"{dropzone}":c.workarea+" "+c.root+" "+c.dropzone};
var e=3,f=4,g=1,i=0;EasyBlog.require().library("scrolly","history").script("composer/debugger","composer/document","composer/blocks","composer/category","composer/tags","composer/revisions","composer/media","composer/posts","composer/templates","composer/blogimage","composer/location","composer/panels","composer/panels/post","composer/panels/authorship","composer/panels/category","composer/panels/seo","composer/panels/autopost").done(function(){EasyBlog.Controller("Composer",{hostname:"composer",pluginExtendsInstance:!0,elements:["[data-eb-composer-{frame|manager|actions|form|ghosts|alerts|saving-redirect-message|saving-message|saving-info-message|saving-progress-bar|saving-close-button|saving-entry-button|apply-post-button|publish-post-button|update-post-button|submit-post-button|reject-post-button|approve-post-button|preview-post-button|save-post-button|unpublish-post-button|delete-post-button|published-field}]","[data-eb-composer-{views|view|viewport|viewport-content}]","[data-eb-composer-{autosave|autosave-message}]","[data-eb-{alert-template}]","[data-eb-composer-toolbar-{messages}]","[data-eb-composer-{close-message}]"],defaultOptions:{templates:{},postUid:null,authorId:null,"{retryButton}":"[data-eb-composer-instance-entry-button]"}},function(b,c,d,h){return{saveOptions:{autosave:!1,showSaveMessage:!0,updateRevisionStatus:!0,updateAddressBar:!0},init:function(){try{window.parent.EasyBlog.ComposerLauncher.ready()
}catch(e){}a(window).on("beforeunload",function(a){return a.preventDefault(),!1}),c.templates.alert=b.alertTemplate().detach().html(),h=b.frame(),c.authorId=h.data("author-id"),d.noscroll(),EasyBlog.Composer=b,a.extend(c,h.htmlData("eb-composer")),b.installPlugins(["debugger","media","templates","blocks","posts","panels","document","blogimage","location","artboard","tags","category","revisions"]),b.keepalive.start(),1!=c.autosave.enabled||b.frame().hasClass("show-templates")||b.autosave.start(),EasyBlog.debug&&b.debugger.activate(),b.trigger("composerReady")
},"{self} composerDocumentReady":function(){b.frame().removeClass("is-loading")},installPlugins:function(c){a.each(c,function(a,c){b.addPlugin(c)})},settings:{get:function(a){return d.find("input[name='"+a+"']").val()},set:function(a,c){return d.find("input[name='"+a+"']").val(c),b.trigger("composerSettingsChange",[a,c]),c}},getPostId:function(){return h.attr("data-post-id")},getPostUid:function(){return h.attr("data-post-uid")},getRevisionId:function(){return b.getPostUid().split(".")[1]},getDoctype:function(){return h.attr("data-post-doctype")
},views:{show:function(a){h.switchClass("view-"+a),b.view().removeClass("active").where("name",a).addClass("active"),"revisions"==a&&b.manager().removeClass("has-messages"),b.trigger("composerViewShow",[a])},hide:function(a){b.trigger("composerViewHide",[a]),b.views.show("document")}},keepalive:{timer:null,start:function(d){var e=b.keepalive,d=d||c.keepalive.interval;e.stop(),1>d||(e.timer=a.delay(function(){e.run(d)},d))},run:function(a){EasyBlog.ajax("site/views/composer/keepAlive").always(function(){b.keepalive.start(a)
})},stop:function(){clearTimeout(b.keepalive.timer)}},autosave:{timer:null,counter:0,start:function(d){var e=b.autosave,d=d||c.autosave.interval;e.stop(),1>d||!d||(e.timer=a.delay(function(){e.run(d)},d))},run:function(a){b.autosave.save(),b.autosave.start(a)},stop:function(){clearTimeout(b.autosave.timer)},save:function(){b.saving||(0==b.autosave.counter&&b.publishedField().val(e),b.autosave.counter++,b.save({autosave:!0,showSaveMessage:!1}).done(function(a,c){200==c.code&&(b.autosave().removeClass("hide"),b.autosaveMessage().html(c.message))
}))}},validate:function(){var c=a.Task();return b.trigger("composerValidate",[c]),c.process().done(function(){}).fail(function(){var d=c.list,e=[];a.each(d,function(a,b){"rejected"==b.state()&&b.fail(function(a){e.push(a)})}),b.setMessage(e)}),c},"{self} composerValidate":function(){},saving:!1,getSaveData:function(c){b.form().each(function(){var b=a(this).serializeObject();a.extend(c,b)})},save:function(c){if(!b.saving){b.saving=!0;var e=a.Deferred();return d.addClass("is-saving"),b.validate().done(function(){c=a.extend(b.saveOptions,c);
var f=a.Task();f.data.autosave=c.autosave?c.autosave:0,b.initSaving(c.autosave),b.updateProgressBar("15"),c.isapply?f.data.isapply=c.isapply:(f.data.isapply=0,c.updateAddressBar=0),b.getSaveData(f.data),b.trigger("composerSave",[f,b]),b.updateProgressBar("25"),f.process().done(function(){b.updateProgressBar("35"),EasyBlog.ajax("site/controllers/posts/save",f.data).done(function(a,e,f,i){if(b.updateProgressBar("65"),!c.isapply&&c.showSaveMessage&&b.setMessage(e),b.trigger("composerSaveSuccess",a),c.updateRevisionStatus){var j=d.find("[data-eb-revisions-fieldset]");
j.children().html(f),composer.revisions.preventParentScrolling()}c.isapply&&c.updateAddressBar&&History.pushState({state:1},"",i),b.publishedField().val()==g&&b.manager().removeClass("revision-draft").addClass("revision-finalized"),b.updateProgressBar("85"),d.find(".eb-composer-actions input[name=uid]").val(a.uid),d.find(".eb-composer-actions input[name=revision_id]").val(a.revision_id),h.attr("data-post-uid",a.uid),b.doneSaving(c.isapply,c.autosave,e.message)}).fail(function(a){b.manager().removeClass("is-saving is-auto-saving"),b.setMessage(a),b.trigger("composerSaveError",[a])
}).always(function(){b.saving=!1}).done(e.resolve).fail(e.reject)}).fail(function(){b.manager().removeClass("is-saving is-auto-saving"),b.trigger("composerSaveError"),b.saving=!1}).always(function(){d.removeClass("is-saving is-auto-saving")})}).fail(function(){b.saving=!1,d.removeClass("is-saving")}),e}},trash:function(){EasyBlog.dialog({content:EasyBlog.ajax("site/views/composer/confirmDelete",{uid:b.getPostUid()})})},setMessage:function(c){a.isArray(c)||(c=[c]),a.each(c,function(a,c){b.manager().addClass("has-messages");
var d="green";/error|danger/.test(c.type)&&(d="red"),/success/.test(c.type)&&(d="green"),b.messages().switchClass("style-"+d),b.messages().find("[data-message]").html(c.message)})},"{closeMessage} click":function(){b.manager().removeClass("has-messages")},"{previewPostButton} click":function(){var a=b.publishedField().val();a!=f&&b.publishedField().val(e),b.save({autosave:0,isapply:1}).done(function(a,b,c,d,e){window.open(e)}).always(function(){})},"{savePostButton} click":function(a){var c=b.publishedField().val();
c!=f&&b.publishedField().val(e),a.addClass("is-saving"),b.save({autosave:1,isapply:0}).done(function(){}).always(function(){a.removeClass("is-saving")})},"{submitPostButton} click":function(){b.disableLeavePrompt(),b.publishedField().val(f),b.save({autosave:0,isapply:0})},"{approvePostButton} click":function(a){b.publishedField().val(g),a.addClass("is-saving"),b.disableLeavePrompt(),b.save({autosave:0,isapply:0}).done(function(){}).always(function(){a.removeClass("is-saving")})},"{rejectPostButton} click":function(){b.publishedField().val(e),b.disableLeavePrompt(),b.save({autosave:0,isapply:0}).done(function(){})
},"{publishPostButton} click":function(a){b.publishedField().val(g),a.addClass("is-saving"),b.disableLeavePrompt(),b.save({autosave:0,isapply:0}).done(function(){}).always(function(){a.removeClass("is-saving")})},"{applyPostButton} click":function(a){b.publishedField().val(g),a.addClass("is-saving"),b.save({autosave:0,isapply:1}).done(function(){}).always(function(){a.removeClass("is-saving")})},"{updatePostButton} click":function(a){b.publishedField().val(g),b.disableLeavePrompt(),a.addClass("is-saving"),b.save({autosave:0,isapply:0}).done(function(){}).always(function(){a.removeClass("is-saving")
})},"{unpublishPostButton} click":function(){b.publishedField().val(i),b.save({autosave:0,isapply:0})},"{deletePostButton} click":function(){b.trash()},"{self} composerSelectTemplate":function(){setTimeout(function(){b.autosave.start()},5e3)},"{savingEntryButton} click":function(){b.disableLeavePrompt();var a=b.savingEntryButton().attr("href");EasyBlog.ComposerLauncher.redirect(a)},"{savingCloseButton} click":function(){b.manager().removeClass("is-saving")},initSaving:function(a){a?b.manager().addClass("is-auto-saving"):(b.manager().removeClass("is-auto-saving"),b.savingEntryButton().addClass("hide"),b.savingCloseButton().addClass("hide"),b.savingProgressBar().removeClass("hide"),b.savingInfoMessage().text(""),b.savingInfoMessage().addClass("hide"),b.savingMessage().removeClass("hide"),b.manager().addClass("is-saving"))
},doneSaving:function(a,c,d){if(b.updateProgressBar("100"),b.savingMessage().addClass("hide"),b.savingInfoMessage().text(d),b.savingInfoMessage().removeClass("hide"),c)b.manager().removeClass("is-auto-saving");else if(a)b.savingEntryButton().removeClass("hide"),b.savingCloseButton().removeClass("hide"),b.savingMessage().addClass("hide");else{b.disableLeavePrompt(),b.savingRedirectMessage().removeClass("hide");var e=b.savingEntryButton().attr("href");EasyBlog.ComposerLauncher.redirect(e)}},disableLeavePrompt:function(){a(window).off("beforeunload"),a(window).unbind("beforeunload"),window.onbeforeunload=function(){}
},updateProgressBar:function(a){b.savingProgressBar().children(".progress-bar").css("width",a+"%")}}}),a("body").addController("EasyBlog.Controller.Composer"),b.resolve()})}),EasyBlog.module("composer/revisions",function(a){var b=this;EasyBlog.Controller("Composer.Revisions",{defaultOptions:{"{revisionsFieldset}":"[data-eb-revisions-fieldset]","{revisionToggle}":"[data-eb-revisions-dropdown-toggle]","{revisionDropdown}":"[data-eb-pilot-dropdown]","{revisionHandler}":"[data-eb-revisions-handler]","{revisionList}":"[data-eb-revisions-list]","{closeComparison}":"[data-revisions-close-comparison]","{compareScreen}":"[data-eb-composer-revisions-compare-screen]","{item}":"[data-eb-composer-revisions-item]","{compareRevision}":"[data-eb-composer-revisions-compare]","{openRevision}":"[data-eb-composer-revisions-open]","{useRevision}":"[data-eb-composer-revisions-use]","{deleteRevision}":"[data-eb-composer-revisions-delete]","{revisionBlocks}":".eb-composer-revisions .ebd-block"}},function(b,c,d,e,f,g){return{init:function(){e=b.composer,g=e.panels,f=e.blocks,b.preventParentScrolling()
},preventParentScrolling:function(){b.revisionList().on("mousewheel",function(a){a.stopPropagation()})},"{item} click":function(a){var c=a.hasClass("active");a.hasClass("is-current")||(b.item().removeClass("active"),a.toggleClass("active",!c))},revisionsLoaded:!1,getRevisionItem:function(c){var d=a(c).parents(b.item.selector);return d},"{revisionBlocks} mouseover":function(b){var d=a(b).data("uid"),e=f.getBlock(d);f.highlight(e)},"{revisionBlocks} mouseout":function(b){var d=a(b).data("uid"),e=f.getBlock(d);
f.unhighlight(e)},"{closeComparison} click":function(){e.views.show("document"),b.compareScreen().html("")},"{compareRevision} click":function(c){e.views.show("revisions");var f=b.getRevisionItem(c),g=a(f).data("id"),h=EasyBlog.Composer.getRevisionId();EasyBlog.ajax("site/views/revisions/compare",{current:h,target:g}).done(function(a){b.compareScreen().html(a)})},"{useRevision} click":function(c){var e=b.getRevisionItem(c),f=a(e).data("id");EasyBlog.dialog({content:EasyBlog.ajax("site/views/revisions/confirmUseRevision",{uid:EasyBlog.Composer.getPostId()+"."+f})})
},"{deleteRevision} click":function(c){var e=a(c).parents(b.item.selector),f=a(e).data("id");EasyBlog.dialog({content:EasyBlog.ajax("site/views/revisions/deleteRevision",{id:f}),bindings:{"{submitButton} click":function(){EasyBlog.ajax("site/controllers/posts/deleteRevision",{id:f}).done(function(){a(e).remove(),EasyBlog.dialog().close()})}}})},"{revisionToggle} click":function(){b.revisionsFieldset().toggleClass("show-revision-list"),EasyBlog.ajax("site/views/revisions/getRevisions",{uid:EasyBlog.Composer.getPostUid()}).done(function(a){b.revisionsLoaded=!0,b.revisionList().html(a)
})},"{composer} composerSaveSuccess":function(){b.revisionsLoaded=!1}}}),b.resolve()}),EasyBlog.module("composer/panels/category",function(){var b=this;EasyBlog.require().done(function(a){EasyBlog.Controller("Composer.Panels.Category",{defaultOptions:{fields:null,templates:{},"{template}":"[data-category-primary-template]","{fieldsTab}":"[data-eb-composer-panel-tab][data-id=fields]","{fieldsPanel}":"[data-eb-composer-panel][data-id=fields]","{fieldsPanelForm}":"[data-eb-composer-panel][data-id=fields] [data-eb-composer-form]","{fieldsForm}":"[data-eb-composer-panel-fields]","{empty}":"[data-eb-composer-fields-empty]","{categories}":"[data-category-primary-items]","{category}":"[data-category-primary-item]","{categoryText}":"[data-title-text]","{primaryCategoryInput}":"[data-category-primary-input]","{primaryCategoryTitle}":"[data-category-primary-title]"}},function(b,c,d,e){return{init:function(){c.templates.primaryCategory=b.template().detach().html(),e=EasyBlog.Composer
},getTemplate:function(b){var d=a(c.templates[b]);return d},insertCategory:function(a){var c=b.getTemplate("primaryCategory");c.attr("data-title",a.title).attr("data-id",a.id).find(b.categoryText).html(a.title),b.categories().append(c)},removeCategory:function(c){if(1!=b.categories().children().length&&(b.categories().children('[data-id="'+c.id+'"]').remove(),1==b.categories().children().length||c.id==b.primaryCategoryInput().val())){var d=a(b.categories().children()[0]),e=d.data("id"),f=d.data("title");b.assignPrimaryCategory(e,f)
}},assignPrimaryCategory:function(a,c){b.primaryCategoryInput().val(a),b.primaryCategoryTitle().html(c);var d={id:a,title:c};b.trigger("categorysetprimary",d)},categoryExists:function(a){var a=b.categories().children('[data-id="'+a.id+'"]');return a.length>0},"{category} click":function(a){var d=a.data("id"),e=a.data("title");b.assignPrimaryCategory(d,e)},"{self} categorydeselect":function(a,c,d){b.fieldsPanel().find('[data-category-id="'+d.id+'"]').remove(),0==b.fieldsPanel().find("[data-panel-field]").length&&b.empty().show(),b.removeCategory(d)
},"{self} categoryselect":function(a,c,d){b.categoryExists(d)||b.insertCategory(d),EasyBlog.ajax("site/views/categories/getCustomFields",{id:d.id,postId:EasyBlog.Composer.getPostId()}).done(function(a){if(a.length>0){var c=e.panels.panelTab.get("fields");c.removeClass("hide"),b.empty().hide(),b.fieldsPanelForm().append(a)}})},"{self} composerSaveError":function(a,c,d){d.customCode&&-500==d.customCode?b.fieldsTab().addClass("has-error"):b.fieldsTab().removeClass("has-error")}}}),b.resolve()})})});